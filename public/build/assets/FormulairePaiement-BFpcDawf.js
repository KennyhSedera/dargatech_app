import{r as w,j as e,e as K,q as J,v as W,$ as Z}from"./app-clMDA67x.js";import{I as n}from"./InputLabel-BtJ_EI82.js";import{T as d,I as j}from"./TextInput-Dc4aDVti.js";import{u as E}from"./useTheme-BIKk6cg-.js";import{D as ee}from"./DangerButton-QSzsQmjX.js";import{g as te}from"./TypePaiementService-DeNLarXH.js";import{b as ae,a as se}from"./clientService-BZcx74pk.js";import{P as le}from"./PrimaryButton-CtQBZZip.js";import{T as ne}from"./TextArea-5LFm12Ib.js";import{S as M}from"./SelectInput-tSz_y1-7.js";import{I as re}from"./InputAutocomplete -BwK5b4kU.js";import{a as oe,b as ie,u as ce,c as me}from"./PaiementService-rFuNb3VT.js";import{S as ue}from"./Snackbar-jsmHZbT6.js";import{F as de}from"./FichierPaiementPdf-BRQTrcks.js";import{B as he,h as Y}from"./constant-BMpCbHf-.js";import"./createLucideIcon-TXl_3ZLp.js";import"./api-vU-7hkGc.js";import"./iconBase-DgEeITKv.js";const pe=({data:m,setData:c})=>{const[l,r]=w.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);w.useEffect(()=>{m.produits&&m.produits.length>0&&r(m.produits)},[m.produits]);const o=s=>{const t=parseFloat(s.quantite)||0,i=parseFloat(s.prix_unitaire)||0,x=parseFloat(s.tva)||0,k=t*i,b=k*(1+x/100);return{total_ht:k,total_ttc:b}},a=(s,t,i)=>{const x=[...l];if(x[s][t]=i,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:b,total_ttc:C}=o(x[s]);x[s].total_ht=b,x[s].total_ttc=C}r(x);const k={produits:x,description:m.description||"",montant_paye:g(x).totalTTCGlobal.toFixed(2)};c(b=>({...b,...k}))},g=s=>{const t=b=>{const C=parseFloat(b);return isNaN(C)?0:C},i=s.reduce((b,C)=>b+t(C.total_ht),0),x=s.reduce((b,C)=>b+t(C.total_ttc),0),k=s.reduce((b,C)=>{const D=t(C.tva),S=t(C.total_ht);return b+S*D/100},0);return{totalHTGlobal:parseFloat(i.toFixed(2)),totalTTCGlobal:parseFloat(x.toFixed(2)),totalTVAGlobal:parseFloat(k.toFixed(2))}},{totalHTGlobal:f,totalTTCGlobal:O,totalTVAGlobal:N}=g(l),A=()=>{const s=[...l,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];r(s),c(t=>({...t,produits:s}))},$=s=>{const t=l.filter((x,k)=>k!==s);r(t);const i=g(t);c(x=>({...x,produits:t,montant_paye:i.totalTTCGlobal.toFixed(2)}))},F=s=>{const t=s.target.value;c(i=>({...i,description:t}))},T=s=>{const t=parseFloat(s);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[e.jsx("div",{className:"block lg:hidden",children:l.map((s,t)=>e.jsxs("div",{className:"relative p-4 mb-4 border border-gray-200 rounded-lg",children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full -top-2 -right-2",onClick:()=>$(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(n,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(d,{id:`designation-${t}`,name:"designation",value:s.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:i=>a(t,"designation",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(d,{id:`reference-${t}`,name:"reference",value:s.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:i=>a(t,"reference",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:s.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:i=>a(t,"quantite",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(d,{id:`unite-${t}`,name:"unite",value:s.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:i=>a(t,"unite",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(d,{id:`tva-${t}`,name:"tva",value:s.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:i=>a(t,"tva",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:s.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:i=>a(t,"prix_unitaire",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(s.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(s.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t))}),e.jsx("div",{className:"hidden lg:block",children:l.map((s,t)=>e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(n,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(n,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(d,{id:`designation-${t}`,name:"designation",value:s.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:i=>a(t,"designation",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`reference-${t}`,name:"reference",value:s.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:i=>a(t,"reference",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:s.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:i=>a(t,"quantite",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`unite-${t}`,name:"unite",value:s.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:i=>a(t,"unite",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`tva-${t}`,name:"tva",value:s.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:i=>a(t,"tva",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:s.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:i=>a(t,"prix_unitaire",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(s.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(s.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute w-5 h-5 text-xs text-white bg-red-500 rounded-full -right-2 -top-2",onClick:()=>$(t),children:"×"})]},t))}),e.jsx(ne,{name:"description",value:m.description||"",placeholder:"Description",onChange:F,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:A,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:f.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:N.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:O.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},ve=({data:m,setData:c,validationErrors:l,errors:r,setValidationErrors:o})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(n,{htmlFor:"type",value:"Type"}),e.jsx(M,{id:"type",name:"type",value:m.type,className:"block w-full mt-1",autoComplete:"type",onChange:a=>c("type",a.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(j,{message:l.type||r.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(n,{htmlFor:"numero",value:"N*"}),e.jsx(d,{id:"numero",name:"numero",value:m.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:a=>c("numero",a.target.value),required:!0,disabled:!0,onFocus:()=>o({...l,numero:""})}),e.jsx(j,{message:l.numero||r.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(n,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(d,{id:"date_creation",name:"date_creation",value:m.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:a=>c("date_creation",a.target.value),type:"date",required:!0,onFocus:()=>o({...l,date_creation:""})}),e.jsx(j,{message:l.date_creation||r.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(n,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(d,{id:"lieu_creation",name:"lieu_creation",value:m.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:a=>c("lieu_creation",a.target.value),required:!0,onFocus:()=>o({...l,lieu_creation:""})}),e.jsx(j,{message:l.lieu_creation||r.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(n,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(M,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:m.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:a=>c("date_additionnel",a.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(j,{message:r.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(n,{htmlFor:"date",value:"*"}),e.jsx(d,{id:"date",name:"date",value:m.date,className:"block w-full mt-1",autoComplete:"date",onChange:a=>c("date",a.target.value),required:!0,type:"date",onFocus:()=>o({...l,date:""})})]})]}),_e=({clients:m,data:c,setData:l,errors:r,validationErrors:o,setValidationErrors:a,handleSelect:g})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(n,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(M,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:c.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:f=>l("civilite_acheteur",f.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(j,{message:r.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(n,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(re,{data:m,className:"block w-full mt-1",onSelect:g,defaultValue:c.client_id||1,onFocus:()=>a({...o,client_id:""})}),e.jsx(j,{message:o.prenom_acheteur||r.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(n,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(d,{id:"nom_acheteur",name:"nom_acheteur",value:c.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:f=>l("nom_acheteur",f.target.value),required:!0,onFocus:()=>a({...o,nom_acheteur:""})}),e.jsx(j,{message:o.nom_acheteur||r.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(d,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:c.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:f=>l("num_rue_acheteur",f.target.value),required:!0,onFocus:()=>a({...o,num_rue_acheteur:""})}),e.jsx(j,{message:o.num_rue_acheteur||r.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(d,{id:"ville_acheteur",name:"ville_acheteur",value:c.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:f=>l("ville_acheteur",f.target.value),required:!0,onFocus:()=>a({...o,ville_acheteur:""})}),e.jsx(j,{message:o.ville_acheteur||r.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(d,{id:"pays_acheteur",name:"pays_acheteur",value:c.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:f=>l("pays_acheteur",f.target.value),required:!0,onFocus:()=>a({...o,pays_acheteur:""})}),e.jsx(j,{message:o.pays_acheteur||r.pays_acheteur,className:"mt-2"})]})]})]})]}),ge=({data:m,setData:c,errors:l,validationErrors:r,setValidationErrors:o})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(d,{id:"nom_vendeurs",name:"nom_vendeurs",value:m.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:a=>c("nom_vendeurs",a.target.value),required:!0,onFocus:()=>o({...r,nom_vendeurs:""})}),e.jsx(j,{message:r.nom_vendeurs||l.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(n,{htmlFor:"select1",value:"Type"}),e.jsx(M,{id:"select1",type:"select1",name:"select1",value:m.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:a=>c("select1",a.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(n,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(d,{id:"num_tva",name:"num_tva",value:m.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:a=>c("num_tva",a.target.value),required:!0,onFocus:()=>o({...r,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(j,{message:r.num_tva||l.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(d,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:m.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:a=>c("nom_rue_vendeur",a.target.value),required:!0,onFocus:()=>o({...r,nom_rue_vendeur:""})}),e.jsx(j,{message:r.nom_rue_vendeur||l.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(d,{id:"ville_vendeur",name:"ville_vendeur",value:m.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:a=>c("ville_vendeur",a.target.value),required:!0,onFocus:()=>o({...r,ville_vendeur:""})}),e.jsx(j,{message:r.ville_vendeur||l.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(d,{id:"pays_vendeur",name:"pays_vendeur",value:m.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:a=>c("pays_vendeur",a.target.value),required:!0,onFocus:()=>o({...r,pays_vendeur:""})}),e.jsx(j,{message:r.pays_vendeur||l.pays_vendeur,className:"mt-2"})]})]})]})]}),xe=({data:m,errors:c,setData:l,setValidationErrors:r,validationErrors:o,typePaiement:a})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(M,{id:"mode_paiement",name:"mode_paiement",value:m.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:g=>l("mode_paiement",g.target.value),required:!0,children:a.map(g=>e.jsx("option",{value:g.nom,children:g.nom},g.id))}),e.jsx(j,{message:o.mode_paiement||c.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(d,{id:"date_echeance",name:"date_echeance",value:m.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:g=>l("date_echeance",g.target.value),required:!0,type:"date",onFocus:()=>r({...o,date_echeance:""})}),e.jsx(j,{message:o.date_echeance||c.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(d,{id:"nom_vendeur",name:"nom_vendeur",value:m.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:g=>l("nom_vendeur",g.target.value),required:!0,onFocus:()=>r({...o,nom_vendeur:""})}),e.jsx(j,{message:o.nom_vendeur||c.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"etat_paiment",value:"État"}),e.jsx(M,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:m.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:g=>l("etat_paiment",g.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(j,{message:o.etat_paiment||c.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"montant_paye",name:"montant_paye",value:m.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:g=>l("montant_paye",g.target.value),required:!0,onFocus:()=>r({...o,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(j,{message:o.montant_paye||c.montant_paye,className:"mt-2"})]})]})]}),je=async(m,c,l)=>{var r,o;try{const a=await K.post("/api/paiement/generate-and-send-pdf",{email:c,data:m,telegram_chat_id:l});return a.data.success,a.data}catch(a){throw console.error("Erreur lors de l'envoi du PDF:",a),alert("Erreur lors de l'envoi du PDF: "+(((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||a.message)),a}};function fe(m){const c=/(\d{2}\/\d{2}\/\d{4})/g,l=m.match(c);if(!l||l.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const r=l[0],o=l[1],a=N=>{const[A,$,F]=N.split("/");return new Date(`${$}/${A}/${F}`)},g=a(r),f=a(o),O=N=>({object:N,iso:N.toISOString(),localeFormat:N.toLocaleDateString(),original:`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")}`});return{startDate:O(g),endDate:O(f),durationDays:Math.floor((f-g)/(1e3*60*60*24))}}const Ye=({token_data:m,telegramback:c})=>{const{theme:l,setTheme:r}=E(),o=w.useRef(null),[a,g]=w.useState(!0),[f,O]=w.useState(null),[N,A]=w.useState(!1),{props:$}=J(),{client_id:F,amount:T,designation:s}=$,[t,i]=w.useState({}),[x,k]=w.useState([]),[b,C]=w.useState([]),[D,S]=w.useState({open:!1,message:"",type:"success"}),[H,R]=w.useState(""),P=new URLSearchParams(window.location.search).get("id");w.useEffect(()=>{r(l||"light"),B()},[l]);const{data:h,setData:y,errors:G,reset:U}=W({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""});w.useEffect(()=>{T&&s&&y(_=>({..._,produits:[..._.produits,{designation:s,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:T,total_ht:T,total_ttc:T}],montant_paye:T,description:s,objet:"Frais de l'installation du pompage solaire.",date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0]}))},[T,s]);const B=async()=>{var _;try{const[{clients:u},p]=await Promise.all([ae(),te()]);k(u==null?void 0:u.map(v=>({id:v.id,nom:v.prenom,nom_famille:v.nom,ville:v.localisation,pays:"Togo",village:v.localisation,quartier:v.localisation,email:v.email,genre:v.genre,telephone:v.telephone,localisation:v.localisation}))),C((_=p.type)==null?void 0:_.map(v=>({id:v.id,nom:v.name})))}catch(u){console.error("Error fetching payment types:",u)}},L=async _=>{try{const u=await oe(_);if(u){const p=u;let v=null;F?v=x.find(q=>q.id===parseInt(F))||x.find(q=>q.id===F):v=x.find(q=>q.id===p.client_id);const I=fe(p.periode_couverte);h.periode_couverte=I.startDate.original+" au "+I.endDate.original,v&&(y({...h,numero:p.numero,nom_acheteur:v.nom_famille,prenom_acheteur:v.nom,civilite_acheteur:v.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:v.ville,pays_acheteur:v.pays,num_rue_acheteur:v.village||v.quartier,client_id:v.id,objet:p.observation,description:p.description,mode_paiement:p.mode_paiement,date_echeance:p.echeance,statut_paiement:p.statut_paiement,produits:p.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseFloat(p.montant).toFixed(2),date_creation:p.date_creation||I.startDate.original,date:p.date||I.endDate.original,lieu_creation:p.lieu_creation,date_additionnel:p.date_additionnel,nom_vendeur:p.nom_vendeur,nom_vendeurs:p.nom_vendeurs,select1:p.select1,num_tva:p.num_tva,nom_rue_vendeur:p.nom_rue_vendeur,ville_vendeur:p.ville_vendeur,pays_vendeur:p.pays_vendeur}),R(v.email)),A(!0)}}catch(u){console.error("Error fetching payment data:",u),S({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}},Q=async _=>{try{const{client:u}=await se(_);console.log(u),u&&(y({...h,client_id:_,nom_acheteur:u.nom,prenom_acheteur:u.prenom,civilite_acheteur:u.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:u.localisation,pays_acheteur:"Togo",num_rue_acheteur:u.localisation}),R(u.email))}catch(u){return console.error("Error fetching client:",u),null}};w.useEffect(()=>{x.length>0&&P?L(P):x.length>0&&F&&Q(F)},[x,P,F]);const V=async()=>{const{data:_}=await ie();_&&y("numero",he(_.numero))};w.useEffect(()=>{P||V()},[P]);const X=_=>{const u=x.find(p=>p.id===_.id);u&&(y("client_id",u.id),y("nom_acheteur",u.nom_famille),y("prenom_acheteur",u.nom),y("ville_acheteur",u.ville),y("pays_acheteur",u.pays),y("num_rue_acheteur",u.village||u.quartier),y("civilite_acheteur",u.genre==="Homme"?"Mr.":"Mme."),R(u.email))},z=async()=>{h.periode_couverte=Y(h.date_creation).format("DD/MM/YYYY")+" au "+Y(h.date).format("DD/MM/YYYY"),h.date_paiement=h.date_paiement?new Date(h.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],h.observation=h.objet,h.echeance=h.date_echeance,h.statut_paiement=h.etat_paiment,h.montant_paye=h.montant_paye||"0",h.montant=h.montant_paye||"0",N&&P&&(h.id=P);try{let _;if(N?_=await ce(P,h):_=await me(h),S({open:!0,message:_.message,type:_.success?"success":"error"}),_.success){setTimeout(async()=>{if(U(),m?c(_.message):window.history.back(),F&&T&&s)try{const I=await(await fetch(`/api/paiement/client/${F}`,{method:"GET"})).json();console.log("Mise à jour is_payed:",I)}catch(v){console.error("Erreur mise à jour client:",v)}},3e3);const u=m?m.chat_id:null,p=await je(h,H,u);p.success&&S({open:!0,message:p.message,type:p.success?"success":"error"})}}catch(_){console.error("Error submitting payment:",_),S({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(Z,{title:N?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(ue,{message:D.message,type:D.type,duration:3e3,position:"top-right",show:D.open,onClose:()=>S({...D,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(ee,{onClick:()=>m?c():window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:N?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ve,{data:h,errors:G,setData:y,validationErrors:t,setValidationErrors:i})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(ge,{data:h,errors:G,setData:y,setValidationErrors:i,validationErrors:t})}),e.jsx("div",{className:"space-y-4",children:e.jsx(_e,{clients:x,data:h,errors:G,handleSelect:X,setData:y,setValidationErrors:i,validationErrors:t})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(n,{htmlFor:"objet",value:"Objet"}),e.jsx(d,{id:"objet",name:"objet",value:h.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:_=>y("objet",_.target.value),required:!0,onFocus:()=>i({...t,objet:""})}),e.jsx(j,{message:t.objet||G.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(pe,{data:h,setData:y})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(xe,{data:h,errors:G,setData:y,setValidationErrors:i,typePaiement:b,validationErrors:t})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(le,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:z,children:N?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:a&&f&&e.jsx("div",{ref:o,children:e.jsx(de,{data:f})})})]})};export{Ye as default};
