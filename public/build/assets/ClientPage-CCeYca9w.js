import{r as n,v as $,j as e,$ as A,m as H}from"./app-Cyd9xhLH.js";import{M as R}from"./Modal-BwpCajKY.js";import{T as x,I as p}from"./TextInput-DVNf_BbI.js";import{I as d}from"./InputLabel-Dw51ejW7.js";import{u as G,c as K,b as O,d as V}from"./clientService-B_nQRvKv.js";import{a as W}from"./validateForm-CYV7VTEV.js";import{S as B}from"./SelectInput-tPDHgPxb.js";import{C as z}from"./ConfirmDialog-BtCXd3-2.js";import{D as J}from"./DataTable-Bv0IfKn_.js";import{E as Q}from"./EmptyState-mAvrvCC4.js";import{H as U}from"./HeaderPage-CWZVp20S.js";import{S as X}from"./Snackbar-Cm3Je60F.js";import{A as Y,R as Z}from"./AuthenticatedLayout-CYQ-r_ar.js";import{j as M}from"./constant-CIHZtd9e.js";import{G as ee}from"./index-C37zIjTF.js";import{T as te,a as ae}from"./index-C4K58-H6.js";import"./transition-CW-Yh3Cj.js";import"./createLucideIcon-wZOBFVHe.js";import"./api-CYmHlwKl.js";import"./index-BQEIpkbm.js";import"./iconBase-arXsq7GH.js";import"./useTheme-D-97-V1T.js";const se=({open:N=!0,setOpen:S,dataModify:s={},onCloseFormulaire:b=()=>{}})=>{const[k,g]=n.useState("Enregistrer"),[o,c]=n.useState({}),[f,v]=n.useState(!1),{data:r,setData:i,errors:m,reset:_}=$({nom:"",prenom:"",email:"",genre:"Homme",CIN:"",telephone:"",pays:"Togo",ville:"Kara",localisation:"",surface_cultivee:"",type_activite_agricole:""}),u=a=>{S(!1),C(),b(a)},C=()=>{_(),g("Enregistrer"),c({}),v(!1)};n.useEffect(()=>{var a,j,w,F;s.id?(i({nom:s.nom||"",prenom:s.prenom||"",email:s.email||"",genre:s.genre||"Homme",CIN:s.CIN||"",telephone:s.telephone||"",pays:((a=s.localisation)==null?void 0:a.pays)||"Togo",ville:((j=s.localisation)==null?void 0:j.ville)||"Kara",quartier:((w=s.localisation)==null?void 0:w.quartier)||"",village:((F=s.localisation)==null?void 0:F.village)||"",localisation:(s==null?void 0:s.localisation)||"",surface_cultivee:s.surface_cultivee||"",type_activite_agricole:s.type_activite_agricole||""}),g("Modifier")):C()},[s,i]);const h=async()=>{if(W(r,c)){v(!0),g(s.id?"Modification...":"Enregistrement...");try{s.id?(await G(s.id,r),u("Client modifié avec succès !")):(await K(r),u("Client créé avec succès !"))}catch(a){console.error("Erreur:",a),v(!1),g(s.id?"Modifier":"Enregistrer")}}};return e.jsxs(R,{show:N,closeable:!1,onClose:u,maxWidth:"3xl",children:[e.jsx("div",{className:"text-center font-semibold text-2xl",children:s.id?"Modifier un Maraîcher":"Ajouter un Maraîcher"}),e.jsxs("form",{className:"w-full my-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"nom",value:"Nom"}),e.jsx(x,{id:"nom",name:"nom",value:r.nom,className:"mt-1 block w-full",autoComplete:"nom",isFocused:!0,onChange:a=>i("nom",a.target.value),required:!0,onFocus:()=>c({...o,nom:""})}),e.jsx(p,{message:o.nom||m.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"prenom",value:"Prénom"}),e.jsx(x,{id:"prenom",name:"prenom",value:r.prenom,className:"mt-1 block w-full",autoComplete:"prenom",onChange:a=>i("prenom",a.target.value),required:!0,onFocus:()=>c({...o,prenom:""})}),e.jsx(p,{message:o.prenom||m.prenom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",value:"Email"}),e.jsx(x,{id:"email",name:"email",value:r.email,className:"mt-1 block w-full",autoComplete:"email",onChange:a=>i("email",a.target.value),onFocus:()=>c({...o,email:""})}),e.jsx(p,{message:o.email||m.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"genre",value:"Sexe"}),e.jsxs(B,{id:"genre",type:"genre",name:"genre",value:r.genre,className:"block w-full mt-1",autoComplete:"genre",onChange:a=>i("genre",a.target.value),required:!0,children:[e.jsx("option",{value:"Homme",children:"Homme"}),e.jsx("option",{value:"Femme",children:"Femme"})]}),e.jsx(p,{message:m.genre,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"CIN",value:"Pièce d'identité"}),e.jsx(x,{id:"CIN",name:"CIN",value:r.CIN,className:"mt-1 block w-full",autoComplete:"CIN",onChange:a=>i("CIN",a.target.value),required:!0,onFocus:()=>c({...o,CIN:""})}),e.jsx(p,{message:o.CIN||m.CIN,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"telephone",value:"Téléphone"}),e.jsx(x,{id:"telephone",name:"telephone",value:r.telephone,className:"mt-1 block w-full",autoComplete:"telephone",onChange:a=>i("telephone",a.target.value),required:!0,onFocus:()=>c({...o,telephone:""})}),e.jsx(p,{message:o.telephone||m.telephone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"localisation",value:"Localisation ou adresse"}),e.jsx(x,{id:"localisation",name:"localisation",value:r.localisation,className:"mt-1 block w-full",autoComplete:"localisation",onChange:a=>i("localisation",a.target.value),required:!0,onFocus:()=>c({...o,localisation:""})}),e.jsx(p,{message:o.localisation||m.localisation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"type_activite_agricole",value:"Type activité agricole"}),e.jsx(x,{id:"type_activite_agricole",name:"type_activite_agricole",value:r.type_activite_agricole,className:"mt-1 block w-full",autoComplete:"type_activite_agricole",onChange:a=>i("type_activite_agricole",a.target.value),required:!0,onFocus:()=>c({...o,type_activite_agricole:""})}),e.jsx(p,{message:o.type_activite_agricole||m.type_activite_agricole,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"surface_cultivee",value:"Surface cultivée (en ha)"}),e.jsx(x,{id:"surface_cultivee",name:"surface_cultivee",value:r.surface_cultivee,className:"mt-1 block w-full",autoComplete:"surface_cultivee",onChange:a=>i("surface_cultivee",a.target.value),required:!0,onFocus:()=>c({...o,surface_cultivee:""})}),e.jsx(p,{message:o.surface_cultivee||m.surface_cultivee,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"rounded-md py-1 px-4 text-red-500 bg-red-400/10",onClick:()=>u(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${f&&"opacity-25"}`,disabled:f,onClick:h,children:k})]})]})},ye=()=>{const[N,S]=n.useState(""),[s,b]=n.useState(!1),[k,g]=n.useState(1),[o,c]=n.useState([]),[f,v]=n.useState([]),[r,i]=n.useState({}),[m,_]=n.useState(!0),[u,C]=n.useState({open:!1,message:"",id:0}),[h,a]=n.useState({open:!1,message:"",type:"success"}),j=async()=>{_(!0);const y=(await O()).clients.map(l=>({id:l.id,nom:l.nom,prenom:l.prenom,CIN:l.CIN,email:l.email,telephone:l.telephone,localisation:l.localisation,surface_cultivee:l.surface_cultivee,type_activite_agricole:l.type_activite_agricole,created_via:l.created_via}));c(y),v(y),_(!1)};n.useEffect(()=>{j()},[]);const w=t=>{S(t),g(1);const y=o.filter(l=>l.nom.toLowerCase().includes(t.toLowerCase())||l.prenom.toLowerCase().includes(t.toLowerCase())||l.telephone.toLowerCase().includes(t.toLowerCase())||l.surface_cultivee.toLowerCase().includes(t.toLowerCase())||l.type_activite_agricole.toLowerCase().includes(t.toLowerCase())||l.localisation.toLowerCase().includes(t.toLowerCase()));v(y)},F=()=>{b(!0)},I=[{key:"id",label:"ID",sortable:!0},{key:"nom",label:"Nom",sortable:!0},{key:"prenom",label:"Prénom",sortable:!0},{key:"CIN",label:"CIN"},{key:"email",label:"Email",sortable:!0},{key:"telephone",label:"Téléphone"},{key:"localisation",label:"Localisation",sortable:!0},{key:"surface_cultivee",label:"Surface cultivée (ha)",sortable:!0},{key:"type_activite_agricole",label:"Type d'activité agricole"},{key:"created_via",label:"Via",customRender:t=>e.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:t==="web"?e.jsx(ae,{}):e.jsx(Z,{className:"text-blue-400"})})}],E=[{label:e.jsx(M,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:t=>P(t.id)},{label:e.jsx(te,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>T(t)},{label:e.jsx(ee,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>D(t)}],L=t=>{j(),t&&a({...h,message:t,open:!0}),i({})},T=t=>{i(t),b(!0)},D=t=>{C({open:!0,message:`Êtes-vous sûr de vouloir supprimer ${t.nom} ${t.prenom}?`,id:t.id})},q=async()=>{const{message:t}=await V(u.id);a({...h,message:t,open:!0}),C({...u,open:!1,id:0}),j(),g(1)},P=async t=>{H.visit(`/client/${t}`)};return e.jsxs(Y,{children:[e.jsx(A,{title:"Maraîchers"}),e.jsx(U,{title:`Liste des Maraîchers ( Total: ${o.length} )`,handleClick:F,onSearch:w,search:N}),e.jsx(se,{setOpen:b,open:s,dataModify:r,onCloseFormulaire:L}),e.jsx(X,{message:h.message,type:h.type,duration:3e3,position:"top-right",show:h.open,onClose:()=>a({...h,message:"",open:!1})}),e.jsx(z,{open:u.open,message:u.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>C({...u,open:!1}),accept:q}),m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsx("div",{children:f.length>0?e.jsx(J,{headers:I,rows:f,itemsPerPage:10,actions:E,className:"mt-4",currentPage:k,onPageChange:g}):e.jsx(Q,{nom:"maraîcher",search:N})})]})};export{ye as default};
