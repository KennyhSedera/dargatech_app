import{r as m,v as $,j as e,$ as A}from"./app-aLckg_Lc.js";import{C as V}from"./ConfirmDialog-DCtw3JzG.js";import{D as H}from"./DataTable-C083C-nx.js";import{H as O}from"./HeaderPage-Ch1MkM1N.js";import{M as B}from"./Modal-BJjOr0fo.js";import{I as c,T as g}from"./TextInput-CLvGHTGP.js";import{I as d}from"./InputLabel-L7xfQjCL.js";import{b as K}from"./validateForm-CYV7VTEV.js";import{g as q,c as R,u as W,d as G}from"./installationService-B0SMyrri.js";import{I as z}from"./InputAutocomplete -DBNDwd7s.js";import{b as J}from"./clientService-hpjJX7Fc.js";import{p as Q,q as U,f as X,r as Y}from"./constant-hVELMu8D.js";import{S as Z}from"./SelectInput-DhswDDP7.js";import{S as M}from"./Snackbar-oFoxIlwm.js";import{A as ee}from"./AuthenticatedLayout-CJuN6Xw1.js";import{G as te}from"./index-DT3Jk8L4.js";import{T as ae}from"./index-CECjaDJM.js";import{E as se}from"./EmptyState-C4q1f84e.js";import"./index-DvDH6ep7.js";import"./iconBase-h1gACPcP.js";import"./transition-DDNWLEKc.js";import"./index-CdQXhAN7.js";import"./api-T3JIhlAS.js";import"./useTheme-xIG_PlD7.js";const oe=({open:w=!0,setOpen:I,dataModify:o={},onCloseFormulaire:v=()=>{}})=>{const[C,h]=m.useState("Enregistrer"),[S,f]=m.useState(!1),[s,u]=m.useState({}),[y,F]=m.useState([]),{data:r,setData:l,errors:i}=$({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"",source_eau:"Puits",hmt:"",latitude:"",longitude:"",pays:"Togo",ville:"Kara",statuts:"installée"});console.log(o);const N=async()=>{const[{clients:t},_]=await Promise.all([J(),q()]),E=t.map(x=>({id:x.id,nom:x.nom+" "+x.prenom})),P=_.data.reduce((x,L)=>{const a=parseInt(L.code_installation.replace(/\D/g,""),10);return a>x?a:x},0),T=`${U("I"+String(P).padStart(4,"0"))}`;F(E),o.id||l("code_installation",T)},p=t=>{I(!1),b(),v(t)},b=()=>{l({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"I0001",source_eau:"Puits",hmt:"",latitude:"",longitude:"",pays:"Togo",ville:"Kara"}),f(!1),h("Enregistrer"),u({})};m.useEffect(()=>{var t,_;N(),o.id?(l({client_id:o.client_id||0,date_installation:Q(o.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:o.puissance_pompe||"",profondeur_forage:o.profondeur_forage||"",debit_nominal:o.debit_nominal||"",numero_serie:o.numero_serie||"",code_installation:o.code_installation||"",source_eau:o.source_eau||"",hmt:o.hmt||"",ville:((t=o.localisation)==null?void 0:t.ville)||"Kara",pays:((_=o.localisation)==null?void 0:_.pays)||"Togo",latitude:o.latitude,longitude:o.longitude}),h("Modifier")):b()},[o,l]);const k=async()=>{if(!(C==="Enregistrer"&&!K(r,u))){f(!0),h("Chargement...");try{let t;C==="Enregistrer"?{message:t}=await R(r):{message:t}=await W(o.id,r),p(t)}catch(t){console.error("Error submitting installation:",t),t.response&&t.response.data&&(console.log("Validation errors:",t.response.data.errors),u(t.response.data.errors||{}))}finally{f(!1),h(o.id?"Modifier":"Enregistrer")}}},D=t=>{l("client_id",t.id)};return e.jsxs(B,{show:w,closeable:!1,onClose:p,maxWidth:"4xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_id",value:"Nom client"}),e.jsx(z,{data:y,className:"block w-full mt-1",onSelect:D,defaultValue:r.client_id??0,onFocus:()=>u({...s,client_id:""})}),e.jsx(c,{message:s.client_id||i.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"numero_serie",value:"Numéro de série de la pompe"}),e.jsx(g,{id:"numero_serie",name:"numero_serie",value:r.numero_serie,className:"block w-full mt-1",autoComplete:"numero_serie",onChange:t=>l("numero_serie",t.target.value),required:!0,onFocus:()=>u({...s,numero_serie:""})}),e.jsx(c,{message:s.numero_serie||i.numero_serie,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"source_eau",value:"Source d'eau"}),e.jsxs(Z,{id:"source_eau",type:"source_eau",name:"source_eau",value:r.source_eau,className:"block w-full mt-1",autoComplete:"source_eau",onChange:t=>l("source_eau",t.target.value),required:!0,children:[e.jsx("option",{value:"Puits",children:"Puits"}),e.jsx("option",{value:"Forage",children:"Forage"}),e.jsx("option",{value:"Etang",children:"Etang"}),e.jsx("option",{value:"Barrage",children:"Barrage"}),e.jsx("option",{value:"Puits",children:"Rivière"})]}),e.jsx(c,{message:s.source_eau||i.source_eau,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hmt",value:"HMT (m)"}),e.jsx(g,{id:"hmt",name:"hmt",value:r.hmt,className:"block w-full mt-1",autoComplete:"hmt",onChange:t=>l("hmt",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,hmt:""})}),e.jsx(c,{message:s.hmt||i.hmt,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"profondeur_forage",value:"Distance maximale pompe champ PV (m)"}),e.jsx(g,{id:"profondeur_forage",name:"profondeur_forage",value:r.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:t=>l("profondeur_forage",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,profondeur_forage:""})}),e.jsx(c,{message:s.profondeur_forage||i.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(g,{id:"debit_nominal",name:"debit_nominal",value:r.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:t=>l("debit_nominal",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,debit_nominal:""})}),e.jsx(c,{message:s.debit_nominal||i.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"puissance_pompe",value:"Puissance crête installé (W)"}),e.jsx(g,{id:"puissance_pompe",name:"puissance_pompe",value:r.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:t=>l("puissance_pompe",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,puissance_pompe:""})}),e.jsx(c,{message:s.puissance_pompe||i.puissance_pompe,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"pays",value:"Pays"}),e.jsx(g,{id:"pays",name:"pays",value:r.pays,className:"block w-full mt-1",autoComplete:"pays",onChange:t=>l("pays",t.target.value),required:!0,onFocus:()=>u({...s,pays:""})}),e.jsx(c,{message:s.pays||i.pays,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"ville",value:"Ville"}),e.jsx(g,{id:"ville",name:"ville",value:r.ville,className:"block w-full mt-1",autoComplete:"ville",onChange:t=>l("ville",t.target.value),required:!0,onFocus:()=>u({...s,ville:""})}),e.jsx(c,{message:s.ville||i.ville,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"latitude",value:"Latitude"}),e.jsx(g,{id:"latitude",name:"latitude",value:r.latitude,className:"block w-full mt-1",autoComplete:"latitude",type:"number",min:"0",onChange:t=>l("latitude",t.target.value),onFocus:()=>u({...s,latitude:""})}),e.jsx(c,{message:s.latitude||i.latitude,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"longitude",value:"Longitude"}),e.jsx(g,{id:"longitude",name:"longitude",value:r.longitude,className:"block w-full mt-1",autoComplete:"longitude",type:"number",min:"0",onChange:t=>l("longitude",t.target.value),onFocus:()=>u({...s,longitude:""})}),e.jsx(c,{message:s.longitude||i.longitude,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"date_installation",value:"Date de l'installation"}),e.jsx(g,{id:"date_installation",name:"date_installation",value:r.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:t=>l("date_installation",t.target.value),required:!0,onFocus:()=>u({...s,date_installation:""})}),e.jsx(c,{message:s.date_installation||i.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>p(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${S&&"opacity-25"}`,disabled:S,onClick:k,children:C})]})]})},ke=()=>{const[w,I]=m.useState(""),[o,v]=m.useState(!1),[C,h]=m.useState({}),[S,f]=m.useState(1),[s,u]=m.useState([]),[y,F]=m.useState([]),[r,l]=m.useState(!0),[i,N]=m.useState({open:!1,message:"",id:0}),[p,b]=m.useState({open:!1,message:"",type:"success"}),k=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"numero_serie",label:"Numéro de série de la pompe"},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation"},{key:"statuts",label:"Statuts",customRender:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${a==="installée"?"bg-green-500/50":a==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:a})}],D=[{label:e.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:a=>L(a)},{label:e.jsx(te,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:a=>T(a)}],t=()=>{v(!0)},_=async()=>{l(!0);const{data:a}=await q(),j=a.map(n=>({id:n.id,code_installation:n.code_installation,client_id:n.client_id,nom:n.client.nom+" "+n.client.prenom,puissance_pompe:n.puissance_pompe,profondeur_forage:n.profondeur_forage,debit_nominal:n.debit_nominal,numero_serie:n.numero_serie,source_eau:n.source_eau,hmt:n.hmt,date_installation:X(n.date_installation),statuts:n.statuts,latitude:n.localisation.latitude,longitude:n.localisation.longitude}));u(j),F(j),l(!1)};m.useEffect(()=>{_()},[]);const E=a=>{I(a),f(1);const j=s.filter(n=>n.nom.toLowerCase().includes(a.toLowerCase())||n.statuts.toLowerCase().includes(a.toLowerCase())||n.date_installation.toString().toLowerCase().includes(a.toLowerCase()));F(j)},P=a=>{_(),a&&b({...p,message:a,open:!0}),h({})},T=a=>{N({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${a.code_installation} du ${a.nom} le ${a.date_installation} ?`,id:a.id})},x=async()=>{const{message:a}=await G(i.id);b({...p,message:a,open:!0}),N({...i,open:!1,id:0}),_(),f(1)},L=a=>{const j=a.date_installation?a.date_installation:"Invalid date";h({...a,date_installation:Y(j)}),v(!0)};return e.jsxs(ee,{children:[e.jsx(A,{title:"Installations"}),e.jsx(O,{title:"Liste des Installations",handleClick:t,onSearch:E,search:w}),e.jsx(oe,{open:o,setOpen:v,onCloseFormulaire:P,dataModify:C}),e.jsx(M,{message:p.message,type:p.type,duration:3e3,position:"top-right",show:p.open,onClose:()=>b({...p,message:"",open:!1})}),e.jsx(V,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>N({...i,open:!1}),accept:x}),r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsx("div",{children:y.length>0?e.jsx(H,{headers:k,rows:y,itemsPerPage:10,actions:D,className:"mt-4",currentPage:S,onPageChange:f,masqueColumns:["client_id","latitude","longitude"]}):e.jsx(se,{nom:"installation",search:w})})]})};export{ke as default};
