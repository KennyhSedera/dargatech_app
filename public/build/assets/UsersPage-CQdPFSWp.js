import{j as e,r as d,v as D,e as M,$ as P}from"./app-Bc14thCu.js";import{A as $}from"./AuthenticatedLayout-bAfE8ic_.js";import{g as T,d as H}from"./userService-F8ehJzff.js";import{H as V}from"./HeaderPage-DNQX9hl4.js";import{S as z}from"./Snackbar-DqgJCDPl.js";import{C as O}from"./ConfirmDialog-CHqlf67D.js";import{t as R,C as W,F as B,v as G,u as J}from"./constant-p7t4ak8Y.js";import{E as K}from"./EmptyState-C9-oaPk2.js";import{M as Q}from"./Modal-4YuM-mbh.js";import{I as v}from"./InputLabel-EGgfsVS_.js";import{T as y,I as w}from"./TextInput-B5WHqo4Z.js";import"./transition-BK0w5X8f.js";import"./iconBase-Cf47CWzq.js";import"./useTheme-D7Yy0oND.js";import"./index-BYmEwsCp.js";import"./index-BR6vvmh2.js";import"./api-qC64fYbA.js";import"./createLucideIcon-BpnStyId.js";const X=({user:t,handleDelete:b,handleImageError:r})=>{var o,h,p,n,c,l,u,i,x,j,f,a;return e.jsxs("div",{className:"overflow-hidden transition-all duration-300 transform bg-white shadow-lg dark:bg-gray-800 rounded-xl hover:scale-105 hover:shadow-xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-400 via-pink-500 to-purple-600 dark:from-indigo-600 dark:via-purple-600 dark:to-blue-700 opacity-90"}),e.jsxs("div",{className:"relative flex items-start justify-between px-6 pt-4 pb-14",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate",children:t.name}),e.jsx("div",{className:"relative",children:!t.user_role.isAdmin&&e.jsx("button",{onClick:()=>b(t.id),className:"p-2 text-white transition-colors rounded-full hover:bg-red-50 dark:hover:bg-gray-700",children:e.jsx(R,{})})})]}),e.jsx("div",{className:"absolute -bottom-12 left-6",children:e.jsx("div",{className:"w-24 h-24 overflow-hidden border-4 border-white shadow-md rounded-xl dark:border-gray-800",children:(o=t.profile)!=null&&o.photo||(h=t.technicien)!=null&&h.photo||(p=t.partenaire)!=null&&p.logo?e.jsx("img",{src:((n=t.profile)==null?void 0:n.photo)||((c=t.technicien)==null?void 0:c.photo)||((l=t.partenaire)==null?void 0:l.logo),alt:`${t.name}'s profile`,className:"object-cover w-full h-full bg-gray-100 dark:bg-gray-900",onError:r}):e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-100 to-gray-300 dark:from-gray-700 dark:to-gray-600",children:e.jsx(W,{className:"text-4xl text-gray-400 dark:text-gray-300"})})})})]}),e.jsxs("div",{className:"px-6 pb-6 pt-14",children:[e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 text-xs font-medium text-white rounded-full bg-gradient-to-r from-green-400 to-blue-500",children:t.user_role.name})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:t.email})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(G,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((u=t.technicien)==null?void 0:u.contact)||((i=t.profile)==null?void 0:i.contact)||((x=t.partenaire)==null?void 0:x.telephone)})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(J,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((j=t.technicien)==null?void 0:j.adress)||((f=t.profile)==null?void 0:f.adress)||((a=t.partenaire)==null?void 0:a.adresse)})]})]})]})]},t.id)},Y=({open:t,closeForm:b})=>{const[r,o]=d.useState({}),[h,p]=d.useState(!1),{data:n,setData:c,errors:l,reset:u}=D({name:"",email:"",contact:"",adress:"",telegram_username:""}),i=a=>{b(a),x()},x=()=>{u(),o({}),p(!1)},j=(a,N)=>{const g={};return a.name||(g.name="Le nom est obligatoire"),a.email||(g.email="L'email est obligatoire"),a.contact||(g.contact="Le contact est obligatoire"),a.adress||(g.adress="L'adresse est obligatoire"),N(g),Object.keys(g).length===0},f=()=>{j(n,o)&&(p(!0),M.post("create/admin",n).then(a=>{p(!1),i(a.data.message)}).catch(a=>{p(!1),a.response&&a.response.data&&o(a.response.data.errors||{})}))};return e.jsxs(Q,{show:t,maxWidth:"xl",onClose:()=>i(""),closeable:!1,children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:"Créer un Administrateur"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"name",value:"Nom"}),e.jsx(y,{id:"name",name:"name",value:n.name,className:"block w-full mt-1",autoComplete:"name",isFocused:!0,onChange:a=>c("name",a.target.value),required:!0,onFocus:()=>o({...r,name:""})}),e.jsx(w,{message:r.name||l.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"email",value:"Email"}),e.jsx(y,{id:"email",name:"email",value:n.email,className:"block w-full mt-1",autoComplete:"email",onChange:a=>c("email",a.target.value),required:!0,onFocus:()=>o({...r,email:""})}),e.jsx(w,{message:r.email||l.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"contact",value:"Contact"}),e.jsx(y,{id:"contact",name:"contact",value:n.contact,className:"block w-full mt-1",autoComplete:"contact",type:"number",onChange:a=>c("contact",a.target.value),required:!0,onFocus:()=>o({...r,contact:""})}),e.jsx(w,{message:r.contact||l.contact,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"adress",value:"adress"}),e.jsx(y,{id:"adress",name:"adress",value:n.adress,className:"block w-full mt-1",autoComplete:"adress",onChange:a=>c("adress",a.target.value),required:!0,onFocus:()=>o({...r,adress:""})}),e.jsx(w,{message:r.adress||l.adress,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(v,{htmlFor:"telegram_username",value:"Pseudo sur telegram"}),e.jsx(y,{id:"telegram_username",name:"telegram_username",value:n.telegram_username,className:"block w-full mt-1",autoComplete:"telegram_username",onChange:a=>c("telegram_username",a.target.value),required:!0,onFocus:()=>o({...r,telegram_username:""})}),e.jsx(w,{message:r.telegram_username||l.telegram_username,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>i(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${h&&"opacity-25"}`,disabled:h,onClick:f,children:"Enregistrer"})]})]})},fe=()=>{const[t,b]=d.useState([]),[r,o]=d.useState([]),[h,p]=d.useState(!0),[n,c]=d.useState(""),[l,u]=d.useState({open:!1,message:"",id:0}),[i,x]=d.useState({open:!1,message:"",type:"success"}),[j,f]=d.useState(!1),a=async()=>{try{const s=await T();b(s),o(s)}catch(s){console.error("Failed to fetch users:",s)}finally{p(!1)}};d.useEffect(()=>{a()},[]);const N=s=>{c(s);const q=t.filter(m=>{var C,L,k,F,S,_,E;return m.name.toLowerCase().includes(s.toLowerCase())||m.email.toLowerCase().includes(s.toLowerCase())||((C=m.technicien)==null?void 0:C.contact.toLowerCase().includes(s.toLowerCase()))||((L=m.technicien)==null?void 0:L.adress.toLowerCase().includes(s.toLowerCase()))||m.user_role.name.toLowerCase().includes(s.toLowerCase())||((k=m.profile)==null?void 0:k.adress.toLowerCase().includes(s.toLowerCase()))||((F=m.profile)==null?void 0:F.contact.toLowerCase().includes(s.toLowerCase()))||((S=m.partenaire)==null?void 0:S.telephone.toLowerCase().includes(s.toLowerCase()))||((_=m.partenaire)==null?void 0:_.adresse.toLowerCase().includes(s.toLowerCase()))||((E=m.partenaire)==null?void 0:E.site_web.toLowerCase().includes(s.toLowerCase()))});o(q)},g=s=>{s&&x({open:!0,message:s,type:"success"}),f(!1),a()},U=s=>{s.target.onerror=null,s.target.src="/path/to/default-avatar.png"},A=s=>{u({open:!0,message:"Voulez-vous vraiment supprimer cet utilisateur ?",id:s})},I=async()=>{const s=await H(l.id);s.success?(x({...i,open:!0,message:"Utilisateur supprimé avec succès",type:"success"}),u({...l,open:!1}),a()):x({...i,open:!0,message:s.message,type:"error"})};return e.jsxs($,{children:[e.jsx(P,{title:"Users"}),e.jsx(V,{title:"Liste des utilisateurs",onSearch:N,search:n,handleClick:()=>f(!0)}),e.jsx(O,{open:l.open,message:l.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",accept:I,close:()=>u({...l,open:!1,id:0})}),e.jsx(Y,{closeForm:g,open:j}),e.jsx(z,{message:i.message,type:i.type,duration:3e3,position:"top-right",show:i.open,onClose:()=>x({...i,message:"",open:!1})}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r.length===0?e.jsx(K,{nom:"utilisateur",search:n}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map(s=>e.jsx(X,{user:s,handleDelete:A,handleImageError:U},s.id))})})})]})};export{fe as default};
