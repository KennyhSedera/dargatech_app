import{r as l,m as A,j as e,L as $}from"./app-D3V72n1s.js";import{C as H}from"./ConfirmDialog-5hj8CJNe.js";import{D as O}from"./DataTable-BjbqtfrA.js";import{H as V}from"./HeaderPage-Btzt9_gr.js";import{M as B}from"./Modal-BhNVd-e7.js";import{I as _,T as b}from"./TextInput-D47YkKcQ.js";import{I as g}from"./InputLabel-DoSA4Kpv.js";import{b as R}from"./validateForm-CYV7VTEV.js";import{g as q,c as W,u as G,d as z}from"./installationService-BXYu1xFc.js";import{I as J}from"./InputAutocomplete -BRW3oAnl.js";import{b as K}from"./clientService-DrG4ST6C.js";import{o as Q,p as U,f as X,q as Y}from"./constant-DDOpUsbX.js";import{S as Z}from"./SelectInput-DYhYCpbz.js";import{S as M}from"./Snackbar-Bpq3mgeY.js";import{A as ee}from"./AuthenticatedLayout-DhMiK9Mg.js";import{G as te}from"./index-D8vJ1ctu.js";import{T as ae}from"./index-B7OlFyTE.js";import{E as se}from"./EmptyState-BIBpj0yu.js";import"./index-CGv1R1oo.js";import"./iconBase-CLKRYcMR.js";import"./transition-C7mIkZXA.js";import"./index-CHxTFCly.js";import"./api-B0F_CExV.js";import"./useTheme-BOnyXEtS.js";const oe=({open:C=!0,setOpen:F,dataModify:n={},onCloseFormulaire:j=()=>{}})=>{const[S,h]=l.useState("Enregistrer"),[w,x]=l.useState(!1),[s,u]=l.useState({}),[N,I]=l.useState([]),{data:m,setData:i,errors:r,reset:y}=A({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"",source_eau:"Puits",hmt:""}),d=async()=>{const[{clients:t},P]=await Promise.all([K(),q()]),E=t.map(p=>({id:p.id,nom:p.nom+" "+p.prenom})),T=P.data.reduce((p,a)=>{const c=parseInt(a.code_installation.replace(/\D/g,""),10);return c>p?c:p},0),L=`${U("I"+String(T).padStart(4,"0"))}`;I(E),n.id||i("code_installation",L)},f=t=>{F(!1),v(),j(t)},v=()=>{i({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"I0001",source_eau:"Puits",hmt:""}),x(!1),h("Enregistrer"),u({})};l.useEffect(()=>{d(),n.id?(i({client_id:n.client_id||0,date_installation:Q(n.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:n.puissance_pompe||"",profondeur_forage:n.profondeur_forage||"",debit_nominal:n.debit_nominal||"",numero_serie:n.numero_serie||"",code_installation:n.code_installation||"",source_eau:n.source_eau||"",hmt:n.hmt||""}),h("Modifier")):v()},[n,i]);const D=async()=>{if(R(m,u)){x(!0),h("Chargement...");try{let t;S==="Enregistrer"?{message:t}=await W(m):{message:t}=await G(n.id,m),f(t)}catch(t){console.error("Error submitting payment:",t)}finally{v()}}},k=t=>{i("client_id",t.id)};return e.jsxs(B,{show:C,closeable:!1,onClose:f,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:n.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"client_id",value:"Nom client"}),e.jsx(J,{data:N,className:"block w-full mt-1",onSelect:k,isFocused:!0,defaultValue:m.client_id??0,onFocus:()=>u({...s,client_id:""})}),e.jsx(_,{message:s.client_id||r.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"numero_serie",value:"Numéro de série de la pompe"}),e.jsx(b,{id:"numero_serie",name:"numero_serie",value:m.numero_serie,className:"block w-full mt-1",autoComplete:"numero_serie",onChange:t=>i("numero_serie",t.target.value),required:!0,onFocus:()=>u({...s,numero_serie:""})}),e.jsx(_,{message:s.numero_serie||r.numero_serie,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"source_eau",value:"Source d'eau"}),e.jsxs(Z,{id:"source_eau",type:"source_eau",name:"source_eau",value:m.source_eau,className:"block w-full mt-1",autoComplete:"source_eau",onChange:t=>i("source_eau",t.target.value),required:!0,children:[e.jsx("option",{value:"Puits",children:"Puits"}),e.jsx("option",{value:"Forage",children:"Forage"}),e.jsx("option",{value:"Etang",children:"Etang"}),e.jsx("option",{value:"Barrage",children:"Barrage"}),e.jsx("option",{value:"Puits",children:"Rivière"})]}),e.jsx(_,{message:s.source_eau||r.source_eau,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"hmt",value:"HMT (m)"}),e.jsx(b,{id:"hmt",name:"hmt",value:m.hmt,className:"block w-full mt-1",autoComplete:"hmt",onChange:t=>i("hmt",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,hmt:""})}),e.jsx(_,{message:s.hmt||r.hmt,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"profondeur_forage",value:"Distance maximale pompe champ PV (m)"}),e.jsx(b,{id:"profondeur_forage",name:"profondeur_forage",value:m.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:t=>i("profondeur_forage",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,profondeur_forage:""})}),e.jsx(_,{message:s.profondeur_forage||r.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(b,{id:"debit_nominal",name:"debit_nominal",value:m.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:t=>i("debit_nominal",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,debit_nominal:""})}),e.jsx(_,{message:s.debit_nominal||r.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"puissance_pompe",value:"Puissance crête installé (W)"}),e.jsx(b,{id:"puissance_pompe",name:"puissance_pompe",value:m.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:t=>i("puissance_pompe",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,puissance_pompe:""})}),e.jsx(_,{message:s.puissance_pompe||r.puissance_pompe,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"date_installation",value:"Date de l'installation"}),e.jsx(b,{id:"date_installation",name:"date_installation",value:m.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:t=>i("date_installation",t.target.value),required:!0,onFocus:()=>u({...s,date_installation:""})}),e.jsx(_,{message:s.date_installation||r.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>f(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${w&&"opacity-25"}`,disabled:w,onClick:D,children:S})]})]})},De=()=>{const[C,F]=l.useState(""),[n,j]=l.useState(!1),[S,h]=l.useState({}),[w,x]=l.useState(1),[s,u]=l.useState([]),[N,I]=l.useState([]),[m,i]=l.useState(!0),[r,y]=l.useState({open:!1,message:"",id:0}),[d,f]=l.useState({open:!1,message:"",type:"success"}),v=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"numero_serie",label:"Numéro de série de la pompe"},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation"},{key:"statuts",label:"Statuts",customRender:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${a==="installée"?"bg-green-500/50":a==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:a})}],D=[{label:e.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:a=>p(a)},{label:e.jsx(te,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:a=>T(a)}],k=()=>{j(!0)},t=async()=>{i(!0);const{data:a}=await q(),c=a.map(o=>({id:o.id,code_installation:o.code_installation,client_id:o.client_id,nom:o.client.nom+" "+o.client.prenom,puissance_pompe:o.puissance_pompe,profondeur_forage:o.profondeur_forage,debit_nominal:o.debit_nominal,numero_serie:o.numero_serie,source_eau:o.source_eau,hmt:o.hmt,date_installation:X(o.date_installation),statuts:o.statuts}));u(c),I(c),i(!1)};l.useEffect(()=>{t()},[]);const P=a=>{F(a),x(1);const c=s.filter(o=>o.nom.toLowerCase().includes(a.toLowerCase())||o.statuts.toLowerCase().includes(a.toLowerCase())||o.date_installation.toString().toLowerCase().includes(a.toLowerCase()));I(c)},E=a=>{t(),a&&f({...d,message:a,open:!0}),h({})},T=a=>{y({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation du ${a.nom} le ${a.date_installation} ?`,id:a.id})},L=async()=>{const{message:a}=await z(r.id);f({...d,message:a,open:!0}),y({...r,open:!1,id:0}),t(),x(1)},p=a=>{const c=a.date_installation?a.date_installation:"Invalid date";h({...a,date_installation:Y(c)}),j(!0)};return e.jsxs(ee,{children:[e.jsx($,{title:"Installations"}),e.jsx(V,{title:"Liste des Installations",handleClick:k,onSearch:P,search:C}),e.jsx(oe,{open:n,setOpen:j,onCloseFormulaire:E,dataModify:S}),e.jsx(M,{message:d.message,type:d.type,duration:3e3,position:"top-right",show:d.open,onClose:()=>f({...d,message:"",open:!1})}),e.jsx(H,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>y({...r,open:!1}),accept:L}),m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{children:N.length>0?e.jsx(O,{headers:v,rows:N,itemsPerPage:10,actions:D,className:"mt-4",currentPage:w,onPageChange:x,masqueColumns:["client_id"]}):e.jsx(se,{nom:"installation",search:C})})]})};export{De as default};
