import{r as s,j as a,$ as G,m as V}from"./app-Pu65E-ws.js";import{C as W}from"./ConfirmDialog-5HIraWuG.js";import{D as O}from"./DataTable-7spkIUen.js";import{H as z}from"./HeaderPage-C1eP3eNx.js";import{F as B}from"./FormulaireInstallation-csGLDasg.js";import{S as J}from"./Snackbar-BFo-vz-h.js";import{f as K,p as Q,q as U}from"./constant-CFstdDhS.js";import{A as X,R as Y}from"./AuthenticatedLayout-COQfLdpd.js";import{g as Z,d as ee}from"./installationService-De4GBxCj.js";import{G as te}from"./index-Z00MtdLu.js";import{T as ae,a as se}from"./index-DwxUomxv.js";import{E as oe}from"./EmptyState-BbI3zo1G.js";import"./Modal-DsF0a3X0.js";import"./transition-CnLwA50T.js";import"./index-DK91IBrd.js";import"./iconBase-DnlMGKFD.js";import"./TextInput-Bi3fgNc5.js";import"./createLucideIcon-nAuUIF4O.js";import"./InputLabel-BvhJwt0g.js";import"./InputAutocomplete -D7rYU693.js";import"./clientService-BjrM7fr0.js";import"./api-B5uXgu3C.js";import"./SelectInput-55Ii-PZj.js";import"./InputImage-Dq2UjVss.js";import"./useTheme-BKgsgLQj.js";const Pe=()=>{const[u,S]=s.useState(""),[k,r]=s.useState(!1),[L,p]=s.useState({}),[D,l]=s.useState(1),[b,I]=s.useState([]),[f,g]=s.useState([]),[N,x]=s.useState(!0),[i,d]=s.useState({open:!1,message:"",id:0}),[o,m]=s.useState({open:!1,message:"",type:"success"}),[P,T]=s.useState(10),$=[{key:"code_installation",label:"Code",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"numero_serie",label:"Numéro de série de la pompe",sortable:!0},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation",sortable:!0},{key:"statuts",label:"Statuts",customRender:e=>a.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${e==="installée"?"bg-green-500/50":e==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"created_via",label:"Via",customRender:e=>a.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?a.jsx(se,{}):a.jsx(Y,{className:"text-blue-400 bg-white"})})}],E=[{label:a.jsx(Q,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:e=>q(e.id)},{label:a.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>H(e)},{label:a.jsx(te,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>R(e)}],F=()=>{r(!0)},c=async()=>{x(!0);const{data:e}=await Z(),n=e.map(t=>({id:t.id,code_installation:t.code_installation,client_id:t.client_id,nom:t.client.nom+" "+t.client.prenom,puissance_pompe:t.puissance_pompe,profondeur_forage:t.profondeur_forage,debit_nominal:t.debit_nominal,numero_serie:t.numero_serie,source_eau:t.source_eau,hmt:t.hmt,date_installation:K(t.date_installation),statuts:t.statuts,latitude:t.localisation.latitude,longitude:t.localisation.longitude,created_via:t.created_via}));I(n),g(n),x(!1)};s.useEffect(()=>{c()},[]);const v=e=>{S(e),l(1);const n=b.filter(t=>{var h,_,C,w,y,j;return((h=t==null?void 0:t.nom)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))||((_=t==null?void 0:t.code_installation)==null?void 0:_.toLowerCase().includes(e.toLowerCase()))||((C=t==null?void 0:t.numero_serie)==null?void 0:C.toLowerCase().includes(e.toLowerCase()))||((w=t==null?void 0:t.source_eau)==null?void 0:w.toLowerCase().includes(e.toLowerCase()))||((y=t==null?void 0:t.statuts)==null?void 0:y.toLowerCase().includes(e.toLowerCase()))||((j=t==null?void 0:t.date_installation)==null?void 0:j.toString().toLowerCase().includes(e.toLowerCase()))});g(n)},A=e=>{c(),e&&m({...o,message:e,open:!0}),p({})},R=e=>{d({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${e.code_installation} du ${e.nom} le ${e.date_installation} ?`,id:e.id})},M=async()=>{const{message:e}=await ee(i.id);m({...o,message:e,open:!0}),d({...i,open:!1,id:0}),c(),l(1)},H=e=>{const n=e.date_installation?e.date_installation:"Invalid date";p({...e,date_installation:U(n)}),r(!0)},q=e=>{V.visit(`/installation/${e}`)};return a.jsxs(X,{children:[a.jsx(G,{title:"Installations"}),a.jsx(z,{title:`Liste des Installations ( Total: ${b.length} )`,handleClick:F,onSearch:v,search:u}),a.jsx(B,{open:k,setOpen:r,onCloseFormulaire:A,dataModify:L,token_data:null}),a.jsx(J,{message:o.message,type:o.type,duration:3e3,position:"top-right",show:o.open,onClose:()=>m({...o,message:"",open:!1})}),a.jsx(W,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>d({...i,open:!1}),accept:M}),N?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):a.jsx("div",{children:f.length>0?a.jsx(O,{headers:$,rows:f,itemsPerPage:P,actions:E,className:"mt-4",currentPage:D,onPageChange:l,masqueColumns:["client_id","latitude","longitude"],onItemsPerPageChange:e=>T(e)}):a.jsx(oe,{nom:"installation",search:u})})]})};export{Pe as default};
