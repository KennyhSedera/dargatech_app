import{r as w,j as e,e as X,q as B,v as z,$ as K}from"./app-C6rXvzpA.js";import{I as o}from"./InputLabel-BXlx6FiE.js";import{T as d,I as x}from"./TextInput-zeY_lM4k.js";import{u as J}from"./useTheme-4PTwsFc3.js";import{D as W}from"./DangerButton-BisdEsSm.js";import{g as Z}from"./TypePaiementService-B_JIeS4v.js";import{b as E}from"./clientService-MsxXbAou.js";import{P as ee}from"./PrimaryButton-D5tIvRy4.js";import{T as te}from"./TextArea-CpqgXbCB.js";import{S as I}from"./SelectInput-CTN8E1E8.js";import{I as ae}from"./InputAutocomplete -BdvPdsYi.js";import{g as se,a as le,u as ne,c as re}from"./PaiementService-CKLld2nW.js";import{S as oe}from"./Snackbar-BanJxzZ7.js";import{F as ie}from"./FichierPaiementPdf-CyGjBwSO.js";import{s as me,h as R}from"./constant-BwN-RMpC.js";import"./createLucideIcon-DzUSzV4h.js";import"./api-B4o5EXgG.js";import"./iconBase-yTY5GPQ3.js";const ce=({data:c,setData:m})=>{const[r,i]=w.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);w.useEffect(()=>{c.produits&&c.produits.length>0&&i(c.produits)},[c.produits]);const n=l=>{const t=parseFloat(l.quantite)||0,u=parseFloat(l.prix_unitaire)||0,N=parseFloat(l.tva)||0,P=t*u,f=P*(1+N/100);return{total_ht:P,total_ttc:f}},a=(l,t,u)=>{const N=[...r];if(N[l][t]=u,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:f,total_ttc:b}=n(N[l]);N[l].total_ht=f,N[l].total_ttc=b}i(N);const P={produits:N,description:c.description||"",montant_paye:g(N).totalTTCGlobal.toFixed(2)};m(f=>({...f,...P}))},g=l=>{const t=f=>{const b=parseFloat(f);return isNaN(b)?0:b},u=l.reduce((f,b)=>f+t(b.total_ht),0),N=l.reduce((f,b)=>f+t(b.total_ttc),0),P=l.reduce((f,b)=>{const G=t(b.tva),O=t(b.total_ht);return f+O*G/100},0);return{totalHTGlobal:parseFloat(u.toFixed(2)),totalTTCGlobal:parseFloat(N.toFixed(2)),totalTVAGlobal:parseFloat(P.toFixed(2))}},{totalHTGlobal:j,totalTTCGlobal:D,totalTVAGlobal:F}=g(r),C=()=>{const l=[...r,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];i(l),m(t=>({...t,produits:l}))},T=l=>{const t=r.filter((N,P)=>P!==l);i(t);const u=g(t);m(N=>({...N,produits:t,montant_paye:u.totalTTCGlobal.toFixed(2)}))},S=l=>{const t=l.target.value;m(u=>({...u,description:t}))},k=l=>{const t=parseFloat(l);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[e.jsx("div",{className:"block lg:hidden",children:r.map((l,t)=>e.jsxs("div",{className:"relative p-4 mb-4 border border-gray-200 rounded-lg",children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full -top-2 -right-2",onClick:()=>T(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(d,{id:`designation-${t}`,name:"designation",value:l.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:u=>a(t,"designation",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(d,{id:`reference-${t}`,name:"reference",value:l.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:u=>a(t,"reference",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:l.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:u=>a(t,"quantite",u.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(d,{id:`unite-${t}`,name:"unite",value:l.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:u=>a(t,"unite",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(d,{id:`tva-${t}`,name:"tva",value:l.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:u=>a(t,"tva",u.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:l.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:u=>a(t,"prix_unitaire",u.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:k(l.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:k(l.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t))}),e.jsx("div",{className:"hidden lg:block",children:r.map((l,t)=>e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(d,{id:`designation-${t}`,name:"designation",value:l.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:u=>a(t,"designation",u.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`reference-${t}`,name:"reference",value:l.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:u=>a(t,"reference",u.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:l.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:u=>a(t,"quantite",u.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`unite-${t}`,name:"unite",value:l.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:u=>a(t,"unite",u.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`tva-${t}`,name:"tva",value:l.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:u=>a(t,"tva",u.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:l.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:u=>a(t,"prix_unitaire",u.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:k(l.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:k(l.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute w-5 h-5 text-xs text-white bg-red-500 rounded-full -right-2 -top-2",onClick:()=>T(t),children:"×"})]},t))}),e.jsx(te,{name:"description",value:c.description||"",placeholder:"Description",onChange:S,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:C,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:j.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:F.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:D.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},ue=({data:c,setData:m,validationErrors:r,errors:i,setValidationErrors:n})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"type",value:"Type"}),e.jsx(I,{id:"type",name:"type",value:c.type,className:"block w-full mt-1",autoComplete:"type",onChange:a=>m("type",a.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(x,{message:r.type||i.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"numero",value:"N*"}),e.jsx(d,{id:"numero",name:"numero",value:c.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:a=>m("numero",a.target.value),required:!0,disabled:!0,onFocus:()=>n({...r,numero:""})}),e.jsx(x,{message:r.numero||i.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(d,{id:"date_creation",name:"date_creation",value:c.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:a=>m("date_creation",a.target.value),type:"date",required:!0,onFocus:()=>n({...r,date_creation:""})}),e.jsx(x,{message:r.date_creation||i.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(d,{id:"lieu_creation",name:"lieu_creation",value:c.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:a=>m("lieu_creation",a.target.value),required:!0,onFocus:()=>n({...r,lieu_creation:""})}),e.jsx(x,{message:r.lieu_creation||i.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(I,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:c.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:a=>m("date_additionnel",a.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(x,{message:i.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"date",value:"*"}),e.jsx(d,{id:"date",name:"date",value:c.date,className:"block w-full mt-1",autoComplete:"date",onChange:a=>m("date",a.target.value),required:!0,type:"date",onFocus:()=>n({...r,date:""})})]})]}),de=({clients:c,data:m,setData:r,errors:i,validationErrors:n,setValidationErrors:a,handleSelect:g})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(o,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(I,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:m.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:j=>r("civilite_acheteur",j.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(x,{message:i.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(ae,{data:c,className:"block w-full mt-1",onSelect:g,defaultValue:m.client_id,onFocus:()=>a({...n,client_id:""})}),e.jsx(x,{message:n.prenom_acheteur||i.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(d,{id:"nom_acheteur",name:"nom_acheteur",value:m.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:j=>r("nom_acheteur",j.target.value),required:!0,onFocus:()=>a({...n,nom_acheteur:""})}),e.jsx(x,{message:n.nom_acheteur||i.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(d,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:m.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:j=>r("num_rue_acheteur",j.target.value),required:!0,onFocus:()=>a({...n,num_rue_acheteur:""})}),e.jsx(x,{message:n.num_rue_acheteur||i.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(d,{id:"ville_acheteur",name:"ville_acheteur",value:m.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:j=>r("ville_acheteur",j.target.value),required:!0,onFocus:()=>a({...n,ville_acheteur:""})}),e.jsx(x,{message:n.ville_acheteur||i.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(d,{id:"pays_acheteur",name:"pays_acheteur",value:m.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:j=>r("pays_acheteur",j.target.value),required:!0,onFocus:()=>a({...n,pays_acheteur:""})}),e.jsx(x,{message:n.pays_acheteur||i.pays_acheteur,className:"mt-2"})]})]})]})]}),he=({data:c,setData:m,errors:r,validationErrors:i,setValidationErrors:n})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(d,{id:"nom_vendeurs",name:"nom_vendeurs",value:c.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:a=>m("nom_vendeurs",a.target.value),required:!0,onFocus:()=>n({...i,nom_vendeurs:""})}),e.jsx(x,{message:i.nom_vendeurs||r.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(o,{htmlFor:"select1",value:"Type"}),e.jsx(I,{id:"select1",type:"select1",name:"select1",value:c.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:a=>m("select1",a.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(d,{id:"num_tva",name:"num_tva",value:c.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:a=>m("num_tva",a.target.value),required:!0,onFocus:()=>n({...i,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(x,{message:i.num_tva||r.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(d,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:c.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:a=>m("nom_rue_vendeur",a.target.value),required:!0,onFocus:()=>n({...i,nom_rue_vendeur:""})}),e.jsx(x,{message:i.nom_rue_vendeur||r.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(d,{id:"ville_vendeur",name:"ville_vendeur",value:c.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:a=>m("ville_vendeur",a.target.value),required:!0,onFocus:()=>n({...i,ville_vendeur:""})}),e.jsx(x,{message:i.ville_vendeur||r.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(d,{id:"pays_vendeur",name:"pays_vendeur",value:c.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:a=>m("pays_vendeur",a.target.value),required:!0,onFocus:()=>n({...i,pays_vendeur:""})}),e.jsx(x,{message:i.pays_vendeur||r.pays_vendeur,className:"mt-2"})]})]})]})]}),pe=({data:c,errors:m,setData:r,setValidationErrors:i,validationErrors:n,typePaiement:a})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(I,{id:"mode_paiement",name:"mode_paiement",value:c.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:g=>r("mode_paiement",g.target.value),required:!0,children:a.map(g=>e.jsx("option",{value:g.nom,children:g.nom},g.id))}),e.jsx(x,{message:n.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(d,{id:"date_echeance",name:"date_echeance",value:c.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:g=>r("date_echeance",g.target.value),required:!0,type:"date",onFocus:()=>i({...n,date_echeance:""})}),e.jsx(x,{message:n.date_echeance||m.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(d,{id:"nom_vendeur",name:"nom_vendeur",value:c.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:g=>r("nom_vendeur",g.target.value),required:!0,onFocus:()=>i({...n,nom_vendeur:""})}),e.jsx(x,{message:n.nom_vendeur||m.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"etat_paiment",value:"État"}),e.jsx(I,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:c.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:g=>r("etat_paiment",g.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(x,{message:n.etat_paiment||m.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"montant_paye",name:"montant_paye",value:c.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:g=>r("montant_paye",g.target.value),required:!0,onFocus:()=>i({...n,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(x,{message:n.montant_paye||m.montant_paye,className:"mt-2"})]})]})]}),ve=async(c,m)=>{var r,i;try{const n=await X.post("/api/paiement/generate-and-send-pdf",{email:m,data:c});return n.data.success&&alert(n.data.message),n.data}catch(n){throw console.error("Erreur lors de l'envoi du PDF:",n),alert("Erreur lors de l'envoi du PDF: "+(((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||n.message)),n}};function _e(c){const m=/(\d{2}\/\d{2}\/\d{4})/g,r=c.match(m);if(!r||r.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const i=r[0],n=r[1],a=F=>{const[C,T,S]=F.split("/");return new Date(`${T}/${C}/${S}`)},g=a(i),j=a(n),D=F=>({object:F,iso:F.toISOString(),localeFormat:F.toLocaleDateString(),original:`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`});return{startDate:D(g),endDate:D(j),durationDays:Math.floor((j-g)/(1e3*60*60*24))}}const Oe=()=>{const{theme:c,setTheme:m}=J(),r=w.useRef(null),[i,n]=w.useState(!0),[a,g]=w.useState(null),[j,D]=w.useState(!1),{props:F}=B(),{client_id:C,amount:T,designation:S}=F,[k,l]=w.useState({}),[t,u]=w.useState([]),[N,P]=w.useState([]),[f,b]=w.useState({open:!1,message:"",type:"success"}),[G,O]=w.useState(""),$=new URLSearchParams(window.location.search).get("id"),{data:p,setData:y,errors:M,reset:Y}=z({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""});w.useEffect(()=>{let s=null;C&&(s=t.find(h=>h.id===parseInt(C))||t.find(h=>h.id===C)),y(h=>({...h,client_id:C,nom_acheteur:s==null?void 0:s.nom_famille,prenom_acheteur:s==null?void 0:s.nom,civilite_acheteur:(s==null?void 0:s.genre)==="Homme"?"Mr.":"Mme.",ville_acheteur:s==null?void 0:s.ville,pays_acheteur:s==null?void 0:s.pays,num_rue_acheteur:(s==null?void 0:s.village)||(s==null?void 0:s.quartier)}))},[C,t]),w.useEffect(()=>{y(s=>({...s,produits:[...s.produits,{designation:S,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:T,total_ht:T,total_ttc:T}],montant_paye:T,description:S,objet:S,date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0]}))},[T,S]);const H=async()=>{var s;try{const[{clients:h},v]=await Promise.all([E(),Z()]);u(h==null?void 0:h.map(_=>({id:_.id,nom:_.prenom,nom_famille:_.nom,ville:_.localisation,pays:"Togo",village:_.localisation,quartier:_.localisation,email:_.email,genre:_.genre,telephone:_.telephone,localisation:_.localisation}))),P((s=v.type)==null?void 0:s.map(_=>({id:_.id,nom:_.name})))}catch(h){console.error("Error fetching payment types:",h)}},U=async s=>{try{const h=await se(s);if(h){const v=h;let _=null;C?_=t.find(q=>q.id===parseInt(C))||t.find(q=>q.id===C):_=t.find(q=>q.id===v.client_id);const A=_e(v.periode_couverte);p.periode_couverte=A.startDate.original+" au "+A.endDate.original,_&&(y({...p,numero:v.numero,nom_acheteur:_.nom_famille,prenom_acheteur:_.nom,civilite_acheteur:_.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:_.ville,pays_acheteur:_.pays,num_rue_acheteur:_.village||_.quartier,client_id:_.id,objet:v.observation,description:v.description,mode_paiement:v.mode_paiement,date_echeance:v.echeance,statut_paiement:v.statut_paiement,produits:v.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseFloat(v.montant).toFixed(2),date_creation:v.date_creation||A.startDate.original,date:v.date||A.endDate.original,lieu_creation:v.lieu_creation,date_additionnel:v.date_additionnel,nom_vendeur:v.nom_vendeur,nom_vendeurs:v.nom_vendeurs,select1:v.select1,num_tva:v.num_tva,nom_rue_vendeur:v.nom_rue_vendeur,ville_vendeur:v.ville_vendeur,pays_vendeur:v.pays_vendeur}),O(_.email)),D(!0)}}catch(h){console.error("Error fetching payment data:",h),b({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};w.useEffect(()=>{m(c||"light"),H()},[c]),w.useEffect(()=>{t.length>0&&$&&U($)},[t,$]);const L=async()=>{const{data:s}=await le();s&&y("numero",me(s.numero))};w.useEffect(()=>{$||L()},[$]);const Q=s=>{const h=t.find(v=>v.id===s.id);h&&(y("client_id",h.id),y("nom_acheteur",h.nom_famille),y("prenom_acheteur",h.nom),y("ville_acheteur",h.ville),y("pays_acheteur",h.pays),y("num_rue_acheteur",h.village||h.quartier),y("civilite_acheteur",h.genre==="Homme"?"Mr.":"Mme."),O(h.email))},V=async()=>{p.periode_couverte=R(p.date_creation).format("DD/MM/YYYY")+" au "+R(p.date).format("DD/MM/YYYY"),p.date_paiement=p.date_paiement?new Date(p.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],p.observation=p.objet,p.echeance=p.date_echeance,p.statut_paiement=p.etat_paiment,p.montant_paye=p.montant_paye||"0",p.montant=p.montant_paye||"0",j&&$&&(p.id=$);try{let s;j?s=await ne($,p):s=await re(p),b({open:!0,message:s.message,type:s.success?"success":"error"}),s.success&&(setTimeout(async()=>{if(Y(),window.history.back(),C&&T&&S)try{const v=await(await fetch(`/api/clients/${C}/is-paid`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_payed:!0})})).json();console.log("Mise à jour is_payed:",v)}catch(h){console.error("Erreur mise à jour client:",h)}},3e3),ve(p,G))}catch(s){console.error("Error submitting payment:",s),b({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(K,{title:j?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(oe,{message:f.message,type:f.type,duration:3e3,position:"top-right",show:f.open,onClose:()=>b({...f,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(W,{onClick:()=>window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:j?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ue,{data:p,errors:M,setData:y,validationErrors:k,setValidationErrors:l})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(he,{data:p,errors:M,setData:y,setValidationErrors:l,validationErrors:k})}),e.jsx("div",{className:"space-y-4",children:e.jsx(de,{clients:t,data:p,errors:M,handleSelect:Q,setData:y,setValidationErrors:l,validationErrors:k})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(o,{htmlFor:"objet",value:"Objet"}),e.jsx(d,{id:"objet",name:"objet",value:p.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:s=>y("objet",s.target.value),required:!0,onFocus:()=>l({...k,objet:""})}),e.jsx(x,{message:k.objet||M.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(ce,{data:p,setData:y})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(pe,{data:p,errors:M,setData:y,setValidationErrors:l,typePaiement:N,validationErrors:k})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(ee,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:V,children:j?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:i&&a&&e.jsx("div",{ref:r,children:e.jsx(ie,{data:a})})})]})};export{Oe as default};
