import{j as e,r as k,$ as J}from"./app-C3sor9L4.js";import{A as L}from"./AuthenticatedLayout-CLwVZ-wy.js";import{a as K}from"./clientService-hyM6e_BQ.js";import{h as x,a as g,F as Q,b as X,c as B,H as Z,d as ee,e as O,g as te,i as se,j as ae,k as re,I as ne,l as le,L as de}from"./constant-B3AJgSY9.js";import"./fr-Br33CVeN.js";import{E as ie}from"./EmptyState-DUOD9pSV.js";import"./transition-B6nE3wWa.js";import"./iconBase-9uOaMuco.js";import"./useTheme-DlLaRjSD.js";import"./index-1F4s39e6.js";import"./Modal-BWcsPSCo.js";import"./index-QRAOQUCe.js";import"./createLucideIcon-BXQGW1cT.js";import"./api-Bbx9t1jZ.js";x.locale("fr");const ce=({paiement:t,getStatusColor:d,getStatusBadge:r})=>{var n;if(!t)return null;const l=(c,y)=>{if(!c||!y)return"";const f=x(c),u=x(y);return f.isBefore(u,"day")?"(en avance)":f.isSame(u,"day")?"(à temps)":"(en retard)"},i=t.date_paiement?l(t.date_paiement,t.date_echeance):"";return e.jsx("div",{className:`p-4 mb-4 border-2 rounded-lg ${d(t.statut_paiement)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Installation"}),t.date_paiement&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x(t.date_paiement).format("DD MMM YYYY")})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(t.montant)," FCFA"]}),r(t.statut_paiement,t.date_echeance),t.date_paiement&&((n=t.statut_paiement)==null?void 0:n.toLowerCase())==="payé"&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["le"," ",x(t.date_paiement).format("DD MMM YYYY")," ",i]})]})]})})},xe=({montantPaye:t,montantRestant:d,pourcentagePaye:r,trimestresPayes:l,trimestresRestants:i,nombreTrimestres:n})=>e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Vue d'ensemble"}),e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsxs("div",{className:"relative w-40 h-40",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",strokeDasharray:`${r*2.51} ${251-r*2.51}`,className:"text-green-500 transition-all duration-500",strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[r,"%"]})})]})}),e.jsx("h4",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Progression"}),e.jsx("div",{className:"w-full h-3 mb-4 overflow-hidden bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx("div",{className:"h-full transition-all duration-500 bg-gradient-to-r from-green-500 to-blue-500",style:{width:`${r}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4 ",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant payé"}),e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(t)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant restant"}),e.jsxs("p",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:[g(d)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres payés"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[l," / ",n]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres restants"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:i})]})]})]}),oe=({trimestre:t,getStatusColor:d,getStatusBadge:r,isDernierTrimestre:l})=>{var c;const i=((c=t.statut_paiement)==null?void 0:c.toLowerCase())==="payé",n=Math.max(t.montant_attendu-t.montant,0);return e.jsxs("div",{className:`p-4 border-2 rounded-lg transition-all ${d(t.statut_paiement,t.estIncomplet)}`,children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[t.echeance,l&&e.jsx("span",{className:"ml-2 text-xs font-normal text-orange-600 dark:text-orange-400",children:"(Dernier)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.periode})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[g(t.montant)," FCFA"]}),t.estIncomplet&&e.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:["Reste : ",g(n)," FCFA"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.statut_paiement,t.date_echeance,t.estIncomplet),e.jsx("span",{className:`text-xs ${t.remarque.color}`,children:t.remarque.text})]}),i&&t.date_paiement&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["le"," ",x(t.date_paiement).format("DD MMM YYYY")]})]})]})},me=({paiementsTrimestres:t,paiementInstallation:d,getStatusColor:r,getStatusBadge:l,nombreTrimestres:i})=>e.jsxs("div",{className:"p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Calendrier des Paiements"}),e.jsx(ce,{paiement:d,getStatusColor:r,getStatusBadge:l}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:t.map((n,c)=>e.jsx(oe,{trimestre:n,getStatusColor:r,getStatusBadge:l,isDernierTrimestre:c===i-1},n.id))})]}),ge=({paiements:t,client:d})=>{var P;if(!t||t.length===0)return null;const l=3*4,i=18e3,n=22e3,c=t.find(a=>{var s;return((s=a.echeance)==null?void 0:s.toLowerCase())==="installation"}),y=t.filter(a=>{var s;return(s=a.echeance)==null?void 0:s.match(/^T\d+$/i)}),f=(c==null?void 0:c.date_paiement)||((P=y[0])==null?void 0:P.date_paiement)||new Date,u=t.reduce((a,s)=>{if(!s.echeance)return a;const o=s.echeance.toUpperCase();return a[o]||(a[o]=[]),a[o].push(s),a},{}),M=(a,s)=>{if(!a||!s)return"";const o=x(a),h=x(s);return o.isBefore(h,"month")?{color:"text-green-500",text:"(en avance)"}:o.isSame(h,"month")?{color:"text-blue-500",text:"(à temps)"}:{color:"text-red-500",text:"(en retard)"}},Y=Array.from({length:l},(a,s)=>{const o=s+1,h=`T${String(o).padStart(2,"0")}`,C=o===l?n:i,A=u[h]||[],_=A.reduce((b,j)=>{var H;return((H=j.statut_paiement)==null?void 0:H.toLowerCase())==="payé"?b+parseFloat(j.montant||0):b},0),W=_>0&&_<C,D=_>=C?"payé":_>0?"incomplet":"en attente",S=A.filter(b=>{var j;return((j=b.statut_paiement)==null?void 0:j.toLowerCase())==="payé"}).sort((b,j)=>new Date(j.date_paiement)-new Date(b.date_paiement))[0],E=S?S.date_paiement:null,R=x(f).add(s*3,"months"),T=x(R).add(2,"months"),G=`${R.format("MMM YYYY")} – ${T.format("MMM YYYY")}`,z=(D==null?void 0:D.toLowerCase())==="payé"?M(E,T):"";return{id:`trim-${o}`,echeance:h,periode:G,montant:_,montant_attendu:C,statut_paiement:D,date_echeance:T.format("YYYY-MM-DD"),date_paiement:E,estIncomplet:W,remarque:z}}),F=i*(l-1)+n,N=(c?parseFloat(c.montant):0)+F,p=t.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).reduce((a,s)=>a+parseFloat(s.montant||0),0),w=N-p,m=N>0?Math.round(p/N*100):0,I=Y.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).length,$=l-I,U=(a,s)=>s?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-700":(a==null?void 0:a.toLowerCase())==="payé"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700":"bg-white border-gray-200 dark:bg-slate-800 dark:border-gray-700",V=(a,s,o)=>{const h=(a==null?void 0:a.toLowerCase())==="payé",C=!h&&s&&x(s).isBefore(x());return o?e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-600 dark:text-yellow-400",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Incomplet"})]}):h?e.jsxs("div",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Payé"})]}):C?e.jsxs("div",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"En retard"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-orange-600 dark:text-orange-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"À venir"})]})};return e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-6 border-b border-gray-200 md:grid-cols-4 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[g(N)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Payé"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[g(p)," FCFA"]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:[m,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Reste"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[g(w)," FCFA"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[$," trim."]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestriel"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[g(i)," FCFA"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"/3 mois"})]})]}),e.jsx(xe,{montantPaye:p,montantRestant:w,pourcentagePaye:m,trimestresPayes:I,trimestresRestants:$,montantTrimestrielNormal:i,nombreTrimestres:l}),e.jsx(me,{paiementsTrimestres:Y,paiementInstallation:c,getStatusColor:U,getStatusBadge:V,nombreTrimestres:l})]})},v=({icon:t,label:d,value:r,bgColor:l,iconColor:i})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg ${l}`,children:e.jsx(t,{className:`w-5 h-5 ${i}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:r||"Non renseigné"})]})]}),q=({message:t="Chargement des données..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 rounded-full border-t-transparent animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t})]})}),he=({client:t,installation:d})=>{const r=d&&d.length>0?d[0]:null;return e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col justify-between space-y-4 md:flex-row md:space-y-0 md:items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-teal-500/10",children:e.jsx(Z,{className:"w-8 h-8 text-teal-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.nom," ",t.prenom]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Client ID: #",t.id]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Inscrit le"," ",x(t.created_at).format("DD MMM YYYY")]})]})]})]}),r&&e.jsxs("div",{className:`flex items-center px-4 py-3 space-x-3 rounded-lg text-white border-2 ${r.statuts==="installée"?"border-green-500":"border-red-500"}`,children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-yellow-500/20",children:e.jsx(ee,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase dark:text-gray-400",children:"Installation"}),e.jsx("p",{className:"text-base font-bold text-gray-900 dark:text-white",children:r.code_installation||"N/A"}),r.date_installation&&e.jsxs("div",{className:"flex items-center mt-1 space-x-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:x(r.date_installation).format("DD MMM YYYY")})]})]})]})]})})};x.locale("fr");const Fe=({client:t})=>{var F;const[d,r]=k.useState([]),[l,i]=k.useState([]),[n,c]=k.useState(null),[y,f]=k.useState(!0),[u,M]=k.useState(!0),Y=async N=>{var p,w;try{M(!0);const m=await K(N);m&&(i(((p=m.client)==null?void 0:p.installations)||[]),r(((w=m.client)==null?void 0:w.paiement)||[]),c(m.client))}catch(m){console.error("Erreur lors de la récupération des données:",m)}finally{f(!1),M(!1)}};return k.useEffect(()=>{t!=null&&t.id&&Y(t.id)},[t]),y?e.jsx(L,{children:e.jsx(q,{})}):t?e.jsxs(L,{children:[e.jsx(J,{title:`${t.nom} ${t.prenom}`}),u?e.jsx(q,{}):e.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsx(he,{client:t,installation:l}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 p-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{icon:te,label:"Téléphone",value:t.telephone,bgColor:"bg-blue-50 dark:bg-blue-900/20",iconColor:"text-blue-600 dark:text-blue-400"}),e.jsx(v,{icon:se,label:"Email",value:t.email,bgColor:"bg-indigo-50 dark:bg-indigo-900/20",iconColor:"text-indigo-600 dark:text-indigo-400"}),e.jsx(v,{icon:ae,label:"CIN",value:t.CIN,bgColor:"bg-yellow-50 dark:bg-yellow-900/20",iconColor:"text-yellow-600 dark:text-yellow-400"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-red-50 dark:bg-red-900/20",children:e.jsx(re,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:(n==null?void 0:n.localisation)||"Non renseigné"}),((F=n==null?void 0:n.localisation)==null?void 0:F.pays)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n.localisation.pays})]})]}),e.jsx(v,{icon:ne,label:"Genre",value:t.genre,bgColor:"bg-purple-50 dark:bg-purple-900/20",iconColor:"text-purple-600 dark:text-purple-400"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-orange-50 dark:bg-orange-900/20",children:e.jsx(O,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Date du contrat"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:x(t.date_contrat).format("DD MMM YYYY")})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{icon:le,label:"Surface cultivée",value:`${t.surface_cultivee} ha`,bgColor:"bg-green-50 dark:bg-green-900/20",iconColor:"text-green-600 dark:text-green-400"}),e.jsx(v,{icon:de,label:"Type d'activité agricole",value:t.type_activite_agricole,bgColor:"bg-teal-50 dark:bg-teal-900/20",iconColor:"text-teal-600 dark:text-teal-400"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 bg-gray-100 rounded-lg dark:bg-gray-900/50",children:"⚙️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Créée via"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:t.created_via||"Non renseigné"})]})]})]})]})]}),e.jsx(ge,{paiements:d,client:t})]})})]}):e.jsx(L,{children:e.jsx(ie,{message:"Aucune donnée client disponible"})})};export{Fe as default};
