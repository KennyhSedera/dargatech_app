import{r as w,j as e,e as K,q as J,v as W,$ as Z}from"./app-Cob9HbXO.js";import{I as o}from"./InputLabel-CUFPKeCw.js";import{T as h,I as f}from"./TextInput-Bctdj7nG.js";import{u as E}from"./useTheme-BpFgSPIB.js";import{D as ee}from"./DangerButton-C-qEOzHG.js";import{g as te}from"./TypePaiementService-BFvJcv97.js";import{b as ae}from"./clientService-DE-ATc4z.js";import{P as se}from"./PrimaryButton-AhTmb4dh.js";import{T as le}from"./TextArea-iFsaez8F.js";import{S as O}from"./SelectInput-NsaMhx3Z.js";import{I as ne}from"./InputAutocomplete -Dm6yGkTg.js";import{a as re,b as oe,u as ie,c as me}from"./PaiementService-tUMBGyiF.js";import{S as ce}from"./Snackbar-ClJduyzr.js";import{F as ue}from"./FichierPaiementPdf-SQ4_mbR7.js";import{A as de,h as H}from"./constant-CVQSjBqd.js";import"./createLucideIcon-pOJUdN2G.js";import"./api-D4-mOWOr.js";import"./iconBase-CgiQbB3O.js";const he=({data:u,setData:i})=>{const[r,d]=w.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);w.useEffect(()=>{u.produits&&u.produits.length>0&&d(u.produits)},[u.produits]);const m=n=>{const t=parseFloat(n.quantite)||0,c=parseFloat(n.prix_unitaire)||0,j=parseFloat(n.tva)||0,P=t*c,C=P*(1+j/100);return{total_ht:P,total_ttc:C}},a=(n,t,c)=>{const j=[...r];if(j[n][t]=c,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:C,total_ttc:T}=m(j[n]);j[n].total_ht=C,j[n].total_ttc=T}d(j);const P={produits:j,description:u.description||"",montant_paye:p(j).totalTTCGlobal.toFixed(2)};i(C=>({...C,...P}))},p=n=>{const t=C=>{const T=parseFloat(C);return isNaN(T)?0:T},c=n.reduce((C,T)=>C+t(T.total_ht),0),j=n.reduce((C,T)=>C+t(T.total_ttc),0),P=n.reduce((C,T)=>{const $=t(T.tva),I=t(T.total_ht);return C+I*$/100},0);return{totalHTGlobal:parseFloat(c.toFixed(2)),totalTTCGlobal:parseFloat(j.toFixed(2)),totalTVAGlobal:parseFloat(P.toFixed(2))}},{totalHTGlobal:y,totalTTCGlobal:A,totalTVAGlobal:b}=p(r),G=()=>{const n=[...r,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];d(n),i(t=>({...t,produits:n}))},D=n=>{const t=r.filter((j,P)=>P!==n);d(t);const c=p(t);i(j=>({...j,produits:t,montant_paye:c.totalTTCGlobal.toFixed(2)}))},F=n=>{const t=n.target.value;i(c=>({...c,description:t}))},q=n=>{const t=parseFloat(n);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[e.jsx("div",{className:"block lg:hidden",children:r.map((n,t)=>e.jsxs("div",{className:"relative p-4 mb-4 border border-gray-200 rounded-lg",children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full -top-2 -right-2",onClick:()=>D(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(h,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:c=>a(t,"designation",c.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(h,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:c=>a(t,"reference",c.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:c=>a(t,"quantite",c.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(h,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:c=>a(t,"unite",c.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(h,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:c=>a(t,"tva",c.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:c=>a(t,"prix_unitaire",c.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:q(n.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:q(n.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t))}),e.jsx("div",{className:"hidden lg:block",children:r.map((n,t)=>e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(h,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:c=>a(t,"designation",c.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:c=>a(t,"reference",c.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:c=>a(t,"quantite",c.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:c=>a(t,"unite",c.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:c=>a(t,"tva",c.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:c=>a(t,"prix_unitaire",c.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:q(n.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:q(n.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute w-5 h-5 text-xs text-white bg-red-500 rounded-full -right-2 -top-2",onClick:()=>D(t),children:"×"})]},t))}),e.jsx(le,{name:"description",value:u.description||"",placeholder:"Description",onChange:F,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:G,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:y.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:b.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:A.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},pe=({data:u,setData:i,validationErrors:r,errors:d,setValidationErrors:m})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"type",value:"Type"}),e.jsx(O,{id:"type",name:"type",value:u.type,className:"block w-full mt-1",autoComplete:"type",onChange:a=>i("type",a.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(f,{message:r.type||d.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"numero",value:"N*"}),e.jsx(h,{id:"numero",name:"numero",value:u.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:a=>i("numero",a.target.value),required:!0,disabled:!0,onFocus:()=>m({...r,numero:""})}),e.jsx(f,{message:r.numero||d.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(h,{id:"date_creation",name:"date_creation",value:u.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:a=>i("date_creation",a.target.value),type:"date",required:!0,onFocus:()=>m({...r,date_creation:""})}),e.jsx(f,{message:r.date_creation||d.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(h,{id:"lieu_creation",name:"lieu_creation",value:u.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:a=>i("lieu_creation",a.target.value),required:!0,onFocus:()=>m({...r,lieu_creation:""})}),e.jsx(f,{message:r.lieu_creation||d.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(O,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:u.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:a=>i("date_additionnel",a.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(f,{message:d.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"date",value:"*"}),e.jsx(h,{id:"date",name:"date",value:u.date,className:"block w-full mt-1",autoComplete:"date",onChange:a=>i("date",a.target.value),required:!0,type:"date",onFocus:()=>m({...r,date:""})})]})]}),ve=({clients:u,data:i,setData:r,errors:d,validationErrors:m,setValidationErrors:a,handleSelect:p})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(o,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(O,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:i.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:y=>r("civilite_acheteur",y.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(f,{message:d.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(ne,{data:u,className:"block w-full mt-1",onSelect:p,defaultValue:i.client_id,onFocus:()=>a({...m,client_id:""})}),e.jsx(f,{message:m.prenom_acheteur||d.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(h,{id:"nom_acheteur",name:"nom_acheteur",value:i.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:y=>r("nom_acheteur",y.target.value),required:!0,onFocus:()=>a({...m,nom_acheteur:""})}),e.jsx(f,{message:m.nom_acheteur||d.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(h,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:i.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:y=>r("num_rue_acheteur",y.target.value),required:!0,onFocus:()=>a({...m,num_rue_acheteur:""})}),e.jsx(f,{message:m.num_rue_acheteur||d.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(h,{id:"ville_acheteur",name:"ville_acheteur",value:i.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:y=>r("ville_acheteur",y.target.value),required:!0,onFocus:()=>a({...m,ville_acheteur:""})}),e.jsx(f,{message:m.ville_acheteur||d.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(h,{id:"pays_acheteur",name:"pays_acheteur",value:i.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:y=>r("pays_acheteur",y.target.value),required:!0,onFocus:()=>a({...m,pays_acheteur:""})}),e.jsx(f,{message:m.pays_acheteur||d.pays_acheteur,className:"mt-2"})]})]})]})]}),_e=({data:u,setData:i,errors:r,validationErrors:d,setValidationErrors:m})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(h,{id:"nom_vendeurs",name:"nom_vendeurs",value:u.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:a=>i("nom_vendeurs",a.target.value),required:!0,onFocus:()=>m({...d,nom_vendeurs:""})}),e.jsx(f,{message:d.nom_vendeurs||r.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(o,{htmlFor:"select1",value:"Type"}),e.jsx(O,{id:"select1",type:"select1",name:"select1",value:u.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:a=>i("select1",a.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(h,{id:"num_tva",name:"num_tva",value:u.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:a=>i("num_tva",a.target.value),required:!0,onFocus:()=>m({...d,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(f,{message:d.num_tva||r.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(h,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:u.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:a=>i("nom_rue_vendeur",a.target.value),required:!0,onFocus:()=>m({...d,nom_rue_vendeur:""})}),e.jsx(f,{message:d.nom_rue_vendeur||r.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(h,{id:"ville_vendeur",name:"ville_vendeur",value:u.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:a=>i("ville_vendeur",a.target.value),required:!0,onFocus:()=>m({...d,ville_vendeur:""})}),e.jsx(f,{message:d.ville_vendeur||r.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(h,{id:"pays_vendeur",name:"pays_vendeur",value:u.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:a=>i("pays_vendeur",a.target.value),required:!0,onFocus:()=>m({...d,pays_vendeur:""})}),e.jsx(f,{message:d.pays_vendeur||r.pays_vendeur,className:"mt-2"})]})]})]})]}),ge=({data:u,errors:i,setData:r,setValidationErrors:d,validationErrors:m,typePaiement:a})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(O,{id:"mode_paiement",name:"mode_paiement",value:u.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:p=>r("mode_paiement",p.target.value),required:!0,children:a.map(p=>e.jsx("option",{value:p.nom,children:p.nom},p.id))}),e.jsx(f,{message:m.mode_paiement||i.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(h,{id:"date_echeance",name:"date_echeance",value:u.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:p=>r("date_echeance",p.target.value),required:!0,type:"date",onFocus:()=>d({...m,date_echeance:""})}),e.jsx(f,{message:m.date_echeance||i.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(h,{id:"nom_vendeur",name:"nom_vendeur",value:u.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:p=>r("nom_vendeur",p.target.value),required:!0,onFocus:()=>d({...m,nom_vendeur:""})}),e.jsx(f,{message:m.nom_vendeur||i.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"etat_paiment",value:"État"}),e.jsx(O,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:u.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:p=>r("etat_paiment",p.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(f,{message:m.etat_paiment||i.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"montant_paye",name:"montant_paye",value:u.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:p=>r("montant_paye",p.target.value),required:!0,onFocus:()=>d({...m,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(f,{message:m.montant_paye||i.montant_paye,className:"mt-2"})]})]})]}),xe=async(u,i,r,d)=>{var m,a;try{const p=await K.post("/api/paiement/generate-and-send-pdf",{email:i,data:u,telegram_chat_id:r});return p.data.success,p.data}catch(p){throw console.error("Erreur lors de l'envoi du PDF:",p),alert("Erreur lors de l'envoi du PDF: "+(((a=(m=p.response)==null?void 0:m.data)==null?void 0:a.message)||p.message)),p}};function je(u){const i=/(\d{2}\/\d{2}\/\d{4})/g,r=u.match(i);if(!r||r.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const d=r[0],m=r[1],a=b=>{const[G,D,F]=b.split("/");return new Date(`${D}/${G}/${F}`)},p=a(d),y=a(m),A=b=>({object:b,iso:b.toISOString(),localeFormat:b.toLocaleDateString(),original:`${b.getFullYear()}-${(b.getMonth()+1).toString().padStart(2,"0")}-${b.getDate().toString().padStart(2,"0")}`});return{startDate:A(p),endDate:A(y),durationDays:Math.floor((y-p)/(1e3*60*60*24))}}const Re=({token_data:u,telegramback:i})=>{const{theme:r,setTheme:d}=E(),m=w.useRef(null),[a,p]=w.useState(!0),[y,A]=w.useState(null),[b,G]=w.useState(!1),{props:D}=J(),{client_id:F,amount:q,designation:n}=D,[t,c]=w.useState({}),[j,P]=w.useState([]),[C,T]=w.useState([]),[$,I]=w.useState({open:!1,message:"",type:"success"}),[U,Y]=w.useState(""),S=new URLSearchParams(window.location.search).get("id"),{data:x,setData:N,errors:R,reset:L}=W({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""});w.useEffect(()=>{let l=null;F&&(l=j.find(v=>v.id===parseInt(F))||j.find(v=>v.id===F)),N(v=>({...v,client_id:F,nom_acheteur:l==null?void 0:l.nom_famille,prenom_acheteur:l==null?void 0:l.nom,civilite_acheteur:(l==null?void 0:l.genre)==="Homme"?"Mr.":"Mme.",ville_acheteur:l==null?void 0:l.ville,pays_acheteur:l==null?void 0:l.pays,num_rue_acheteur:(l==null?void 0:l.village)||(l==null?void 0:l.quartier)}))},[F,j]),w.useEffect(()=>{N(l=>({...l,produits:[...l.produits,{designation:n,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:q,total_ht:q,total_ttc:q}],montant_paye:q,description:n,objet:n,date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0]}))},[q,n]);const Q=async()=>{var l;try{const[{clients:v},_]=await Promise.all([ae(),te()]);P(v==null?void 0:v.map(g=>({id:g.id,nom:g.prenom,nom_famille:g.nom,ville:g.localisation,pays:"Togo",village:g.localisation,quartier:g.localisation,email:g.email,genre:g.genre,telephone:g.telephone,localisation:g.localisation}))),T((l=_.type)==null?void 0:l.map(g=>({id:g.id,nom:g.name})))}catch(v){console.error("Error fetching payment types:",v)}},V=async l=>{try{const v=await re(l);if(v){const _=v;let g=null;F?g=j.find(k=>k.id===parseInt(F))||j.find(k=>k.id===F):g=j.find(k=>k.id===_.client_id);const M=je(_.periode_couverte);x.periode_couverte=M.startDate.original+" au "+M.endDate.original,g&&(N({...x,numero:_.numero,nom_acheteur:g.nom_famille,prenom_acheteur:g.nom,civilite_acheteur:g.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:g.ville,pays_acheteur:g.pays,num_rue_acheteur:g.village||g.quartier,client_id:g.id,objet:_.observation,description:_.description,mode_paiement:_.mode_paiement,date_echeance:_.echeance,statut_paiement:_.statut_paiement,produits:_.produits.map(k=>({...k,designation:k.designation,prix_unitaire:k.prix_unitaire,quantite:k.quantite,unite:k.unite})),montant_paye:parseFloat(_.montant).toFixed(2),date_creation:_.date_creation||M.startDate.original,date:_.date||M.endDate.original,lieu_creation:_.lieu_creation,date_additionnel:_.date_additionnel,nom_vendeur:_.nom_vendeur,nom_vendeurs:_.nom_vendeurs,select1:_.select1,num_tva:_.num_tva,nom_rue_vendeur:_.nom_rue_vendeur,ville_vendeur:_.ville_vendeur,pays_vendeur:_.pays_vendeur}),Y(g.email)),G(!0)}}catch(v){console.error("Error fetching payment data:",v),I({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};w.useEffect(()=>{d(r||"light"),Q()},[r]),w.useEffect(()=>{j.length>0&&S&&V(S)},[j,S]);const X=async()=>{const{data:l}=await oe();l&&N("numero",de(l.numero))};w.useEffect(()=>{S||X()},[S]);const B=l=>{const v=j.find(_=>_.id===l.id);v&&(N("client_id",v.id),N("nom_acheteur",v.nom_famille),N("prenom_acheteur",v.nom),N("ville_acheteur",v.ville),N("pays_acheteur",v.pays),N("num_rue_acheteur",v.village||v.quartier),N("civilite_acheteur",v.genre==="Homme"?"Mr.":"Mme."),Y(v.email))},z=async()=>{x.periode_couverte=H(x.date_creation).format("DD/MM/YYYY")+" au "+H(x.date).format("DD/MM/YYYY"),x.date_paiement=x.date_paiement?new Date(x.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],x.observation=x.objet,x.echeance=x.date_echeance,x.statut_paiement=x.etat_paiment,x.montant_paye=x.montant_paye||"0",x.montant=x.montant_paye||"0",b&&S&&(x.id=S);try{let l;if(b?l=await ie(S,x):l=await me(x),I({open:!0,message:l.message,type:l.success?"success":"error"}),l.success){setTimeout(async()=>{if(L(),u?i(l.message):window.history.back(),F&&q&&n)try{const M=await(await fetch(`/api/clients/${F}/is-paid`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_payed:!0})})).json();console.log("Mise à jour is_payed:",M)}catch(g){console.error("Erreur mise à jour client:",g)}},3e3);const v=u?u.chat_id:null,_=await xe(x,U,v);_.success&&($(_.message),u?i(_.message):window.history.back(),s)}}catch(l){console.error("Error submitting payment:",l),I({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(Z,{title:b?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(ce,{message:$.message,type:$.type,duration:3e3,position:"top-right",show:$.open,onClose:()=>I({...$,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(ee,{onClick:()=>u?i():window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:b?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(pe,{data:x,errors:R,setData:N,validationErrors:t,setValidationErrors:c})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(_e,{data:x,errors:R,setData:N,setValidationErrors:c,validationErrors:t})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ve,{clients:j,data:x,errors:R,handleSelect:B,setData:N,setValidationErrors:c,validationErrors:t})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(o,{htmlFor:"objet",value:"Objet"}),e.jsx(h,{id:"objet",name:"objet",value:x.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:l=>N("objet",l.target.value),required:!0,onFocus:()=>c({...t,objet:""})}),e.jsx(f,{message:t.objet||R.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(he,{data:x,setData:N})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ge,{data:x,errors:R,setData:N,setValidationErrors:c,typePaiement:C,validationErrors:t})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(se,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:z,children:b?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:a&&y&&e.jsx("div",{ref:m,children:e.jsx(ue,{data:y})})})]})};export{Re as default};
