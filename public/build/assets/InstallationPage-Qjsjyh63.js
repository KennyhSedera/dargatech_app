import{r as s,j as a,$ as V,m as W}from"./app-DtIOmszM.js";import{C as q}from"./index-CsJ4QUTT.js";import{D as O}from"./DataTable-BB8EVSg2.js";import{H as z}from"./HeaderPage-BFP1Irbn.js";import{F as B}from"./FormulaireInstallation-CxoGckdT.js";import{S as J}from"./Snackbar-DpIitYzr.js";import{f as K,t as Q,u as U}from"./constant-DL8UIkUJ.js";import{A as X,R as Y}from"./AuthenticatedLayout-B_Hsivs8.js";import{g as Z,d as ee}from"./installationService-BH2ZYgEX.js";import{G as te}from"./index-CpCFpiil.js";import{a as ae,T as se}from"./index-B5tZQ_Vc.js";import{E as oe}from"./EmptyState-CA1V175n.js";import"./Modal-Da7oLZO9.js";import"./transition-0js-FjRc.js";import"./iconBase-CH7_inEQ.js";import"./TextInput-DpZeXhzL.js";import"./createLucideIcon-Br6977Up.js";import"./InputLabel-CGZ7a-Kg.js";import"./InputAutocomplete -COq3Vmc2.js";import"./clientService-DVXRoPCh.js";import"./api-xdiG_W6n.js";import"./SelectInput-L9xJN6lD.js";import"./InputImage-C6LeyGSH.js";import"./useTheme-62wc6eoV.js";const Ne=()=>{const[u,S]=s.useState(""),[k,r]=s.useState(!1),[L,p]=s.useState({}),[D,l]=s.useState(1),[b,I]=s.useState([]),[f,g]=s.useState([]),[N,x]=s.useState(!0),[i,d]=s.useState({open:!1,message:"",id:0}),[o,c]=s.useState({open:!1,message:"",type:"success"}),[P,T]=s.useState(10),$=[{key:"code_installation",label:"Code",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"numero_serie",label:"Numéro de série de la pompe",sortable:!0},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation",sortable:!0},{key:"statuts",label:"Statuts",customRender:e=>a.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${e==="installée"?"bg-green-500/50":e==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"created_via",label:"Via",customRender:e=>a.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?a.jsx(se,{}):a.jsx(Y,{className:"text-blue-400 bg-white"})})}],E=[{action:!0,label:a.jsx(Q,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:e=>G(e.id)},{label:a.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>H(e)},{label:a.jsx(te,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>R(e)}],F=()=>{r(!0)},m=async()=>{x(!0);const{data:e}=await Z(),n=e.map(t=>({id:t.id,code_installation:t.code_installation,client_id:t.client_id,nom:t.client.nom+" "+t.client.prenom,puissance_pompe:t.puissance_pompe,profondeur_forage:t.profondeur_forage,debit_nominal:t.debit_nominal,numero_serie:t.numero_serie,source_eau:t.source_eau,hmt:t.hmt,date_installation:K(t.date_installation),statuts:t.statuts,latitude:t.localisation.latitude,longitude:t.localisation.longitude,created_via:t.created_via}));I(n),g(n),x(!1)};s.useEffect(()=>{m()},[]);const v=e=>{S(e),l(1);const n=b.filter(t=>{var h,_,C,w,y,j;return((h=t==null?void 0:t.nom)==null?void 0:h.toLowerCase().includes(e.toLowerCase()))||((_=t==null?void 0:t.code_installation)==null?void 0:_.toLowerCase().includes(e.toLowerCase()))||((C=t==null?void 0:t.numero_serie)==null?void 0:C.toLowerCase().includes(e.toLowerCase()))||((w=t==null?void 0:t.source_eau)==null?void 0:w.toLowerCase().includes(e.toLowerCase()))||((y=t==null?void 0:t.statuts)==null?void 0:y.toLowerCase().includes(e.toLowerCase()))||((j=t==null?void 0:t.date_installation)==null?void 0:j.toString().toLowerCase().includes(e.toLowerCase()))});g(n)},A=e=>{m(),e&&c({...o,message:e,open:!0}),p({})},R=e=>{d({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${e.code_installation} du ${e.nom} le ${e.date_installation} ?`,id:e.id})},M=async()=>{const{message:e}=await ee(i.id);c({...o,message:e,open:!0}),d({...i,open:!1,id:0}),m(),l(1)},H=e=>{const n=e.date_installation?e.date_installation:"Invalid date";p({...e,date_installation:U(n)}),r(!0)},G=e=>{W.visit(`/installation/${e}`)};return a.jsxs(X,{children:[a.jsx(V,{title:"Installations"}),a.jsx(z,{title:`Liste des Installations ( Total: ${b.length} )`,handleClick:F,onSearch:v,search:u}),a.jsx(B,{open:k,setOpen:r,onCloseFormulaire:A,dataModify:L,token_data:null}),a.jsx(J,{message:o.message,type:o.type,duration:3e3,position:"top-right",show:o.open,onClose:()=>c({...o,message:"",open:!1})}),a.jsx(q,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>d({...i,open:!1}),accept:M}),N?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):a.jsx("div",{children:f.length>0?a.jsx(O,{headers:$,rows:f,itemsPerPage:P,actions:E,className:"mt-4",currentPage:D,onPageChange:l,masqueColumns:["client_id","latitude","longitude"],onItemsPerPageChange:e=>T(e)}):a.jsx(oe,{nom:"installation",search:u})})]})};export{Ne as default};
