import{r as k,j as e,e as te,q as ae,v as se,$ as le}from"./app-C3sor9L4.js";import{I as c}from"./InputLabel-0a2Fb2ys.js";import{T as h,I as g}from"./TextInput-D_xP1ltP.js";import{u as ne}from"./useTheme-DlLaRjSD.js";import{D as re}from"./DangerButton-BBC6mxLL.js";import{g as oe}from"./TypePaiementService-D2WJJGfa.js";import{b as ce,a as ie}from"./clientService-hyM6e_BQ.js";import{P as me}from"./PrimaryButton-CcmjnzBa.js";import{T as ue}from"./TextArea-Bjx2s7-4.js";import{S as H}from"./SelectInput-D5sSdeXG.js";import{I as de}from"./InputAutocomplete -CGpgBISC.js";import{a as he,b as pe,u as _e,c as ve,e as ge}from"./PaiementService-0Azi2FQM.js";import{S as xe}from"./Snackbar-BHmXA1CU.js";import{F as je}from"./FichierPaiementPdf-DnEqIple.js";import{v as fe,x as ye,h as X,K as Ne}from"./constant-B3AJgSY9.js";import{a as be}from"./validateForm-DkOh89YH.js";import"./createLucideIcon-BXQGW1cT.js";import"./api-Bbx9t1jZ.js";import"./iconBase-9uOaMuco.js";const we=({data:d,setData:m,validationErrors:s,setValidationErrors:i})=>{const[r,l]=k.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);k.useEffect(()=>{d.produits&&d.produits.length>0&&l(d.produits)},[d.produits]);const y=n=>{const t=parseFloat(n.quantite)||0,u=parseFloat(n.prix_unitaire)||0,_=parseFloat(n.tva)||0,b=t*u,x=b*(1+_/100);return{total_ht:b,total_ttc:x}},p=(n,t,u)=>{const _=[...r];if(_[n][t]=u,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:x,total_ttc:f}=y(_[n]);_[n].total_ht=x,_[n].total_ttc=f}l(_);const b={produits:_,description:d.description||"",montant_paye:Y(_).totalTTCGlobal.toFixed(2)};if(m(x=>({...x,...b})),s!=null&&s.produits&&s.produits[n]){const x={...s};x.produits[n]&&(delete x.produits[n][t],Object.keys(x.produits[n]).length===0&&delete x.produits[n],Object.keys(x.produits).some(Q=>Object.keys(x.produits[Q]).length>0)||delete x.produits,i(x))}},Y=n=>{const t=x=>{const f=parseFloat(x);return isNaN(f)?0:f},u=n.reduce((x,f)=>x+t(f.total_ht),0),_=n.reduce((x,f)=>x+t(f.total_ttc),0),b=n.reduce((x,f)=>{const Q=t(f.tva),O=t(f.total_ht);return x+O*Q/100},0);return{totalHTGlobal:parseFloat(u.toFixed(2)),totalTTCGlobal:parseFloat(_.toFixed(2)),totalTVAGlobal:parseFloat(b.toFixed(2))}},{totalHTGlobal:T,totalTTCGlobal:U,totalTVAGlobal:L}=Y(r),q=()=>{const n=[...r,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];l(n),m(t=>({...t,produits:n}))},I=n=>{const t=r.filter((_,b)=>b!==n);l(t);const u=Y(t);if(m(_=>({..._,produits:t,montant_paye:u.totalTTCGlobal.toFixed(2)})),s!=null&&s.produits){const _={...s},b={};Object.keys(_.produits).forEach(x=>{const f=parseInt(x);f<n?b[f]=_.produits[f]:f>n&&(b[f-1]=_.produits[f])}),Object.keys(b).length>0?_.produits=b:delete _.produits,i(_)}},A=n=>{const t=n.target.value;m(u=>({...u,description:t}))},S=n=>{const t=parseFloat(n);return isNaN(t)?"0.00":t.toFixed(2)},D=(n,t)=>{var u,_;return((_=(u=s==null?void 0:s.produits)==null?void 0:u[n])==null?void 0:_[t])||""},$=s.produits==="Ajouter au moins un produit ou service.";return e.jsxs("div",{children:[e.jsxs("div",{className:"block lg:hidden",children:[r.map((n,t)=>e.jsxs("div",{className:`relative p-4 mb-4 border ${$?"border-red-500":"border-gray-200"} rounded-lg`,children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full top-1 right-1",onClick:()=>I(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(c,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(h,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:u=>p(t,"designation",u.target.value),required:!0,placeholder:"Nom du produit ou service"}),e.jsx(g,{message:D(t,"designation"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(h,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:u=>p(t,"reference",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:u=>p(t,"quantite",u.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(h,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:u=>p(t,"unite",u.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(h,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:u=>p(t,"tva",u.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:u=>p(t,"prix_unitaire",u.target.value),required:!0,type:"number",min:0}),e.jsx(g,{message:D(t,"prix_unitaire"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:S(n.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:S(n.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t)),e.jsx("div",{className:"text-sm text-red-500",children:$&&s.produits})]}),e.jsxs("div",{className:` ${$&&"md:border relative md:border-red-500 md:p-4 md:rounded-md"} hidden lg:block`,children:[r.map((n,t)=>e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(c,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(h,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:u=>p(t,"designation",u.target.value),required:!0,placeholder:"Nom du produit ou service",onFocus:()=>i({...s,produits:""})})}),e.jsx("div",{children:e.jsx(h,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:u=>p(t,"reference",u.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:u=>p(t,"quantite",u.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:u=>p(t,"unite",u.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:u=>p(t,"tva",u.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:u=>p(t,"prix_unitaire",u.target.value),required:!0,type:"number",min:0,onFocus:()=>i({...s,produits:"",montant_paye:""})})}),e.jsx("div",{children:e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:S(n.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:S(n.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute right-0 w-5 h-5 text-xs text-white bg-red-500 rounded-full -top-2",onClick:()=>I(t),children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-3",children:[e.jsx("div",{className:"col-span-4",children:e.jsx(g,{message:D(t,"designation"),className:"mt-1"})}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{children:e.jsx(g,{message:D(t,"prix_unitaire"),className:"mt-1"})})]})]},t)),e.jsx("div",{className:"absolute col-span-11 px-2 text-sm text-red-500 bg-white -bottom-2 dark:bg-gray-800",children:$&&s.produits})]}),e.jsx(ue,{name:"description",value:d.description||"",placeholder:"Description",onChange:A,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:q,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-900",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:T.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:L.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:U.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},Ce=({data:d,setData:m,validationErrors:s,errors:i,setValidationErrors:r})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(c,{htmlFor:"type",value:"Type"}),e.jsx(H,{id:"type",name:"type",value:d.type,className:"block w-full mt-1",autoComplete:"type",onChange:l=>m("type",l.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(g,{message:s.type||i.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(c,{htmlFor:"numero",value:"N*"}),e.jsx(h,{id:"numero",name:"numero",value:d.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:l=>m("numero",l.target.value),required:!0,disabled:!0,onFocus:()=>r({...s,numero:""})}),e.jsx(g,{message:s.numero||i.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(c,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(h,{id:"date_creation",name:"date_creation",value:d.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:l=>m("date_creation",l.target.value),type:"date",required:!0,onFocus:()=>r({...s,date_creation:""})}),e.jsx(g,{message:s.date_creation||i.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(c,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(h,{id:"lieu_creation",name:"lieu_creation",value:d.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:l=>m("lieu_creation",l.target.value),required:!0,onFocus:()=>r({...s,lieu_creation:""})}),e.jsx(g,{message:s.lieu_creation||i.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(c,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(H,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:d.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:l=>m("date_additionnel",l.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(g,{message:i.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(c,{htmlFor:"date",value:"*"}),e.jsx(h,{id:"date",name:"date",value:d.date,className:"block w-full mt-1",autoComplete:"date",onChange:l=>m("date",l.target.value),required:!0,type:"date",onFocus:()=>r({...s,date:""})})]})]}),Fe=({clients:d,data:m,setData:s,errors:i,validationErrors:r,setValidationErrors:l,handleSelect:y})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(c,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(H,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:m.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:p=>s("civilite_acheteur",p.target.value),required:!0,children:[e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mme.",children:"Mme."})]}),e.jsx(g,{message:i.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(c,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(de,{data:d,className:"block w-full mt-1",onSelect:y,defaultValue:m.client_id||1,onFocus:()=>l({...r,prenom_acheteur:""})}),e.jsx(g,{message:r.prenom_acheteur||i.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(c,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(h,{id:"nom_acheteur",name:"nom_acheteur",value:m.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:p=>s("nom_acheteur",p.target.value),required:!0,onFocus:()=>l({...r,nom_acheteur:""})}),e.jsx(g,{message:r.nom_acheteur||i.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(h,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:m.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:p=>s("num_rue_acheteur",p.target.value),required:!0,onFocus:()=>l({...r,num_rue_acheteur:""})}),e.jsx(g,{message:r.num_rue_acheteur||i.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(h,{id:"ville_acheteur",name:"ville_acheteur",value:m.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:p=>s("ville_acheteur",p.target.value),required:!0,onFocus:()=>l({...r,ville_acheteur:""})}),e.jsx(g,{message:r.ville_acheteur||i.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(h,{id:"pays_acheteur",name:"pays_acheteur",value:m.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:p=>s("pays_acheteur",p.target.value),required:!0,onFocus:()=>l({...r,pays_acheteur:""})}),e.jsx(g,{message:r.pays_acheteur||i.pays_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"echeance",value:"Echéance"}),e.jsx(h,{id:"echeance",name:"echeance",value:m.echeance,className:"block w-full mt-1",autoComplete:"echeance",onChange:p=>s("echeance",p.target.value),required:!0,onFocus:()=>l({...r,echeance:""}),readOnly:!0}),e.jsx(g,{message:r.echeance||i.echeance,className:"mt-2"})]})]})]})]}),Te=({data:d,setData:m,errors:s,validationErrors:i,setValidationErrors:r})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(h,{id:"nom_vendeurs",name:"nom_vendeurs",value:d.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:l=>m("nom_vendeurs",l.target.value),required:!0,onFocus:()=>r({...i,nom_vendeurs:""})}),e.jsx(g,{message:i.nom_vendeurs||s.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(c,{htmlFor:"select1",value:"Type"}),e.jsx(H,{id:"select1",type:"select1",name:"select1",value:d.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:l=>m("select1",l.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(c,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(h,{id:"num_tva",name:"num_tva",value:d.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:l=>m("num_tva",l.target.value),required:!0,onFocus:()=>r({...i,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(g,{message:i.num_tva||s.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(h,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:d.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:l=>m("nom_rue_vendeur",l.target.value),required:!0,onFocus:()=>r({...i,nom_rue_vendeur:""})}),e.jsx(g,{message:i.nom_rue_vendeur||s.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(h,{id:"ville_vendeur",name:"ville_vendeur",value:d.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:l=>m("ville_vendeur",l.target.value),required:!0,onFocus:()=>r({...i,ville_vendeur:""})}),e.jsx(g,{message:i.ville_vendeur||s.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(h,{id:"pays_vendeur",name:"pays_vendeur",value:d.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:l=>m("pays_vendeur",l.target.value),required:!0,onFocus:()=>r({...i,pays_vendeur:""})}),e.jsx(g,{message:i.pays_vendeur||s.pays_vendeur,className:"mt-2"})]})]})]})]}),ke=({data:d,errors:m,setData:s,setValidationErrors:i,validationErrors:r,typePaiement:l})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(H,{id:"mode_paiement",name:"mode_paiement",value:d.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:y=>s("mode_paiement",y.target.value),required:!0,children:l.map(y=>e.jsx("option",{value:y.nom,children:y.nom},y.id))}),e.jsx(g,{message:r.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(h,{id:"date_echeance",name:"date_echeance",value:d.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:y=>s("date_echeance",y.target.value),required:!0,type:"date",onFocus:()=>i({...r,date_echeance:""})}),e.jsx(g,{message:r.date_echeance||m.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(h,{id:"nom_vendeur",name:"nom_vendeur",value:d.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:y=>s("nom_vendeur",y.target.value),required:!0,onFocus:()=>i({...r,nom_vendeur:""})}),e.jsx(g,{message:r.nom_vendeur||m.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"etat_paiment",value:"État"}),e.jsx(H,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:d.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:y=>s("etat_paiment",y.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(g,{message:r.etat_paiment||m.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"montant_paye",name:"montant_paye",value:d.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:y=>s("montant_paye",y.target.value),required:!0,onFocus:()=>i({...r,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(g,{message:r.montant_paye||m.montant_paye,className:"mt-2"})]})]})]}),qe=async(d,m,s)=>{var i,r;try{const l=await te.post("/api/paiement/generate-and-send-pdf",{email:m,data:d,telegram_chat_id:s});return l.data.success,l.data}catch(l){throw console.error("Erreur lors de l'envoi du PDF:",l),alert("Erreur lors de l'envoi du PDF: "+(((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||l.message)),l}};function $e(d){const m=/(\d{2}\/\d{2}\/\d{4})/g,s=d.match(m);if(!s||s.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const i=s[0],r=s[1],l=T=>{const[U,L,q]=T.split("/");return new Date(`${L}/${U}/${q}`)},y=l(i),p=l(r),Y=T=>({object:T,iso:T.toISOString(),localeFormat:T.toLocaleDateString(),original:`${T.getFullYear()}-${(T.getMonth()+1).toString().padStart(2,"0")}-${T.getDate().toString().padStart(2,"0")}`});return{startDate:Y(y),endDate:Y(p),durationDays:Math.floor((p-y)/(1e3*60*60*24))}}const Je=({token_data:d,telegramback:m})=>{const{theme:s,setTheme:i}=ne(),r=k.useRef(null),[l,y]=k.useState(!0),[p,Y]=k.useState(null),[T,U]=k.useState(!1),{props:L}=ae(),{client_id:q,amount:I,designation:A}=L,[S,D]=k.useState({}),[$,n]=k.useState([]),[t,u]=k.useState([]),[_,b]=k.useState({open:!1,message:"",type:"success"}),[x,f]=k.useState(""),O=new URLSearchParams(window.location.search).get("id");k.useEffect(()=>{i(s||"light"),V()},[s]);const{data:j,setData:N,errors:R,reset:z}=se({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:"",echeance:"T1"});k.useEffect(()=>{I&&A&&N(v=>({...v,produits:[...v.produits,{designation:A,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:I,total_ht:I,total_ttc:I}],montant_paye:I,description:A,objet:"Frais de l'installation du pompage solaire.",date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0],echeance:"Installation"}))},[I,A]);const V=async()=>{var v;try{const[{clients:o},w]=await Promise.all([ce(),oe()]);n(o==null?void 0:o.map(a=>({id:a.id,title:`${a.prenom} ${a.nom}`,nom:a.prenom,nom_famille:a.nom,ville:a.localisation,pays:"Togo",village:a.localisation,quartier:a.localisation,email:a.email,genre:a.genre,telephone:a.telephone,localisation:a.localisation,pays_acheteur:a.pays_acheteur,ville_acheteur:a.ville_acheteur}))),u((v=w.type)==null?void 0:v.map(a=>({id:a.id,nom:a.name})))}catch(o){console.error("Error fetching payment types:",o)}},J=async v=>{var o;try{const w=await he(v);if(w){const a=w;let C=null;q?C=$.find(P=>P.id===parseInt(q))||$.find(P=>P.id===q):C=$.find(P=>P.id===a.client_id);let M=null,F=a.periode_couverte;const G=/\d{2}\/\d{2}\/\d{4}/g,K=(o=a.periode_couverte)==null?void 0:o.match(G);if(K&&K.length>=2)try{M=$e(a.periode_couverte),F=M.startDate.original+" au "+M.endDate.original}catch(P){console.warn("Impossible d'extraire les dates:",P),F=a.periode_couverte}C&&(N({...j,numero:a.numero,nom_acheteur:C.nom_famille,prenom_acheteur:C.nom,civilite_acheteur:C.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:C.ville_acheteur||a.ville_acheteur,pays_acheteur:C.pays_acheteur||a.pays_acheteur,num_rue_acheteur:C.village||C.quartier,client_id:C.id,objet:a.observation,description:a.description,mode_paiement:a.mode_paiement,date_echeance:a.echeance,statut_paiement:a.statut_paiement,produits:a.produits.map(P=>({...P,designation:P.designation,prix_unitaire:P.prix_unitaire,quantite:P.quantite,unite:P.unite})),montant_paye:parseFloat(a.montant).toFixed(2),date_creation:a.date_creation||(M==null?void 0:M.startDate.original)||X().format("DD/MM/YYYY"),date:a.date||(M==null?void 0:M.endDate.original)||X().format("DD/MM/YYYY"),lieu_creation:a.lieu_creation,date_additionnel:a.date_additionnel,nom_vendeur:a.nom_vendeur,nom_vendeurs:a.nom_vendeurs,select1:a.select1,num_tva:a.num_tva,nom_rue_vendeur:a.nom_rue_vendeur,ville_vendeur:a.ville_vendeur,pays_vendeur:a.pays_vendeur,code_postal_vendeur:a.code_postal_vendeur,telephone_vendeur:a.telephone_vendeur,email_vendeur:a.email_vendeur,date_paiement:a.date_paiement,date_echeance:a.date_echeance,echeance:a.echeance,observation:a.observation,periode_couverte:F}),f(C.email)),U(!0)}}catch(w){console.error("Error fetching payment data:",w),b({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}},W=async v=>{try{const{client:o}=await ie(v);o&&(B({email:o.email,genre:o.genre,id:o.id,localisation:o.localisation,nom:o.prenom,nom_famille:o.nom,pays:o.pays_acheteur,pays_acheteur:o.pays_acheteur,quartier:o.localisation,telephone:o.telephone,title:`${o.prenom} ${o.nom}`,village:o.localisation,ville:o.ville_acheteur,ville_acheteur:o.ville_acheteur}),f(o.email))}catch(o){return console.error("Error fetching client:",o),null}};k.useEffect(()=>{$.length>0&&O?J(O):$.length>0&&q&&W(q)},[$,O,q]);const Z=async()=>{const{data:v}=await pe();v&&N("numero",Ne(v.numero))},E=async v=>{const o=await ge(v);if(o&&o.length>0){const w={};if(o.forEach(F=>{if(F!=null&&F.echeance&&/^T\d+$/i.test(F.echeance)){const G=parseInt(F.echeance.match(/^T(\d+)$/i)[1],10);w[G]||(w[G]=0),w[G]+=parseInt(F.montant)||F.montant||0}}),Object.keys(w).length===0){N("echeance","T01");return}const a=Object.keys(w).map(Number).sort((F,G)=>F-G);let C=a[0];for(const F of a)if(w[F]>=18e3)C=F;else{N("echeance",`T${String(F).padStart(2,"0")}`);return}const M=`T${String(C+1).padStart(2,"0")}`;N("echeance",M)}else N("echeance","T01")};k.useEffect(()=>{O||Z()},[O]);const B=v=>{const o=$.find(w=>w.id===v.id);o&&(N("client_id",o.id),N("nom_acheteur",o.nom_famille),N("prenom_acheteur",o.nom),N("num_rue_acheteur",o.localisation),N("ville_acheteur",o.ville_acheteur),N("pays_acheteur",o.pays_acheteur),N("civilite_acheteur",o.genre==="Homme"?"Mr.":"Mme."),f(o.email),!q&&E(o.id))},ee=async()=>{if(j.periode_couverte=I?"Frais d'installation.":X(j.date_creation).format("DD/MM/YYYY")+" au "+X(j.date).format("DD/MM/YYYY"),j.date_paiement=j.date_paiement?new Date(j.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],j.observation=j.objet,j.statut_paiement=j.etat_paiment,j.montant_paye=j.montant_paye||"0",j.montant=j.montant_paye||"0",T&&O&&(j.id=O),!!be(j,D))try{let v;if(T?v=await _e(O,j):v=await ve(j),b({open:!0,message:v.message,type:v.success?"success":"error"}),v.success){setTimeout(async()=>{if(z(),d?m(v.message):window.history.back(),q&&I&&A)try{const C=await(await fetch(`/api/paiement/client/${q}`,{method:"GET"})).json();console.log("Mise à jour is_payed:",C)}catch(a){console.error("Erreur mise à jour client:",a)}},3e3);const o=d?d.chat_id:null,w=await qe(j,x,o);w.success&&b({open:!0,message:w.message,type:w.success?"success":"error"})}}catch(v){console.error("Error submitting payment:",v),b({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(le,{title:T?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(xe,{message:_.message,type:_.type,duration:3e3,position:"top-right",show:_.open,onClose:()=>b({..._,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 mb-6 text-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:fe,alt:"logo",className:"w-12 h-12 mr-2"}),e.jsx("img",{src:ye,alt:"titre",className:"w-auto h-9"})]}),e.jsx(re,{onClick:()=>d?m():window.history.back(),className:"text-sm capitalize sm:text-base",children:"Retour"})]}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:T?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(Ce,{data:j,errors:R,setData:N,validationErrors:S,setValidationErrors:D})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(Te,{data:j,errors:R,setData:N,setValidationErrors:D,validationErrors:S})}),e.jsx("div",{className:"space-y-4",children:e.jsx(Fe,{clients:$,data:j,errors:R,handleSelect:B,setData:N,setValidationErrors:D,validationErrors:S})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(c,{htmlFor:"objet",value:"Observation"}),e.jsx(h,{id:"objet",name:"objet",value:j.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:v=>N("objet",v.target.value),required:!0,onFocus:()=>D({...S,objet:""}),placeholder:"Ajouter l'objet du paiement"}),e.jsx(g,{message:S.objet||R.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(we,{data:j,setData:N,errors:R,setValidationErrors:D,validationErrors:S})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ke,{data:j,errors:R,setData:N,setValidationErrors:D,typePaiement:t,validationErrors:S})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(me,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:ee,children:T?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:l&&p&&e.jsx("div",{ref:r,children:e.jsx(je,{data:p})})})]})};export{Je as default};
