import{r as C,j as e,e as U,m as L,L as X}from"./app-Cy2PBkd3.js";import{I as u}from"./InputLabel-CxuQG83Q.js";import{T as h,I as _}from"./TextInput-DS3o0hEc.js";import{u as B}from"./useTheme-Aq3x9ALX.js";import{D as Q}from"./DangerButton-D7iti764.js";import{g as K}from"./TypePaiementService-WHyU13xD.js";import{b as V}from"./clientService-B-mL-H3m.js";import{P as z}from"./PrimaryButton-DCOGI-Ha.js";import{T as J}from"./TextArea-DAQzUXcG.js";import{S as I}from"./SelectInput-ClLTcwVB.js";import{I as W}from"./InputAutocomplete -DwF_Q_sL.js";import{g as Z,u as E,c as ee}from"./PaiementService-Ca-CfDFG.js";import{S as te}from"./Snackbar-C3F7nXS9.js";import"./html2pdf-1hdC8tIZ.js";import{F as ae}from"./FichierPaiementPdf-BH1H-gK-.js";import{h as O}from"./constant-BO8MEuAf.js";import"./api-D3R6-SgC.js";import"./iconBase-Bq1bRPGb.js";const ne=({data:o,setData:r})=>{const[s,l]=C.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);C.useEffect(()=>{o.produits&&o.produits.length>0&&l(o.produits)},[o.produits]);const a=c=>{const t=parseFloat(c.quantite)||0,m=parseFloat(c.prix_unitaire)||0,x=parseFloat(c.tva)||0,T=t*m,y=T*(1+x/100);return{total_ht:T,total_ttc:y}},n=(c,t,m)=>{const x=[...s];if(x[c][t]=m,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:y,total_ttc:N}=a(x[c]);x[c].total_ht=y,x[c].total_ttc=N}l(x);const T={produits:x,description:o.description||"",montant_paye:p(x).totalTTCGlobal.toFixed(2)};r(y=>({...y,...T}))},p=c=>{const t=y=>{const N=parseFloat(y);return isNaN(N)?0:N},m=c.reduce((y,N)=>y+t(N.total_ht),0),x=c.reduce((y,N)=>y+t(N.total_ttc),0),T=c.reduce((y,N)=>{const S=t(N.tva),D=t(N.total_ht);return y+D*S/100},0);return{totalHTGlobal:parseFloat(m.toFixed(2)),totalTTCGlobal:parseFloat(x.toFixed(2)),totalTVAGlobal:parseFloat(T.toFixed(2))}},{totalHTGlobal:g,totalTTCGlobal:P,totalTVAGlobal:F}=p(s),w=()=>{const c=[...s,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];l(c),r(t=>({...t,produits:c}))},i=c=>{const t=s.filter((x,T)=>T!==c);l(t);const m=p(t);r(x=>({...x,produits:t,montant_paye:m.totalTTCGlobal.toFixed(2)}))},j=c=>{const t=c.target.value;r(m=>({...m,description:t}))},k=c=>{const t=parseFloat(c);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[s.map((c,t)=>e.jsxs("div",{className:"grid grid-cols-11 gap-3 my-4 relative",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(u,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(u,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(h,{id:`designation-${t}`,name:"designation",value:c.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>n(t,"designation",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`reference-${t}`,name:"reference",value:c.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>n(t,"reference",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:c.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>n(t,"quantite",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`unite-${t}`,name:"unite",value:c.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>n(t,"unite",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`tva-${t}`,name:"tva",value:c.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>n(t,"tva",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:c.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>n(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:k(c.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:k(c.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"bg-red-500 absolute -right-2 -top-2 w-5 h-5 rounded-full text-xs",onClick:()=>i(t),children:"X"})]},t)),e.jsx(J,{name:"description",value:o.description||"",placeholder:"Description",onChange:j,rows:"2",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600 w-full"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-1 mt-3 rounded",onClick:w,children:"+ Produit"}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total HT"}),e.jsx("td",{className:"pl-8",children:g.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]}),e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total TVA"}),e.jsx("td",{className:"pl-8",children:F.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]}),e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total TTC"}),e.jsx("td",{className:"pl-8",children:P.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]})]})})})]})},se=({data:o,setData:r,validationErrors:s,errors:l,setValidationErrors:a})=>e.jsxs("div",{className:"grid grid-cols-6 gap-2 mt-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"type",value:"Type"}),e.jsx(I,{id:"type",name:"type",value:o.type,className:"block w-full mt-1",autoComplete:"type",onChange:n=>r("type",n.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(_,{message:s.type||l.type,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"numero",value:"N*"}),e.jsx(h,{id:"numero",name:"numero",value:o.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:n=>r("numero",n.target.value),required:!0,disabled:!0,onFocus:()=>a({...s,numero:""})}),e.jsx(_,{message:s.numero||l.numero,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"installation_id",value:"Date de création"}),e.jsx(h,{id:"date_creation",name:"date_creation",value:o.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:n=>r("date_creation",n.target.value),type:"date",required:!0,onFocus:()=>a({...s,date_creation:""})}),e.jsx(_,{message:s.date_creation||l.date_creation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(h,{id:"lieu_creation",name:"lieu_creation",value:o.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:n=>r("lieu_creation",n.target.value),required:!0,onFocus:()=>a({...s,lieu_creation:""})}),e.jsx(_,{message:s.lieu_creation||l.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(I,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:o.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:n=>r("date_additionnel",n.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(_,{message:l.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"date",value:"*"}),e.jsx(h,{id:"date",name:"date",value:o.date,className:"block w-full mt-1",autoComplete:"date",onChange:n=>r("date",n.target.value),required:!0,type:"date",onFocus:()=>a({...s,date:""})})]})]}),le=({clients:o,data:r,setData:s,errors:l,validationErrors:a,setValidationErrors:n,handleSelect:p})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(I,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:r.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:g=>s("civilite_acheteur",g.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(_,{message:l.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(u,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(W,{data:o,className:"block w-full mt-1",onSelect:p,defaultValue:r.client_id,onFocus:()=>n({...a,client_id:""})}),e.jsx(_,{message:a.prenom_acheteur||l.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(u,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(h,{id:"nom_acheteur",name:"nom_acheteur",value:r.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:g=>s("nom_acheteur",g.target.value),required:!0,onFocus:()=>n({...a,nom_acheteur:""})}),e.jsx(_,{message:a.nom_acheteur||l.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(h,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:r.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:g=>s("num_rue_acheteur",g.target.value),required:!0,onFocus:()=>n({...a,num_rue_acheteur:""})}),e.jsx(_,{message:a.num_rue_acheteur||l.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(h,{id:"ville_acheteur",name:"ville_acheteur",value:r.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:g=>s("ville_acheteur",g.target.value),required:!0,onFocus:()=>n({...a,ville_acheteur:""})}),e.jsx(_,{message:a.ville_acheteur||l.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(h,{id:"pays_acheteur",name:"pays_acheteur",value:r.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:g=>s("pays_acheteur",g.target.value),required:!0,onFocus:()=>n({...a,pays_acheteur:""})}),e.jsx(_,{message:a.pays_acheteur||l.pays_acheteur,className:"mt-2"})]})]})]})]}),re=({data:o,setData:r,errors:s,validationErrors:l,setValidationErrors:a})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(h,{id:"nom_vendeurs",name:"nom_vendeurs",value:o.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:n=>r("nom_vendeurs",n.target.value),required:!0,onFocus:()=>a({...l,nom_vendeurs:""})}),e.jsx(_,{message:l.nom_vendeurs||s.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(I,{id:"select1",type:"select1",name:"select1",value:o.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:n=>r("select1",n.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(h,{id:"num_tva",name:"num_tva",value:o.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:n=>r("num_tva",n.target.value),required:!0,onFocus:()=>a({...l,num_tva:""})}),e.jsx(_,{message:l.num_tva||s.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(h,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:o.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:n=>r("nom_rue_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,nom_rue_vendeur:""})}),e.jsx(_,{message:l.nom_rue_vendeur||s.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(h,{id:"ville_vendeur",name:"ville_vendeur",value:o.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:n=>r("ville_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,ville_vendeur:""})}),e.jsx(_,{message:l.ville_vendeur||s.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(h,{id:"pays_vendeur",name:"pays_vendeur",value:o.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:n=>r("pays_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,pays_vendeur:""})}),e.jsx(_,{message:l.pays_vendeur||s.pays_vendeur,className:"mt-2"})]})]})]})]}),oe=({data:o,errors:r,setData:s,setValidationErrors:l,validationErrors:a,typePaiement:n})=>e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(I,{id:"mode_paiement",name:"mode_paiement",value:o.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:p=>s("mode_paiement",p.target.value),required:!0,children:n.map(p=>e.jsx("option",{value:p.nom,children:p.nom},p.id))}),e.jsx(_,{message:a.mode_paiement||r.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(h,{id:"date_echeance",name:"date_echeance",value:o.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:p=>s("date_echeance",p.target.value),required:!0,type:"date",onFocus:()=>l({...a,date_echeance:""})}),e.jsx(_,{message:a.date_echeance||r.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(h,{id:"nom_vendeur",name:"nom_vendeur",value:o.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:p=>s("nom_vendeur",p.target.value),required:!0,onFocus:()=>l({...a,nom_vendeur:""})}),e.jsx(_,{message:a.nom_vendeur||r.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"etat_paiment",value:"Etat"}),e.jsx(I,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:o.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:p=>s("etat_paiment",p.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(_,{message:a.etat_paiment||r.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsx(h,{id:"montant_paye",name:"montant_paye",value:o.montant_paye,className:"block w-full mt-1",autoComplete:"montant_paye",readOnly:!0,onChange:p=>s("montant_paye",p.target.value),required:!0,onFocus:()=>l({...a,montant_paye:""})}),e.jsx(_,{message:a.montant_paye||r.montant_paye,className:"mt-2"})]})]})]}),ie=async(o,r)=>{var s,l;try{const a=await U.post("/api/paiement/generate-and-send-pdf",{email:r,data:o});return a.data.success&&alert(a.data.message),a.data}catch(a){throw console.error("Erreur lors de l'envoi du PDF:",a),alert("Erreur lors de l'envoi du PDF: "+(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message)),a}};function ce(o){const r=/(\d{2}\/\d{2}\/\d{4})/g,s=o.match(r);if(!s||s.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const l=s[0],a=s[1],n=F=>{const[w,i,j]=F.split("/");return new Date(`${i}/${w}/${j}`)},p=n(l),g=n(a),P=F=>({object:F,iso:F.toISOString(),localeFormat:F.toLocaleDateString(),original:`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`});return{startDate:P(p),endDate:P(g),durationDays:Math.floor((g-p)/(1e3*60*60*24))}}const ke=()=>{const{theme:o,setTheme:r}=B(),s=C.useRef(null),[l,a]=C.useState(!0),[n,p]=C.useState(null),[g,P]=C.useState(!1),w=new URLSearchParams(window.location.search).get("id"),{data:i,setData:j,errors:k,reset:c}=L({type:"recu",numero:"R1_TEST",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""}),[t,m]=C.useState({}),[x,T]=C.useState([]),[y,N]=C.useState([]),[S,D]=C.useState({open:!1,message:"",type:"success"}),[G,$]=C.useState(""),A=async()=>{var f;try{const[{clients:v},b]=await Promise.all([V(),K()]);T(v==null?void 0:v.map(d=>({id:d.id,nom:d.prenom,nom_famille:d.nom,ville:d.localisation.ville,pays:d.localisation.pays,village:d.localisation.village,quartier:d.localisation.quartier,email:d.email,genre:d.genre,telephone:d.telephone,localisation:d.localisation.pays+" "+d.localisation.ville}))),N((f=b.type)==null?void 0:f.map(d=>({id:d.id,nom:d.name})))}catch(v){console.error("Error fetching payment types:",v)}},Y=async f=>{try{const v=await Z(f);if(v){const b=v,d=x.find(q=>q.id===b.client_id),M=ce(b.periode_couverte);i.periode_couverte=M.startDate.original+" au "+M.endDate.original,d&&(j({...i,nom_acheteur:d.nom_famille,prenom_acheteur:d.nom,civilite_acheteur:d.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:d.ville,pays_acheteur:d.pays,num_rue_acheteur:d.village||d.quartier,client_id:d.id,objet:b.observation,description:b.description,mode_paiement:b.mode_paiement,date_echeance:b.echeance,statut_paiement:b.statut_paiement,produits:b.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseInt(b.montant).toFixed(2),date_creation:M.startDate.original,date:M.endDate.original}),$(d.email)),P(!0)}}catch(v){console.error("Error fetching payment data:",v),D({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};C.useEffect(()=>{r(o||"light"),A()},[o]),C.useEffect(()=>{x.length>0&&w&&Y(w)},[x,w]);const R=f=>{const v=x.find(b=>b.id===f.id);v&&(j("client_id",v.id),j("nom_acheteur",v.nom_famille),j("prenom_acheteur",v.nom),j("ville_acheteur",v.ville),j("pays_acheteur",v.pays),j("num_rue_acheteur",v.village||v.quartier),j("civilite_acheteur",v.genre==="Homme"?"Mr.":"Mme."),$(v.email))},H=async()=>{i.periode_couverte=O(i.date_creation).format("DD/MM/YYYY")+" au "+O(i.date).format("DD/MM/YYYY"),i.date_paiement=i.date_paiement?new Date(i.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],i.observation=i.objet,i.echeance=i.date_echeance,i.statut_paiement=i.etat_paiment,i.montant_paye=i.montant_paye||"0",i.montant=i.montant_paye||"0",g&&w&&(i.id=w);try{let f;g?f=await E(w,i):f=await ee(i),D({open:!0,message:f.message,type:f.success?"success":"error"}),f.success&&(setTimeout(()=>{c(),window.history.back()},3e3),ie(i,G))}catch(f){console.error("Error submitting payment:",f),D({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-900 dark:text-white p-10",children:[e.jsx(X,{title:g?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(te,{message:S.message,type:S.type,duration:3e3,position:"top-right",show:S.open,onClose:()=>D({...S,message:"",open:!1})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg",children:[e.jsx(Q,{onClick:()=>window.history.back(),className:"absolute capitalize",children:"Retour"}),e.jsx("div",{className:"text-center text-2xl font-bold",children:g?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx(se,{data:i,errors:k,setData:j,validationErrors:t,setValidationErrors:m}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsx(re,{data:i,errors:k,setData:j,setValidationErrors:m,validationErrors:t}),e.jsx(le,{clients:x,data:i,errors:k,handleSelect:R,setData:j,setValidationErrors:m,validationErrors:t})]}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsx("div",{className:"my-10 grid grid-cols-2",children:e.jsxs("div",{children:[e.jsx(u,{htmlFor:"objet",value:"Objet"}),e.jsx(h,{id:"objet",name:"objet",value:i.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:f=>j("objet",f.target.value),required:!0,onFocus:()=>m({...t,objet:""})}),e.jsx(_,{message:t.objet||k.objet,className:"mt-2"})]})}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex items-center justify-start",children:e.jsx("span",{className:"font-bold text-lg",children:"Désignations"})}),e.jsx(ne,{data:i,setData:j})]}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsx(oe,{data:i,errors:k,setData:j,setValidationErrors:m,typePaiement:y,validationErrors:t}),e.jsx("div",{className:"mt-8 flex items-center justify-end",children:e.jsx(z,{className:"px-10",onClick:H,children:g?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:l&&n&&e.jsx("div",{ref:s,children:e.jsx(ae,{data:n})})})]})};export{ke as default};
