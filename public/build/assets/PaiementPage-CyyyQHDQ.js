import{r as s,m as V,j as e,L as B,S as G}from"./app-Cxde9slr.js";import{C as H,D as M,G as R}from"./index-IPAcnWJ3.js";import{c as W,u as z,g as J,d as K}from"./PaiementService-De_DWKXV.js";import{b as Q}from"./clientService-CRa0LvHd.js";import{I as b,T as A}from"./TextInput-DDGqk7QW.js";import{I as h}from"./InputLabel-BH2OC3Oe.js";import{g as U}from"./TypePaiementService-DU1446Aw.js";import{M as X}from"./Modal-DZNDPzOd.js";import{I as q}from"./InputAutocomplete -CUk-3AzD.js";import{d as Y}from"./validateForm-C-Be7ugn.js";import{o as Z,n as ee,f as te}from"./constant-Dkjcvjdz.js";import{S as ae}from"./Snackbar-CVikIy-f.js";import{A as se}from"./AuthenticatedLayout-Cny4Hpvo.js";import oe from"./TypePaiement-Dr68dYFI.js";import{H as ne}from"./HeaderPage-CH1d2zbm.js";import"./iconBase-CoMNK4hD.js";import"./api-DrtQ1g-O.js";import"./transition-BTaUzaGJ.js";import"./index-BEvqcnz0.js";import"./index-DDlNmvDD.js";import"./useTheme-GXHCWeq9.js";import"./index-D3JkyBQ-.js";import"./InputImage-BuEnIGHB.js";const re=({open:k=!0,setOpen:L,dataModify:r={},onCloseFormulaire:F=()=>{}})=>{const[j,d]=s.useState("Enregistrer"),[i,c]=s.useState({}),[y,v]=s.useState(!1),[w,C]=s.useState([]),[D,S]=s.useState([]),{data:n,setData:l,errors:m,reset:x}=V({client_id:"",montant:"",date_paiement:new Date().toISOString().split("T")[0],mode_paiement:"",periode_couverte:"",receipt_path:""}),g=async()=>{var t;try{const[{clients:u},$]=await Promise.all([Q(),U()]);C(u==null?void 0:u.map(p=>({id:p.id,nom:`${p.nom} ${p.prenom}`}))),S((t=$.type)==null?void 0:t.map(p=>({id:p.id,nom:p.name})))}catch(u){console.error("Error fetching clients or payment types:",u)}},_=s.useCallback(()=>{r.id?(l({client_id:r.client_id||"",montant:r.montant||"",date_paiement:Z(r.date_paiement)||new Date().toISOString().split("T")[0],mode_paiement:parseInt(r.mode_paiement)||"",periode_couverte:r.periode_couverte||"",receipt_path:r.receipt_path||""}),d("Modifier")):N()},[r,l]),f=t=>{L(!1),N(),F(t)},N=()=>{x(),d("Enregistrer"),c({})};s.useEffect(()=>{g()},[]),s.useEffect(()=>{_()},[r,_]);const T=async()=>{if(Y(n,c)){v(!0),d("Loading ...");try{let t;j==="Enregistrer"?{message:t}=await W(n):{message:t}=await z(r.id,n),f(t)}catch(t){console.error("Error submitting payment:",t)}finally{v(!1),d("Enregistrer")}}},E=t=>{l("client_id",t.id)},I=t=>{l("mode_paiement",t.id)};return e.jsxs(X,{show:k,closeable:!1,onClose:f,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:r.nom?"Modifier un Paiement":"Ajouter un Paiement"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"client_id",value:"Nom client"}),e.jsx(q,{data:w,isFocused:!0,className:"block w-full mt-1",onSelect:E,defaultValue:n.client_id,onFocus:()=>c({...i,client_id:""})}),e.jsx(b,{message:i.client_id||m.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"montant",value:"Montant ($)"}),e.jsx(A,{id:"montant",name:"montant",value:n.montant,className:"block w-full mt-1",autoComplete:"montant",onChange:t=>l("montant",t.target.value),required:!0,type:"number",onFocus:()=>c({...i,montant:""})}),e.jsx(b,{message:i.montant||m.montant,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"mode_paiement",value:"Mode paiement"}),e.jsx(q,{data:D,className:"block w-full mt-1",onSelect:I,defaultValue:n.mode_paiement,onFocus:()=>c({...i,mode_paiement:""})}),e.jsx(b,{message:i.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"periode_couverte",value:"Période couverte"}),e.jsx(A,{id:"periode_couverte",name:"periode_couverte",value:n.periode_couverte,className:"block w-full mt-1",autoComplete:"periode_couverte",onChange:t=>l("periode_couverte",t.target.value),required:!0,onFocus:()=>c({...i,periode_couverte:""})}),e.jsx(b,{message:i.periode_couverte||m.periode_couverte,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"date_paiement",value:"Date de paiement"}),e.jsx(A,{id:"date_paiement",name:"date_paiement",value:n.date_paiement,className:"block w-full mt-1",autoComplete:"date_paiement",type:"date",onChange:t=>l("date_paiement",t.target.value),required:!0,onFocus:()=>c({...i,date_paiement:""})}),e.jsx(b,{message:i.date_paiement||m.date_paiement,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>f(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${y&&"opacity-25"}`,disabled:y,onClick:T,children:j})]})]})},Fe=()=>{const[k,L]=s.useState(""),[r,F]=s.useState({}),[j,d]=s.useState(1),[i,c]=s.useState(!1),[y,v]=s.useState([]),[w,C]=s.useState([]),[D,S]=s.useState(!0),[n,l]=s.useState({open:!1,message:"",id:0}),[m,x]=s.useState({open:!1,message:"",type:"success"}),[g,_]=s.useState(!1),[f,N]=s.useState(!1),T=[{key:"id",label:"ID"},{key:"nom",label:"Nom client"},{key:"montant",label:"Montant ($)"},{key:"mode_paiement",label:"Mode de paiement"},{key:"periode_couverte",label:"Periode couverte"},{key:"date_paiement",label:"Date de paiement"},{key:"statut_paiement",label:"Statut"},{key:"observation",label:"Observation"}],E=[{label:e.jsx(R,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:a=>p(a)}],I=()=>{G.visit("/form/paiement")},t=async()=>{try{S(!0);const{data:a}=await J(),P=a.map(o=>({id:o.id,client_id:o.client_id,nom:`${o.client.nom} ${o.client.prenom}`,montant:o.montant,mode_paiement:o.mode_paiement,periode_couverte:o.periode_couverte,date_paiement:te(o.date_paiement),statut_paiement:o.statut_paiement,observation:o.observation}));v(P),C(P)}catch(a){console.log(a)}finally{S(!1)}};s.useEffect(()=>{t()},[]);const u=a=>{L(a),d(1);const P=y.filter(o=>o.nom.toLowerCase().includes(a.toLowerCase())||o.montant.toLowerCase().includes(a.toLowerCase())||o.type_paiement.toLowerCase().includes(a.toLowerCase())||o.periode_couverte.toLowerCase().includes(a.toLowerCase())||o.mode_paiement.toLowerCase().includes(a.toLowerCase())||o.date_paiement.toString().toLowerCase().includes(a.toLowerCase()));C(P)},$=a=>{t(),a&&x({...m,message:a,open:!0}),F({})},p=a=>{l({open:!0,message:`Êtes-vous sûr de vouloir supprimer la paiement du ${a.nom} le ${a.date_paiement} ?`,id:a.id})},O=async()=>{const{message:a}=await K(n.id);x({...m,message:a,open:!0}),l({...n,open:!1,id:0}),t(),d(1)};return e.jsxs(se,{setId:N,children:[e.jsx(B,{title:"Paiements"}),e.jsx(re,{open:i,setOpen:c,onCloseFormulaire:$,dataModify:r}),e.jsx(ae,{message:m.message,type:m.type,duration:3e3,position:"top-right",show:m.open,onClose:()=>x({...m,message:"",open:!1})}),e.jsx(H,{open:n.open,message:n.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>l({...n,open:!1}),accept:O}),!f&&e.jsxs("span",{className:"flex items-center w-40 p-1 mb-2 border border-gray-300 rounded-md dark:border-gray-700",children:[e.jsx("div",{onClick:()=>_(!1),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${g?"bg-transparent":"bg-gray-300 dark:bg-gray-700"}`,children:"Tous"}),e.jsx("div",{onClick:()=>_(!0),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${g?"bg-gray-300 dark:bg-gray-700":"bg-transparent"}`,children:"Types"})]}),g?e.jsx(oe,{}):e.jsxs("div",{children:[e.jsx(ne,{title:"Liste des Paiements",handleClick:I,search:k,onSearch:u}),D?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{children:w.length>0?e.jsx(M,{headers:T,rows:w,itemsPerPage:9,actions:E,className:"mt-4",currentPage:j,onPageChange:d,masqueColumns:["client_id"]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:ee,alt:"no data",className:"max-w-md mt-2 opacity-50"})})})]})]})};export{Fe as default};
