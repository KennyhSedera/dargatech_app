import{r as n,j as e,L as U,e as q}from"./app-Cy2PBkd3.js";import{u as B}from"./useTheme-Aq3x9ALX.js";import{h as M}from"./html2pdf-1hdC8tIZ.js";import{P as o,K,E as Q,Q as y,R as D,S as R,T as F,d as P,U as V}from"./constant-BO8MEuAf.js";import{D as W}from"./DangerButton-D7iti764.js";import z from"./RapportPdf-BP9xBilK.js";import"./iconBase-Bq1bRPGb.js";import"./fr-B4HmnGfx.js";const te=({intervention_id:m})=>{var u,f,N,v,p,w,k,$;const{theme:x,setTheme:S}=B(),[s,T]=n.useState(null),[_,L]=n.useState(!0),[h,C]=n.useState(null),[I,b]=n.useState(!0),[l,E]=n.useState("information"),[t,G]=n.useState(!1),j=n.useRef(null);n.useEffect(()=>{S(x||"light")},[x]),n.useEffect(()=>{const a=async()=>{var i,r;try{b(!0);const c=await q.get(`/api/rapport/maintenance/${m}`);T(c.data)}catch(c){C(((r=(i=c.response)==null?void 0:i.data)==null?void 0:r.message)||"Une erreur est survenue")}finally{L(!1),b(!1)}};console.log(s),m&&a()},[m]);const g=a=>a?new Date(a).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):"",A=()=>{var r,c;const a=j.current;if(!a)return;const i={margin:.5,filename:`rapport-maintenance-${(s==null?void 0:s.id)+"-du-"+((r=s==null?void 0:s.client)==null?void 0:r.nom)+"-"+((c=s==null?void 0:s.client)==null?void 0:c.prenom)||"undefined"}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};M().from(a).set(i).save()};if(_)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full animate-spin"}),e.jsx("h2",{className:"text-lg font-medium text-slate-600 dark:text-slate-300",children:"Chargement du rapport..."})]})});if(h)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 dark:bg-slate-900",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl p-8 max-w-md",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mb-6",children:e.jsx(o,{className:"h-8 w-8 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-800 dark:text-slate-200 mb-3",children:"Erreur"}),e.jsx("p",{className:"text-center text-slate-600 dark:text-slate-400 mb-6",children:h}),e.jsx(W,{onClick:()=>window.history.back(),className:"px-5 py-2.5 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors shadow-sm",children:"Retour"})]})})});const d=({id:a,label:i,icon:r})=>e.jsxs("button",{onClick:()=>E(a),className:`flex items-center space-x-2 px-4 py-3 rounded-lg transition-colors w-full ${l===a?"bg-teal-500 text-white shadow-md":"text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700/50"}`,children:[r,e.jsx("span",{className:"font-medium",children:i})]});return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200",children:[e.jsx(U,{title:"Rapport de maintenance - Dargatech"}),I?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:`max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 ${t?"print-container":""}`,children:[e.jsxs("div",{className:`mb-8 flex flex-col md:flex-row md:items-center md:justify-between ${t?"print-header":""}`,children:[e.jsxs("div",{className:"flex items-center mb-4 md:mb-0",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"mr-4 p-2 rounded-full bg-white dark:bg-slate-800 shadow-sm hover:shadow-md transition-shadow no-print",children:e.jsx(K,{className:"h-5 w-5 text-slate-600 dark:text-slate-300"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-14 w-14 rounded-full flex items-center justify-center mr-3",children:e.jsx("img",{src:Q,alt:"logo",className:`w-16 ${t?"print-logo":""}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${t?"print-title":""}`,children:"Dargatech"}),e.jsx("p",{className:`text-sm text-slate-500 dark:text-slate-400 ${t?"print-subtitle":""}`,children:"Solutions solaires durables"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Maintenance #",s==null?void 0:s.maintenanceId]}),e.jsxs("div",{className:"text-lg font-semibold mt-1",children:["Rapport d'intervention #",s==null?void 0:s.id]}),e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:g(s==null?void 0:s.date_intervention)})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6",children:[e.jsxs("div",{className:"lg:w-64 flex-shrink-0 space-y-2 no-print sm:border-r-0 lg:border-r-2 pr-1",children:[e.jsx(d,{id:"information",label:"Information client",icon:e.jsx(y,{className:"h-4 w-4"})}),e.jsx(d,{id:"probleme",label:"Problème",icon:e.jsx(o,{className:"h-4 w-4"})}),e.jsx(d,{id:"diagnostic",label:"Diagnostic",icon:e.jsx(D,{className:"h-4 w-4"})}),e.jsx(d,{id:"intervention",label:"Intervention",icon:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(d,{id:"verification",label:"Vérification",icon:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(d,{id:"recommandation",label:"Recommandations",icon:e.jsx(P,{className:"h-4 w-4"})}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("button",{onClick:A,className:"w-full flex items-center justify-center space-x-2 bg-teal-600 hover:bg-teal-700 text-white px-4 py-3 rounded-lg transition-colors shadow-sm",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Télécharger en PDF"})]})})]}),e.jsxs("div",{className:`flex-1 bg-white dark:bg-slate-800 rounded-xl shadow-xl overflow-hidden ${t?"print-content":""}`,children:[l==="information"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(y,{className:"h-5 w-5 text-teal-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Information du client"})]}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-6 ${t?"print-grid":""}`,children:[e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Nom complet"}),e.jsxs("div",{className:`font-medium ${t?"print-card-content":""}`,children:[(u=s==null?void 0:s.client)==null?void 0:u.nom," ",(f=s==null?void 0:s.client)==null?void 0:f.prenom]})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Téléphone"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:(N=s==null?void 0:s.client)==null?void 0:N.telephone})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Localisation"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:(v=s==null?void 0:s.client)==null?void 0:v.localisation})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Email"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:((p=s==null?void 0:s.client)==null?void 0:p.email)||"Non spécifié"})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Technicien"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:s!=null&&s.technicien?`${s.technicien.user.name}`:"Non assigné"})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Date de l'intervention"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:g(s==null?void 0:s.date_intervention)})]})]})]}),l==="probleme"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(o,{className:"h-5 w-5 text-red-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Description de la panne"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Problèmes rapportés"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-teal-500 ${t?"print-card":""}`,children:(s==null?void 0:s.description_panne)||"Non spécifié"})]}),(s==null?void 0:s.photo_probleme)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Documentation visuelle"}),e.jsx("div",{className:`flex justify-center bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:e.jsx("img",{src:`/${s.photo_probleme}`,alt:"Photo du problème",className:"max-w-full h-auto max-h-96 rounded-lg shadow-md"})})]})]})]}),l==="diagnostic"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(D,{className:"h-5 w-5 text-amber-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Diagnostic & Cause"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Diagnostic initial"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-amber-500 ${t?"print-card":""}`,children:(s==null?void 0:s.diagnostic_initial)||"Non documenté"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Cause identifiée"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-orange-500 ${t?"print-card":""}`,children:(s==null?void 0:s.cause_identifiee)||"Non identifiée"})]})]})]}),l==="intervention"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(R,{className:"h-5 w-5 text-green-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Interventions réalisées"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-xs font-semibold px-3 py-1 rounded-full uppercase",children:((w=s==null?void 0:s.maintenance)==null?void 0:w.type_intervention)||"Non spécifié"})}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-green-500 ${t?"print-card":""}`,children:(s==null?void 0:s.intervention_realisee)||"Aucune intervention documentée"})]}),l==="verification"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(F,{className:"h-5 w-5 text-indigo-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Test post réparation"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`text-xs font-semibold px-3 py-1 rounded-full uppercase ${((k=s==null?void 0:s.maintenance)==null?void 0:k.status_intervention)==="terminée"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300"}`,children:(($=s==null?void 0:s.maintenance)==null?void 0:$.status_intervention)||"Non spécifié"})}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-indigo-500 ${t?"print-card":""}`,children:(s==null?void 0:s.verification_fonctionnement)||"Non documenté"})]}),l==="recommandation"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(P,{className:"h-5 w-5 text-purple-500 mr-3"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Recommandations au client"})]}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-purple-500 ${t?"print-card":""}`,children:(s==null?void 0:s.recommandation_client)||"Aucune recommandation spécifique"})]})]})]}),e.jsxs("div",{className:`mt-8 pt-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-500 dark:text-slate-400 flex justify-between items-center ${t?"print-footer":""}`,children:[e.jsxs("div",{children:["Rapport généré le ",new Date().toLocaleDateString("fr-FR")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Dargatech Solutions Solaires"}),e.jsx("div",{className:"w-1 h-1 rounded-full bg-slate-400 mx-2"}),e.jsxs("span",{children:["Rapport #ID: ",s==null?void 0:s.id]}),t&&e.jsxs("span",{className:"ml-4",children:["Page ",e.jsx("span",{className:"print-page-number"})]})]})]})]}),e.jsx("div",{className:"hidden",children:e.jsx(z,{data:s,ref:j})})]})};export{te as default};
