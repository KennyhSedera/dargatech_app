import{r as T,j as e,e as W,q as Z,v as E,$ as ee}from"./app-DQEW2JI7.js";import{I as o}from"./InputLabel-BXLlQAHm.js";import{T as h,I as x}from"./TextInput-KL61RiXX.js";import{u as te}from"./useTheme-RehbxCAz.js";import{D as ae}from"./DangerButton-CHndGFmK.js";import{g as se}from"./TypePaiementService-8J-jYB8t.js";import{b as le,a as ne}from"./clientService-_NmUGFLZ.js";import{P as re}from"./PrimaryButton-Ah8PTdmp.js";import{T as oe}from"./TextArea-wZCMI-yu.js";import{S as G}from"./SelectInput-DwRsSlMo.js";import{I as ie}from"./InputAutocomplete -D6-9QHhq.js";import{a as ce,b as me,u as ue,c as de,e as he}from"./PaiementService-DhqejJTh.js";import{S as pe}from"./Snackbar-BlyweEdY.js";import{F as _e}from"./FichierPaiementPdf-DoToch-T.js";import{C as ve,h as U,D as ge}from"./constant-Dj-w38li.js";import{a as xe}from"./validateForm-DkOh89YH.js";import"./lodash-DFHJF0P6.js";import"./createLucideIcon-CN1kuLlK.js";import"./api-BUDAeA6W.js";import"./iconBase-qX__T5RX.js";const je=({data:u,setData:c,validationErrors:a,setValidationErrors:i})=>{const[n,s]=T.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);T.useEffect(()=>{u.produits&&u.produits.length>0&&s(u.produits)},[u.produits]);const y=l=>{const t=parseFloat(l.quantite)||0,m=parseFloat(l.prix_unitaire)||0,_=parseFloat(l.tva)||0,w=t*m,j=w*(1+_/100);return{total_ht:w,total_ttc:j}},N=(l,t,m)=>{const _=[...n];if(_[l][t]=m,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:j,total_ttc:f}=y(_[l]);_[l].total_ht=j,_[l].total_ttc=f}s(_);const w={produits:_,description:u.description||"",montant_paye:b(_).totalTTCGlobal.toFixed(2)};if(c(j=>({...j,...w})),a!=null&&a.produits&&a.produits[l]){const j={...a};j.produits[l]&&(delete j.produits[l][t],Object.keys(j.produits[l]).length===0&&delete j.produits[l],Object.keys(j.produits).some(H=>Object.keys(j.produits[H]).length>0)||delete j.produits,i(j))}},b=l=>{const t=j=>{const f=parseFloat(j);return isNaN(f)?0:f},m=l.reduce((j,f)=>j+t(f.total_ht),0),_=l.reduce((j,f)=>j+t(f.total_ttc),0),w=l.reduce((j,f)=>{const H=t(f.tva),I=t(f.total_ht);return j+I*H/100},0);return{totalHTGlobal:parseFloat(m.toFixed(2)),totalTTCGlobal:parseFloat(_.toFixed(2)),totalTVAGlobal:parseFloat(w.toFixed(2))}},{totalHTGlobal:C,totalTTCGlobal:R,totalTVAGlobal:Y}=b(n),P=()=>{const l=[...n,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];s(l),c(t=>({...t,produits:l}))},k=l=>{const t=n.filter((_,w)=>w!==l);s(t);const m=b(t);if(c(_=>({..._,produits:t,montant_paye:m.totalTTCGlobal.toFixed(2)})),a!=null&&a.produits){const _={...a},w={};Object.keys(_.produits).forEach(j=>{const f=parseInt(j);f<l?w[f]=_.produits[f]:f>l&&(w[f-1]=_.produits[f])}),Object.keys(w).length>0?_.produits=w:delete _.produits,i(_)}},M=l=>{const t=l.target.value;c(m=>({...m,description:t}))},$=l=>{const t=parseFloat(l);return isNaN(t)?"0.00":t.toFixed(2)},S=(l,t)=>{var m,_;return((_=(m=a==null?void 0:a.produits)==null?void 0:m[l])==null?void 0:_[t])||""},q=a.produits==="Ajouter au moins un produit ou service.";return e.jsxs("div",{children:[e.jsxs("div",{className:"block lg:hidden",children:[n.map((l,t)=>e.jsxs("div",{className:`relative p-4 mb-4 border ${q?"border-red-500":"border-gray-200"} rounded-lg`,children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full top-1 right-1",onClick:()=>k(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(h,{id:`designation-${t}`,name:"designation",value:l.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>N(t,"designation",m.target.value),required:!0,placeholder:"Nom du produit ou service"}),e.jsx(x,{message:S(t,"designation"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(h,{id:`reference-${t}`,name:"reference",value:l.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>N(t,"reference",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:l.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>N(t,"quantite",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(h,{id:`unite-${t}`,name:"unite",value:l.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>N(t,"unite",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(h,{id:`tva-${t}`,name:"tva",value:l.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>N(t,"tva",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:l.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>N(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0}),e.jsx(x,{message:S(t,"prix_unitaire"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:$(l.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:$(l.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t)),e.jsx("div",{className:"text-sm text-red-500",children:q&&a.produits})]}),e.jsxs("div",{className:` ${q&&"md:border relative md:border-red-500 md:p-4 md:rounded-md"} hidden lg:block`,children:[n.map((l,t)=>e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(h,{id:`designation-${t}`,name:"designation",value:l.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>N(t,"designation",m.target.value),required:!0,placeholder:"Nom du produit ou service",onFocus:()=>i({...a,produits:""})})}),e.jsx("div",{children:e.jsx(h,{id:`reference-${t}`,name:"reference",value:l.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>N(t,"reference",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`quantite-${t}`,name:"quantite",value:l.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>N(t,"quantite",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`unite-${t}`,name:"unite",value:l.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>N(t,"unite",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(h,{id:`tva-${t}`,name:"tva",value:l.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>N(t,"tva",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(h,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:l.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>N(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0,onFocus:()=>i({...a,produits:"",montant_paye:""})})}),e.jsx("div",{children:e.jsx(h,{id:`total_ht-${t}`,name:"total_ht",value:$(l.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{id:`total_ttc-${t}`,name:"total_ttc",value:$(l.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute right-0 w-5 h-5 text-xs text-white bg-red-500 rounded-full -top-2",onClick:()=>k(t),children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-3",children:[e.jsx("div",{className:"col-span-4",children:e.jsx(x,{message:S(t,"designation"),className:"mt-1"})}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{children:e.jsx(x,{message:S(t,"prix_unitaire"),className:"mt-1"})})]})]},t)),e.jsx("div",{className:"absolute col-span-11 px-2 text-sm text-red-500 bg-white -bottom-2 dark:bg-gray-800",children:q&&a.produits})]}),e.jsx(oe,{name:"description",value:u.description||"",placeholder:"Description",onChange:M,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:P,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-900",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:C.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:Y.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:R.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},fe=({data:u,setData:c,validationErrors:a,errors:i,setValidationErrors:n})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"type",value:"Type"}),e.jsx(G,{id:"type",name:"type",value:u.type,className:"block w-full mt-1",autoComplete:"type",onChange:s=>c("type",s.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(x,{message:a.type||i.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"numero",value:"N*"}),e.jsx(h,{id:"numero",name:"numero",value:u.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:s=>c("numero",s.target.value),required:!0,disabled:!0,onFocus:()=>n({...a,numero:""})}),e.jsx(x,{message:a.numero||i.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(h,{id:"date_creation",name:"date_creation",value:u.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:s=>c("date_creation",s.target.value),type:"date",required:!0,onFocus:()=>n({...a,date_creation:""})}),e.jsx(x,{message:a.date_creation||i.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(h,{id:"lieu_creation",name:"lieu_creation",value:u.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:s=>c("lieu_creation",s.target.value),required:!0,onFocus:()=>n({...a,lieu_creation:""})}),e.jsx(x,{message:a.lieu_creation||i.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(G,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:u.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:s=>c("date_additionnel",s.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(x,{message:i.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"date",value:"*"}),e.jsx(h,{id:"date",name:"date",value:u.date,className:"block w-full mt-1",autoComplete:"date",onChange:s=>c("date",s.target.value),required:!0,type:"date",onFocus:()=>n({...a,date:""})})]})]}),ye=({clients:u,data:c,setData:a,errors:i,validationErrors:n,setValidationErrors:s,handleSelect:y,amount:N})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(o,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(G,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:c.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:b=>a("civilite_acheteur",b.target.value),required:!0,children:[e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mme.",children:"Mme."})]}),e.jsx(x,{message:i.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(ie,{data:u,className:"block w-full mt-1",onSelect:y,defaultValue:c.client_id||1,onFocus:()=>s({...n,prenom_acheteur:""})}),e.jsx(x,{message:n.prenom_acheteur||i.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(h,{id:"nom_acheteur",name:"nom_acheteur",value:c.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:b=>a("nom_acheteur",b.target.value),required:!0,onFocus:()=>s({...n,nom_acheteur:""})}),e.jsx(x,{message:n.nom_acheteur||i.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(h,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:c.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:b=>a("num_rue_acheteur",b.target.value),required:!0,onFocus:()=>s({...n,num_rue_acheteur:""})}),e.jsx(x,{message:n.num_rue_acheteur||i.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(h,{id:"ville_acheteur",name:"ville_acheteur",value:c.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:b=>a("ville_acheteur",b.target.value),required:!0,onFocus:()=>s({...n,ville_acheteur:""})}),e.jsx(x,{message:n.ville_acheteur||i.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(h,{id:"pays_acheteur",name:"pays_acheteur",value:c.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:b=>a("pays_acheteur",b.target.value),required:!0,onFocus:()=>s({...n,pays_acheteur:""})}),e.jsx(x,{message:n.pays_acheteur||i.pays_acheteur,className:"mt-2"})]}),!N&&e.jsxs("div",{children:[e.jsx(o,{htmlFor:"echeance",value:"Echéance"}),e.jsx(h,{id:"echeance",name:"echeance",value:c.echeance,className:"block w-full mt-1",autoComplete:"echeance",onChange:b=>a("echeance",b.target.value),required:!0,onFocus:()=>s({...n,echeance:""}),readOnly:!0}),e.jsx(x,{message:n.echeance||i.echeance,className:"mt-2"})]})]})]})]}),Ne=({data:u,setData:c,errors:a,validationErrors:i,setValidationErrors:n})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(h,{id:"nom_vendeurs",name:"nom_vendeurs",value:u.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:s=>c("nom_vendeurs",s.target.value),required:!0,onFocus:()=>n({...i,nom_vendeurs:""})}),e.jsx(x,{message:i.nom_vendeurs||a.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(o,{htmlFor:"select1",value:"Type"}),e.jsx(G,{id:"select1",type:"select1",name:"select1",value:u.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:s=>c("select1",s.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(h,{id:"num_tva",name:"num_tva",value:u.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:s=>c("num_tva",s.target.value),required:!0,onFocus:()=>n({...i,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(x,{message:i.num_tva||a.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(h,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:u.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:s=>c("nom_rue_vendeur",s.target.value),required:!0,onFocus:()=>n({...i,nom_rue_vendeur:""})}),e.jsx(x,{message:i.nom_rue_vendeur||a.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(h,{id:"ville_vendeur",name:"ville_vendeur",value:u.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:s=>c("ville_vendeur",s.target.value),required:!0,onFocus:()=>n({...i,ville_vendeur:""})}),e.jsx(x,{message:i.ville_vendeur||a.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(h,{id:"pays_vendeur",name:"pays_vendeur",value:u.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:s=>c("pays_vendeur",s.target.value),required:!0,onFocus:()=>n({...i,pays_vendeur:""})}),e.jsx(x,{message:i.pays_vendeur||a.pays_vendeur,className:"mt-2"})]})]})]})]}),be=({data:u,errors:c,setData:a,setValidationErrors:i,validationErrors:n,typePaiement:s})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(G,{id:"mode_paiement",name:"mode_paiement",value:u.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:y=>a("mode_paiement",y.target.value),required:!0,children:s.map(y=>e.jsx("option",{value:y.nom,children:y.nom},y.id))}),e.jsx(x,{message:n.mode_paiement||c.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(h,{id:"date_echeance",name:"date_echeance",value:u.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:y=>a("date_echeance",y.target.value),required:!0,type:"date",onFocus:()=>i({...n,date_echeance:""})}),e.jsx(x,{message:n.date_echeance||c.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(h,{id:"nom_vendeur",name:"nom_vendeur",value:u.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:y=>a("nom_vendeur",y.target.value),required:!0,onFocus:()=>i({...n,nom_vendeur:""})}),e.jsx(x,{message:n.nom_vendeur||c.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"etat_paiment",value:"État"}),e.jsx(G,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:u.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:y=>a("etat_paiment",y.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(x,{message:n.etat_paiment||c.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"montant_paye",name:"montant_paye",value:u.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:y=>a("montant_paye",y.target.value),required:!0,onFocus:()=>i({...n,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(x,{message:n.montant_paye||c.montant_paye,className:"mt-2"})]})]})]}),we=async(u,c,a)=>{var i,n;try{const s=await W.post("/api/paiement/generate-and-send-pdf",{email:c,data:u,telegram_chat_id:a});return s.data.success,s.data}catch(s){throw console.error("Erreur lors de l'envoi du PDF:",s),alert("Erreur lors de l'envoi du PDF: "+(((n=(i=s.response)==null?void 0:i.data)==null?void 0:n.message)||s.message)),s}};function Ce(u){const c=/(\d{2}\/\d{2}\/\d{4})/g,a=u.match(c);if(!a||a.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const i=a[0],n=a[1],s=C=>{const[R,Y,P]=C.split("/");return new Date(`${Y}/${R}/${P}`)},y=s(i),N=s(n),b=C=>({object:C,iso:C.toISOString(),localeFormat:C.toLocaleDateString(),original:`${C.getFullYear()}-${(C.getMonth()+1).toString().padStart(2,"0")}-${C.getDate().toString().padStart(2,"0")}`});return{startDate:b(y),endDate:b(N),durationDays:Math.floor((N-y)/(1e3*60*60*24))}}const Be=({token_data:u,telegramback:c})=>{const{theme:a,setTheme:i}=te(),n=T.useRef(null),[s,y]=T.useState(!0),[N,b]=T.useState(null),[C,R]=T.useState(!1),{props:Y}=Z(),{client_id:P,amount:k,designation:M}=Y,[$,S]=T.useState({}),[q,l]=T.useState([]),[t,m]=T.useState([]),[_,w]=T.useState({open:!1,message:"",type:"success"}),[j,f]=T.useState(""),I=new URLSearchParams(window.location.search).get("id");T.useEffect(()=>{i(a||"light"),Q()},[a]);const{data:g,setData:F,errors:O,reset:L}=E({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:"",echeance:"T1"});T.useEffect(()=>{k&&M&&F(v=>({...v,produits:[...v.produits,{designation:M,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:k,total_ht:k,total_ttc:k}],montant_paye:k,description:M,objet:"Frais de l'installation du pompage solaire.",date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0],echeance:""}))},[k,M]);const Q=async()=>{var v;try{const[{clients:d},r]=await Promise.all([le(),se()]);l(d==null?void 0:d.map(p=>({id:p.id,title:`${p.prenom} ${p.nom}`,nom:p.prenom,nom_famille:p.nom,ville:p.localisation,pays:"Togo",village:p.localisation,quartier:p.localisation,email:p.email,genre:p.genre,telephone:p.telephone,localisation:p.localisation}))),m((v=r.type)==null?void 0:v.map(p=>({id:p.id,nom:p.name})))}catch(d){console.error("Error fetching payment types:",d)}},X=async v=>{try{const d=await ce(v);if(d){const r=d;let p=null;P?p=q.find(D=>D.id===parseInt(P))||q.find(D=>D.id===P):p=q.find(D=>D.id===r.client_id);const A=Ce(r.periode_couverte);g.periode_couverte=A.startDate.original+" au "+A.endDate.original,p&&(F({...g,numero:r.numero,nom_acheteur:p.nom_famille,prenom_acheteur:p.nom,civilite_acheteur:p.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:p.ville,pays_acheteur:p.pays,num_rue_acheteur:p.village||p.quartier,client_id:p.id,objet:r.observation,description:r.description,mode_paiement:r.mode_paiement,date_echeance:r.echeance,statut_paiement:r.statut_paiement,produits:r.produits.map(D=>({...D,designation:D.designation,prix_unitaire:D.prix_unitaire,quantite:D.quantite,unite:D.unite})),montant_paye:parseFloat(r.montant).toFixed(2),date_creation:r.date_creation||A.startDate.original,date:r.date||A.endDate.original,lieu_creation:r.lieu_creation,date_additionnel:r.date_additionnel,nom_vendeur:r.nom_vendeur,nom_vendeurs:r.nom_vendeurs,select1:r.select1,num_tva:r.num_tva,nom_rue_vendeur:r.nom_rue_vendeur,ville_vendeur:r.ville_vendeur,pays_vendeur:r.pays_vendeur,ville_acheteur:r.ville_acheteur,pays_acheteur:r.pays_acheteur,code_postal_vendeur:r.code_postal_vendeur,telephone_vendeur:r.telephone_vendeur,email_vendeur:r.email_vendeur,date_paiement:r.date_paiement,date_echeance:r.date_echeance,echeance:r.echeance,observation:r.observation}),f(p.email)),R(!0)}}catch(d){console.error("Error fetching payment data:",d),w({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}},B=async v=>{try{const{client:d}=await ne(v);console.log(d),d&&(F({...g,client_id:v,nom_acheteur:d.nom,prenom_acheteur:d.prenom,civilite_acheteur:d.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:"",pays_acheteur:"",num_rue_acheteur:d.localisation}),f(d.email))}catch(d){return console.error("Error fetching client:",d),null}};T.useEffect(()=>{q.length>0&&I?X(I):q.length>0&&P&&B(P)},[q,I,P]);const z=async()=>{const{data:v}=await me();v&&F("numero",ve(v.numero))},K=async v=>{var r;const d=await he(v);d&&F("echeance",ge((r=d[0])==null?void 0:r.echeance))};T.useEffect(()=>{I||z()},[I]);const V=v=>{const d=q.find(r=>r.id===v.id);d&&(F("client_id",d.id),F("nom_acheteur",d.nom_famille),F("prenom_acheteur",d.nom),F("num_rue_acheteur",d.village||d.quartier),F("civilite_acheteur",d.genre==="Homme"?"Mr.":"Mme."),f(d.email),!k&&K(d.id))},J=async()=>{if(g.periode_couverte=k?"Frais d'installation.":U(g.date_creation).format("DD/MM/YYYY")+" au "+U(g.date).format("DD/MM/YYYY"),g.date_paiement=g.date_paiement?new Date(g.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],g.observation=g.objet,g.statut_paiement=g.etat_paiment,g.montant_paye=g.montant_paye||"0",g.montant=g.montant_paye||"0",C&&I&&(g.id=I),!!xe(g,S))try{let v;if(C?v=await ue(I,g):v=await de(g),w({open:!0,message:v.message,type:v.success?"success":"error"}),v.success){setTimeout(async()=>{if(L(),u?c(v.message):window.history.back(),P&&k&&M)try{const A=await(await fetch(`/api/paiement/client/${P}`,{method:"GET"})).json();console.log("Mise à jour is_payed:",A)}catch(p){console.error("Erreur mise à jour client:",p)}},3e3);const d=u?u.chat_id:null,r=await we(g,j,d);r.success&&w({open:!0,message:r.message,type:r.success?"success":"error"})}}catch(v){console.error("Error submitting payment:",v),w({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(ee,{title:C?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(pe,{message:_.message,type:_.type,duration:3e3,position:"top-right",show:_.open,onClose:()=>w({..._,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(ae,{onClick:()=>u?c():window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:C?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(fe,{data:g,errors:O,setData:F,validationErrors:$,setValidationErrors:S})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(Ne,{data:g,errors:O,setData:F,setValidationErrors:S,validationErrors:$})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ye,{clients:q,data:g,errors:O,handleSelect:V,setData:F,setValidationErrors:S,validationErrors:$,amount:k})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(o,{htmlFor:"objet",value:"Observation"}),e.jsx(h,{id:"objet",name:"objet",value:g.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:v=>F("objet",v.target.value),required:!0,onFocus:()=>S({...$,objet:""}),placeholder:"Ajouter l'objet du paiement"}),e.jsx(x,{message:$.objet||O.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(je,{data:g,setData:F,errors:O,setValidationErrors:S,validationErrors:$})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(be,{data:g,errors:O,setData:F,setValidationErrors:S,typePaiement:t,validationErrors:$})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(re,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:J,children:C?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:s&&N&&e.jsx("div",{ref:n,children:e.jsx(_e,{data:N})})})]})};export{Be as default};
