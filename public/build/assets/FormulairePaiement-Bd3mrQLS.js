import{r as b,j as e,e as z,q as K,v as J,$ as W}from"./app-DzG4DzLh.js";import{I as o}from"./InputLabel-3UIe_m4a.js";import{T as d,I as j}from"./TextInput-Dk5vNc4F.js";import{u as Z}from"./useTheme-CvXsb40T.js";import{D as E}from"./DangerButton-DJ0F-yta.js";import{g as ee}from"./TypePaiementService-BV6YsHtH.js";import{b as te}from"./clientService-Ds69zEeP.js";import{P as ae}from"./PrimaryButton-Cx_8pikI.js";import{T as se}from"./TextArea-B7KVu58A.js";import{S as I}from"./SelectInput-BN-ZdTfC.js";import{I as le}from"./InputAutocomplete -DyK3PeAf.js";import{a as ne,b as re,u as oe,c as ie}from"./PaiementService-BHdIqhCp.js";import{S as me}from"./Snackbar-kB46Vwr4.js";import{F as ce}from"./FichierPaiementPdf-B_Z4TVuj.js";import{A as ue,h as Y}from"./constant-C1fj40wr.js";import"./createLucideIcon-CHrN6-VM.js";import"./api-CaryC7AZ.js";import"./iconBase-k9FPIicb.js";const de=({data:u,setData:c})=>{const[r,i]=b.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);b.useEffect(()=>{u.produits&&u.produits.length>0&&i(u.produits)},[u.produits]);const l=n=>{const t=parseFloat(n.quantite)||0,m=parseFloat(n.prix_unitaire)||0,g=parseFloat(n.tva)||0,k=t*m,w=k*(1+g/100);return{total_ht:k,total_ttc:w}},a=(n,t,m)=>{const g=[...r];if(g[n][t]=m,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:w,total_ttc:F}=l(g[n]);g[n].total_ht=w,g[n].total_ttc=F}i(g);const k={produits:g,description:u.description||"",montant_paye:x(g).totalTTCGlobal.toFixed(2)};c(w=>({...w,...k}))},x=n=>{const t=w=>{const F=parseFloat(w);return isNaN(F)?0:F},m=n.reduce((w,F)=>w+t(F.total_ht),0),g=n.reduce((w,F)=>w+t(F.total_ttc),0),k=n.reduce((w,F)=>{const $=t(F.tva),D=t(F.total_ht);return w+D*$/100},0);return{totalHTGlobal:parseFloat(m.toFixed(2)),totalTTCGlobal:parseFloat(g.toFixed(2)),totalTVAGlobal:parseFloat(k.toFixed(2))}},{totalHTGlobal:f,totalTTCGlobal:M,totalTVAGlobal:N}=x(r),O=()=>{const n=[...r,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];i(n),c(t=>({...t,produits:n}))},S=n=>{const t=r.filter((g,k)=>k!==n);i(t);const m=x(t);c(g=>({...g,produits:t,montant_paye:m.totalTTCGlobal.toFixed(2)}))},C=n=>{const t=n.target.value;c(m=>({...m,description:t}))},T=n=>{const t=parseFloat(n);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[e.jsx("div",{className:"block lg:hidden",children:r.map((n,t)=>e.jsxs("div",{className:"relative p-4 mb-4 border border-gray-200 rounded-lg",children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full -top-2 -right-2",onClick:()=>S(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(d,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>a(t,"designation",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(d,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>a(t,"reference",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>a(t,"quantite",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(d,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>a(t,"unite",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(d,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>a(t,"tva",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>a(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(n.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(n.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t))}),e.jsx("div",{className:"hidden lg:block",children:r.map((n,t)=>e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(o,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(o,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(d,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>a(t,"designation",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>a(t,"reference",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>a(t,"quantite",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>a(t,"unite",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>a(t,"tva",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>a(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(n.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(n.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute w-5 h-5 text-xs text-white bg-red-500 rounded-full -right-2 -top-2",onClick:()=>S(t),children:"×"})]},t))}),e.jsx(se,{name:"description",value:u.description||"",placeholder:"Description",onChange:C,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:O,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:f.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:N.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:M.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},he=({data:u,setData:c,validationErrors:r,errors:i,setValidationErrors:l})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"type",value:"Type"}),e.jsx(I,{id:"type",name:"type",value:u.type,className:"block w-full mt-1",autoComplete:"type",onChange:a=>c("type",a.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(j,{message:r.type||i.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"numero",value:"N*"}),e.jsx(d,{id:"numero",name:"numero",value:u.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:a=>c("numero",a.target.value),required:!0,disabled:!0,onFocus:()=>l({...r,numero:""})}),e.jsx(j,{message:r.numero||i.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(d,{id:"date_creation",name:"date_creation",value:u.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:a=>c("date_creation",a.target.value),type:"date",required:!0,onFocus:()=>l({...r,date_creation:""})}),e.jsx(j,{message:r.date_creation||i.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(d,{id:"lieu_creation",name:"lieu_creation",value:u.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:a=>c("lieu_creation",a.target.value),required:!0,onFocus:()=>l({...r,lieu_creation:""})}),e.jsx(j,{message:r.lieu_creation||i.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(o,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(I,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:u.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:a=>c("date_additionnel",a.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(j,{message:i.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(o,{htmlFor:"date",value:"*"}),e.jsx(d,{id:"date",name:"date",value:u.date,className:"block w-full mt-1",autoComplete:"date",onChange:a=>c("date",a.target.value),required:!0,type:"date",onFocus:()=>l({...r,date:""})})]})]}),pe=({clients:u,data:c,setData:r,errors:i,validationErrors:l,setValidationErrors:a,handleSelect:x})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(o,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(I,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:c.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:f=>r("civilite_acheteur",f.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(j,{message:i.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(le,{data:u,className:"block w-full mt-1",onSelect:x,defaultValue:c.client_id,onFocus:()=>a({...l,client_id:""})}),e.jsx(j,{message:l.prenom_acheteur||i.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(o,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(d,{id:"nom_acheteur",name:"nom_acheteur",value:c.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:f=>r("nom_acheteur",f.target.value),required:!0,onFocus:()=>a({...l,nom_acheteur:""})}),e.jsx(j,{message:l.nom_acheteur||i.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(d,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:c.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:f=>r("num_rue_acheteur",f.target.value),required:!0,onFocus:()=>a({...l,num_rue_acheteur:""})}),e.jsx(j,{message:l.num_rue_acheteur||i.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(d,{id:"ville_acheteur",name:"ville_acheteur",value:c.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:f=>r("ville_acheteur",f.target.value),required:!0,onFocus:()=>a({...l,ville_acheteur:""})}),e.jsx(j,{message:l.ville_acheteur||i.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(d,{id:"pays_acheteur",name:"pays_acheteur",value:c.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:f=>r("pays_acheteur",f.target.value),required:!0,onFocus:()=>a({...l,pays_acheteur:""})}),e.jsx(j,{message:l.pays_acheteur||i.pays_acheteur,className:"mt-2"})]})]})]})]}),ve=({data:u,setData:c,errors:r,validationErrors:i,setValidationErrors:l})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(d,{id:"nom_vendeurs",name:"nom_vendeurs",value:u.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:a=>c("nom_vendeurs",a.target.value),required:!0,onFocus:()=>l({...i,nom_vendeurs:""})}),e.jsx(j,{message:i.nom_vendeurs||r.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(o,{htmlFor:"select1",value:"Type"}),e.jsx(I,{id:"select1",type:"select1",name:"select1",value:u.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:a=>c("select1",a.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(d,{id:"num_tva",name:"num_tva",value:u.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:a=>c("num_tva",a.target.value),required:!0,onFocus:()=>l({...i,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(j,{message:i.num_tva||r.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(d,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:u.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:a=>c("nom_rue_vendeur",a.target.value),required:!0,onFocus:()=>l({...i,nom_rue_vendeur:""})}),e.jsx(j,{message:i.nom_rue_vendeur||r.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(d,{id:"ville_vendeur",name:"ville_vendeur",value:u.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:a=>c("ville_vendeur",a.target.value),required:!0,onFocus:()=>l({...i,ville_vendeur:""})}),e.jsx(j,{message:i.ville_vendeur||r.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(d,{id:"pays_vendeur",name:"pays_vendeur",value:u.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:a=>c("pays_vendeur",a.target.value),required:!0,onFocus:()=>l({...i,pays_vendeur:""})}),e.jsx(j,{message:i.pays_vendeur||r.pays_vendeur,className:"mt-2"})]})]})]})]}),_e=({data:u,errors:c,setData:r,setValidationErrors:i,validationErrors:l,typePaiement:a})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(I,{id:"mode_paiement",name:"mode_paiement",value:u.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:x=>r("mode_paiement",x.target.value),required:!0,children:a.map(x=>e.jsx("option",{value:x.nom,children:x.nom},x.id))}),e.jsx(j,{message:l.mode_paiement||c.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(d,{id:"date_echeance",name:"date_echeance",value:u.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:x=>r("date_echeance",x.target.value),required:!0,type:"date",onFocus:()=>i({...l,date_echeance:""})}),e.jsx(j,{message:l.date_echeance||c.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(d,{id:"nom_vendeur",name:"nom_vendeur",value:u.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:x=>r("nom_vendeur",x.target.value),required:!0,onFocus:()=>i({...l,nom_vendeur:""})}),e.jsx(j,{message:l.nom_vendeur||c.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"etat_paiment",value:"État"}),e.jsx(I,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:u.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:x=>r("etat_paiment",x.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(j,{message:l.etat_paiment||c.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"montant_paye",name:"montant_paye",value:u.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:x=>r("montant_paye",x.target.value),required:!0,onFocus:()=>i({...l,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(j,{message:l.montant_paye||c.montant_paye,className:"mt-2"})]})]})]}),ge=async(u,c)=>{var r,i;try{const l=await z.post("/api/paiement/generate-and-send-pdf",{email:c,data:u});return l.data.success&&alert(l.data.message),l.data}catch(l){throw console.error("Erreur lors de l'envoi du PDF:",l),alert("Erreur lors de l'envoi du PDF: "+(((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.message)||l.message)),l}};function xe(u){const c=/(\d{2}\/\d{2}\/\d{4})/g,r=u.match(c);if(!r||r.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const i=r[0],l=r[1],a=N=>{const[O,S,C]=N.split("/");return new Date(`${S}/${O}/${C}`)},x=a(i),f=a(l),M=N=>({object:N,iso:N.toISOString(),localeFormat:N.toLocaleDateString(),original:`${N.getFullYear()}-${(N.getMonth()+1).toString().padStart(2,"0")}-${N.getDate().toString().padStart(2,"0")}`});return{startDate:M(x),endDate:M(f),durationDays:Math.floor((f-x)/(1e3*60*60*24))}}const Ge=({token_data:u,telegramback:c})=>{const{theme:r,setTheme:i}=Z(),l=b.useRef(null),[a,x]=b.useState(!0),[f,M]=b.useState(null),[N,O]=b.useState(!1),{props:S}=K(),{client_id:C,amount:T,designation:n}=S,[t,m]=b.useState({}),[g,k]=b.useState([]),[w,F]=b.useState([]),[$,D]=b.useState({open:!1,message:"",type:"success"}),[H,R]=b.useState(""),P=new URLSearchParams(window.location.search).get("id"),{data:p,setData:y,errors:A,reset:U}=J({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""});b.useEffect(()=>{let s=null;C&&(s=g.find(h=>h.id===parseInt(C))||g.find(h=>h.id===C)),y(h=>({...h,client_id:C,nom_acheteur:s==null?void 0:s.nom_famille,prenom_acheteur:s==null?void 0:s.nom,civilite_acheteur:(s==null?void 0:s.genre)==="Homme"?"Mr.":"Mme.",ville_acheteur:s==null?void 0:s.ville,pays_acheteur:s==null?void 0:s.pays,num_rue_acheteur:(s==null?void 0:s.village)||(s==null?void 0:s.quartier)}))},[C,g]),b.useEffect(()=>{y(s=>({...s,produits:[...s.produits,{designation:n,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:T,total_ht:T,total_ttc:T}],montant_paye:T,description:n,objet:n,date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0]}))},[T,n]);const L=async()=>{var s;try{const[{clients:h},v]=await Promise.all([te(),ee()]);k(h==null?void 0:h.map(_=>({id:_.id,nom:_.prenom,nom_famille:_.nom,ville:_.localisation,pays:"Togo",village:_.localisation,quartier:_.localisation,email:_.email,genre:_.genre,telephone:_.telephone,localisation:_.localisation}))),F((s=v.type)==null?void 0:s.map(_=>({id:_.id,nom:_.name})))}catch(h){console.error("Error fetching payment types:",h)}},Q=async s=>{try{const h=await ne(s);if(h){const v=h;let _=null;C?_=g.find(q=>q.id===parseInt(C))||g.find(q=>q.id===C):_=g.find(q=>q.id===v.client_id);const G=xe(v.periode_couverte);p.periode_couverte=G.startDate.original+" au "+G.endDate.original,_&&(y({...p,numero:v.numero,nom_acheteur:_.nom_famille,prenom_acheteur:_.nom,civilite_acheteur:_.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:_.ville,pays_acheteur:_.pays,num_rue_acheteur:_.village||_.quartier,client_id:_.id,objet:v.observation,description:v.description,mode_paiement:v.mode_paiement,date_echeance:v.echeance,statut_paiement:v.statut_paiement,produits:v.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseFloat(v.montant).toFixed(2),date_creation:v.date_creation||G.startDate.original,date:v.date||G.endDate.original,lieu_creation:v.lieu_creation,date_additionnel:v.date_additionnel,nom_vendeur:v.nom_vendeur,nom_vendeurs:v.nom_vendeurs,select1:v.select1,num_tva:v.num_tva,nom_rue_vendeur:v.nom_rue_vendeur,ville_vendeur:v.ville_vendeur,pays_vendeur:v.pays_vendeur}),R(_.email)),O(!0)}}catch(h){console.error("Error fetching payment data:",h),D({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};b.useEffect(()=>{i(r||"light"),L()},[r]),b.useEffect(()=>{g.length>0&&P&&Q(P)},[g,P]);const V=async()=>{const{data:s}=await re();s&&y("numero",ue(s.numero))};b.useEffect(()=>{P||V()},[P]);const X=s=>{const h=g.find(v=>v.id===s.id);h&&(y("client_id",h.id),y("nom_acheteur",h.nom_famille),y("prenom_acheteur",h.nom),y("ville_acheteur",h.ville),y("pays_acheteur",h.pays),y("num_rue_acheteur",h.village||h.quartier),y("civilite_acheteur",h.genre==="Homme"?"Mr.":"Mme."),R(h.email))},B=async()=>{p.periode_couverte=Y(p.date_creation).format("DD/MM/YYYY")+" au "+Y(p.date).format("DD/MM/YYYY"),p.date_paiement=p.date_paiement?new Date(p.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],p.observation=p.objet,p.echeance=p.date_echeance,p.statut_paiement=p.etat_paiment,p.montant_paye=p.montant_paye||"0",p.montant=p.montant_paye||"0",N&&P&&(p.id=P);try{let s;N?s=await oe(P,p):s=await ie(p),D({open:!0,message:s.message,type:s.success?"success":"error"}),s.success&&(setTimeout(async()=>{if(U(),u?c(s.message):window.history.back(),C&&T&&n)try{const v=await(await fetch(`/api/clients/${C}/is-paid`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_payed:!0})})).json();console.log("Mise à jour is_payed:",v)}catch(h){console.error("Erreur mise à jour client:",h)}},3e3),ge(p,H))}catch(s){console.error("Error submitting payment:",s),D({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(W,{title:N?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(me,{message:$.message,type:$.type,duration:3e3,position:"top-right",show:$.open,onClose:()=>D({...$,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(E,{onClick:()=>u?c():window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:N?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(he,{data:p,errors:A,setData:y,validationErrors:t,setValidationErrors:m})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(ve,{data:p,errors:A,setData:y,setValidationErrors:m,validationErrors:t})}),e.jsx("div",{className:"space-y-4",children:e.jsx(pe,{clients:g,data:p,errors:A,handleSelect:X,setData:y,setValidationErrors:m,validationErrors:t})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(o,{htmlFor:"objet",value:"Objet"}),e.jsx(d,{id:"objet",name:"objet",value:p.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:s=>y("objet",s.target.value),required:!0,onFocus:()=>m({...t,objet:""})}),e.jsx(j,{message:t.objet||A.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(de,{data:p,setData:y})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(_e,{data:p,errors:A,setData:y,setValidationErrors:m,typePaiement:w,validationErrors:t})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(ae,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:B,children:N?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:a&&f&&e.jsx("div",{ref:l,children:e.jsx(ce,{data:f})})})]})};export{Ge as default};
