import{r as s,m as V,j as e,L as B}from"./app-BkC8VWgr.js";import{S as G,C as H,D as M,G as R}from"./index-C9BLxk6X.js";import{a as F}from"./index-C9tktaFt.js";import{b as W}from"./clientService-B8q9ajEg.js";import{I as j,T as q}from"./TextInput-BkqmQp0b.js";import{I as w}from"./InputLabel-DJrVxPwe.js";import{g as z,T as J}from"./TypePaiement-92I70VKx.js";import{M as K}from"./Modal-BJN1yNeG.js";import{I as O}from"./InputAutocomplete -BF7EsfYc.js";import{d as Q}from"./validateForm-B0TA_X9F.js";import{d as U,n as X,f as Y,p as Z}from"./constant-B050u7nx.js";import{A as ee,T as te}from"./AuthenticatedLayout-BevpI5nv.js";import{H as ae}from"./HeaderPage-DFPcx5HP.js";import"./transition-CGbVp9qO.js";import"./useTheme-ZuXOj12l.js";const se=async()=>{try{return(await F.get("/paiement")).data}catch(i){throw console.error("Erreur lors de la récupération des paiements",i),i}},oe=async i=>{try{return(await F.post("/paiement",i)).data}catch(m){throw console.error("Erreur lors de l'enregistrement du paiement",m),m}},re=async(i,m)=>{try{return(await F.put(`/paiement/${i}`,m)).data}catch(o){throw console.error("Erreur lors de la modification du paiement",o),o}},ne=async i=>{try{return(await F.delete(`/paiement/${i}`)).data}catch(m){throw console.error("Erreur lors de la suppression du paiement",m),m}},ie=({open:i=!0,setOpen:m,dataModify:o={},onCloseFormulaire:v=()=>{}})=>{const[C,u]=s.useState("Enregistrer"),[c,l]=s.useState({}),[S,N]=s.useState(!1),[P,k]=s.useState([]),[g,f]=s.useState([]),{data:n,setData:d,errors:p,reset:T}=V({client_id:"",montant:"",date_paiement:new Date().toISOString().split("T")[0],mode_paiement:"",periode_couverte:"",receipt_path:""}),L=async()=>{var a;try{const[{clients:_},A]=await Promise.all([W(),z()]);k(_==null?void 0:_.map(x=>({id:x.id,nom:`${x.nom} ${x.prenom}`}))),f((a=A.type)==null?void 0:a.map(x=>({id:x.id,nom:x.name})))}catch(_){console.error("Error fetching clients or payment types:",_)}},D=s.useCallback(()=>{o.id?(d({client_id:o.client_id||"",montant:o.montant||"",date_paiement:U(o.date_paiement)||new Date().toISOString().split("T")[0],mode_paiement:parseInt(o.mode_paiement)||"",periode_couverte:o.periode_couverte||"",receipt_path:o.receipt_path||""}),u("Modifier")):E()},[o,d]),y=a=>{m(!1),E(),v(a)},E=()=>{T(),u("Enregistrer"),l({})};s.useEffect(()=>{L()},[]),s.useEffect(()=>{D()},[o,D]);const I=async()=>{if(Q(n,l)){N(!0),u("Loading ...");try{let a;C==="Enregistrer"?{message:a}=await oe(n):{message:a}=await re(o.id,n),y(a)}catch(a){console.error("Error submitting payment:",a)}finally{N(!1),u("Enregistrer")}}},b=a=>{d("client_id",a.id)},$=a=>{d("mode_paiement",a.id)};return e.jsxs(K,{show:i,closeable:!1,onClose:y,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier un Paiement":"Ajouter un Paiement"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"client_id",value:"Nom client"}),e.jsx(O,{data:P,isFocused:!0,className:"block w-full mt-1",onSelect:b,defaultValue:n.client_id,onFocus:()=>l({...c,client_id:""})}),e.jsx(j,{message:c.client_id||p.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"montant",value:"Montant ($)"}),e.jsx(q,{id:"montant",name:"montant",value:n.montant,className:"block w-full mt-1",autoComplete:"montant",onChange:a=>d("montant",a.target.value),required:!0,type:"number",onFocus:()=>l({...c,montant:""})}),e.jsx(j,{message:c.montant||p.montant,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"mode_paiement",value:"Mode paiement"}),e.jsx(O,{data:g,className:"block w-full mt-1",onSelect:$,defaultValue:n.mode_paiement,onFocus:()=>l({...c,mode_paiement:""})}),e.jsx(j,{message:c.mode_paiement||p.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"periode_couverte",value:"Période couverte"}),e.jsx(q,{id:"periode_couverte",name:"periode_couverte",value:n.periode_couverte,className:"block w-full mt-1",autoComplete:"periode_couverte",onChange:a=>d("periode_couverte",a.target.value),required:!0,onFocus:()=>l({...c,periode_couverte:""})}),e.jsx(j,{message:c.periode_couverte||p.periode_couverte,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"date_paiement",value:"Date de paiement"}),e.jsx(q,{id:"date_paiement",name:"date_paiement",value:n.date_paiement,className:"block w-full mt-1",autoComplete:"date_paiement",type:"date",onChange:a=>d("date_paiement",a.target.value),required:!0,onFocus:()=>l({...c,date_paiement:""})}),e.jsx(j,{message:c.date_paiement||p.date_paiement,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>y(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${S&&"opacity-25"}`,disabled:S,onClick:I,children:C})]})]})},ve=()=>{const[i,m]=s.useState(""),[o,v]=s.useState({}),[C,u]=s.useState(1),[c,l]=s.useState(!1),[S,N]=s.useState([]),[P,k]=s.useState([]),[g,f]=s.useState({open:!1,message:"",id:0}),[n,d]=s.useState({open:!1,message:"",type:"success"}),[p,T]=s.useState(!1),[L,D]=s.useState(!1),y=[{key:"id",label:"ID"},{key:"nom",label:"Nom client"},{key:"montant",label:"Montant ($)"},{key:"type_paiement",label:"Mode de paiement"},{key:"periode_couverte",label:"Periode couverte"},{key:"date_paiement",label:"Date de paiement"}],E=[{label:e.jsx(te,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>x(t)},{label:e.jsx(R,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>_(t)}],I=()=>{l(!0)},b=async()=>{try{const{data:t}=await se(),h=t.map(r=>({id:r.id,client_id:r.client_id,nom:`${r.client.nom} ${r.client.prenom}`,montant:r.montant,type_paiement:r.type_paiement.name,mode_paiement:r.mode_paiement,periode_couverte:r.periode_couverte,date_paiement:Y(r.date_paiement)}));N(h),k(h)}catch(t){console.log(t)}};s.useEffect(()=>{b()},[]);const $=t=>{m(t),u(1);const h=S.filter(r=>r.nom.toLowerCase().includes(t.toLowerCase())||r.montant.toLowerCase().includes(t.toLowerCase())||r.type_paiement.toLowerCase().includes(t.toLowerCase())||r.periode_couverte.toLowerCase().includes(t.toLowerCase())||r.mode_paiement.toLowerCase().includes(t.toLowerCase())||r.date_paiement.toString().toLowerCase().includes(t.toLowerCase()));k(h)},a=t=>{b(),t&&d({...n,message:t,open:!0}),v({})},_=t=>{f({open:!0,message:`Êtes-vous sûr de vouloir supprimer la paiement du ${t.nom} le ${t.date_paiement} ?`,id:t.id})},A=async()=>{const{message:t}=await ne(g.id);d({...n,message:t,open:!0}),f({...g,open:!1,id:0}),b(),u(1)},x=t=>{const h=t.date_paiement?t.date_paiement:"Invalid date";v({...t,date_paiement:Z(h)}),l(!0)};return e.jsxs(ee,{setId:D,children:[e.jsx(B,{title:"Paiements"}),e.jsx(ie,{open:c,setOpen:l,onCloseFormulaire:a,dataModify:o}),e.jsx(G,{message:n.message,type:n.type,duration:3e3,position:"top-right",show:n.open,onClose:()=>d({...n,message:"",open:!1})}),e.jsx(H,{open:g.open,message:g.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>f({...g,open:!1}),accept:A}),!L&&e.jsxs("span",{className:"flex items-center w-40 p-1 mb-2 border border-gray-300 rounded-md dark:border-gray-700",children:[e.jsx("div",{onClick:()=>T(!1),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${p?"bg-transparent":"bg-gray-300 dark:bg-gray-700"}`,children:"Tous"}),e.jsx("div",{onClick:()=>T(!0),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${p?"bg-gray-300 dark:bg-gray-700":"bg-transparent"}`,children:"Types"})]}),p?e.jsx(J,{}):e.jsxs("div",{children:[e.jsx(ae,{title:"Liste des Paiements",handleClick:I,search:i,onSearch:$}),P.length>0?e.jsx(M,{headers:y,rows:P,itemsPerPage:10,actions:E,className:"mt-4",currentPage:C,onPageChange:u,masqueColumns:["client_id"]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:X,alt:"no data",className:"max-w-md opacity-50 mt-2"})})]})]})};export{ve as default};
