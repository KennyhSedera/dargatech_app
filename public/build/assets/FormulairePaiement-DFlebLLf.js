import{r as k,j as e,e as te,q as ae,v as se,$ as le}from"./app-bGW8gQVj.js";import{I as i}from"./InputLabel-CgZ2-JDp.js";import{T as p,I as x}from"./TextInput-s67fNs0t.js";import{u as ne}from"./useTheme-CYNzC_Mm.js";import{D as re}from"./DangerButton-D3eEDBCB.js";import{g as oe}from"./TypePaiementService-DpRS_niu.js";import{b as ie,a as ce}from"./clientService-VpfBISFH.js";import{P as ue}from"./PrimaryButton-768r66JO.js";import{T as me}from"./TextArea-CkVIbC1U.js";import{S as H}from"./SelectInput-Bx5kSbrg.js";import{I as de}from"./InputAutocomplete -COhvNNyL.js";import{a as pe,b as he,u as _e,c as ve,e as ge}from"./PaiementService-Chkvov8i.js";import{S as xe}from"./Snackbar-BGKq9OL_.js";import{F as je}from"./FichierPaiementPdf-E65c_83L.js";import{w as fe,y as ye,h as X,M as Ne}from"./constant-vxfAKWQM.js";import{a as be}from"./validateForm-DkOh89YH.js";import"./createLucideIcon-C-CRoZJf.js";import"./api-9KDcsv6L.js";import"./iconBase-B2fljwAO.js";const we=({data:d,setData:u,validationErrors:a,setValidationErrors:c})=>{const[r,l]=k.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);k.useEffect(()=>{d.produits&&d.produits.length>0&&l(d.produits)},[d.produits]);const N=n=>{const t=parseFloat(n.quantite)||0,m=parseFloat(n.prix_unitaire)||0,_=parseFloat(n.tva)||0,w=t*m,j=w*(1+_/100);return{total_ht:w,total_ttc:j}},h=(n,t,m)=>{const _=[...r];if(_[n][t]=m,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:j,total_ttc:f}=N(_[n]);_[n].total_ht=j,_[n].total_ttc=f}l(_);const w={produits:_,description:d.description||"",montant_paye:Y(_).totalTTCGlobal.toFixed(2)};if(u(j=>({...j,...w})),a!=null&&a.produits&&a.produits[n]){const j={...a};j.produits[n]&&(delete j.produits[n][t],Object.keys(j.produits[n]).length===0&&delete j.produits[n],Object.keys(j.produits).some(Q=>Object.keys(j.produits[Q]).length>0)||delete j.produits,c(j))}},Y=n=>{const t=j=>{const f=parseFloat(j);return isNaN(f)?0:f},m=n.reduce((j,f)=>j+t(f.total_ht),0),_=n.reduce((j,f)=>j+t(f.total_ttc),0),w=n.reduce((j,f)=>{const Q=t(f.tva),O=t(f.total_ht);return j+O*Q/100},0);return{totalHTGlobal:parseFloat(m.toFixed(2)),totalTTCGlobal:parseFloat(_.toFixed(2)),totalTVAGlobal:parseFloat(w.toFixed(2))}},{totalHTGlobal:T,totalTTCGlobal:U,totalTVAGlobal:L}=Y(r),q=()=>{const n=[...r,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];l(n),u(t=>({...t,produits:n}))},M=n=>{const t=r.filter((_,w)=>w!==n);l(t);const m=Y(t);if(u(_=>({..._,produits:t,montant_paye:m.totalTTCGlobal.toFixed(2)})),a!=null&&a.produits){const _={...a},w={};Object.keys(_.produits).forEach(j=>{const f=parseInt(j);f<n?w[f]=_.produits[f]:f>n&&(w[f-1]=_.produits[f])}),Object.keys(w).length>0?_.produits=w:delete _.produits,c(_)}},A=n=>{const t=n.target.value;u(m=>({...m,description:t}))},D=n=>{const t=parseFloat(n);return isNaN(t)?"0.00":t.toFixed(2)},I=(n,t)=>{var m,_;return((_=(m=a==null?void 0:a.produits)==null?void 0:m[n])==null?void 0:_[t])||""},S=a.produits==="Ajouter au moins un produit ou service.";return e.jsxs("div",{children:[e.jsxs("div",{className:"block lg:hidden",children:[r.map((n,t)=>e.jsxs("div",{className:`relative p-4 mb-4 border ${S?"border-red-500":"border-gray-200"} rounded-lg`,children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full top-1 right-1",onClick:()=>M(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(i,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(p,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>h(t,"designation",m.target.value),required:!0,placeholder:"Nom du produit ou service"}),e.jsx(x,{message:I(t,"designation"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(p,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>h(t,"reference",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(p,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>h(t,"quantite",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(p,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>h(t,"unite",m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(p,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>h(t,"tva",m.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(p,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>h(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0}),e.jsx(x,{message:I(t,"prix_unitaire"),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(p,{id:`total_ht-${t}`,name:"total_ht",value:D(n.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(p,{id:`total_ttc-${t}`,name:"total_ttc",value:D(n.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t)),e.jsx("div",{className:"text-sm text-red-500",children:S&&a.produits})]}),e.jsxs("div",{className:` ${S&&"md:border relative md:border-red-500 md:p-4 md:rounded-md"} hidden lg:block`,children:[r.map((n,t)=>e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(i,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(i,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(p,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>h(t,"designation",m.target.value),required:!0,placeholder:"Nom du produit ou service",onFocus:()=>c({...a,produits:""})})}),e.jsx("div",{children:e.jsx(p,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>h(t,"reference",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(p,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>h(t,"quantite",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(p,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>h(t,"unite",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(p,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>h(t,"tva",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(p,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>h(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0,onFocus:()=>c({...a,produits:"",montant_paye:""})})}),e.jsx("div",{children:e.jsx(p,{id:`total_ht-${t}`,name:"total_ht",value:D(n.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(p,{id:`total_ttc-${t}`,name:"total_ttc",value:D(n.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute right-0 w-5 h-5 text-xs text-white bg-red-500 rounded-full -top-2",onClick:()=>M(t),children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-3",children:[e.jsx("div",{className:"col-span-4",children:e.jsx(x,{message:I(t,"designation"),className:"mt-1"})}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{children:e.jsx(x,{message:I(t,"prix_unitaire"),className:"mt-1"})})]})]},t)),e.jsx("div",{className:"absolute col-span-11 px-2 text-sm text-red-500 bg-white -bottom-2 dark:bg-gray-800",children:S&&a.produits})]}),e.jsx(me,{name:"description",value:d.description||"",placeholder:"Description",onChange:A,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:q,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 dark:bg-gray-900",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:T.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:L.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:U.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},Ce=({data:d,setData:u,validationErrors:a,errors:c,setValidationErrors:r})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(i,{htmlFor:"type",value:"Type"}),e.jsx(H,{id:"type",name:"type",value:d.type,className:"block w-full mt-1",autoComplete:"type",onChange:l=>u("type",l.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(x,{message:a.type||c.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(i,{htmlFor:"numero",value:"N*"}),e.jsx(p,{id:"numero",name:"numero",value:d.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:l=>u("numero",l.target.value),required:!0,disabled:!0,onFocus:()=>r({...a,numero:""})}),e.jsx(x,{message:a.numero||c.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(i,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(p,{id:"date_creation",name:"date_creation",value:d.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:l=>u("date_creation",l.target.value),type:"date",required:!0,onFocus:()=>r({...a,date_creation:""})}),e.jsx(x,{message:a.date_creation||c.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(i,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(p,{id:"lieu_creation",name:"lieu_creation",value:d.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:l=>u("lieu_creation",l.target.value),required:!0,onFocus:()=>r({...a,lieu_creation:""})}),e.jsx(x,{message:a.lieu_creation||c.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(i,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(H,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:d.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:l=>u("date_additionnel",l.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(x,{message:c.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(i,{htmlFor:"date",value:"*"}),e.jsx(p,{id:"date",name:"date",value:d.date,className:"block w-full mt-1",autoComplete:"date",onChange:l=>u("date",l.target.value),required:!0,type:"date",onFocus:()=>r({...a,date:""})})]})]}),Fe=({clients:d,data:u,setData:a,errors:c,validationErrors:r,setValidationErrors:l,handleSelect:N})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(i,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(H,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:u.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:h=>a("civilite_acheteur",h.target.value),required:!0,children:[e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mme.",children:"Mme."})]}),e.jsx(x,{message:c.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(i,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(de,{data:d,className:"block w-full mt-1",onSelect:N,defaultValue:u.client_id||1,onFocus:()=>l({...r,prenom_acheteur:""})}),e.jsx(x,{message:r.prenom_acheteur||c.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(i,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(p,{id:"nom_acheteur",name:"nom_acheteur",value:u.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:h=>a("nom_acheteur",h.target.value),required:!0,onFocus:()=>l({...r,nom_acheteur:""})}),e.jsx(x,{message:r.nom_acheteur||c.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(p,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:u.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:h=>a("num_rue_acheteur",h.target.value),required:!0,onFocus:()=>l({...r,num_rue_acheteur:""})}),e.jsx(x,{message:r.num_rue_acheteur||c.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(p,{id:"ville_acheteur",name:"ville_acheteur",value:u.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:h=>a("ville_acheteur",h.target.value),required:!0,onFocus:()=>l({...r,ville_acheteur:""})}),e.jsx(x,{message:r.ville_acheteur||c.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(p,{id:"pays_acheteur",name:"pays_acheteur",value:u.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:h=>a("pays_acheteur",h.target.value),required:!0,onFocus:()=>l({...r,pays_acheteur:""})}),e.jsx(x,{message:r.pays_acheteur||c.pays_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"echeance",value:"Echéance"}),e.jsx(p,{id:"echeance",name:"echeance",value:u.echeance,className:"block w-full mt-1",autoComplete:"echeance",onChange:h=>a("echeance",h.target.value),required:!0,onFocus:()=>l({...r,echeance:""})}),e.jsx(x,{message:r.echeance||c.echeance,className:"mt-2"})]})]})]})]}),Te=({data:d,setData:u,errors:a,validationErrors:c,setValidationErrors:r})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(p,{id:"nom_vendeurs",name:"nom_vendeurs",value:d.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:l=>u("nom_vendeurs",l.target.value),required:!0,onFocus:()=>r({...c,nom_vendeurs:""})}),e.jsx(x,{message:c.nom_vendeurs||a.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(i,{htmlFor:"select1",value:"Type"}),e.jsx(H,{id:"select1",type:"select1",name:"select1",value:d.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:l=>u("select1",l.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(i,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(p,{id:"num_tva",name:"num_tva",value:d.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:l=>u("num_tva",l.target.value),required:!0,onFocus:()=>r({...c,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(x,{message:c.num_tva||a.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(p,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:d.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:l=>u("nom_rue_vendeur",l.target.value),required:!0,onFocus:()=>r({...c,nom_rue_vendeur:""})}),e.jsx(x,{message:c.nom_rue_vendeur||a.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(p,{id:"ville_vendeur",name:"ville_vendeur",value:d.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:l=>u("ville_vendeur",l.target.value),required:!0,onFocus:()=>r({...c,ville_vendeur:""})}),e.jsx(x,{message:c.ville_vendeur||a.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(p,{id:"pays_vendeur",name:"pays_vendeur",value:d.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:l=>u("pays_vendeur",l.target.value),required:!0,onFocus:()=>r({...c,pays_vendeur:""})}),e.jsx(x,{message:c.pays_vendeur||a.pays_vendeur,className:"mt-2"})]})]})]})]}),ke=({data:d,errors:u,setData:a,setValidationErrors:c,validationErrors:r,typePaiement:l})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(H,{id:"mode_paiement",name:"mode_paiement",value:d.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:N=>a("mode_paiement",N.target.value),required:!0,children:l.map(N=>e.jsx("option",{value:N.nom,children:N.nom},N.id))}),e.jsx(x,{message:r.mode_paiement||u.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(p,{id:"date_echeance",name:"date_echeance",value:d.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:N=>a("date_echeance",N.target.value),required:!0,type:"date",onFocus:()=>c({...r,date_echeance:""})}),e.jsx(x,{message:r.date_echeance||u.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(p,{id:"nom_vendeur",name:"nom_vendeur",value:d.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:N=>a("nom_vendeur",N.target.value),required:!0,onFocus:()=>c({...r,nom_vendeur:""})}),e.jsx(x,{message:r.nom_vendeur||u.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"etat_paiment",value:"État"}),e.jsx(H,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:d.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:N=>a("etat_paiment",N.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(x,{message:r.etat_paiment||u.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"montant_paye",name:"montant_paye",value:d.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:N=>a("montant_paye",N.target.value),required:!0,onFocus:()=>c({...r,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(x,{message:r.montant_paye||u.montant_paye,className:"mt-2"})]})]})]}),qe=async(d,u,a)=>{var c,r;try{const l=await te.post("/api/paiement/generate-and-send-pdf",{email:u,data:d,telegram_chat_id:a});return l.data.success,l.data}catch(l){throw console.error("Erreur lors de l'envoi du PDF:",l),alert("Erreur lors de l'envoi du PDF: "+(((r=(c=l.response)==null?void 0:c.data)==null?void 0:r.message)||l.message)),l}};function Se(d){const u=/(\d{2}\/\d{2}\/\d{4})/g,a=d.match(u);if(!a||a.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const c=a[0],r=a[1],l=T=>{const[U,L,q]=T.split("/");return new Date(`${L}/${U}/${q}`)},N=l(c),h=l(r),Y=T=>({object:T,iso:T.toISOString(),localeFormat:T.toLocaleDateString(),original:`${T.getFullYear()}-${(T.getMonth()+1).toString().padStart(2,"0")}-${T.getDate().toString().padStart(2,"0")}`});return{startDate:Y(N),endDate:Y(h),durationDays:Math.floor((h-N)/(1e3*60*60*24))}}const Je=({token_data:d,telegramback:u})=>{const{theme:a,setTheme:c}=ne(),r=k.useRef(null),[l,N]=k.useState(!0),[h,Y]=k.useState(null),[T,U]=k.useState(!1),{props:L}=ae(),{client_id:q,amount:M,designation:A}=L,[D,I]=k.useState({}),[S,n]=k.useState([]),[t,m]=k.useState([]),[_,w]=k.useState({open:!1,message:"",type:"success"}),[j,f]=k.useState(""),O=new URLSearchParams(window.location.search).get("id");k.useEffect(()=>{c(a||"light"),V()},[a]);const{data:v,setData:b,errors:R,reset:K}=se({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:"",echeance:""});k.useEffect(()=>{M&&A&&b(g=>({...g,produits:[...g.produits,{designation:A,reference:"",quantite:1,unite:"",tva:0,prix_unitaire:M,total_ht:M,total_ttc:M}],montant_paye:M,description:A,objet:"Frais de l'installation du pompage solaire.",date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0],echeance:"Installation"}))},[M,A]);const V=async()=>{var g;try{const[{clients:o},y]=await Promise.all([ie(),oe()]);n(o==null?void 0:o.map(s=>({id:s.id,title:`${s.prenom} ${s.nom}`,nom:s.prenom,nom_famille:s.nom,ville:s.localisation,pays:"Togo",village:s.localisation,quartier:s.localisation,email:s.email,genre:s.genre,telephone:s.telephone,localisation:s.localisation,pays_acheteur:s.pays_acheteur,ville_acheteur:s.ville_acheteur}))),m((g=y.type)==null?void 0:g.map(s=>({id:s.id,nom:s.name})))}catch(o){console.error("Error fetching payment types:",o)}},J=async g=>{var o;try{const y=await pe(g);if(y){const s=y;let C=null;q?C=S.find(P=>P.id===parseInt(q))||S.find(P=>P.id===q):C=S.find(P=>P.id===s.client_id);let $=null,F=s.periode_couverte;const G=/\d{2}\/\d{2}\/\d{4}/g,z=(o=s.periode_couverte)==null?void 0:o.match(G);if(z&&z.length>=2)try{$=Se(s.periode_couverte),F=$.startDate.original+" au "+$.endDate.original}catch(P){console.warn("Impossible d'extraire les dates:",P),F=s.periode_couverte}C&&(b({...v,numero:s.numero,nom_acheteur:C.nom_famille,prenom_acheteur:C.nom,civilite_acheteur:C.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:C.ville_acheteur||s.ville_acheteur,pays_acheteur:C.pays_acheteur||s.pays_acheteur,num_rue_acheteur:C.village||C.quartier,client_id:C.id,objet:s.observation,description:s.description,mode_paiement:s.mode_paiement,statut_paiement:s.statut_paiement,produits:s.produits.map(P=>({...P,designation:P.designation,prix_unitaire:P.prix_unitaire,quantite:P.quantite,unite:P.unite})),montant_paye:parseFloat(s.montant).toFixed(2),date_creation:s.date_creation||($==null?void 0:$.startDate.original)||X().format("DD/MM/YYYY"),date:s.date||($==null?void 0:$.endDate.original)||X().format("DD/MM/YYYY"),lieu_creation:s.lieu_creation,date_additionnel:s.date_additionnel,nom_vendeur:s.nom_vendeur,nom_vendeurs:s.nom_vendeurs,select1:s.select1,num_tva:s.num_tva,nom_rue_vendeur:s.nom_rue_vendeur,ville_vendeur:s.ville_vendeur,pays_vendeur:s.pays_vendeur,code_postal_vendeur:s.code_postal_vendeur,telephone_vendeur:s.telephone_vendeur,email_vendeur:s.email_vendeur,date_paiement:s.date_paiement,date_echeance:s.date_echeance,echeance:s.echeance,observation:s.observation,periode_couverte:F}),f(C.email)),U(!0)}}catch(y){console.error("Error fetching payment data:",y),w({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}},W=async g=>{try{const{client:o}=await ce(g);o&&(B({email:o.email,genre:o.genre,id:o.id,localisation:o.localisation,nom:o.prenom,nom_famille:o.nom,pays:o.pays_acheteur,pays_acheteur:o.pays_acheteur,quartier:o.localisation,telephone:o.telephone,title:`${o.prenom} ${o.nom}`,village:o.localisation,ville:o.ville_acheteur,ville_acheteur:o.ville_acheteur}),f(o.email))}catch(o){return console.error("Error fetching client:",o),null}};k.useEffect(()=>{S.length>0&&O?J(O):S.length>0&&q&&W(q)},[S,O,q]);const Z=async()=>{const{data:g}=await he();g&&b("numero",Ne(g.numero))},E=async g=>{const o=await ge(g);if(o&&o.length>0){const y={};if(o.forEach(F=>{if(F!=null&&F.echeance&&/^T\d+$/i.test(F.echeance)){const G=parseInt(F.echeance.match(/^T(\d+)$/i)[1],10);y[G]||(y[G]=0),y[G]+=parseInt(F.montant)||F.montant||0}}),Object.keys(y).length===0){b("echeance","T01");return}const s=Object.keys(y).map(Number).sort((F,G)=>F-G);let C=s[0];for(const F of s)if(y[F]>=18e3)C=F;else{b("echeance",`T${String(F).padStart(2,"0")}`);return}const $=`T${String(C+1).padStart(2,"0")}`;b("echeance",$)}else b(y=>({...y,produits:[...y.produits,{designation:"Acompte pour signature de contrat et installation",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:3e4,total_ht:3e4,total_ttc:3e4}],montant_paye:"30000",description:"Acompte pour signature de contrat et installation",objet:"Frais de l'installation du pompage solaire.",date_paiement:new Date().toISOString().split("T")[0],date_echeance:new Date().toISOString().split("T")[0],echeance:"Installation"}))};k.useEffect(()=>{O||Z()},[O]);const B=g=>{const o=S.find(y=>y.id===g.id);o&&(b("client_id",o.id),b("nom_acheteur",o.nom_famille),b("prenom_acheteur",o.nom),b("num_rue_acheteur",o.localisation),b("ville_acheteur",o.ville_acheteur),b("pays_acheteur",o.pays_acheteur),b("civilite_acheteur",o.genre==="Homme"?"Mr.":"Mme."),f(o.email),!q&&E(o.id))},ee=async()=>{if(v.periode_couverte=M?"Frais d'installation.":X(v.date_creation).format("DD/MM/YYYY")+" au "+X(v.date).format("DD/MM/YYYY"),v.date_paiement=v.date_paiement?new Date(v.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],v.observation=v.objet,v.statut_paiement=v.etat_paiment,v.montant_paye=v.montant_paye||"0",v.montant=v.montant_paye||"0",T&&O&&(v.id=O),!!be(v,I))try{let g;if(T?g=await _e(O,v):g=await ve(v),w({open:!0,message:g.message,type:g.success?"success":"error"}),g.success){setTimeout(async()=>{if(K(),d?u(g.message):window.history.back(),q&&M&&A||v.objet==="Frais de l'installation du pompage solaire."){const s=q||v.client_id;try{const $=await(await fetch(`/api/paiement/client/${s}`,{method:"GET"})).json();console.log("Mise à jour is_payed:",$)}catch(C){console.error("Erreur mise à jour client:",C)}}},3e3);const o=d?d.chat_id:null,y=await qe(v,j,o);y.success&&w({open:!0,message:y.message,type:y.success?"success":"error"})}}catch(g){console.error("Error submitting payment:",g),w({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(le,{title:T?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(xe,{message:_.message,type:_.type,duration:3e3,position:"top-right",show:_.open,onClose:()=>w({..._,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 mb-6 text-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:fe,alt:"logo",className:"w-12 h-12 mr-2"}),e.jsx("img",{src:ye,alt:"titre",className:"w-auto h-9"})]}),e.jsx(re,{onClick:()=>d?u():window.history.back(),className:"text-sm capitalize sm:text-base",children:"Retour"})]}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:T?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(Ce,{data:v,errors:R,setData:b,validationErrors:D,setValidationErrors:I})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(Te,{data:v,errors:R,setData:b,setValidationErrors:I,validationErrors:D})}),e.jsx("div",{className:"space-y-4",children:e.jsx(Fe,{clients:S,data:v,errors:R,handleSelect:B,setData:b,setValidationErrors:I,validationErrors:D})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(i,{htmlFor:"objet",value:"Observation"}),e.jsx(p,{id:"objet",name:"objet",value:v.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:g=>b("objet",g.target.value),required:!0,onFocus:()=>I({...D,objet:""}),placeholder:"Ajouter l'objet du paiement"}),e.jsx(x,{message:D.objet||R.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(we,{data:v,setData:b,errors:R,setValidationErrors:I,validationErrors:D})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ke,{data:v,errors:R,setData:b,setValidationErrors:I,typePaiement:t,validationErrors:D})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(ue,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:ee,children:T?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:l&&h&&e.jsx("div",{ref:r,children:e.jsx(je,{data:h})})})]})};export{Je as default};
