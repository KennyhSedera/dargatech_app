import{r as s,j as a,$ as E,m as F}from"./app-CKIQC7bl.js";import{C as v}from"./ConfirmDialog-DpPfg_rg.js";import{D as A}from"./DataTable-gPVHnAYW.js";import{H as R}from"./HeaderPage-Cu_PBayX.js";import{F as M}from"./FormulaireInstallation-ZjQVdpEW.js";import{S as H}from"./Snackbar-BgpWpSLL.js";import{f as q,p as G,q as V}from"./constant-Ccl-ng2K.js";import{A as W,R as O}from"./AuthenticatedLayout-BmgAKyoc.js";import{g as z,d as B}from"./installationService-DJ9FzzDK.js";import{G as J}from"./index-y2Q3NTKV.js";import{T as K,a as Q}from"./index-D8MTw20h.js";import{E as U}from"./EmptyState-BuVt_WbL.js";import"./Modal-OJ7ZqoQe.js";import"./transition-De7C3uv9.js";import"./index-C37N_ndF.js";import"./iconBase-BrNMzGLU.js";import"./TextInput-CrJOgruW.js";import"./createLucideIcon-CKqiLiGq.js";import"./InputLabel-CLXF8NDZ.js";import"./validateForm-f9K0gDaZ.js";import"./InputAutocomplete -C9q5CEsw.js";import"./clientService-CgtVVlBX.js";import"./api-DgjbNlyT.js";import"./SelectInput-D3RubUYM.js";import"./useTheme-CqPKuz4y.js";const ye=()=>{const[u,h]=s.useState(""),[_,r]=s.useState(!1),[C,p]=s.useState({}),[w,l]=s.useState(1),[b,y]=s.useState([]),[f,x]=s.useState([]),[j,g]=s.useState(!0),[i,d]=s.useState({open:!1,message:"",id:0}),[o,m]=s.useState({open:!1,message:"",type:"success"}),S=[{key:"code_installation",label:"Code",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"numero_serie",label:"Numéro de série de la pompe",sortable:!0},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation",sortable:!0},{key:"statuts",label:"Statuts",customRender:e=>a.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${e==="installée"?"bg-green-500/50":e==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"created_via",label:"Via",customRender:e=>a.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?a.jsx(Q,{}):a.jsx(O,{className:"text-blue-400 bg-white"})})}],L=[{label:a.jsx(G,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:e=>$(e.id)},{label:a.jsx(K,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>P(e)},{label:a.jsx(J,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>I(e)}],k=()=>{r(!0)},c=async()=>{g(!0);const{data:e}=await z(),n=e.map(t=>({id:t.id,code_installation:t.code_installation,client_id:t.client_id,nom:t.client.nom+" "+t.client.prenom,puissance_pompe:t.puissance_pompe,profondeur_forage:t.profondeur_forage,debit_nominal:t.debit_nominal,numero_serie:t.numero_serie,source_eau:t.source_eau,hmt:t.hmt,date_installation:q(t.date_installation),statuts:t.statuts,latitude:t.localisation.latitude,longitude:t.localisation.longitude,created_via:t.created_via}));y(n),x(n),g(!1)};s.useEffect(()=>{c()},[]);const D=e=>{h(e),l(1);const n=b.filter(t=>t.nom.toLowerCase().includes(e.toLowerCase())||t.code_installation.toLowerCase().includes(e.toLowerCase())||t.numero_serie.toLowerCase().includes(e.toLowerCase())||t.source_eau.toLowerCase().includes(e.toLowerCase())||t.statuts.toLowerCase().includes(e.toLowerCase())||t.date_installation.toString().toLowerCase().includes(e.toLowerCase()));x(n)},N=e=>{c(),e&&m({...o,message:e,open:!0}),p({})},I=e=>{d({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${e.code_installation} du ${e.nom} le ${e.date_installation} ?`,id:e.id})},T=async()=>{const{message:e}=await B(i.id);m({...o,message:e,open:!0}),d({...i,open:!1,id:0}),c(),l(1)},P=e=>{const n=e.date_installation?e.date_installation:"Invalid date";p({...e,date_installation:V(n)}),r(!0)},$=e=>{F.visit(`/installation/${e}`)};return a.jsxs(W,{children:[a.jsx(E,{title:"Installations"}),a.jsx(R,{title:`Liste des Installations ( Total: ${b.length} )`,handleClick:k,onSearch:D,search:u}),a.jsx(M,{open:_,setOpen:r,onCloseFormulaire:N,dataModify:C}),a.jsx(H,{message:o.message,type:o.type,duration:3e3,position:"top-right",show:o.open,onClose:()=>m({...o,message:"",open:!1})}),a.jsx(v,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>d({...i,open:!1}),accept:T}),j?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):a.jsx("div",{children:f.length>0?a.jsx(A,{headers:S,rows:f,itemsPerPage:6,actions:L,className:"mt-4",currentPage:w,onPageChange:l,masqueColumns:["client_id","latitude","longitude"]}):a.jsx(U,{nom:"installation",search:u})})]})};export{ye as default};
