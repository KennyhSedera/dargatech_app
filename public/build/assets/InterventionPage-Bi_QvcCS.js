import{r as a,m as O,j as e,L as B}from"./app-BkC8VWgr.js";import{S as G,C as H,D as V,G as R}from"./index-C9BLxk6X.js";import{H as W}from"./HeaderPage-DFPcx5HP.js";import{M as z}from"./Modal-BJN1yNeG.js";import{I as b,T as N}from"./TextInput-BkqmQp0b.js";import{I as f}from"./InputLabel-DJrVxPwe.js";import{a as J}from"./installationService-DA5AsylQ.js";import{I as K}from"./InputAutocomplete -BF7EsfYc.js";import{d as M,n as Q,f as U,p as X}from"./constant-B050u7nx.js";import{a as D}from"./index-C9tktaFt.js";import{S as Y}from"./SelectInput-DM56CVdk.js";import{c as Z}from"./validateForm-B0TA_X9F.js";import{g as ee,A as te,T as ne}from"./AuthenticatedLayout-BevpI5nv.js";import"./transition-CGbVp9qO.js";import"./useTheme-ZuXOj12l.js";const se=async()=>{try{return(await D.get("/maintenance")).data}catch(c){throw console.error("Erreur lors de la récupération des maintenances",c),c}},oe=async c=>{try{return(await D.post("/maintenance",c)).data}catch(d){throw console.error("Erreur lors de l'enregistrement du maintenance",d),d}},ie=async(c,d)=>{try{return(await D.put(`/maintenance/${c}`,d)).data}catch(o){throw console.error("Erreur lors de la modification du maintenance",o),o}},ae=async c=>{try{return(await D.delete(`/maintenance/${c}`)).data}catch(d){throw console.error("Erreur lors de la suppression du maintenance",d),d}},re=({open:c=!0,setOpen:d,dataModify:o={},onCloseFormulaire:I=()=>{},idTechnicien:v})=>{const[h,x]=a.useState("Enregistrer"),[j,y]=a.useState(!1),[l,u]=a.useState({}),[F,S]=a.useState([]),[L,_]=a.useState([]),{data:r,setData:i,errors:m,reset:k}=O({installation_id:0,date_intervention:new Date().toISOString().split("T")[0],type_intervention:"préventive",description_probleme:"",solutions_apportees:"",duree_intervention:"",technicien:v}),E=async()=>{const[{data:n},C]=await Promise.all([J(),ee()]),A=n.map(p=>({id:p.id,nom:p.code_installation,message:p.alert[0].message})),t=C==null?void 0:C.data.map(p=>({id:p.technicien.id,nom:p.name}));_(t),S(A)},w=n=>{d(!1),g(),I(n)},g=()=>{k(),y(!1),x("Enregistrer"),u({})};a.useEffect(()=>{E(),o.id?(i({installation_id:o.installation_id||0,date_intervention:M(o.date_intervention)||new Date().toISOString().split("T")[0],type_intervention:o.type_intervention||"",description_probleme:o.description_probleme||"",solutions_apportees:o.solutions_apportees||"",duree_intervention:o.duree_intervention||"",technicien:o.technicien_id||0}),x("Modifier")):g()},[o,i]),a.useEffect(()=>{v&&i("technicien",v)},[v,i]);const T=async()=>{if(Z(r,u)){y(!0),x("Chargement..."),console.log(r);try{let n;h==="Enregistrer"?{message:n}=await oe(r):{message:n}=await ie(o.id,r),w(n)}catch(n){console.error("Error submitting payment:",n)}finally{y(!1),x("Enregistrer")}}},P=n=>{i({...r,installation_id:n.id,description_probleme:n.message})};return e.jsxs(z,{show:c,closeable:!1,onClose:w,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Intervention":"Ajouter une Intervention"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"installation_id",value:"Code d'instalation"}),e.jsx(K,{data:F,className:"block w-full mt-1",onSelect:P,isFocused:!0,defaultValue:r.installation_id,readOnly:o.id,onFocus:()=>u({...l,installation_id:""})}),e.jsx(b,{message:l.installation_id||m.installation_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"type_intervention",value:"Type d'intervention"}),e.jsxs(Y,{id:"type_intervention",type:"type_intervention",name:"type_intervention",value:r.type_intervention,className:"block w-full mt-1",autoComplete:"type_intervention",onChange:n=>i("type_intervention",n.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Préventive"}),e.jsx("option",{value:"curative",children:"Curative"})]}),e.jsx(b,{message:m.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"description_probleme",value:"Description du problème"}),e.jsx(N,{id:"description_probleme",name:"description_probleme",value:r.description_probleme,className:"block w-full mt-1",autoComplete:"description_probleme",onChange:n=>i("description_probleme",n.target.value),required:!0,onFocus:()=>u({...l,description_probleme:""})}),e.jsx(b,{message:l.description_probleme||m.description_probleme,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"solutions_apportees",value:"Solutions apportées"}),e.jsx(N,{id:"solutions_apportees",name:"solutions_apportees",value:r.solutions_apportees,className:"block w-full mt-1",autoComplete:"solutions_apportees",onChange:n=>i("solutions_apportees",n.target.value),required:!0,onFocus:()=>u({...l,solutions_apportees:""})}),e.jsx(b,{message:l.solutions_apportees||m.solutions_apportees,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"duree_intervention",value:"Durée de l'intervention (jour)"}),e.jsx(N,{id:"duree_intervention",name:"duree_intervention",value:r.duree_intervention,className:"block w-full mt-1",autoComplete:"duree_intervention",onChange:n=>i("duree_intervention",n.target.value),required:!0,type:"number",onFocus:()=>u({...l,duree_intervention:""})}),e.jsx(b,{message:l.duree_intervention||m.duree_intervention,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"date_intervention",value:"Date d'intervention"}),e.jsx(N,{id:"date_intervention",name:"date_intervention",value:r.date_intervention,className:"block w-full mt-1",autoComplete:"date_intervention",type:"date",onChange:n=>i("date_intervention",n.target.value),required:!0,onFocus:()=>u({...l,date_intervention:""})}),e.jsx(b,{message:l.date_intervention||m.date_intervention,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>w(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${j&&"opacity-25"}`,disabled:j,onClick:T,children:h})]})]})},we=()=>{const[c,d]=a.useState(""),[o,I]=a.useState(0),[v,h]=a.useState(!1),[x,j]=a.useState({}),[y,l]=a.useState(1),[u,F]=a.useState([]),[S,L]=a.useState([]),[_,r]=a.useState({open:!1,message:"",id:0}),[i,m]=a.useState({open:!1,message:"",type:"success"}),k=[{key:"id",label:"ID"},{key:"code_installation",label:"Installation"},{key:"nom",label:"Client"},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème"},{key:"solutions_apportees",label:"Solutions"},{key:"duree_intervention",label:"Durée (jour)"},{key:"date_intervention",label:"Date"},{key:"technicien",label:"Technicien"}],E=[{label:e.jsx(ne,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>A(t)},{label:e.jsx(R,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>n(t)}],w=()=>{h(!0)},g=async()=>{const{data:t}=await se(),p=t.map(s=>{var q,$;return{id:s.id,installation_id:s.installation_id,code_installation:s.installation.code_installation,nom:s.installation.client.nom+" "+s.installation.client.prenom,type_intervention:s.type_intervention,description_probleme:s.description_probleme,solutions_apportees:s.solutions_apportees,duree_intervention:s.duree_intervention,date_intervention:U(s.date_intervention),technicien:((q=s.techniciens)==null?void 0:q.user.name)||null,technicien_id:(($=s.techniciens)==null?void 0:$.id)||null}});F(p),L(p)};a.useEffect(()=>{g()},[]);const T=t=>{d(t),l(1);const p=u.filter(s=>s.nom.toLowerCase().includes(t.toLowerCase())||s.type_intervention.toLowerCase().includes(t.toLowerCase())||s.description_probleme.toLowerCase().includes(t.toLowerCase())||s.solutions_apportees.toLowerCase().includes(t.toLowerCase())||s.technicien.toLowerCase().includes(t.toLowerCase())||s.duree_intervention.toString().toLowerCase().includes(t.toLowerCase())||s.date_intervention.toString().toLowerCase().includes(t.toLowerCase()));L(p)},P=t=>{g(),t&&m({...i,message:t,open:!0}),j({})},n=t=>{r({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${t.nom} le ${t.date_intervention} ?`,id:t.id})},C=async()=>{const{message:t}=await ae(_.id);m({...i,message:t,open:!0}),r({..._,open:!1,id:0}),g(),l(1)},A=t=>{const p=t.date_intervention?t.date_intervention:"Invalid date";j({...t,date_intervention:X(p)}),h(!0)};return e.jsxs(te,{setId:I,children:[e.jsx(B,{title:"Maintenance"}),e.jsx(W,{search:c,onSearch:T,title:"Liste des interventions",handleClick:w}),e.jsx(G,{message:i.message,type:i.type,duration:3e3,position:"top-right",show:i.open,onClose:()=>m({...i,message:"",open:!1})}),e.jsx(H,{open:_.open,message:_.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>r({..._,open:!1}),accept:C}),e.jsx(re,{open:v,setOpen:h,dataModify:x,onCloseFormulaire:P,idTechnicien:o}),e.jsx("div",{children:S.length>0?e.jsx(V,{headers:k,rows:S,itemsPerPage:10,actions:E,className:"mt-4",currentPage:y,onPageChange:l,masqueColumns:["client_id"]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:Q,alt:"no data",className:"max-w-md opacity-50 mt-2"})})})]})};export{we as default};
