import{r,m as A,j as e,L as q}from"./app-BkC8VWgr.js";import{S as $,C as O,D as W,G}from"./index-C9BLxk6X.js";import{H,F as R}from"./HeaderPage-DFPcx5HP.js";import{M as V}from"./Modal-BJN1yNeG.js";import{I as _,T as j}from"./TextInput-BkqmQp0b.js";import{I as f}from"./InputLabel-DJrVxPwe.js";import{b as B}from"./validateForm-B0TA_X9F.js";import{g as P,c as z,u as J,d as K}from"./installationService-DA5AsylQ.js";import{I as Q}from"./InputAutocomplete -BF7EsfYc.js";import{b as U}from"./clientService-B8q9ajEg.js";import{d as X,i as Y,n as Z,f as M,p as ee}from"./constant-B050u7nx.js";import{A as te,T as ae}from"./AuthenticatedLayout-BevpI5nv.js";import"./index-C9tktaFt.js";import"./transition-CGbVp9qO.js";import"./useTheme-ZuXOj12l.js";const se=({open:y=!0,setOpen:I,dataModify:o={},onCloseFormulaire:x=()=>{}})=>{const[C,m]=r.useState("Enregistrer"),[w,p]=r.useState(!1),[l,d]=r.useState({}),[S,v]=r.useState([]),{data:n,setData:i,errors:c,reset:N}=A({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:""}),F=async()=>{const[{clients:a},k]=await Promise.all([U(),P()]),E=a.map(u=>({id:u.id,nom:u.nom+" "+u.prenom})),T=k.data.reduce((u,s)=>{const L=parseInt(s.code_installation.replace(/\D/g,""),10);return L>u?L:u},0),t=`${Y("I"+String(T).padStart(4,"0"))}`;v(E),o.id||i("code_installation",t)},g=a=>{I(!1),b(),x(a)},b=()=>{i({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:"I0001"}),p(!1),m("Enregistrer"),d({})};r.useEffect(()=>{F(),o.id?(i({client_id:o.client_id||0,date_installation:X(o.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:o.puissance_pompe||"",profondeur_forage:o.profondeur_forage||"",debit_nominal:o.debit_nominal||"",surface_panneaux:o.surface_panneaux||"",code_installation:o.code_installation||""}),m("Modifier")):b()},[o,i]);const h=async()=>{if(B(n,d)){p(!0),m("Chargement...");try{let a;C==="Enregistrer"?{message:a}=await z(n):{message:a}=await J(o.id,n),g(a)}catch(a){console.error("Error submitting payment:",a)}finally{b()}}},D=a=>{i("client_id",a.id)};return e.jsxs(V,{show:y,closeable:!1,onClose:g,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"client_id",value:"Nom client"}),e.jsx(Q,{data:S,className:"block w-full mt-1",onSelect:D,isFocused:!0,defaultValue:n.client_id??0,onFocus:()=>d({...l,client_id:""})}),e.jsx(_,{message:l.client_id||c.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"puissance_pompe",value:"Puissance du pompe (W)"}),e.jsx(j,{id:"puissance_pompe",name:"puissance_pompe",value:n.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:a=>i("puissance_pompe",a.target.value),required:!0,type:"number",onFocus:()=>d({...l,puissance_pompe:""})}),e.jsx(_,{message:l.puissance_pompe||c.puissance_pompe,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"profondeur_forage",value:"Profondeur du forage (m)"}),e.jsx(j,{id:"profondeur_forage",name:"profondeur_forage",value:n.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:a=>i("profondeur_forage",a.target.value),required:!0,type:"number",onFocus:()=>d({...l,profondeur_forage:""})}),e.jsx(_,{message:l.profondeur_forage||c.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(j,{id:"debit_nominal",name:"debit_nominal",value:n.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:a=>i("debit_nominal",a.target.value),required:!0,type:"number",onFocus:()=>d({...l,debit_nominal:""})}),e.jsx(_,{message:l.debit_nominal||c.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"surface_panneaux",value:"Surface des panneaux solaires (m²)"}),e.jsx(j,{id:"surface_panneaux",name:"surface_panneaux",value:n.surface_panneaux,className:"block w-full mt-1",autoComplete:"surface_panneaux",onChange:a=>i("surface_panneaux",a.target.value),required:!0,type:"number",onFocus:()=>d({...l,surface_panneaux:""})}),e.jsx(_,{message:l.surface_panneaux||c.surface_panneaux,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"date_installation",value:"Date d'installation"}),e.jsx(j,{id:"date_installation",name:"date_installation",value:n.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:a=>i("date_installation",a.target.value),required:!0,onFocus:()=>d({...l,date_installation:""})}),e.jsx(_,{message:l.date_installation||c.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>g(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${w&&"opacity-25"}`,disabled:w,onClick:h,children:C})]})]})},he=()=>{const[y,I]=r.useState(""),[o,x]=r.useState(!1),[C,m]=r.useState({}),[w,p]=r.useState(1),[l,d]=r.useState([]),[S,v]=r.useState([]),[n,i]=r.useState({open:!1,message:"",id:0}),[c,N]=r.useState({open:!1,message:"",type:"success"}),F=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"puissance_pompe",label:"Puissance du pompe (W)"},{key:"profondeur_forage",label:"Profondeur du forage (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"surface_panneaux",label:"Surface des panneaux solaires (m²)"},{key:"date_installation",label:"Date d'installation"},{key:"statuts",label:"Statuts",customRender:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${t==="installée"?"bg-green-500/50":t==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:t})}],g=[{label:e.jsx(R,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:t=>showDetail(t.id)},{label:e.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>T(t)},{label:e.jsx(G,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>k(t)}],b=()=>{x(!0)},h=async()=>{const{data:t}=await P(),u=t.map(s=>({id:s.id,code_installation:s.code_installation,client_id:s.client_id,nom:s.client.nom+" "+s.client.prenom,puissance_pompe:s.puissance_pompe,profondeur_forage:s.profondeur_forage,debit_nominal:s.debit_nominal,surface_panneaux:s.surface_panneaux,date_installation:M(s.date_installation),statuts:s.statuts}));d(u),v(u)};r.useEffect(()=>{h()},[]);const D=t=>{I(t),p(1);const u=l.filter(s=>s.nom.toLowerCase().includes(t.toLowerCase())||s.statuts.toLowerCase().includes(t.toLowerCase())||s.date_installation.toString().toLowerCase().includes(t.toLowerCase()));v(u)},a=t=>{h(),t&&N({...c,message:t,open:!0}),m({})},k=t=>{i({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation du ${t.nom} le ${t.date_installation} ?`,id:t.id})},E=async()=>{const{message:t}=await K(n.id);N({...c,message:t,open:!0}),i({...n,open:!1,id:0}),h(),p(1)},T=t=>{const u=t.date_installation?t.date_installation:"Invalid date";m({...t,date_installation:ee(u)}),x(!0)};return e.jsxs(te,{children:[e.jsx(q,{title:"Installations"}),e.jsx(H,{title:"Liste des Installations",handleClick:b,onSearch:D,search:y}),e.jsx(se,{open:o,setOpen:x,onCloseFormulaire:a,dataModify:C}),e.jsx($,{message:c.message,type:c.type,duration:3e3,position:"top-right",show:c.open,onClose:()=>N({...c,message:"",open:!1})}),e.jsx(O,{open:n.open,message:n.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>i({...n,open:!1}),accept:E}),e.jsx("div",{children:S.length>0?e.jsx(W,{headers:F,rows:S,itemsPerPage:10,actions:g,className:"mt-4",currentPage:w,onPageChange:p,masqueColumns:["client_id"]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:Z,alt:"no data",className:"max-w-md opacity-50 mt-2"})})})]})};export{he as default};
