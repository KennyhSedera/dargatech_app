import{r as a,q as J,j as t,$ as K,m as S}from"./app-DzG4DzLh.js";import{C as Q}from"./ConfirmDialog-RuM9veyS.js";import{D as U}from"./DataTable-CK4fE-JX.js";import{E as X}from"./EmptyState-CVJUQM3F.js";import{H as Y}from"./HeaderPage-DNzcBx9A.js";import{F as Z}from"./FormulaireMaintenance-Cos3NkUe.js";import{F as ee}from"./FormulaireRapportMaintenance-CU-Ty4QZ.js";import{S as te}from"./Snackbar-kB46Vwr4.js";import{f as ne,q as ae}from"./constant-C1fj40wr.js";import{A as oe,R as se}from"./AuthenticatedLayout-DqalP9kN.js";import{g as re,d as ie}from"./maintenanceService-CiaZRJaI.js";import{G as le}from"./index-CrD15DTq.js";import{T as de,a as pe}from"./index-BJxSO_no.js";import"./Modal-DSbXiRse.js";import"./transition-DCzKZadW.js";import"./index-DqqrotcL.js";import"./iconBase-k9FPIicb.js";import"./TextInput-Dk5vNc4F.js";import"./createLucideIcon-CHrN6-VM.js";import"./InputLabel-3UIe_m4a.js";import"./installationService-Cu6MftA0.js";import"./api-CaryC7AZ.js";import"./InputAutocomplete -DyK3PeAf.js";import"./SelectInput-BN-ZdTfC.js";import"./validateForm-CtIdfQW8.js";import"./TextArea-B7KVu58A.js";import"./InputImage-BQ60e7lM.js";import"./useTheme-CvXsb40T.js";const qe=()=>{const[u,D]=a.useState(""),[x,k]=a.useState(0),[N,p]=a.useState(!1),[R,b]=a.useState(!1),[L,f]=a.useState({}),[P,h]=a.useState({}),[T,m]=a.useState(1),[g,F]=a.useState([]),[_,v]=a.useState([]),[I,y]=a.useState(!0),[r,c]=a.useState({open:!1,message:"",id:0}),[s,l]=a.useState({open:!1,message:"",type:"success"}),i=J().props.auth.user,[M,$]=a.useState(10),E=[{key:"id",label:"ID",sortable:!0},{key:"code_installation",label:"Installation",sortable:!0},{key:"nom",label:"Client",sortable:!0},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème",customRender:e=>t.jsxs("div",{className:"relative max-w-md group",children:[t.jsx("span",{className:"line-clamp-2",children:e}),t.jsx("div",{className:"absolute bottom-0 left-0 z-50 hidden max-w-md p-2 mt-2 text-sm text-gray-800 bg-white border border-gray-300 rounded shadow-md group-hover:block",children:e})]})},{key:"date_intervention",label:"Date d'intervenir",sortable:!0},{key:"status_intervention",label:"Statuts",customRender:e=>t.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap ${e==="terminée"?"bg-green-500/50":e==="en attente"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"status_intervention",label:"Rapport",sortable:!0,customRender:(e,o)=>{var n,j,C;return t.jsx("span",{onClick:()=>{var w;return e==="terminée"?S.visit("/rapport",{data:{intervention_id:o.id}}):((w=i.user_role)==null?void 0:w.name)==="partenaire"?null:O(o)},className:`px-2 py-1 rounded-full flex text-nowrap ${((n=i.user_role)==null?void 0:n.name)==="partenaire"&&e!=="terminée"?"cursor-default":"cursor-pointer"} ${e==="terminée"?"text-green-500":((j=i.user_role)==null?void 0:j.name)==="partenaire"?"text-gray-300":"text-blue-500"}`,children:e==="terminée"?"Consulter":((C=i.user_role)==null?void 0:C.name)==="partenaire"?"En attente":"Ajouter"})}},{key:"created_via",label:"Via",customRender:e=>t.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?t.jsx(pe,{}):t.jsx(se,{className:"text-blue-400"})})}],A=[{label:t.jsx(de,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>W(e)},{label:t.jsx(le,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>B(e)}],q=()=>{p(!0)},O=e=>{var o;((o=i.user_role)==null?void 0:o.name)==="partenaire"?S.visit("/rapport",{data:{intervention_id:e.id}}):(b(!0),h(e))},d=async()=>{y(!0);const{data:e}=await re(),o=e.map(n=>({id:n.id,installation_id:n.installation_id,code_installation:n.installation.code_installation,nom:n.installation.client.nom+" "+n.installation.client.prenom,idclient:n.installation.client.id,type_intervention:n.type_intervention,description_probleme:n.description_probleme,status_intervention:n.status_intervention,date_intervention:ne(n.date_intervention),created_via:n.created_via}));F(o),v(o),y(!1)};a.useEffect(()=>{d()},[]);const G=e=>{D(e),m(1);const o=g.filter(n=>n.nom.toLowerCase().includes(e.toLowerCase())||n.type_intervention.toLowerCase().includes(e.toLowerCase())||n.description_probleme.toLowerCase().includes(e.toLowerCase())||n.date_intervention.toString().toLowerCase().includes(e.toLowerCase()));v(o)},H=e=>{d(),e&&l({...s,message:e,open:!0}),f({})},z=e=>{d(),e&&l({...s,message:e,open:!0}),h({})},B=e=>{c({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${e.nom} le ${e.date_intervention} ?`,id:e.id})},V=async()=>{const{message:e}=await ie(r.id);l({...s,message:e,open:!0}),c({...r,open:!1,id:0}),d(),m(1)},W=e=>{const o=e.date_intervention?e.date_intervention:"Invalid date";f({...e,date_intervention:ae(o)}),p(!0)};return t.jsxs(oe,{setId:k,children:[t.jsx(K,{title:"Maintenance"}),t.jsx(Y,{search:u,onSearch:G,title:`Liste des interventions ( Total: ${g.length} )`,handleClick:q}),t.jsx(te,{message:s.message,type:s.type,duration:3e3,position:"top-right",show:s.open,onClose:()=>l({...s,message:"",open:!1})}),t.jsx(Q,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>c({...r,open:!1}),accept:V}),t.jsx(Z,{open:N,setOpen:p,dataModify:L,onCloseFormulaire:H,idTechnicien:x}),t.jsx(ee,{open:R,setOpen:b,dataModify:P,onCloseFormulaire:z,idTechnicien:x}),I?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):t.jsx("div",{children:_.length>0?t.jsx(U,{headers:E,rows:_,itemsPerPage:M,actions:A,className:"mt-4",currentPage:T,onPageChange:m,masqueColumns:["client_id"],onItemsPerPageChange:e=>$(e)}):t.jsx(X,{nom:"intervention",search:u})})]})};export{qe as default};
