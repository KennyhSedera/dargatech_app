import{r as o,v as Q,j as e,$ as U,m as A}from"./app-DtIOmszM.js";import{C as X}from"./index-CsJ4QUTT.js";import{D as Y}from"./DataTable-BB8EVSg2.js";import{c as Z,u as ee,g as te,d as ae}from"./PaiementService-p8zwZgz7.js";import{b as se}from"./clientService-DVXRoPCh.js";import{I as j,T as q}from"./TextInput-DpZeXhzL.js";import{I as y}from"./InputLabel-CGZ7a-Kg.js";import{g as oe}from"./TypePaiementService-CFtvSsij.js";import{M as re}from"./Modal-Da7oLZO9.js";import{I as z}from"./InputAutocomplete -COq3Vmc2.js";import{a as ne}from"./validateForm-DkOh89YH.js";import{z as ie,f as me,t as de,u as ce}from"./constant-DL8UIkUJ.js";import{S as le}from"./Snackbar-DpIitYzr.js";import{A as pe}from"./AuthenticatedLayout-B_Hsivs8.js";import{G as ue}from"./index-CpCFpiil.js";import ge from"./TypePaiement-XJOu8rbz.js";import{H as xe}from"./HeaderPage-BFP1Irbn.js";import{a as be}from"./index-B5tZQ_Vc.js";import{E as fe}from"./EmptyState-CA1V175n.js";import"./iconBase-CH7_inEQ.js";import"./api-xdiG_W6n.js";import"./createLucideIcon-Br6977Up.js";import"./transition-0js-FjRc.js";import"./useTheme-62wc6eoV.js";import"./InputImage-C6LeyGSH.js";const _e=({open:w=!0,setOpen:D,dataModify:n={},onCloseFormulaire:C=()=>{}})=>{const[S,l]=o.useState("Enregistrer"),[i,c]=o.useState({}),[x,P]=o.useState(!1),[N,k]=o.useState([]),[E,F]=o.useState([]),{data:r,setData:d,errors:m,reset:b}=Q({client_id:"",montant:"",date_paiement:new Date().toISOString().split("T")[0],mode_paiement:"",periode_couverte:"",receipt_path:""}),f=async()=>{var s;try{const[{clients:u},v]=await Promise.all([se(),oe()]);k(u==null?void 0:u.map(p=>({id:p.id,nom:`${p.nom} ${p.prenom}`}))),F((s=v.type)==null?void 0:s.map(p=>({id:p.id,nom:p.name})))}catch(u){console.error("Error fetching clients or payment types:",u)}},_=o.useCallback(()=>{n.id?(d({client_id:n.client_id||"",montant:n.montant||"",date_paiement:ie(n.date_paiement)||new Date().toISOString().split("T")[0],mode_paiement:parseInt(n.mode_paiement)||"",periode_couverte:n.periode_couverte||"",receipt_path:n.receipt_path||""}),l("Modifier")):T()},[n,d]),h=s=>{D(!1),T(),C(s)},T=()=>{b(),l("Enregistrer"),c({})};o.useEffect(()=>{f()},[]),o.useEffect(()=>{_()},[n,_]);const L=async()=>{if(ne(r,c)){P(!0),l("Loading ...");try{let s;S==="Enregistrer"?{message:s}=await Z(r):{message:s}=await ee(n.id,r),h(s)}catch(s){console.error("Error submitting payment:",s)}finally{P(!1),l("Enregistrer")}}},I=s=>{d("client_id",s.id)},$=s=>{d("mode_paiement",s.id)};return e.jsxs(re,{show:w,closeable:!1,onClose:h,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:n.nom?"Modifier un Paiement":"Ajouter un Paiement"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"client_id",value:"Nom client"}),e.jsx(z,{data:N,isFocused:!0,className:"block w-full mt-1",onSelect:I,defaultValue:r.client_id,onFocus:()=>c({...i,client_id:""})}),e.jsx(j,{message:i.client_id||m.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"montant",value:"Montant ($)"}),e.jsx(q,{id:"montant",name:"montant",value:r.montant,className:"block w-full mt-1",autoComplete:"montant",onChange:s=>d("montant",s.target.value),required:!0,type:"number",onFocus:()=>c({...i,montant:""})}),e.jsx(j,{message:i.montant||m.montant,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"mode_paiement",value:"Mode paiement"}),e.jsx(z,{data:E,className:"block w-full mt-1",onSelect:$,defaultValue:r.mode_paiement,onFocus:()=>c({...i,mode_paiement:""})}),e.jsx(j,{message:i.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"periode_couverte",value:"Période couverte"}),e.jsx(q,{id:"periode_couverte",name:"periode_couverte",value:r.periode_couverte,className:"block w-full mt-1",autoComplete:"periode_couverte",onChange:s=>d("periode_couverte",s.target.value),required:!0,onFocus:()=>c({...i,periode_couverte:""})}),e.jsx(j,{message:i.periode_couverte||m.periode_couverte,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"date_paiement",value:"Date de paiement"}),e.jsx(q,{id:"date_paiement",name:"date_paiement",value:r.date_paiement,className:"block w-full mt-1",autoComplete:"date_paiement",type:"date",onChange:s=>d("date_paiement",s.target.value),required:!0,onFocus:()=>c({...i,date_paiement:""})}),e.jsx(j,{message:i.date_paiement||m.date_paiement,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>h(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${x&&"opacity-25"}`,disabled:x,onClick:L,children:S})]})]})},ze=()=>{const[w,D]=o.useState(""),[n,C]=o.useState({}),[S,l]=o.useState(1),[i,c]=o.useState(!1),[x,P]=o.useState([]),[N,k]=o.useState([]),[E,F]=o.useState(!0),[r,d]=o.useState({open:!1,message:"",id:0}),[m,b]=o.useState({open:!1,message:"",type:"success"}),[f,_]=o.useState(!1),[h,T]=o.useState(!1),[L,I]=o.useState(10),$=[{key:"id",label:"ID",sortable:!0},{key:"numero",label:"Numero",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"montant",label:"Montant (CFA)"},{key:"mode_paiement",label:"Mode de paiement"},{key:"periode_couverte",label:"Periode couverte"},{key:"date_paiement",label:"Date de paiement",sortable:!0},{key:"statut_paiement",label:"Statut",sortable:!0,customRender:(t,g)=>e.jsx("span",{className:`px-2 py-1 rounded-full flex text-nowrap cursor-pointer text-white ${t==="En attente"?"bg-yellow-500/50":t==="Payé"?"bg-green-500/50":"bg-red-500/50"}`,children:t})},{key:"observation",label:"Observation"}],s=[{label:e.jsx(de,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:t=>A.visit(`/paiement/${t.id}/view`)},{label:e.jsx(be,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>K(t)},{label:e.jsx(ue,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>W(t)}],u=()=>{A.visit("/form/paiement")},v=async()=>{try{F(!0);const{data:t}=await te(),g=t.map(a=>({id:a.id,numero:a.numero,client_id:a.client_id,nom:`${a.client.nom} ${a.client.prenom}`,montant:a.montant,mode_paiement:a.mode_paiement,periode_couverte:a.periode_couverte,date_paiement:me(a.date_echeance),statut_paiement:a.statut_paiement,observation:a.observation}));P(g),k(g)}catch(t){console.log(t)}finally{F(!1)}};o.useEffect(()=>{v()},[]);const p=t=>{D(t),l(1);const g=x.filter(a=>{var O,V,B,G,H,R;return((O=a==null?void 0:a.numero)==null?void 0:O.toLowerCase().includes(t.toLowerCase()))||((V=a==null?void 0:a.nom)==null?void 0:V.toLowerCase().includes(t.toLowerCase()))||((B=a==null?void 0:a.montant)==null?void 0:B.toString().toLowerCase().includes(t.toLowerCase()))||((G=a==null?void 0:a.periode_couverte)==null?void 0:G.toLowerCase().includes(t.toLowerCase()))||((H=a==null?void 0:a.mode_paiement)==null?void 0:H.toLowerCase().includes(t.toLowerCase()))||((R=a==null?void 0:a.date_paiement)==null?void 0:R.toString().toLowerCase().includes(t.toLowerCase()))});k(g)},M=t=>{v(),t&&b({...m,message:t,open:!0}),C({})},W=t=>{d({open:!0,message:`Êtes-vous sûr de vouloir supprimer la paiement du ${t.nom} le ${t.date_paiement} ?`,id:t.id})},J=async()=>{const{message:t}=await ae(r.id);b({...m,message:t,open:!0}),d({...r,open:!1,id:0}),v(),l(1)},K=t=>{const g=t.date_paiement?t.date_paiement:"Invalid date";C({...t,date_paiement:ce(g)}),A.visit("/form/paiement?id="+t.id)};return e.jsxs(pe,{setId:T,children:[e.jsx(U,{title:"Paiements"}),e.jsx(_e,{open:i,setOpen:c,onCloseFormulaire:M,dataModify:n}),e.jsx(le,{message:m.message,type:m.type,duration:3e3,position:"top-right",show:m.open,onClose:()=>b({...m,message:"",open:!1})}),e.jsx(X,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>d({...r,open:!1}),accept:J}),!h&&e.jsxs("span",{className:"flex items-center w-40 p-1 mb-2 border border-gray-300 rounded-md dark:border-gray-700",children:[e.jsx("div",{onClick:()=>_(!1),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${f?"bg-transparent":"bg-gray-300 dark:bg-gray-700"}`,children:"Tous"}),e.jsx("div",{onClick:()=>_(!0),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${f?"bg-gray-300 dark:bg-gray-700":"bg-transparent"}`,children:"Types"})]}),f?e.jsx(ge,{}):e.jsxs("div",{children:[e.jsx(xe,{title:`Liste des Paiements ( Total : ${x.length} )`,handleClick:u,search:w,onSearch:p}),E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsx("div",{children:N.length>0?e.jsx(Y,{headers:$,rows:N,itemsPerPage:L,actions:s,className:"mt-4",currentPage:S,onPageChange:l,masqueColumns:["client_id"],onItemsPerPageChange:t=>I(t)}):e.jsx(fe,{nom:"paiement",search:w})})]})]})};export{ze as default};
