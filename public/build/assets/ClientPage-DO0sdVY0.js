import{r as l,m as I,j as e,L as q,S as A}from"./app-BkC8VWgr.js";import{M as $}from"./Modal-BJN1yNeG.js";import{T as h,I as x}from"./TextInput-BkqmQp0b.js";import{I as v}from"./InputLabel-DJrVxPwe.js";import{c as G,u as H,b as O,d as B}from"./clientService-B8q9ajEg.js";import{a as R}from"./validateForm-B0TA_X9F.js";import{S as V,C as W,D as z,G as J}from"./index-C9BLxk6X.js";import{H as K,F as Q}from"./HeaderPage-DFPcx5HP.js";import{n as U}from"./constant-B050u7nx.js";import{A as X,T as Y}from"./AuthenticatedLayout-BevpI5nv.js";import"./transition-CGbVp9qO.js";import"./index-C9tktaFt.js";import"./useTheme-ZuXOj12l.js";const Z=({open:w=!0,setOpen:N,dataModify:r={},onCloseFormulaire:f=()=>{}})=>{const[b,p]=l.useState("Enregistrer"),[a,m]=l.useState({}),[C,d]=l.useState(!1),{data:n,setData:c,errors:i,reset:j}=I({nom:"",prenom:"",telephone:"",localisation:"",surface_cultivee:"",type_activite_agricole:""}),u=s=>{N(!1),g(),f(s)},g=()=>{j(),p("Enregistrer"),m({}),d(!1)};l.useEffect(()=>{r.id?(c({nom:r.nom||"",prenom:r.prenom||"",telephone:r.telephone||"",localisation:r.localisation||"",surface_cultivee:r.surface_cultivee||"",type_activite_agricole:r.type_activite_agricole||""}),p("Modifier")):g()},[r,c,p]);const _=async()=>{if(R(n,m)){d(!0),p("Loanding ...");try{let s;b==="Enregistrer"?{message:s}=await G(n):{message:s}=await H(r.id,n),u(s)}catch(s){console.error("Error submitting payment:",s)}finally{d(!1),p("Enregistrer")}}};return e.jsxs($,{show:w,closeable:!1,onClose:u,maxWidth:"xl",children:[e.jsx("div",{className:"text-center font-semibold text-2xl",children:r.nom?"Modifier un Client":"Ajouter un Client"}),e.jsxs("form",{className:"w-full my-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"nom",value:"Nom"}),e.jsx(h,{id:"nom",name:"nom",value:n.nom,className:"mt-1 block w-full",autoComplete:"nom",isFocused:!0,onChange:s=>c("nom",s.target.value),required:!0,onFocus:()=>m({...a,nom:""})}),e.jsx(x,{message:a.nom||i.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"prenom",value:"Prénom"}),e.jsx(h,{id:"prenom",name:"prenom",value:n.prenom,className:"mt-1 block w-full",autoComplete:"prenom",onChange:s=>c("prenom",s.target.value),required:!0,onFocus:()=>m({...a,prenom:""})}),e.jsx(x,{message:a.prenom||i.prenom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"telephone",value:"Téléphone"}),e.jsx(h,{id:"telephone",name:"telephone",value:n.telephone,className:"mt-1 block w-full",autoComplete:"telephone",onChange:s=>c("telephone",s.target.value),required:!0,onFocus:()=>m({...a,telephone:""})}),e.jsx(x,{message:a.telephone||i.telephone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"localisation",value:"Localisation"}),e.jsx(h,{id:"localisation",name:"localisation",value:n.localisation,className:"mt-1 block w-full",autoComplete:"localisation",onChange:s=>c("localisation",s.target.value),required:!0,onFocus:()=>m({...a,localisation:""})}),e.jsx(x,{message:a.localisation||i.localisation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"type_activite_agricole",value:"Type activité agricole"}),e.jsx(h,{id:"type_activite_agricole",name:"type_activite_agricole",value:n.type_activite_agricole,className:"mt-1 block w-full",autoComplete:"type_activite_agricole",onChange:s=>c("type_activite_agricole",s.target.value),required:!0,onFocus:()=>m({...a,type_activite_agricole:""})}),e.jsx(x,{message:a.type_activite_agricole||i.type_activite_agricole,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"surface_cultivee",value:"Surface cultivée (en ha)"}),e.jsx(h,{id:"surface_cultivee",name:"surface_cultivee",value:n.surface_cultivee,className:"mt-1 block w-full",autoComplete:"surface_cultivee",onChange:s=>c("surface_cultivee",s.target.value),required:!0,onFocus:()=>m({...a,surface_cultivee:""})}),e.jsx(x,{message:a.surface_cultivee||i.surface_cultivee,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"rounded-md py-1 px-4 text-red-500 bg-red-400/10",onClick:()=>u(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${C&&"opacity-25"}`,disabled:C,onClick:_,children:b})]})]})},pe=()=>{const[w,N]=l.useState(""),[r,f]=l.useState(!1),[b,p]=l.useState(1),[a,m]=l.useState([]),[C,d]=l.useState([]),[n,c]=l.useState({}),[i,j]=l.useState({open:!1,message:"",id:0}),[u,g]=l.useState({open:!1,message:"",type:"success"}),_=async()=>{const y=(await O()).clients.map(o=>({id:o.id,nom:o.nom,prenom:o.prenom,telephone:o.telephone,localisation:o.localisation,surface_cultivee:o.surface_cultivee,type_activite_agricole:o.type_activite_agricole}));m(y),d(y)};l.useEffect(()=>{_()},[]);const s=t=>{N(t),p(1);const y=a.filter(o=>o.nom.toLowerCase().includes(t.toLowerCase())||o.prenom.toLowerCase().includes(t.toLowerCase())||o.telephone.toLowerCase().includes(t.toLowerCase())||o.surface_cultivee.toLowerCase().includes(t.toLowerCase())||o.type_activite_agricole.toLowerCase().includes(t.toLowerCase())||o.localisation.toLowerCase().includes(t.toLowerCase()));d(y)},F=()=>{f(!0)},S=[{key:"id",label:"ID"},{key:"nom",label:"Nom"},{key:"prenom",label:"Prénom"},{key:"telephone",label:"Téléphone"},{key:"localisation",label:"Localisation"},{key:"surface_cultivee",label:"Surface cultivée (ha)"},{key:"type_activite_agricole",label:"Type d'activité agricole"}],L=[{label:e.jsx(Q,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:t=>P(t.id)},{label:e.jsx(Y,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>E(t)},{label:e.jsx(J,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>T(t)}],k=t=>{_(),t&&g({...u,message:t,open:!0}),c({})},E=t=>{c(t),f(!0)},T=t=>{j({open:!0,message:`Êtes-vous sûr de vouloir supprimer ${t.nom} ${t.prenom}?`,id:t.id})},D=async()=>{const{message:t}=await B(i.id);g({...u,message:t,open:!0}),j({...i,open:!1,id:0}),_(),p(1)},P=async t=>{A.visit(`/client/${t}`)};return e.jsxs(X,{children:[e.jsx(q,{title:"Clients"}),e.jsx(K,{title:"Liste des Clients",handleClick:F,onSearch:s,search:w}),e.jsx(Z,{setOpen:f,open:r,dataModify:n,onCloseFormulaire:k}),e.jsx(V,{message:u.message,type:u.type,duration:3e3,position:"top-right",show:u.open,onClose:()=>g({...u,message:"",open:!1})}),e.jsx(W,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>j({...i,open:!1}),accept:D}),e.jsx("div",{children:C.length>0?e.jsx(z,{headers:S,rows:C,itemsPerPage:10,actions:L,className:"mt-4",currentPage:b,onPageChange:p}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:U,alt:"no data",className:"max-w-md opacity-50 mt-2"})})})]})};export{pe as default};
