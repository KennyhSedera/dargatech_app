import{r as s,v as G,j as e,$ as H,m as q}from"./app-rDfK0lPv.js";import{C as R}from"./ConfirmDialog-Dh5Gy5zQ.js";import{D as M}from"./DataTable-DAw7IFL6.js";import{c as W,u as z,b as J,d as K}from"./PaiementService-BPzZqFwH.js";import{b as Q}from"./clientService-BKs_QZwN.js";import{I as y,T as A}from"./TextInput-DyfXA701.js";import{I as j}from"./InputLabel-D-FJS1kQ.js";import{g as U}from"./TypePaiementService-DCkd_ZX1.js";import{M as X}from"./Modal-ChAzlvnq.js";import{I as O}from"./InputAutocomplete -B2RXT4cj.js";import{b as Y}from"./validateForm-f9K0gDaZ.js";import{r as Z,f as ee,q as te}from"./constant-Dm8pwftn.js";import{S as ae}from"./Snackbar-BwU8_hLQ.js";import{A as se}from"./AuthenticatedLayout-BkCSnvCq.js";import{G as oe}from"./index-DSy3v0eu.js";import re from"./TypePaiement-DX2qa6g0.js";import{H as ne}from"./HeaderPage-DHHyxYQY.js";import{T as ie}from"./index-DxcbJQeI.js";import{E as me}from"./EmptyState-C6VJmEbA.js";import"./api-PtIciLz0.js";import"./createLucideIcon-CbW4KP4D.js";import"./transition-CQNLO7ua.js";import"./iconBase-kq-4DJn5.js";import"./useTheme-DGUkUsZy.js";import"./index-cPQ6tbku.js";import"./InputImage-BRT99bKg.js";const le=({open:v=!0,setOpen:D,dataModify:n={},onCloseFormulaire:w=()=>{}})=>{const[C,c]=s.useState("Enregistrer"),[i,d]=s.useState({}),[g,S]=s.useState(!1),[N,P]=s.useState([]),[F,k]=s.useState([]),{data:r,setData:l,errors:m,reset:b}=G({client_id:"",montant:"",date_paiement:new Date().toISOString().split("T")[0],mode_paiement:"",periode_couverte:"",receipt_path:""}),f=async()=>{var a;try{const[{clients:u},$]=await Promise.all([Q(),U()]);P(u==null?void 0:u.map(p=>({id:p.id,nom:`${p.nom} ${p.prenom}`}))),k((a=$.type)==null?void 0:a.map(p=>({id:p.id,nom:p.name})))}catch(u){console.error("Error fetching clients or payment types:",u)}},_=s.useCallback(()=>{n.id?(l({client_id:n.client_id||"",montant:n.montant||"",date_paiement:Z(n.date_paiement)||new Date().toISOString().split("T")[0],mode_paiement:parseInt(n.mode_paiement)||"",periode_couverte:n.periode_couverte||"",receipt_path:n.receipt_path||""}),c("Modifier")):T()},[n,l]),h=a=>{D(!1),T(),w(a)},T=()=>{b(),c("Enregistrer"),d({})};s.useEffect(()=>{f()},[]),s.useEffect(()=>{_()},[n,_]);const L=async()=>{if(Y(r,d)){S(!0),c("Loading ...");try{let a;C==="Enregistrer"?{message:a}=await W(r):{message:a}=await z(n.id,r),h(a)}catch(a){console.error("Error submitting payment:",a)}finally{S(!1),c("Enregistrer")}}},E=a=>{l("client_id",a.id)},I=a=>{l("mode_paiement",a.id)};return e.jsxs(X,{show:v,closeable:!1,onClose:h,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:n.nom?"Modifier un Paiement":"Ajouter un Paiement"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"client_id",value:"Nom client"}),e.jsx(O,{data:N,isFocused:!0,className:"block w-full mt-1",onSelect:E,defaultValue:r.client_id,onFocus:()=>d({...i,client_id:""})}),e.jsx(y,{message:i.client_id||m.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"montant",value:"Montant ($)"}),e.jsx(A,{id:"montant",name:"montant",value:r.montant,className:"block w-full mt-1",autoComplete:"montant",onChange:a=>l("montant",a.target.value),required:!0,type:"number",onFocus:()=>d({...i,montant:""})}),e.jsx(y,{message:i.montant||m.montant,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"mode_paiement",value:"Mode paiement"}),e.jsx(O,{data:F,className:"block w-full mt-1",onSelect:I,defaultValue:r.mode_paiement,onFocus:()=>d({...i,mode_paiement:""})}),e.jsx(y,{message:i.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"periode_couverte",value:"Période couverte"}),e.jsx(A,{id:"periode_couverte",name:"periode_couverte",value:r.periode_couverte,className:"block w-full mt-1",autoComplete:"periode_couverte",onChange:a=>l("periode_couverte",a.target.value),required:!0,onFocus:()=>d({...i,periode_couverte:""})}),e.jsx(y,{message:i.periode_couverte||m.periode_couverte,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"date_paiement",value:"Date de paiement"}),e.jsx(A,{id:"date_paiement",name:"date_paiement",value:r.date_paiement,className:"block w-full mt-1",autoComplete:"date_paiement",type:"date",onChange:a=>l("date_paiement",a.target.value),required:!0,onFocus:()=>d({...i,date_paiement:""})}),e.jsx(y,{message:i.date_paiement||m.date_paiement,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>h(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${g&&"opacity-25"}`,disabled:g,onClick:L,children:C})]})]})},Ae=()=>{const[v,D]=s.useState(""),[n,w]=s.useState({}),[C,c]=s.useState(1),[i,d]=s.useState(!1),[g,S]=s.useState([]),[N,P]=s.useState([]),[F,k]=s.useState(!0),[r,l]=s.useState({open:!1,message:"",id:0}),[m,b]=s.useState({open:!1,message:"",type:"success"}),[f,_]=s.useState(!1),[h,T]=s.useState(!1),L=[{key:"id",label:"ID",sortable:!0},{key:"numero",label:"Numero",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"montant",label:"Montant ($)"},{key:"mode_paiement",label:"Mode de paiement"},{key:"periode_couverte",label:"Periode couverte"},{key:"date_paiement",label:"Date de paiement",sortable:!0},{key:"statut_paiement",label:"Statut",sortable:!0,customRender:(t,x)=>e.jsx("span",{className:`px-2 py-1 rounded-full flex text-nowrap cursor-pointer text-white ${t==="En attente"?"bg-yellow-500/50":t==="Payé"?"bg-green-500/50":"bg-red-500/50"}`,children:t})},{key:"observation",label:"Observation"}],E=[{label:e.jsx(ie,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>B(t)},{label:e.jsx(oe,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>p(t)}],I=()=>{q.visit("/form/paiement")},a=async()=>{try{k(!0);const{data:t}=await J(),x=t.map(o=>({id:o.id,numero:o.numero,client_id:o.client_id,nom:`${o.client.nom} ${o.client.prenom}`,montant:o.montant,mode_paiement:o.mode_paiement,periode_couverte:o.periode_couverte,date_paiement:ee(o.date_paiement),statut_paiement:o.statut_paiement,observation:o.observation}));S(x),P(x)}catch(t){console.log(t)}finally{k(!1)}};s.useEffect(()=>{a()},[]);const u=t=>{D(t),c(1);const x=g.filter(o=>o.nom.toLowerCase().includes(t.toLowerCase())||o.montant.toLowerCase().includes(t.toLowerCase())||o.type_paiement.toLowerCase().includes(t.toLowerCase())||o.periode_couverte.toLowerCase().includes(t.toLowerCase())||o.mode_paiement.toLowerCase().includes(t.toLowerCase())||o.date_paiement.toString().toLowerCase().includes(t.toLowerCase()));P(x)},$=t=>{a(),t&&b({...m,message:t,open:!0}),w({})},p=t=>{l({open:!0,message:`Êtes-vous sûr de vouloir supprimer la paiement du ${t.nom} le ${t.date_paiement} ?`,id:t.id})},V=async()=>{const{message:t}=await K(r.id);b({...m,message:t,open:!0}),l({...r,open:!1,id:0}),a(),c(1)},B=t=>{const x=t.date_paiement?t.date_paiement:"Invalid date";w({...t,date_paiement:te(x)}),q.visit("/form/paiement?id="+t.id)};return e.jsxs(se,{setId:T,children:[e.jsx(H,{title:"Paiements"}),e.jsx(le,{open:i,setOpen:d,onCloseFormulaire:$,dataModify:n}),e.jsx(ae,{message:m.message,type:m.type,duration:3e3,position:"top-right",show:m.open,onClose:()=>b({...m,message:"",open:!1})}),e.jsx(R,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>l({...r,open:!1}),accept:V}),!h&&e.jsxs("span",{className:"flex items-center w-40 p-1 mb-2 border border-gray-300 rounded-md dark:border-gray-700",children:[e.jsx("div",{onClick:()=>_(!1),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${f?"bg-transparent":"bg-gray-300 dark:bg-gray-700"}`,children:"Tous"}),e.jsx("div",{onClick:()=>_(!0),className:`w-1/2 cursor-pointer text-center py-1 rounded-md text-sm transition-colors duration-300 ${f?"bg-gray-300 dark:bg-gray-700":"bg-transparent"}`,children:"Types"})]}),f?e.jsx(re,{}):e.jsxs("div",{children:[e.jsx(ne,{title:`Liste des Paiements ( Total : ${g.length} )`,handleClick:I,search:v,onSearch:u}),F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsx("div",{children:N.length>0?e.jsx(M,{headers:L,rows:N,itemsPerPage:9,actions:E,className:"mt-4",currentPage:C,onPageChange:c,masqueColumns:["client_id"]}):e.jsx(me,{nom:"paiement",search:v})})]})]})};export{Ae as default};
