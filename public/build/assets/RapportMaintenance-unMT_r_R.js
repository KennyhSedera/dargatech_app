import{r as n,j as e,$ as q,e as z}from"./app-Cztrmo4N.js";import{u as M}from"./useTheme-BBDTX5QG.js";import{h as W}from"./html2pdf-CYXy2Q52.js";import{S as m,T as J,P as K,K as X,U as h,V as b,W as j,X as f,d as g,Y as _,Z as Y}from"./constant-BaSFQpqT.js";import{D as Z}from"./DangerButton-BnX3oE44.js";import G from"./RapportPdf-yux5a62m.js";import"./iconBase-tJIX2eue.js";import"./fr-Br33CVeN.js";const de=({intervention_id:x})=>{var y,D,R,F,S,C,P,T,I;const{theme:u,setTheme:L}=M(),[s,E]=n.useState(null),[A,B]=n.useState(!0),[N,O]=n.useState(null),[U,v]=n.useState(!0),[d,V]=n.useState("information"),[t,H]=n.useState(!1),[p,o]=n.useState(!1),w=n.useRef(null);n.useEffect(()=>{L(u||"light")},[u]),n.useEffect(()=>{const l=async()=>{var i,r;try{v(!0);const c=await z.get(`/api/rapport/maintenance/${x}`);E(c.data)}catch(c){O(((r=(i=c.response)==null?void 0:i.data)==null?void 0:r.message)||"Une erreur est survenue")}finally{B(!1),v(!1)}};console.log(s),x&&l()},[x]);const k=l=>l?new Date(l).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):"Non spécifié",$=()=>{var r,c;const l=w.current;if(!l)return;const i={margin:.5,filename:`rapport-maintenance-${(s==null?void 0:s.id)+"-du-"+((r=s==null?void 0:s.client)==null?void 0:r.nom)+"-"+((c=s==null?void 0:s.client)==null?void 0:c.prenom)||"undefined"}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};W().from(l).set(i).save()};if(A)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-900",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 rounded-full border-t-transparent animate-spin"}),e.jsx("h2",{className:"text-lg font-medium text-slate-600 dark:text-slate-300",children:"Chargement du rapport..."})]})});if(N)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-900",children:e.jsx("div",{className:"max-w-md p-8 bg-white shadow-xl dark:bg-slate-800 rounded-xl",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 mb-6 bg-red-100 rounded-full dark:bg-red-900/30",children:e.jsx(m,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h2",{className:"mb-3 text-xl font-semibold text-slate-800 dark:text-slate-200",children:"Erreur"}),e.jsx("p",{className:"mb-6 text-center text-slate-600 dark:text-slate-400",children:N}),e.jsx(Z,{onClick:()=>window.history.back(),className:"px-5 py-2.5 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors shadow-sm",children:"Retour"})]})})});const a=({id:l,label:i,icon:r})=>e.jsxs("button",{onClick:()=>{V(l),o(!1)},className:`w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ${d===l?"bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 border-l-4 border-teal-500":"text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/40"}`,children:[e.jsx("span",{className:"mr-3",children:r}),e.jsx("span",{className:"font-medium",children:i})]});return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200",children:[e.jsx(q,{title:"Rapport de maintenance - Dargatech"}),U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed top-0 left-0 right-0 z-30 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 ${t?"print-header":""}`,children:e.jsx("div",{className:"px-4 mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsxs("div",{className:`py-4 flex flex-col md:flex-row md:items-center md:justify-between ${t?"print-header":""}`,children:[e.jsxs("div",{className:"flex items-center mb-4 md:mb-0",children:[e.jsx("button",{onClick:()=>o(!p),className:"p-2 mr-4 transition-shadow bg-white rounded-full shadow-sm dark:bg-slate-800 hover:shadow-md md:hidden",children:e.jsx(J,{className:"w-5 h-5 text-slate-600 dark:text-slate-300"})}),e.jsx("button",{onClick:()=>window.history.back(),className:"p-2 mr-4 transition-shadow bg-white rounded-full shadow-sm dark:bg-slate-800 hover:shadow-md no-print",children:e.jsx(K,{className:"w-5 h-5 text-slate-600 dark:text-slate-300"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex items-center justify-center mr-3 rounded-full h-14 w-14",children:e.jsx("img",{src:X,alt:"logo",className:`w-16 ${t?"print-logo":""}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${t?"print-title":""}`,children:"Dargatech"}),e.jsx("p",{className:`text-sm text-slate-500 dark:text-slate-400 ${t?"print-subtitle":""}`,children:"Solutions solaires durables"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Maintenance #",s==null?void 0:s.maintenanceId]}),e.jsxs("div",{className:"mt-1 text-lg font-semibold",children:["Rapport d'intervention #",s==null?void 0:s.id]}),e.jsx("div",{className:"mt-1 text-sm text-slate-500 dark:text-slate-400",children:k(s==null?void 0:s.date_intervention)})]})]})})}),e.jsxs("div",{className:"flex flex-1 pt-24 md:pt-32",children:[e.jsxs("div",{className:"hidden md:flex md:flex-col md:w-64 md:fixed md:left-0 md:top-24 md:bottom-0 md:bg-white md:dark:bg-slate-800 md:border-r md:border-slate-200 md:dark:border-slate-700 no-print",children:[e.jsx("div",{className:"flex-1 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{id:"information",label:"Information client",icon:e.jsx(h,{className:"w-4 h-4"})}),e.jsx(a,{id:"probleme",label:"Problème",icon:e.jsx(m,{className:"w-4 h-4"})}),e.jsx(a,{id:"diagnostic",label:"Diagnostic",icon:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(a,{id:"intervention",label:"Intervention",icon:e.jsx(j,{className:"w-4 h-4"})}),e.jsx(a,{id:"verification",label:"Vérification",icon:e.jsx(f,{className:"w-4 h-4"})}),e.jsx(a,{id:"recommandation",label:"Recommandations",icon:e.jsx(g,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("button",{onClick:$,className:"flex items-center justify-center w-full px-4 py-3 space-x-2 text-white transition-colors bg-teal-600 rounded-lg shadow-sm hover:bg-teal-700",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"Télécharger en PDF"})]})})]}),p&&e.jsxs("div",{className:"fixed inset-0 z-40 md:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-50",onClick:()=>o(!1)}),e.jsxs("div",{className:"relative flex flex-col h-full bg-white shadow-xl w-80 dark:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Navigation"}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{id:"information",label:"Information client",icon:e.jsx(h,{className:"w-4 h-4"})}),e.jsx(a,{id:"probleme",label:"Problème",icon:e.jsx(m,{className:"w-4 h-4"})}),e.jsx(a,{id:"diagnostic",label:"Diagnostic",icon:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(a,{id:"intervention",label:"Intervention",icon:e.jsx(j,{className:"w-4 h-4"})}),e.jsx(a,{id:"verification",label:"Vérification",icon:e.jsx(f,{className:"w-4 h-4"})}),e.jsx(a,{id:"recommandation",label:"Recommandations",icon:e.jsx(g,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:e.jsxs("button",{onClick:$,className:"flex items-center justify-center w-full px-4 py-3 space-x-2 text-white transition-colors bg-teal-600 rounded-lg shadow-sm hover:bg-teal-700",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"Télécharger en PDF"})]})})]})]}),e.jsx("div",{className:`flex-1 md:ml-64 ${t?"print-content":""}`,children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-xl shadow-xl overflow-hidden ${t?"print-content":""}`,children:[d==="information"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(h,{className:"w-5 h-5 mr-3 text-teal-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Information du client"})]}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-6 ${t?"print-grid":""}`,children:[e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Nom complet"}),e.jsxs("div",{className:`font-medium ${t?"print-card-content":""}`,children:[(y=s==null?void 0:s.client)==null?void 0:y.nom," ",(D=s==null?void 0:s.client)==null?void 0:D.prenom]})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Téléphone"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:(R=s==null?void 0:s.client)==null?void 0:R.telephone})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Localisation"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:(F=s==null?void 0:s.client)==null?void 0:F.localisation})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Email"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:((S=s==null?void 0:s.client)==null?void 0:S.email)||"Non spécifié"})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Technicien"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:s!=null&&s.technicien?`${s.technicien.user.name}`:"Non assigné"})]}),e.jsxs("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:[e.jsx("div",{className:`text-sm text-slate-500 dark:text-slate-400 mb-1 ${t?"print-card-title":""}`,children:"Date de l'intervention"}),e.jsx("div",{className:`font-medium ${t?"print-card-content":""}`,children:k(s==null?void 0:s.date_intervention)})]})]})]}),d==="probleme"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(m,{className:"w-5 h-5 mr-3 text-red-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Description de la panne"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Problèmes rapportés"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-teal-500 ${t?"print-card":""}`,children:(s==null?void 0:s.description_panne)||"Non spécifié"})]}),((C=s==null?void 0:s.photo_probleme)==null?void 0:C.length)>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Documentation visuelle"}),e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 justify-center bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 ${t?"print-card":""}`,children:JSON.parse(s==null?void 0:s.photo_probleme).map((l,i)=>e.jsx("img",{src:`/${l}`,alt:`Photo du problème ${i+1}`,className:"object-cover w-full h-auto rounded-lg shadow-md md:h-52"},i))})]})]})]}),d==="diagnostic"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(b,{className:"w-5 h-5 mr-3 text-amber-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Diagnostic & Cause"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Diagnostic initial"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-amber-500 ${t?"print-card":""}`,children:(s==null?void 0:s.diagnostic_initial)||"Non documenté"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Cause identifiée"}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-orange-500 ${t?"print-card":""}`,children:(s==null?void 0:s.cause_identifiee)||"Non identifiée"})]})]})]}),d==="intervention"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(j,{className:"w-5 h-5 mr-3 text-green-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Interventions réalisées"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"px-3 py-1 text-xs font-semibold text-green-800 uppercase bg-green-100 rounded-full dark:bg-green-900/30 dark:text-green-300",children:((P=s==null?void 0:s.maintenance)==null?void 0:P.type_intervention)||"Non spécifié"})}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-green-500 ${t?"print-card":""}`,children:(s==null?void 0:s.intervention_realisee)||"Aucune intervention documentée"})]}),d==="verification"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(f,{className:"w-5 h-5 mr-3 text-indigo-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Test post réparation"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`text-xs font-semibold px-3 py-1 rounded-full uppercase ${((T=s==null?void 0:s.maintenance)==null?void 0:T.status_intervention)==="terminée"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300"}`,children:((I=s==null?void 0:s.maintenance)==null?void 0:I.status_intervention)||"Non spécifié"})}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-indigo-500 ${t?"print-card":""}`,children:(s==null?void 0:s.verification_fonctionnement)||"Non documenté"})]}),d==="recommandation"&&e.jsxs("div",{className:`p-6 ${t?"print-section":""}`,children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(g,{className:"w-5 h-5 mr-3 text-purple-500"}),e.jsx("h2",{className:`text-xl font-bold ${t?"print-section-title":""}`,children:"Recommandations au client"})]}),e.jsx("div",{className:`bg-slate-50 dark:bg-slate-700/40 rounded-lg p-4 border-l-4 border-purple-500 ${t?"print-card":""}`,children:(s==null?void 0:s.recommandation_client)||"Aucune recommandation spécifique"})]})]}),e.jsxs("div",{className:`mt-8 pt-4 border-t border-slate-200 dark:border-slate-700 text-sm text-slate-500 dark:text-slate-400 flex justify-between items-center ${t?"print-footer":""}`,children:[e.jsxs("div",{children:["Rapport généré le"," ",new Date().toLocaleDateString("fr-FR")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Dargatech Solutions Solaires"}),e.jsx("div",{className:"w-1 h-1 mx-2 rounded-full bg-slate-400"}),e.jsxs("span",{children:["Rapport #ID: ",s==null?void 0:s.id]}),t&&e.jsxs("span",{className:"ml-4",children:["Page"," ",e.jsx("span",{className:"print-page-number"})]})]})]})]})})})]})]}),e.jsx("div",{className:"hidden",children:e.jsx(G,{data:s,ref:w})})]})};export{de as default};
