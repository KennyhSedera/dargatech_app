import{r as m,m as A,j as e,L as V}from"./app-BQyrTZVC.js";import{C as $}from"./ConfirmDialog-DABb_ZE0.js";import{D as H}from"./DataTable-09FudaGH.js";import{H as O}from"./HeaderPage-Durkh_Rg.js";import{M as B}from"./Modal-DxdL0X4M.js";import{I as c,T as p}from"./TextInput-Dh7SaJi6.js";import{I as d}from"./InputLabel-BY7gZKOc.js";import{b as K}from"./validateForm-CYV7VTEV.js";import{g as q,c as R,u as W,d as G}from"./installationService-DDVH86hQ.js";import{I as z}from"./InputAutocomplete -CGVkUfiZ.js";import{b as J}from"./clientService-Cx62_ePI.js";import{p as Q,q as U,f as X,r as Y}from"./constant-NEMinriC.js";import{S as Z}from"./SelectInput-BkxtSpZk.js";import{S as M}from"./Snackbar-BVCqO3m-.js";import{A as ee}from"./AuthenticatedLayout-BoTMMhs6.js";import{G as te}from"./index-Cf9I7c0O.js";import{T as ae}from"./index-RbQYcc4a.js";import{E as se}from"./EmptyState-B9HpWti9.js";import"./index-Bva61L1C.js";import"./iconBase-C8Uyol4w.js";import"./transition-DyKxjau6.js";import"./index-D2NUHNAS.js";import"./api-DNr_UqCX.js";import"./useTheme-CPOaTzb7.js";const oe=({open:S=!0,setOpen:E,dataModify:o={},onCloseFormulaire:N=()=>{}})=>{const[w,h]=m.useState("Enregistrer"),[y,f]=m.useState(!1),[s,u]=m.useState({}),[F,I]=m.useState([]),{data:i,setData:l,errors:n,reset:k}=A({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"",source_eau:"Puits",hmt:"",latitude:"",longitude:"",pays:"Togo",ville:"Kara",statuts:"installée"}),_=async()=>{const[{clients:t},j]=await Promise.all([J(),q()]),v=t.map(x=>({id:x.id,nom:x.nom+" "+x.prenom})),C=j.data.reduce((x,a)=>{const g=parseInt(a.code_installation.replace(/\D/g,""),10);return g>x?g:x},0),L=`${U("I"+String(C).padStart(4,"0"))}`;I(v),o.id||l("code_installation",L)},b=t=>{E(!1),D(),N(t)},D=()=>{l({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",numero_serie:"",code_installation:"I0001",source_eau:"Puits",hmt:"",latitude:"",longitude:"",pays:"Togo",ville:"Kara"}),f(!1),h("Enregistrer"),u({})};m.useEffect(()=>{var t,j,v,C;_(),o.id?(l({client_id:o.client_id||0,date_installation:Q(o.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:o.puissance_pompe||"",profondeur_forage:o.profondeur_forage||"",debit_nominal:o.debit_nominal||"",numero_serie:o.numero_serie||"",code_installation:o.code_installation||"",source_eau:o.source_eau||"",hmt:o.hmt||"",latitude:((t=o.localisation)==null?void 0:t.latitude)||"",longitude:((j=o.localisation)==null?void 0:j.longitude)||"",ville:((v=o.localisation)==null?void 0:v.ville)||"Kara",pays:((C=o.localisation)==null?void 0:C.pays)||"Togo"}),h("Modifier")):D()},[o,l]);const P=async()=>{if(!(w==="Enregistrer"&&!K(i,u))){f(!0),h("Chargement...");try{let t;w==="Enregistrer"?{message:t}=await R(i):{message:t}=await W(o.id,i),b(t)}catch(t){console.error("Error submitting installation:",t),t.response&&t.response.data&&(console.log("Validation errors:",t.response.data.errors),u(t.response.data.errors||{}))}finally{f(!1),h(o.id?"Modifier":"Enregistrer")}}},T=t=>{l("client_id",t.id)};return e.jsxs(B,{show:S,closeable:!1,onClose:b,maxWidth:"4xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"client_id",value:"Nom client"}),e.jsx(z,{data:F,className:"block w-full mt-1",onSelect:T,defaultValue:i.client_id??0,onFocus:()=>u({...s,client_id:""})}),e.jsx(c,{message:s.client_id||n.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"numero_serie",value:"Numéro de série de la pompe"}),e.jsx(p,{id:"numero_serie",name:"numero_serie",value:i.numero_serie,className:"block w-full mt-1",autoComplete:"numero_serie",onChange:t=>l("numero_serie",t.target.value),required:!0,onFocus:()=>u({...s,numero_serie:""})}),e.jsx(c,{message:s.numero_serie||n.numero_serie,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"source_eau",value:"Source d'eau"}),e.jsxs(Z,{id:"source_eau",type:"source_eau",name:"source_eau",value:i.source_eau,className:"block w-full mt-1",autoComplete:"source_eau",onChange:t=>l("source_eau",t.target.value),required:!0,children:[e.jsx("option",{value:"Puits",children:"Puits"}),e.jsx("option",{value:"Forage",children:"Forage"}),e.jsx("option",{value:"Etang",children:"Etang"}),e.jsx("option",{value:"Barrage",children:"Barrage"}),e.jsx("option",{value:"Puits",children:"Rivière"})]}),e.jsx(c,{message:s.source_eau||n.source_eau,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hmt",value:"HMT (m)"}),e.jsx(p,{id:"hmt",name:"hmt",value:i.hmt,className:"block w-full mt-1",autoComplete:"hmt",onChange:t=>l("hmt",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,hmt:""})}),e.jsx(c,{message:s.hmt||n.hmt,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"profondeur_forage",value:"Distance maximale pompe champ PV (m)"}),e.jsx(p,{id:"profondeur_forage",name:"profondeur_forage",value:i.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:t=>l("profondeur_forage",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,profondeur_forage:""})}),e.jsx(c,{message:s.profondeur_forage||n.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(p,{id:"debit_nominal",name:"debit_nominal",value:i.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:t=>l("debit_nominal",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,debit_nominal:""})}),e.jsx(c,{message:s.debit_nominal||n.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"puissance_pompe",value:"Puissance crête installé (W)"}),e.jsx(p,{id:"puissance_pompe",name:"puissance_pompe",value:i.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:t=>l("puissance_pompe",t.target.value),required:!0,type:"number",onFocus:()=>u({...s,puissance_pompe:""})}),e.jsx(c,{message:s.puissance_pompe||n.puissance_pompe,className:"mt-2"})]}),o.id?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"pays",value:"Pays"}),e.jsx(p,{id:"pays",name:"pays",value:i.pays,className:"mt-1 block w-full",autoComplete:"pays",onChange:t=>l("pays",t.target.value),required:!0,onFocus:()=>u({...s,pays:""})}),e.jsx(c,{message:s.pays||n.pays,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"ville",value:"Ville"}),e.jsx(p,{id:"ville",name:"ville",value:i.ville,className:"mt-1 block w-full",autoComplete:"ville",onChange:t=>l("ville",t.target.value),required:!0,onFocus:()=>u({...s,ville:""})}),e.jsx(c,{message:s.ville||n.ville,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"latitude",value:"Latitude"}),e.jsx(p,{id:"latitude",name:"latitude",value:i.latitude,className:"mt-1 block w-full",autoComplete:"latitude",type:"number",min:"0",onChange:t=>l("latitude",t.target.value),onFocus:()=>u({...s,latitude:""})}),e.jsx(c,{message:s.latitude||n.latitude,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"longitude",value:"Longitude"}),e.jsx(p,{id:"longitude",name:"longitude",value:i.longitude,className:"mt-1 block w-full",autoComplete:"longitude",type:"number",min:"0",onChange:t=>l("longitude",t.target.value),onFocus:()=>u({...s,longitude:""})}),e.jsx(c,{message:s.longitude||n.longitude,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"date_installation",value:"Date de l'installation"}),e.jsx(p,{id:"date_installation",name:"date_installation",value:i.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:t=>l("date_installation",t.target.value),required:!0,onFocus:()=>u({...s,date_installation:""})}),e.jsx(c,{message:s.date_installation||n.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>b(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${y&&"opacity-25"}`,disabled:y,onClick:P,children:w})]})]})},ke=()=>{const[S,E]=m.useState(""),[o,N]=m.useState(!1),[w,h]=m.useState({}),[y,f]=m.useState(1),[s,u]=m.useState([]),[F,I]=m.useState([]),[i,l]=m.useState(!0),[n,k]=m.useState({open:!1,message:"",id:0}),[_,b]=m.useState({open:!1,message:"",type:"success"}),D=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"numero_serie",label:"Numéro de série de la pompe"},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation"},{key:"statuts",label:"Statuts",customRender:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${a==="installée"?"bg-green-500/50":a==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:a})}],P=[{label:e.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:a=>x(a)},{label:e.jsx(te,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:a=>C(a)}],T=()=>{N(!0)},t=async()=>{l(!0);const{data:a}=await q(),g=a.map(r=>({id:r.id,code_installation:r.code_installation,client_id:r.client_id,nom:r.client.nom+" "+r.client.prenom,puissance_pompe:r.puissance_pompe,profondeur_forage:r.profondeur_forage,debit_nominal:r.debit_nominal,numero_serie:r.numero_serie,source_eau:r.source_eau,hmt:r.hmt,date_installation:X(r.date_installation),statuts:r.statuts}));u(g),I(g),l(!1)};m.useEffect(()=>{t()},[]);const j=a=>{E(a),f(1);const g=s.filter(r=>r.nom.toLowerCase().includes(a.toLowerCase())||r.statuts.toLowerCase().includes(a.toLowerCase())||r.date_installation.toString().toLowerCase().includes(a.toLowerCase()));I(g)},v=a=>{t(),a&&b({..._,message:a,open:!0}),h({})},C=a=>{k({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${a.code_installation} du ${a.nom} le ${a.date_installation} ?`,id:a.id})},L=async()=>{const{message:a}=await G(n.id);b({..._,message:a,open:!0}),k({...n,open:!1,id:0}),t(),f(1)},x=a=>{const g=a.date_installation?a.date_installation:"Invalid date";h({...a,date_installation:Y(g)}),N(!0)};return e.jsxs(ee,{children:[e.jsx(V,{title:"Installations"}),e.jsx(O,{title:"Liste des Installations",handleClick:T,onSearch:j,search:S}),e.jsx(oe,{open:o,setOpen:N,onCloseFormulaire:v,dataModify:w}),e.jsx(M,{message:_.message,type:_.type,duration:3e3,position:"top-right",show:_.open,onClose:()=>b({..._,message:"",open:!1})}),e.jsx($,{open:n.open,message:n.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>k({...n,open:!1}),accept:L}),i?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{children:F.length>0?e.jsx(H,{headers:D,rows:F,itemsPerPage:10,actions:P,className:"mt-4",currentPage:y,onPageChange:f,masqueColumns:["client_id"]}):e.jsx(se,{nom:"installation",search:S})})]})};export{ke as default};
