import{r as a,q as Q,j as n,$ as U,m as D}from"./app-DQEW2JI7.js";import{C as X}from"./index-C5NXqM-O.js";import{D as Y}from"./DataTable-BiUch7KH.js";import{E as Z}from"./EmptyState-B40zLHSq.js";import{H as ee}from"./HeaderPage-CCknKGy_.js";import{F as te}from"./FormulaireMaintenance-Bs2RXoLg.js";import{F as ne}from"./FormulaireRapportMaintenance-Cf-tuHa9.js";import{S as ae}from"./Snackbar-BlyweEdY.js";import{f as oe,r as se}from"./constant-Dj-w38li.js";import{A as re,R as ie}from"./AuthenticatedLayout-BHVSw6Ya.js";import{g as le,d as de}from"./maintenanceService-xGOpkUIf.js";import{G as pe}from"./index-C1UZ5-VU.js";import{T as me,a as ce}from"./index-6_DnDddZ.js";import"./Modal-DqrrOfEt.js";import"./transition-Yp8aShTj.js";import"./iconBase-qX__T5RX.js";import"./TextInput-KL61RiXX.js";import"./createLucideIcon-CN1kuLlK.js";import"./InputLabel-BXLlQAHm.js";import"./installationService-Cn8b7jyo.js";import"./api-BUDAeA6W.js";import"./InputAutocomplete -D6-9QHhq.js";import"./SelectInput-DwRsSlMo.js";import"./validateForm-DkOh89YH.js";import"./TextArea-wZCMI-yu.js";import"./InputImage--00eyjIH.js";import"./useTheme-RehbxCAz.js";const qe=()=>{const[f,k]=a.useState(""),[N,R]=a.useState(0),[L,u]=a.useState(!1),[P,h]=a.useState(!1),[T,g]=a.useState({}),[F,_]=a.useState({}),[I,x]=a.useState(1),[v,M]=a.useState([]),[y,C]=a.useState([]),[$,j]=a.useState(!0),[r,b]=a.useState({open:!1,message:"",id:0}),[s,m]=a.useState({open:!1,message:"",type:"success"}),i=Q().props.auth.user,[E,A]=a.useState(10),O=[{key:"id",label:"ID",sortable:!0},{key:"code_installation",label:"Installation",sortable:!0},{key:"nom",label:"Client",sortable:!0},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème",customRender:e=>n.jsxs("div",{className:"relative max-w-md group",children:[n.jsx("span",{className:"line-clamp-2",children:e}),n.jsx("div",{className:"absolute bottom-0 left-0 z-50 hidden max-w-md p-2 mt-2 text-sm text-gray-800 bg-white border border-gray-300 rounded shadow-md group-hover:block",children:e})]})},{key:"date_intervention",label:"Date d'intervenir",sortable:!0},{key:"status_intervention",label:"Statuts",customRender:e=>n.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap ${e==="terminée"?"bg-green-500/50":e==="en attente"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"status_intervention",label:"Rapport",sortable:!0,customRender:(e,o)=>{var t,l,d;return n.jsx("span",{onClick:()=>{var p;return e==="terminée"?D.visit("/rapport",{data:{intervention_id:o.id}}):((p=i.user_role)==null?void 0:p.name)==="partenaire"?null:H(o)},className:`px-2 py-1 rounded-full flex text-nowrap ${((t=i.user_role)==null?void 0:t.name)==="partenaire"&&e!=="terminée"?"cursor-default":"cursor-pointer"} ${e==="terminée"?"text-green-500":((l=i.user_role)==null?void 0:l.name)==="partenaire"?"text-gray-300":"text-blue-500"}`,children:e==="terminée"?"Consulter":((d=i.user_role)==null?void 0:d.name)==="partenaire"?"En attente":"Ajouter"})}},{key:"created_via",label:"Via",customRender:e=>n.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?n.jsx(ce,{}):n.jsx(ie,{className:"text-blue-400"})})}],q=[{label:n.jsx(me,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>K(e)},{label:n.jsx(pe,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>W(e)}],G=()=>{u(!0)},H=e=>{var o;((o=i.user_role)==null?void 0:o.name)==="partenaire"?D.visit("/rapport",{data:{intervention_id:e.id}}):(h(!0),_(e))},c=async()=>{j(!0);const{data:e}=await le(),o=e.map(t=>({id:t.id,installation_id:t.installation_id,code_installation:t.installation.code_installation,nom:t.installation.client.nom+" "+t.installation.client.prenom,idclient:t.installation.client.id,type_intervention:t.type_intervention,description_probleme:t.description_probleme,status_intervention:t.status_intervention,date_intervention:oe(t.date_intervention),created_via:t.created_via}));M(o),C(o),j(!1)};a.useEffect(()=>{c()},[]);const z=e=>{k(e),x(1);const o=v.filter(t=>{var l,d,p,w,S;return((l=t==null?void 0:t.nom)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((d=t==null?void 0:t.type_intervention)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((p=t==null?void 0:t.description_probleme)==null?void 0:p.toLowerCase().includes(e.toLowerCase()))||((w=t==null?void 0:t.date_intervention)==null?void 0:w.toString().toLowerCase().includes(e.toLowerCase()))||((S=t==null?void 0:t.code_installation)==null?void 0:S.toLowerCase().includes(e.toLowerCase()))});C(o)},B=e=>{c(),e&&m({...s,message:e,open:!0}),g({})},V=e=>{c(),e&&m({...s,message:e,open:!0}),_({})},W=e=>{b({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${e.nom} le ${e.date_intervention} ?`,id:e.id})},J=async()=>{const{message:e}=await de(r.id);m({...s,message:e,open:!0}),b({...r,open:!1,id:0}),c(),x(1)},K=e=>{const o=e.date_intervention?e.date_intervention:"Invalid date";g({...e,date_intervention:se(o)}),u(!0)};return n.jsxs(re,{setId:R,children:[n.jsx(U,{title:"Maintenance"}),n.jsx(ee,{search:f,onSearch:z,title:`Liste des interventions ( Total: ${v.length} )`,handleClick:G}),n.jsx(ae,{message:s.message,type:s.type,duration:3e3,position:"top-right",show:s.open,onClose:()=>m({...s,message:"",open:!1})}),n.jsx(X,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>b({...r,open:!1}),accept:J}),n.jsx(te,{open:L,setOpen:u,dataModify:T,onCloseFormulaire:B,idTechnicien:N}),n.jsx(ne,{open:P,setOpen:h,dataModify:F,onCloseFormulaire:V}),$?n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):n.jsx("div",{children:y.length>0?n.jsx(Y,{headers:O,rows:y,itemsPerPage:E,actions:q,className:"mt-4",currentPage:I,onPageChange:x,masqueColumns:["client_id"],onItemsPerPageChange:e=>A(e)}):n.jsx(Z,{nom:"intervention",search:f})})]})};export{qe as default};
