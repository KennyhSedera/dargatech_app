import{r as n,m as A,j as e,L as $}from"./app-BDvQqi8O.js";import{C as O}from"./ConfirmDialog-KzKBN7n8.js";import{D as W,G}from"./index-DMRp7dzX.js";import{H}from"./HeaderPage-w1fcFvT7.js";import{M as R}from"./Modal-DPvxb8TU.js";import{I as g,T as C}from"./TextInput-D_lpO4jm.js";import{I as b}from"./InputLabel-BbG62oRH.js";import{b as V}from"./validateForm-CYcmU5RH.js";import{g as q,c as B,u as z,d as J}from"./installationService-DN6hx-Oh.js";import{I as K}from"./InputAutocomplete -Dg3p5GlX.js";import{b as Q}from"./clientService-D9KHE1ZU.js";import{o as U,p as X,f as Y,q as Z}from"./constant-DTp0l4TC.js";import{S as M}from"./Snackbar-BRongGB3.js";import{A as ee}from"./AuthenticatedLayout-DCXVhSan.js";import{T as te}from"./index-CC0TBsfS.js";import{E as ae}from"./EmptyState-C14-jZH1.js";import"./iconBase-Cmx0-DVi.js";import"./index-CfUTnf5Z.js";import"./transition-BzRYlxNR.js";import"./api-B2KTsAU8.js";import"./useTheme-D18_VcHq.js";const se=({open:S=!0,setOpen:D,dataModify:o={},onCloseFormulaire:h=()=>{}})=>{const[w,_]=n.useState("Enregistrer"),[v,x]=n.useState(!1),[i,u]=n.useState({}),[I,N]=n.useState([]),{data:c,setData:l,errors:r,reset:y}=A({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:""}),m=async()=>{const[{clients:a},E]=await Promise.all([Q(),q()]),L=a.map(p=>({id:p.id,nom:p.nom+" "+p.prenom})),T=E.data.reduce((p,t)=>{const d=parseInt(t.code_installation.replace(/\D/g,""),10);return d>p?d:p},0),P=`${X("I"+String(T).padStart(4,"0"))}`;N(L),o.id||l("code_installation",P)},f=a=>{D(!1),j(),h(a)},j=()=>{l({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:"I0001"}),x(!1),_("Enregistrer"),u({})};n.useEffect(()=>{m(),o.id?(l({client_id:o.client_id||0,date_installation:U(o.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:o.puissance_pompe||"",profondeur_forage:o.profondeur_forage||"",debit_nominal:o.debit_nominal||"",surface_panneaux:o.surface_panneaux||"",code_installation:o.code_installation||""}),_("Modifier")):j()},[o,l]);const F=async()=>{if(V(c,u)){x(!0),_("Chargement...");try{let a;w==="Enregistrer"?{message:a}=await B(c):{message:a}=await z(o.id,c),f(a)}catch(a){console.error("Error submitting payment:",a)}finally{j()}}},k=a=>{l("client_id",a.id)};return e.jsxs(R,{show:S,closeable:!1,onClose:f,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"client_id",value:"Nom client"}),e.jsx(K,{data:I,className:"block w-full mt-1",onSelect:k,isFocused:!0,defaultValue:c.client_id??0,onFocus:()=>u({...i,client_id:""})}),e.jsx(g,{message:i.client_id||r.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"puissance_pompe",value:"Puissance du pompe (W)"}),e.jsx(C,{id:"puissance_pompe",name:"puissance_pompe",value:c.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:a=>l("puissance_pompe",a.target.value),required:!0,type:"number",onFocus:()=>u({...i,puissance_pompe:""})}),e.jsx(g,{message:i.puissance_pompe||r.puissance_pompe,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"profondeur_forage",value:"Profondeur du forage (m)"}),e.jsx(C,{id:"profondeur_forage",name:"profondeur_forage",value:c.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:a=>l("profondeur_forage",a.target.value),required:!0,type:"number",onFocus:()=>u({...i,profondeur_forage:""})}),e.jsx(g,{message:i.profondeur_forage||r.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(C,{id:"debit_nominal",name:"debit_nominal",value:c.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:a=>l("debit_nominal",a.target.value),required:!0,type:"number",onFocus:()=>u({...i,debit_nominal:""})}),e.jsx(g,{message:i.debit_nominal||r.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"surface_panneaux",value:"Surface des panneaux solaires (m²)"}),e.jsx(C,{id:"surface_panneaux",name:"surface_panneaux",value:c.surface_panneaux,className:"block w-full mt-1",autoComplete:"surface_panneaux",onChange:a=>l("surface_panneaux",a.target.value),required:!0,type:"number",onFocus:()=>u({...i,surface_panneaux:""})}),e.jsx(g,{message:i.surface_panneaux||r.surface_panneaux,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"date_installation",value:"Date d'installation"}),e.jsx(C,{id:"date_installation",name:"date_installation",value:c.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:a=>l("date_installation",a.target.value),required:!0,onFocus:()=>u({...i,date_installation:""})}),e.jsx(g,{message:i.date_installation||r.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>f(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${v&&"opacity-25"}`,disabled:v,onClick:F,children:w})]})]})},Ie=()=>{const[S,D]=n.useState(""),[o,h]=n.useState(!1),[w,_]=n.useState({}),[v,x]=n.useState(1),[i,u]=n.useState([]),[I,N]=n.useState([]),[c,l]=n.useState(!0),[r,y]=n.useState({open:!1,message:"",id:0}),[m,f]=n.useState({open:!1,message:"",type:"success"}),j=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"puissance_pompe",label:"Puissance du pompe (W)"},{key:"profondeur_forage",label:"Profondeur du forage (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"surface_panneaux",label:"Surface des panneaux solaires (m²)"},{key:"date_installation",label:"Date d'installation"},{key:"statuts",label:"Statuts",customRender:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${t==="installée"?"bg-green-500/50":t==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:t})}],F=[{label:e.jsx(te,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>p(t)},{label:e.jsx(G,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>T(t)}],k=()=>{h(!0)},a=async()=>{l(!0);const{data:t}=await q(),d=t.map(s=>({id:s.id,code_installation:s.code_installation,client_id:s.client_id,nom:s.client.nom+" "+s.client.prenom,puissance_pompe:s.puissance_pompe,profondeur_forage:s.profondeur_forage,debit_nominal:s.debit_nominal,surface_panneaux:s.surface_panneaux,date_installation:Y(s.date_installation),statuts:s.statuts}));u(d),N(d),l(!1)};n.useEffect(()=>{a()},[]);const E=t=>{D(t),x(1);const d=i.filter(s=>s.nom.toLowerCase().includes(t.toLowerCase())||s.statuts.toLowerCase().includes(t.toLowerCase())||s.date_installation.toString().toLowerCase().includes(t.toLowerCase()));N(d)},L=t=>{a(),t&&f({...m,message:t,open:!0}),_({})},T=t=>{y({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation du ${t.nom} le ${t.date_installation} ?`,id:t.id})},P=async()=>{const{message:t}=await J(r.id);f({...m,message:t,open:!0}),y({...r,open:!1,id:0}),a(),x(1)},p=t=>{const d=t.date_installation?t.date_installation:"Invalid date";_({...t,date_installation:Z(d)}),h(!0)};return e.jsxs(ee,{children:[e.jsx($,{title:"Installations"}),e.jsx(H,{title:"Liste des Installations",handleClick:k,onSearch:E,search:S}),e.jsx(se,{open:o,setOpen:h,onCloseFormulaire:L,dataModify:w}),e.jsx(M,{message:m.message,type:m.type,duration:3e3,position:"top-right",show:m.open,onClose:()=>f({...m,message:"",open:!1})}),e.jsx(O,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>y({...r,open:!1}),accept:P}),c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{children:I.length>0?e.jsx(W,{headers:j,rows:I,itemsPerPage:10,actions:F,className:"mt-4",currentPage:v,onPageChange:x,masqueColumns:["client_id"]}):e.jsx(ae,{nom:"installation",search:S})})]})};export{Ie as default};
