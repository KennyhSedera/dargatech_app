import{r as s,j as a,$ as v,m as A}from"./app-DzG4DzLh.js";import{C as R}from"./ConfirmDialog-RuM9veyS.js";import{D as M}from"./DataTable-CK4fE-JX.js";import{H}from"./HeaderPage-DNzcBx9A.js";import{F as q}from"./FormulaireInstallation-Ltapnbo3.js";import{S as G}from"./Snackbar-kB46Vwr4.js";import{f as V,p as W,q as O}from"./constant-C1fj40wr.js";import{A as z,R as B}from"./AuthenticatedLayout-DqalP9kN.js";import{g as J,d as K}from"./installationService-Cu6MftA0.js";import{G as Q}from"./index-CrD15DTq.js";import{T as U,a as X}from"./index-BJxSO_no.js";import{E as Y}from"./EmptyState-CVJUQM3F.js";import"./Modal-DSbXiRse.js";import"./transition-DCzKZadW.js";import"./index-DqqrotcL.js";import"./iconBase-k9FPIicb.js";import"./TextInput-Dk5vNc4F.js";import"./createLucideIcon-CHrN6-VM.js";import"./InputLabel-3UIe_m4a.js";import"./InputAutocomplete -DyK3PeAf.js";import"./clientService-Ds69zEeP.js";import"./api-CaryC7AZ.js";import"./SelectInput-BN-ZdTfC.js";import"./InputImage-BQ60e7lM.js";import"./useTheme-CvXsb40T.js";const Se=()=>{const[u,h]=s.useState(""),[_,r]=s.useState(!1),[C,p]=s.useState({}),[w,l]=s.useState(1),[b,y]=s.useState([]),[f,g]=s.useState([]),[j,x]=s.useState(!0),[i,d]=s.useState({open:!1,message:"",id:0}),[o,m]=s.useState({open:!1,message:"",type:"success"}),[S,k]=s.useState(10),L=[{key:"code_installation",label:"Code",sortable:!0},{key:"nom",label:"Nom client",sortable:!0},{key:"numero_serie",label:"Numéro de série de la pompe",sortable:!0},{key:"puissance_pompe",label:"Puissance crête installé (W)"},{key:"profondeur_forage",label:"Distance maximale pompe champ PV (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"source_eau",label:"Source d'eau"},{key:"hmt",label:"HMT (m)"},{key:"date_installation",label:"Date de l'installation",sortable:!0},{key:"statuts",label:"Statuts",customRender:e=>a.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${e==="installée"?"bg-green-500/50":e==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"created_via",label:"Via",customRender:e=>a.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?a.jsx(X,{}):a.jsx(B,{className:"text-blue-400 bg-white"})})}],D=[{label:a.jsx(W,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:e=>F(e.id)},{label:a.jsx(U,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>E(e)},{label:a.jsx(Q,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>T(e)}],I=()=>{r(!0)},c=async()=>{x(!0);const{data:e}=await J(),n=e.map(t=>({id:t.id,code_installation:t.code_installation,client_id:t.client_id,nom:t.client.nom+" "+t.client.prenom,puissance_pompe:t.puissance_pompe,profondeur_forage:t.profondeur_forage,debit_nominal:t.debit_nominal,numero_serie:t.numero_serie,source_eau:t.source_eau,hmt:t.hmt,date_installation:V(t.date_installation),statuts:t.statuts,latitude:t.localisation.latitude,longitude:t.localisation.longitude,created_via:t.created_via}));y(n),g(n),x(!1)};s.useEffect(()=>{c()},[]);const N=e=>{h(e),l(1);const n=b.filter(t=>t.nom.toLowerCase().includes(e.toLowerCase())||t.code_installation.toLowerCase().includes(e.toLowerCase())||t.numero_serie.toLowerCase().includes(e.toLowerCase())||t.source_eau.toLowerCase().includes(e.toLowerCase())||t.statuts.toLowerCase().includes(e.toLowerCase())||t.date_installation.toString().toLowerCase().includes(e.toLowerCase()));g(n)},P=e=>{c(),e&&m({...o,message:e,open:!0}),p({})},T=e=>{d({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation numéro ${e.code_installation} du ${e.nom} le ${e.date_installation} ?`,id:e.id})},$=async()=>{const{message:e}=await K(i.id);m({...o,message:e,open:!0}),d({...i,open:!1,id:0}),c(),l(1)},E=e=>{const n=e.date_installation?e.date_installation:"Invalid date";p({...e,date_installation:O(n)}),r(!0)},F=e=>{A.visit(`/installation/${e}`)};return a.jsxs(z,{children:[a.jsx(v,{title:"Installations"}),a.jsx(H,{title:`Liste des Installations ( Total: ${b.length} )`,handleClick:I,onSearch:N,search:u}),a.jsx(q,{open:_,setOpen:r,onCloseFormulaire:P,dataModify:C,token_data:null}),a.jsx(G,{message:o.message,type:o.type,duration:3e3,position:"top-right",show:o.open,onClose:()=>m({...o,message:"",open:!1})}),a.jsx(R,{open:i.open,message:i.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>d({...i,open:!1}),accept:$}),j?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):a.jsx("div",{children:f.length>0?a.jsx(M,{headers:L,rows:f,itemsPerPage:S,actions:D,className:"mt-4",currentPage:w,onPageChange:l,masqueColumns:["client_id","latitude","longitude"],onItemsPerPageChange:e=>k(e)}):a.jsx(Y,{nom:"installation",search:u})})]})};export{Se as default};
