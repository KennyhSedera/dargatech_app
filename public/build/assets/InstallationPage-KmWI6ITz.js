import{r as n,m as A,j as e,L as $}from"./app-CmL8TdgT.js";import{C as O,D as W,G}from"./index-Cg7cYwVG.js";import{H}from"./HeaderPage-B52-G20L.js";import{M as R}from"./Modal-B5T3nMJo.js";import{I as g,T as C}from"./TextInput-1m94bHjT.js";import{I as b}from"./InputLabel-8KFd54Qy.js";import{b as V}from"./validateForm-C-Be7ugn.js";import{g as q,c as B,u as z,d as J}from"./installationService-BdvxpZEJ.js";import{I as K}from"./InputAutocomplete -CzkjrCZt.js";import{b as Q}from"./clientService-Cc59Lk9M.js";import{o as U,p as X,n as Y,f as Z,q as M}from"./constant-wfS04Kwq.js";import{S as ee}from"./Snackbar-Blx3HZjz.js";import{A as te}from"./AuthenticatedLayout-BQP3T737.js";import{T as ae}from"./index-STnI4Ype.js";import"./iconBase-DIw4c1F9.js";import"./index-CdlGWxea.js";import"./transition-CHtezwrT.js";import"./index-i6ARvHnj.js";import"./api-OGwnO7u9.js";import"./useTheme-l-2LwLbK.js";const se=({open:y=!0,setOpen:D,dataModify:o={},onCloseFormulaire:h=()=>{}})=>{const[S,_]=n.useState("Enregistrer"),[w,x]=n.useState(!1),[l,u]=n.useState({}),[v,N]=n.useState([]),{data:c,setData:i,errors:r,reset:I}=A({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:""}),m=async()=>{const[{clients:a},L]=await Promise.all([Q(),q()]),T=a.map(p=>({id:p.id,nom:p.nom+" "+p.prenom})),E=L.data.reduce((p,t)=>{const d=parseInt(t.code_installation.replace(/\D/g,""),10);return d>p?d:p},0),P=`${X("I"+String(E).padStart(4,"0"))}`;N(T),o.id||i("code_installation",P)},f=a=>{D(!1),j(),h(a)},j=()=>{i({client_id:0,date_installation:new Date().toISOString().split("T")[0],puissance_pompe:"",profondeur_forage:"",debit_nominal:"",surface_panneaux:"",code_installation:"I0001"}),x(!1),_("Enregistrer"),u({})};n.useEffect(()=>{m(),o.id?(i({client_id:o.client_id||0,date_installation:U(o.date_installation)||new Date().toISOString().split("T")[0],puissance_pompe:o.puissance_pompe||"",profondeur_forage:o.profondeur_forage||"",debit_nominal:o.debit_nominal||"",surface_panneaux:o.surface_panneaux||"",code_installation:o.code_installation||""}),_("Modifier")):j()},[o,i]);const F=async()=>{if(V(c,u)){x(!0),_("Chargement...");try{let a;S==="Enregistrer"?{message:a}=await B(c):{message:a}=await z(o.id,c),f(a)}catch(a){console.error("Error submitting payment:",a)}finally{j()}}},k=a=>{i("client_id",a.id)};return e.jsxs(R,{show:y,closeable:!1,onClose:f,maxWidth:"xl",children:[e.jsx("div",{className:"text-2xl font-semibold text-center",children:o.nom?"Modifier une Installation":"Ajouter une Installation"}),e.jsxs("form",{className:"grid w-full grid-cols-1 gap-4 my-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"client_id",value:"Nom client"}),e.jsx(K,{data:v,className:"block w-full mt-1",onSelect:k,isFocused:!0,defaultValue:c.client_id??0,onFocus:()=>u({...l,client_id:""})}),e.jsx(g,{message:l.client_id||r.client_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"puissance_pompe",value:"Puissance du pompe (W)"}),e.jsx(C,{id:"puissance_pompe",name:"puissance_pompe",value:c.puissance_pompe??0,className:"block w-full mt-1",autoComplete:"puissance_pompe",onChange:a=>i("puissance_pompe",a.target.value),required:!0,type:"number",onFocus:()=>u({...l,puissance_pompe:""})}),e.jsx(g,{message:l.puissance_pompe||r.puissance_pompe,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"profondeur_forage",value:"Profondeur du forage (m)"}),e.jsx(C,{id:"profondeur_forage",name:"profondeur_forage",value:c.profondeur_forage,className:"block w-full mt-1",autoComplete:"profondeur_forage",onChange:a=>i("profondeur_forage",a.target.value),required:!0,type:"number",onFocus:()=>u({...l,profondeur_forage:""})}),e.jsx(g,{message:l.profondeur_forage||r.profondeur_forage,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"debit_nominal",value:"Débit nominal (m³/h)"}),e.jsx(C,{id:"debit_nominal",name:"debit_nominal",value:c.debit_nominal,className:"block w-full mt-1",autoComplete:"debit_nominal",onChange:a=>i("debit_nominal",a.target.value),required:!0,type:"number",onFocus:()=>u({...l,debit_nominal:""})}),e.jsx(g,{message:l.debit_nominal||r.debit_nominal,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"surface_panneaux",value:"Surface des panneaux solaires (m²)"}),e.jsx(C,{id:"surface_panneaux",name:"surface_panneaux",value:c.surface_panneaux,className:"block w-full mt-1",autoComplete:"surface_panneaux",onChange:a=>i("surface_panneaux",a.target.value),required:!0,type:"number",onFocus:()=>u({...l,surface_panneaux:""})}),e.jsx(g,{message:l.surface_panneaux||r.surface_panneaux,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"date_installation",value:"Date d'installation"}),e.jsx(C,{id:"date_installation",name:"date_installation",value:c.date_installation,className:"block w-full mt-1",autoComplete:"date_installation",type:"date",onChange:a=>i("date_installation",a.target.value),required:!0,onFocus:()=>u({...l,date_installation:""})}),e.jsx(g,{message:l.date_installation||r.date_installation,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"px-4 py-1 text-red-500 rounded-md bg-red-400/10",onClick:()=>f(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`rounded-md py-1 px-4 disabled:cursor-not-allowed bg-blue-500 text-white ${w&&"opacity-25"}`,disabled:w,onClick:F,children:S})]})]})},ve=()=>{const[y,D]=n.useState(""),[o,h]=n.useState(!1),[S,_]=n.useState({}),[w,x]=n.useState(1),[l,u]=n.useState([]),[v,N]=n.useState([]),[c,i]=n.useState(!0),[r,I]=n.useState({open:!1,message:"",id:0}),[m,f]=n.useState({open:!1,message:"",type:"success"}),j=[{key:"code_installation",label:"Code"},{key:"nom",label:"Nom client"},{key:"puissance_pompe",label:"Puissance du pompe (W)"},{key:"profondeur_forage",label:"Profondeur du forage (m)"},{key:"debit_nominal",label:"Débit nominal (m³/h)"},{key:"surface_panneaux",label:"Surface des panneaux solaires (m²)"},{key:"date_installation",label:"Date d'installation"},{key:"statuts",label:"Statuts",customRender:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap cursor-pointer ${t==="installée"?"bg-green-500/50":t==="en cours"?"bg-blue-500/50":"bg-red-500/50"}`,children:t})}],F=[{label:e.jsx(ae,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:t=>p(t)},{label:e.jsx(G,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:t=>E(t)}],k=()=>{h(!0)},a=async()=>{i(!0);const{data:t}=await q(),d=t.map(s=>({id:s.id,code_installation:s.code_installation,client_id:s.client_id,nom:s.client.nom+" "+s.client.prenom,puissance_pompe:s.puissance_pompe,profondeur_forage:s.profondeur_forage,debit_nominal:s.debit_nominal,surface_panneaux:s.surface_panneaux,date_installation:Z(s.date_installation),statuts:s.statuts}));u(d),N(d),i(!1)};n.useEffect(()=>{a()},[]);const L=t=>{D(t),x(1);const d=l.filter(s=>s.nom.toLowerCase().includes(t.toLowerCase())||s.statuts.toLowerCase().includes(t.toLowerCase())||s.date_installation.toString().toLowerCase().includes(t.toLowerCase()));N(d)},T=t=>{a(),t&&f({...m,message:t,open:!0}),_({})},E=t=>{I({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'installation du ${t.nom} le ${t.date_installation} ?`,id:t.id})},P=async()=>{const{message:t}=await J(r.id);f({...m,message:t,open:!0}),I({...r,open:!1,id:0}),a(),x(1)},p=t=>{const d=t.date_installation?t.date_installation:"Invalid date";_({...t,date_installation:M(d)}),h(!0)};return e.jsxs(te,{children:[e.jsx($,{title:"Installations"}),e.jsx(H,{title:"Liste des Installations",handleClick:k,onSearch:L,search:y}),e.jsx(se,{open:o,setOpen:h,onCloseFormulaire:T,dataModify:S}),e.jsx(ee,{message:m.message,type:m.type,duration:3e3,position:"top-right",show:m.open,onClose:()=>f({...m,message:"",open:!1})}),e.jsx(O,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>I({...r,open:!1}),accept:P}),c?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{children:v.length>0?e.jsx(W,{headers:j,rows:v,itemsPerPage:10,actions:F,className:"mt-4",currentPage:w,onPageChange:x,masqueColumns:["client_id"]}):e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:Y,alt:"no data",className:"max-w-md opacity-50 mt-2"})})})]})};export{ve as default};
