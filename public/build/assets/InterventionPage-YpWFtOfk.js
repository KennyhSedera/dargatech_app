import{r as a,q as Q,j as n,$ as U,m as f}from"./app-w0iqaQyp.js";import{C as X}from"./index-Dm40oNd2.js";import{D as Y}from"./DataTable-Dv05_CXu.js";import{E as Z}from"./EmptyState-CzjdfmiM.js";import{H as ee}from"./HeaderPage-BUYoMQ_Y.js";import{F as te}from"./FormulaireMaintenance-CgBc-CUf.js";import{F as ne}from"./FormulaireRapportMaintenance-OCNf1OgS.js";import{S as ae}from"./Snackbar-8OivGSnw.js";import{f as oe,t as se,u as re}from"./constant-0jnMf1DK.js";import{A as ie,R as le}from"./AuthenticatedLayout-DMEV0mKg.js";import{g as de,d as pe}from"./maintenanceService-CPQ49WmB.js";import{G as ce}from"./index-BpePKvcV.js";import{a as me,T as ue}from"./index-B8x_QMGz.js";import"./Modal-BoZis7QJ.js";import"./transition-D9ObI3tV.js";import"./iconBase-sjoGL-k4.js";import"./TextInput--KfCbiIc.js";import"./createLucideIcon-ozv-MFqD.js";import"./InputLabel-DZfpGWHw.js";import"./installationService-zDfaiKTS.js";import"./api-oJV7_Bnd.js";import"./InputAutocomplete -CsQVN_NC.js";import"./SelectInput-DDMlER3h.js";import"./validateForm-DkOh89YH.js";import"./TextArea-DXQNwOwL.js";import"./InputImage-bYgBKgEe.js";import"./useTheme-sBFOA3iT.js";const Ge=()=>{const[h,N]=a.useState(""),[k,R]=a.useState(0),[L,u]=a.useState(!1),[P,g]=a.useState(!1),[F,_]=a.useState({}),[T,v]=a.useState({}),[I,x]=a.useState(1),[y,$]=a.useState([]),[C,j]=a.useState([]),[E,w]=a.useState(!0),[r,b]=a.useState({open:!1,message:"",id:0}),[s,c]=a.useState({open:!1,message:"",type:"success"}),i=Q().props.auth.user,[M,A]=a.useState(10),O=[{key:"id",label:"ID",sortable:!0},{key:"code_installation",label:"Installation",sortable:!0},{key:"nom",label:"Client",sortable:!0},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème",customRender:e=>n.jsxs("div",{className:"relative max-w-md group",children:[n.jsx("span",{className:"line-clamp-2",children:e}),n.jsx("div",{className:"absolute bottom-0 left-0 z-50 hidden max-w-md p-2 mt-2 text-sm text-gray-800 bg-white border border-gray-300 rounded shadow-md group-hover:block",children:e})]})},{key:"date_intervention",label:"Date d'intervenir",sortable:!0},{key:"status_intervention",label:"Statuts",customRender:e=>n.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap ${e==="terminée"?"bg-green-500/50":e==="en attente"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"status_intervention",label:"Rapport",sortable:!0,customRender:(e,o)=>{var t,l,d;return n.jsx("span",{onClick:()=>{var p;return e==="terminée"?f.visit("/rapport",{data:{intervention_id:o.id}}):((p=i.user_role)==null?void 0:p.name)==="partenaire"?null:H(o)},className:`px-2 py-1 rounded-full flex text-nowrap ${((t=i.user_role)==null?void 0:t.name)==="partenaire"&&e!=="terminée"?"cursor-default":"cursor-pointer"} ${e==="terminée"?"text-green-500":((l=i.user_role)==null?void 0:l.name)==="partenaire"?"text-gray-300":"text-blue-500"}`,children:e==="terminée"?"Consulter":((d=i.user_role)==null?void 0:d.name)==="partenaire"?"En attente":"Ajouter"})}},{key:"created_via",label:"Via",customRender:e=>n.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?n.jsx(ue,{}):n.jsx(le,{className:"text-blue-400"})})}],q=[{action:!0,label:n.jsx(se,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:e=>f.visit(`/intervention/${e.id}/view`)},{label:n.jsx(me,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>K(e)},{label:n.jsx(ce,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>W(e)}],G=()=>{u(!0)},H=e=>{var o;((o=i.user_role)==null?void 0:o.name)==="partenaire"?f.visit("/rapport",{data:{intervention_id:e.id}}):(g(!0),v(e))},m=async()=>{w(!0);const{data:e}=await de(),o=e.map(t=>({id:t.id,installation_id:t.installation_id,code_installation:t.installation.code_installation,nom:t.installation.client.nom+" "+t.installation.client.prenom,idclient:t.installation.client.id,type_intervention:t.type_intervention,description_probleme:t.description_probleme,status_intervention:t.status_intervention,date_intervention:oe(t.date_intervention),created_via:t.created_via}));$(o),j(o),w(!1)};a.useEffect(()=>{m()},[]);const z=e=>{N(e),x(1);const o=y.filter(t=>{var l,d,p,S,D;return((l=t==null?void 0:t.nom)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((d=t==null?void 0:t.type_intervention)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((p=t==null?void 0:t.description_probleme)==null?void 0:p.toLowerCase().includes(e.toLowerCase()))||((S=t==null?void 0:t.date_intervention)==null?void 0:S.toString().toLowerCase().includes(e.toLowerCase()))||((D=t==null?void 0:t.code_installation)==null?void 0:D.toLowerCase().includes(e.toLowerCase()))});j(o)},B=e=>{m(),e&&c({...s,message:e,open:!0}),_({})},V=e=>{m(),e&&c({...s,message:e,open:!0}),v({})},W=e=>{b({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${e.nom} le ${e.date_intervention} ?`,id:e.id})},J=async()=>{const{message:e}=await pe(r.id);c({...s,message:e,open:!0}),b({...r,open:!1,id:0}),m(),x(1)},K=e=>{const o=e.date_intervention?e.date_intervention:"Invalid date";_({...e,date_intervention:re(o)}),u(!0)};return n.jsxs(ie,{setId:R,children:[n.jsx(U,{title:"Maintenance"}),n.jsx(ee,{search:h,onSearch:z,title:`Liste des interventions ( Total: ${y.length} )`,handleClick:G}),n.jsx(ae,{message:s.message,type:s.type,duration:3e3,position:"top-right",show:s.open,onClose:()=>c({...s,message:"",open:!1})}),n.jsx(X,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>b({...r,open:!1}),accept:J}),n.jsx(te,{open:L,setOpen:u,dataModify:F,onCloseFormulaire:B,idTechnicien:k}),n.jsx(ne,{open:P,setOpen:g,dataModify:T,onCloseFormulaire:V}),E?n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):n.jsx("div",{children:C.length>0?n.jsx(Y,{headers:O,rows:C,itemsPerPage:M,actions:q,className:"mt-4",currentPage:I,onPageChange:x,masqueColumns:["client_id"],onItemsPerPageChange:e=>A(e)}):n.jsx(Z,{nom:"intervention",search:h})})]})};export{Ge as default};
