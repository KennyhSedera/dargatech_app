import{j as e,r as v,$ as J}from"./app-B2Jra4XY.js";import{A as $}from"./AuthenticatedLayout-DyU0Ctfs.js";import{a as K}from"./clientService-CaAkbPkY.js";import{h as c,a as g,F as Q,b as X,c as B,H as Z,d as ee,e as O,g as te,i as se,j as ae,k as re,I as ne,l as le,L as de}from"./constant-BdwcjHe6.js";import"./fr-Br33CVeN.js";import{E as ie}from"./EmptyState-DR20Kjev.js";import"./transition-k6REG_Ju.js";import"./iconBase-Cq3BoHHE.js";import"./useTheme-Pmc1lI-U.js";import"./index-bIA0T44u.js";import"./Modal-FGbwJu-T.js";import"./index-dcP68Eoz.js";import"./createLucideIcon-Cc5wsCT0.js";import"./api-ValjjRaG.js";c.locale("fr");const ce=({paiement:t,getStatusColor:x,getStatusBadge:r})=>{var l;if(!t)return null;const n=(i,y)=>{if(!i||!y)return"";const f=c(i),u=c(y);return f.isBefore(u,"day")?{color:"text-green-500",text:"(en avance)"}:f.isSame(u,"day")?{color:"text-blue-500",text:"(à temps)"}:{color:"text-red-500",text:"(en retard)"}},d=t.date_paiement?n(t.date_paiement,t.date_echeance):"";return e.jsx("div",{className:`p-4 mb-4 border-2 rounded-lg ${x(t.statut_paiement)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Installation"}),t.date_paiement&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c(t.date_paiement).format("DD MMM YYYY")})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(t.montant)," FCFA"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r(t.statut_paiement,t.date_echeance),e.jsx("span",{className:`${d.color} text-xs`,children:d.text})]}),t.date_paiement&&((l=t.statut_paiement)==null?void 0:l.toLowerCase())==="payé"&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["le"," ",c(t.date_paiement).format("DD MMM YYYY")," "]})]})]})})},xe=({montantPaye:t,montantRestant:x,pourcentagePaye:r,trimestresPayes:n,trimestresRestants:d,nombreTrimestres:l})=>e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Vue d'ensemble"}),e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsxs("div",{className:"relative w-40 h-40",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",strokeDasharray:`${r*2.51} ${251-r*2.51}`,className:"text-green-500 transition-all duration-500",strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[r,"%"]})})]})}),e.jsx("h4",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Progression"}),e.jsx("div",{className:"w-full h-3 mb-4 overflow-hidden bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx("div",{className:"h-full transition-all duration-500 bg-gradient-to-r from-green-500 to-blue-500",style:{width:`${r}%`}})})]}),oe=({trimestre:t,getStatusColor:x,getStatusBadge:r,isDernierTrimestre:n})=>{var i;const d=((i=t.statut_paiement)==null?void 0:i.toLowerCase())==="payé",l=Math.max(t.montant_attendu-t.montant,0);return e.jsxs("div",{className:`p-4 border-2 rounded-lg transition-all ${x(t.statut_paiement,t.estIncomplet)}`,children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[t.echeance,n&&e.jsx("span",{className:"ml-2 text-xs font-normal text-orange-600 dark:text-orange-400",children:"(Dernier)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.periode})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[g(t.montant)," FCFA"]}),t.estIncomplet&&e.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:["Reste : ",g(l)," FCFA"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.statut_paiement,t.date_echeance,t.estIncomplet),e.jsx("span",{className:`text-xs ${t.remarque.color}`,children:t.remarque.text})]}),d&&t.date_paiement&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["le"," ",c(t.date_paiement).format("DD MMM YYYY")]})]})]})},me=({paiementsTrimestres:t,paiementInstallation:x,getStatusColor:r,getStatusBadge:n,nombreTrimestres:d})=>e.jsxs("div",{className:"p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Calendrier des Paiements"}),e.jsx(ce,{paiement:x,getStatusColor:r,getStatusBadge:n}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:t.map((l,i)=>e.jsx(oe,{trimestre:l,getStatusColor:r,getStatusBadge:n,isDernierTrimestre:i===d-1},l.id))})]}),ge=({paiements:t,client:x})=>{var I;if(!t||t.length===0)return null;const n=3*4,d=18e3,l=22e3,i=t.find(a=>{var s;return((s=a.echeance)==null?void 0:s.toLowerCase())==="installation"}),y=t.filter(a=>{var s;return(s=a.echeance)==null?void 0:s.match(/^T\d+$/i)}),f=(i==null?void 0:i.date_paiement)||((I=y[0])==null?void 0:I.date_paiement)||new Date,u=t.reduce((a,s)=>{if(!s.echeance)return a;const o=s.echeance.toUpperCase();return a[o]||(a[o]=[]),a[o].push(s),a},{}),M=(a,s)=>{if(!a||!s)return"";const o=c(a),p=c(s);return o.isBefore(p,"month")?{color:"text-green-500",text:"(en avance)"}:o.isSame(p,"month")?{color:"text-blue-500",text:"(à temps)"}:{color:"text-red-500",text:"(en retard)"}},Y=Array.from({length:n},(a,s)=>{const o=s+1,p=`T${String(o).padStart(2,"0")}`,C=o===n?l:d,A=u[p]||[],_=A.reduce((k,j)=>{var H;return((H=j.statut_paiement)==null?void 0:H.toLowerCase())==="payé"?k+parseFloat(j.montant||0):k},0),W=_>0&&_<C,D=_>=C?"payé":_>0?"incomplet":"en attente",S=A.filter(k=>{var j;return((j=k.statut_paiement)==null?void 0:j.toLowerCase())==="payé"}).sort((k,j)=>new Date(j.date_paiement)-new Date(k.date_paiement))[0],E=S?S.date_paiement:null,R=c(f).add(s*3,"months"),P=c(R).add(2,"months"),G=`${R.format("MMM YYYY")} – ${P.format("MMM YYYY")}`,z=(D==null?void 0:D.toLowerCase())==="payé"?M(E,P):"";return{id:`trim-${o}`,echeance:p,periode:G,montant:_,montant_attendu:C,statut_paiement:D,date_echeance:P.format("YYYY-MM-DD"),date_paiement:E,estIncomplet:W,remarque:z}}),F=d*(n-1)+l,N=(i?parseFloat(i.montant):0)+F,h=t.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).reduce((a,s)=>a+parseFloat(s.montant||0),0),b=N-h,m=N>0?Math.round(h/N*100):0,T=Y.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).length,L=n-T,U=(a,s)=>s?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-700":(a==null?void 0:a.toLowerCase())==="payé"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700":"bg-white border-gray-200 dark:bg-slate-800 dark:border-gray-700",V=(a,s,o)=>{const p=(a==null?void 0:a.toLowerCase())==="payé",C=!p&&s&&c(s).isBefore(c());return o?e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-600 dark:text-yellow-400",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Incomplet"})]}):p?e.jsxs("div",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Payé"})]}):C?e.jsxs("div",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"En retard"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-orange-600 dark:text-orange-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"À venir"})]})};return e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-6 border-b border-gray-200 md:grid-cols-4 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[g(N)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Payé"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[g(h)," FCFA"]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:[m,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Reste"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[g(b)," FCFA"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[L," trim."]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestriel"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[g(d)," FCFA"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"/3 mois"})]})]}),e.jsx(xe,{montantPaye:h,montantRestant:b,pourcentagePaye:m,trimestresPayes:T,trimestresRestants:L,montantTrimestrielNormal:d,nombreTrimestres:n}),e.jsx(me,{paiementsTrimestres:Y,paiementInstallation:i,getStatusColor:U,getStatusBadge:V,nombreTrimestres:n}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-6 border-t-2 border-gray-200 md:grid-cols-4 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant payé"}),e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(h)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant restant"}),e.jsxs("p",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:[g(b)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres payés"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[T," / ",n]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres restants"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:L})]})]})]})},w=({icon:t,label:x,value:r,bgColor:n,iconColor:d})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg ${n}`,children:e.jsx(t,{className:`w-5 h-5 ${d}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:x}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:r||"Non renseigné"})]})]}),q=({message:t="Chargement des données..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 rounded-full border-t-transparent animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t})]})}),he=({client:t,installation:x})=>{const r=x&&x.length>0?x[0]:null;return e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col justify-between space-y-4 md:flex-row md:space-y-0 md:items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-teal-500/10",children:e.jsx(Z,{className:"w-8 h-8 text-teal-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.nom," ",t.prenom]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Client ID: #",t.id]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Inscrit le"," ",c(t.created_at).format("DD MMM YYYY")]})]})]})]}),r&&e.jsxs("div",{className:`flex items-center px-4 py-3 space-x-3 rounded-lg text-white border-2 ${r.statuts==="installée"?"border-green-500 bg-green-500/10":"border-red-500 bg-red-500/10"}`,children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-yellow-500/20",children:e.jsx(ee,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase dark:text-gray-400",children:"Installation"}),e.jsx("p",{className:"text-base font-bold text-gray-900 dark:text-white",children:r.code_installation||"N/A"}),r.date_installation&&e.jsxs("div",{className:"flex items-center mt-1 space-x-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:c(r.date_installation).format("DD MMM YYYY")})]})]})]})]})})};c.locale("fr");const Fe=({client:t})=>{var F;const[x,r]=v.useState([]),[n,d]=v.useState([]),[l,i]=v.useState(null),[y,f]=v.useState(!0),[u,M]=v.useState(!0),Y=async N=>{var h,b;try{M(!0);const m=await K(N);m&&(d(((h=m.client)==null?void 0:h.installations)||[]),r(((b=m.client)==null?void 0:b.paiement)||[]),i(m.client))}catch(m){console.error("Erreur lors de la récupération des données:",m)}finally{f(!1),M(!1)}};return v.useEffect(()=>{t!=null&&t.id&&Y(t.id)},[t]),y?e.jsx($,{children:e.jsx(q,{})}):t?e.jsxs($,{children:[e.jsx(J,{title:`${t.nom} ${t.prenom}`}),u?e.jsx(q,{}):e.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsx(he,{client:t,installation:n}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 p-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{icon:te,label:"Téléphone",value:t.telephone,bgColor:"bg-blue-50 dark:bg-blue-900/20",iconColor:"text-blue-600 dark:text-blue-400"}),e.jsx(w,{icon:se,label:"Email",value:t.email,bgColor:"bg-indigo-50 dark:bg-indigo-900/20",iconColor:"text-indigo-600 dark:text-indigo-400"}),e.jsx(w,{icon:ae,label:"CIN",value:t.CIN,bgColor:"bg-yellow-50 dark:bg-yellow-900/20",iconColor:"text-yellow-600 dark:text-yellow-400"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-red-50 dark:bg-red-900/20",children:e.jsx(re,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:(l==null?void 0:l.localisation)||"Non renseigné"}),((F=l==null?void 0:l.localisation)==null?void 0:F.pays)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l.localisation.pays})]})]}),e.jsx(w,{icon:ne,label:"Genre",value:t.genre,bgColor:"bg-purple-50 dark:bg-purple-900/20",iconColor:"text-purple-600 dark:text-purple-400"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-orange-50 dark:bg-orange-900/20",children:e.jsx(O,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Date du contrat"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:c(t.date_contrat).format("DD MMM YYYY")})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{icon:le,label:"Surface cultivée",value:`${t.surface_cultivee} ha`,bgColor:"bg-green-50 dark:bg-green-900/20",iconColor:"text-green-600 dark:text-green-400"}),e.jsx(w,{icon:de,label:"Type d'activité agricole",value:t.type_activite_agricole,bgColor:"bg-teal-50 dark:bg-teal-900/20",iconColor:"text-teal-600 dark:text-teal-400"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 bg-gray-100 rounded-lg dark:bg-gray-900/50",children:"⚙️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Créée via"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:t.created_via||"Non renseigné"})]})]})]})]})]}),e.jsx(ge,{paiements:x,client:t})]})})]}):e.jsx($,{children:e.jsx(ie,{message:"Aucune donnée client disponible"})})};export{Fe as default};
