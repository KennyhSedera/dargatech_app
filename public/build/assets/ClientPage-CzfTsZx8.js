import{r as n,v as A,j as e,$ as H,m as $}from"./app-c3qJI57q.js";import{M as G}from"./Modal-BdS7sgfq.js";import{T as v,I as p}from"./TextInput-BgJ2t9aS.js";import{I as d}from"./InputLabel-C-TZjnWz.js";import{u as K,c as O,b as B,d as R}from"./clientService-CiPlXhw0.js";import{a as V}from"./validateForm-CYV7VTEV.js";import{S as W}from"./SelectInput-CzwjY-Zr.js";import{C as z}from"./ConfirmDialog-CRFY0WwR.js";import{D as J}from"./DataTable-DxBbA0zA.js";import{E as Q}from"./EmptyState-CgYYjtgj.js";import{H as U}from"./HeaderPage-BRlTcsAA.js";import{S as X}from"./Snackbar-CvWaLRwL.js";import{A as Y}from"./AuthenticatedLayout-cwMz5Lyt.js";import{j as Z}from"./constant-DEY8BttC.js";import{G as M}from"./index-C8bcBNXW.js";import{T as ee}from"./index-DQvrfVrX.js";import"./transition-PLd8YbUn.js";import"./index-Ze9ldLz0.js";import"./api-Bi4KaLps.js";import"./index-mfF9RBAU.js";import"./iconBase-8XtX0Jdf.js";import"./useTheme-_SBbUE7y.js";const te=({open:N=!0,setOpen:S,dataModify:a={},onCloseFormulaire:f=()=>{}})=>{const[I,g]=n.useState("Enregistrer"),[o,c]=n.useState({}),[b,x]=n.useState(!1),{data:r,setData:i,errors:m,reset:_}=A({nom:"",prenom:"",email:"",genre:"Homme",CIN:"",telephone:"",pays:"Togo",ville:"Kara",localisation:"",surface_cultivee:"",type_activite_agricole:""}),u=t=>{S(!1),C(),f(t)},C=()=>{_(),g("Enregistrer"),c({}),x(!1)};n.useEffect(()=>{var t,j,w,F;a.id?(i({nom:a.nom||"",prenom:a.prenom||"",email:a.email||"",genre:a.genre||"Homme",CIN:a.CIN||"",telephone:a.telephone||"",pays:((t=a.localisation)==null?void 0:t.pays)||"Togo",ville:((j=a.localisation)==null?void 0:j.ville)||"Kara",quartier:((w=a.localisation)==null?void 0:w.quartier)||"",village:((F=a.localisation)==null?void 0:F.village)||"",localisation:(a==null?void 0:a.localisation)||"",surface_cultivee:a.surface_cultivee||"",type_activite_agricole:a.type_activite_agricole||""}),g("Modifier")):C()},[a,i]);const h=async()=>{if(V(r,c)){x(!0),g(a.id?"Modification...":"Enregistrement...");try{a.id?(await K(a.id,r),u("Client modifié avec succès !")):(await O(r),u("Client créé avec succès !"))}catch(t){console.error("Erreur:",t),x(!1),g(a.id?"Modifier":"Enregistrer")}}};return e.jsxs(G,{show:N,closeable:!1,onClose:u,maxWidth:"3xl",children:[e.jsx("div",{className:"text-center font-semibold text-2xl",children:a.id?"Modifier un Maraîcher":"Ajouter un Maraîcher"}),e.jsxs("form",{className:"w-full my-6 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"nom",value:"Nom"}),e.jsx(v,{id:"nom",name:"nom",value:r.nom,className:"mt-1 block w-full",autoComplete:"nom",isFocused:!0,onChange:t=>i("nom",t.target.value),required:!0,onFocus:()=>c({...o,nom:""})}),e.jsx(p,{message:o.nom||m.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"prenom",value:"Prénom"}),e.jsx(v,{id:"prenom",name:"prenom",value:r.prenom,className:"mt-1 block w-full",autoComplete:"prenom",onChange:t=>i("prenom",t.target.value),required:!0,onFocus:()=>c({...o,prenom:""})}),e.jsx(p,{message:o.prenom||m.prenom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",value:"Email"}),e.jsx(v,{id:"email",name:"email",value:r.email,className:"mt-1 block w-full",autoComplete:"email",onChange:t=>i("email",t.target.value),onFocus:()=>c({...o,email:""})}),e.jsx(p,{message:o.email||m.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"genre",value:"Sexe"}),e.jsxs(W,{id:"genre",type:"genre",name:"genre",value:r.genre,className:"block w-full mt-1",autoComplete:"genre",onChange:t=>i("genre",t.target.value),required:!0,children:[e.jsx("option",{value:"Homme",children:"Homme"}),e.jsx("option",{value:"Femme",children:"Femme"})]}),e.jsx(p,{message:m.genre,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"CIN",value:"Pièce d'identité"}),e.jsx(v,{id:"CIN",name:"CIN",value:r.CIN,className:"mt-1 block w-full",autoComplete:"CIN",onChange:t=>i("CIN",t.target.value),required:!0,onFocus:()=>c({...o,CIN:""})}),e.jsx(p,{message:o.CIN||m.CIN,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"telephone",value:"Téléphone"}),e.jsx(v,{id:"telephone",name:"telephone",value:r.telephone,className:"mt-1 block w-full",autoComplete:"telephone",onChange:t=>i("telephone",t.target.value),required:!0,onFocus:()=>c({...o,telephone:""})}),e.jsx(p,{message:o.telephone||m.telephone,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"localisation",value:"Localisation ou adresse"}),e.jsx(v,{id:"localisation",name:"localisation",value:r.localisation,className:"mt-1 block w-full",autoComplete:"localisation",onChange:t=>i("localisation",t.target.value),required:!0,onFocus:()=>c({...o,localisation:""})}),e.jsx(p,{message:o.localisation||m.localisation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"type_activite_agricole",value:"Type activité agricole"}),e.jsx(v,{id:"type_activite_agricole",name:"type_activite_agricole",value:r.type_activite_agricole,className:"mt-1 block w-full",autoComplete:"type_activite_agricole",onChange:t=>i("type_activite_agricole",t.target.value),required:!0,onFocus:()=>c({...o,type_activite_agricole:""})}),e.jsx(p,{message:o.type_activite_agricole||m.type_activite_agricole,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"surface_cultivee",value:"Surface cultivée (en ha)"}),e.jsx(v,{id:"surface_cultivee",name:"surface_cultivee",value:r.surface_cultivee,className:"mt-1 block w-full",autoComplete:"surface_cultivee",onChange:t=>i("surface_cultivee",t.target.value),required:!0,onFocus:()=>c({...o,surface_cultivee:""})}),e.jsx(p,{message:o.surface_cultivee||m.surface_cultivee,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"rounded-md py-1 px-4 text-red-500 bg-red-400/10",onClick:()=>u(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${b&&"opacity-25"}`,disabled:b,onClick:h,children:I})]})]})},we=()=>{const[N,S]=n.useState(""),[a,f]=n.useState(!1),[I,g]=n.useState(1),[o,c]=n.useState([]),[b,x]=n.useState([]),[r,i]=n.useState({}),[m,_]=n.useState(!0),[u,C]=n.useState({open:!1,message:"",id:0}),[h,t]=n.useState({open:!1,message:"",type:"success"}),j=async()=>{_(!0);const y=(await B()).clients.map(l=>({id:l.id,nom:l.nom,prenom:l.prenom,CIN:l.CIN,email:l.email,telephone:l.telephone,localisation:l.localisation,surface_cultivee:l.surface_cultivee,type_activite_agricole:l.type_activite_agricole}));c(y),x(y),_(!1)};n.useEffect(()=>{j()},[]);const w=s=>{S(s),g(1);const y=o.filter(l=>l.nom.toLowerCase().includes(s.toLowerCase())||l.prenom.toLowerCase().includes(s.toLowerCase())||l.telephone.toLowerCase().includes(s.toLowerCase())||l.surface_cultivee.toLowerCase().includes(s.toLowerCase())||l.type_activite_agricole.toLowerCase().includes(s.toLowerCase())||l.localisation.toLowerCase().includes(s.toLowerCase()));x(y)},F=()=>{f(!0)},k=[{key:"id",label:"ID",sortable:!0},{key:"nom",label:"Nom",sortable:!0},{key:"prenom",label:"Prénom",sortable:!0},{key:"CIN",label:"CIN"},{key:"email",label:"Email",sortable:!0},{key:"telephone",label:"Téléphone"},{key:"localisation",label:"Localisation",sortable:!0},{key:"surface_cultivee",label:"Surface cultivée (ha)",sortable:!0},{key:"type_activite_agricole",label:"Type d'activité agricole"}],E=[{label:e.jsx(Z,{className:"text-base"}),color:"text-green-500",hoverColor:"text-green-600",handler:s=>P(s.id)},{label:e.jsx(ee,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:s=>T(s)},{label:e.jsx(M,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:s=>D(s)}],L=s=>{j(),s&&t({...h,message:s,open:!0}),i({})},T=s=>{i(s),f(!0)},D=s=>{C({open:!0,message:`Êtes-vous sûr de vouloir supprimer ${s.nom} ${s.prenom}?`,id:s.id})},q=async()=>{const{message:s}=await R(u.id);t({...h,message:s,open:!0}),C({...u,open:!1,id:0}),j(),g(1)},P=async s=>{$.visit(`/client/${s}`)};return e.jsxs(Y,{children:[e.jsx(H,{title:"Maraîchers"}),e.jsx(U,{title:"Liste des Maraîchers",handleClick:F,onSearch:w,search:N}),e.jsx(te,{setOpen:f,open:a,dataModify:r,onCloseFormulaire:L}),e.jsx(X,{message:h.message,type:h.type,duration:3e3,position:"top-right",show:h.open,onClose:()=>t({...h,message:"",open:!1})}),e.jsx(z,{open:u.open,message:u.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>C({...u,open:!1}),accept:q}),m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):e.jsx("div",{children:b.length>0?e.jsx(J,{headers:k,rows:b,itemsPerPage:10,actions:E,className:"mt-4",currentPage:I,onPageChange:g}):e.jsx(Q,{nom:"maraîcher",search:N})})]})};export{we as default};
