import{j as e,r as d,v as M,e as _,$}from"./app-D-Msguey.js";import{A as P}from"./AuthenticatedLayout-Bw4RC58Y.js";import{g as T,d as z}from"./userService-RqtS7Mun.js";import{H}from"./HeaderPage-fxkogYHJ.js";import{S as V}from"./Snackbar-B-sLl9kM.js";import{C as O}from"./ConfirmDialog-B3pI7AOS.js";import{t as R,z as W,F as B,v as G,u as J}from"./constant-3wDyiK4X.js";import{E as K}from"./EmptyState-Ct5Sk4pD.js";import{M as Q}from"./Modal-Dj6VuHeP.js";import{I as y}from"./InputLabel-BuZNzSG6.js";import{T as v,I as w}from"./TextInput-DxwFrn0K.js";import"./transition-D6kUAclv.js";import"./iconBase-CBus6TuK.js";import"./useTheme-DYp9nMDG.js";import"./index-pZmJ4psc.js";import"./index-CAPDwIcR.js";import"./api-DIg4nFRg.js";import"./createLucideIcon-DqXJoUaS.js";const X=({user:a,handleDelete:b,handleImageError:r})=>{var o,h,m,n,p,l,u,i,x,j,f,t;return e.jsxs("div",{className:"overflow-hidden transition-all duration-300 transform bg-white shadow-lg dark:bg-gray-800 rounded-xl hover:scale-105 hover:shadow-xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-400 via-pink-500 to-purple-600 dark:from-indigo-600 dark:via-purple-600 dark:to-blue-700 opacity-90"}),e.jsxs("div",{className:"relative flex items-start justify-between px-6 pt-4 pb-14",children:[e.jsx("h3",{className:"text-xl font-bold text-white truncate",children:a.name}),e.jsx("div",{className:"relative",children:!a.user_role.isAdmin&&e.jsx("button",{onClick:()=>b(a.id),className:"p-2 text-white transition-colors rounded-full hover:bg-red-50 dark:hover:bg-gray-700",children:e.jsx(R,{})})})]}),e.jsx("div",{className:"absolute -bottom-12 left-6",children:e.jsx("div",{className:"w-24 h-24 overflow-hidden border-4 border-white shadow-md rounded-xl dark:border-gray-800",children:(o=a.profile)!=null&&o.photo||(h=a.technicien)!=null&&h.photo||(m=a.partenaire)!=null&&m.logo?e.jsx("img",{src:((n=a.profile)==null?void 0:n.photo)||((p=a.technicien)==null?void 0:p.photo)||((l=a.partenaire)==null?void 0:l.logo),alt:`${a.name}'s profile`,className:"object-cover w-full h-full bg-gray-100 dark:bg-gray-900",onError:r}):e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gradient-to-br from-gray-100 to-gray-300 dark:from-gray-700 dark:to-gray-600",children:e.jsx(W,{className:"text-4xl text-gray-400 dark:text-gray-300"})})})})]}),e.jsxs("div",{className:"px-6 pb-6 pt-14",children:[e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 text-xs font-medium text-white rounded-full bg-gradient-to-r from-green-400 to-blue-500",children:a.user_role.name})}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:a.email})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(G,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((u=a.technicien)==null?void 0:u.contact)||((i=a.profile)==null?void 0:i.contact)||((x=a.partenaire)==null?void 0:x.telephone)})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(J,{className:"mr-2 text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((j=a.technicien)==null?void 0:j.adress)||((f=a.profile)==null?void 0:f.adress)||((t=a.partenaire)==null?void 0:t.adresse)})]})]})]})]},a.id)},Y=({open:a,closeForm:b})=>{const[r,o]=d.useState({}),[h,m]=d.useState(!1),{data:n,setData:p,errors:l,reset:u}=M({name:"",email:"",contact:"",adress:""}),i=t=>{b(t),x()},x=()=>{u(),o({}),m(!1)},j=(t,N)=>{const g={};return t.name||(g.name="Le nom est obligatoire"),t.email||(g.email="L'email est obligatoire"),t.contact||(g.contact="Le contact est obligatoire"),t.adress||(g.adress="L'adresse est obligatoire"),N(g),Object.keys(g).length===0},f=()=>{j(n,o)&&(m(!0),_.post("create/admin",n).then(t=>{m(!1),i(t.data.message)}).catch(t=>{m(!1),t.response&&t.response.data&&o(t.response.data.errors||{})}))};return e.jsxs(Q,{show:a,maxWidth:"xl",onClose:()=>i(""),closeable:!1,children:[e.jsx("div",{className:"text-center font-semibold text-2xl",children:"Créer un Administrateur"}),e.jsxs("form",{className:"w-full my-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"name",value:"Nom"}),e.jsx(v,{id:"name",name:"name",value:n.name,className:"mt-1 block w-full",autoComplete:"name",isFocused:!0,onChange:t=>p("name",t.target.value),required:!0,onFocus:()=>o({...r,name:""})}),e.jsx(w,{message:r.name||l.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"email",value:"Email"}),e.jsx(v,{id:"email",name:"email",value:n.email,className:"mt-1 block w-full",autoComplete:"email",onChange:t=>p("email",t.target.value),required:!0,onFocus:()=>o({...r,email:""})}),e.jsx(w,{message:r.email||l.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"contact",value:"Contact"}),e.jsx(v,{id:"contact",name:"contact",value:n.contact,className:"mt-1 block w-full",autoComplete:"contact",type:"number",onChange:t=>p("contact",t.target.value),required:!0,onFocus:()=>o({...r,contact:""})}),e.jsx(w,{message:r.contact||l.contact,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"adress",value:"adress"}),e.jsx(v,{id:"adress",name:"adress",value:n.adress,className:"mt-1 block w-full",autoComplete:"adress",onChange:t=>p("adress",t.target.value),required:!0,onFocus:()=>o({...r,adress:""})}),e.jsx(w,{message:r.adress||l.adress,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"rounded-md py-1 px-4 text-red-500 bg-red-400/10",onClick:()=>i(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${h&&"opacity-25"}`,disabled:h,onClick:f,children:"Enregistrer"})]})]})},fe=()=>{const[a,b]=d.useState([]),[r,o]=d.useState([]),[h,m]=d.useState(!0),[n,p]=d.useState(""),[l,u]=d.useState({open:!1,message:"",id:0}),[i,x]=d.useState({open:!1,message:"",type:"success"}),[j,f]=d.useState(!1),t=async()=>{try{const s=await T();b(s),o(s)}catch(s){console.error("Failed to fetch users:",s)}finally{m(!1)}};d.useEffect(()=>{t()},[]);const N=s=>{p(s);const q=a.filter(c=>{var C,L,k,F,S,E,U;return c.name.toLowerCase().includes(s.toLowerCase())||c.email.toLowerCase().includes(s.toLowerCase())||((C=c.technicien)==null?void 0:C.contact.toLowerCase().includes(s.toLowerCase()))||((L=c.technicien)==null?void 0:L.adress.toLowerCase().includes(s.toLowerCase()))||c.user_role.name.toLowerCase().includes(s.toLowerCase())||((k=c.profile)==null?void 0:k.adress.toLowerCase().includes(s.toLowerCase()))||((F=c.profile)==null?void 0:F.contact.toLowerCase().includes(s.toLowerCase()))||((S=c.partenaire)==null?void 0:S.telephone.toLowerCase().includes(s.toLowerCase()))||((E=c.partenaire)==null?void 0:E.adresse.toLowerCase().includes(s.toLowerCase()))||((U=c.partenaire)==null?void 0:U.site_web.toLowerCase().includes(s.toLowerCase()))});o(q)},g=s=>{s&&x({open:!0,message:s,type:"success"}),f(!1),t()},A=s=>{s.target.onerror=null,s.target.src="/path/to/default-avatar.png"},I=s=>{u({open:!0,message:"Voulez-vous vraiment supprimer cet utilisateur ?",id:s})},D=async()=>{const s=await z(l.id);s.success?(x({...i,open:!0,message:"Utilisateur supprimé avec succès",type:"success"}),u({...l,open:!1}),t()):x({...i,open:!0,message:s.message,type:"error"})};return e.jsxs(P,{children:[e.jsx($,{title:"Users"}),e.jsx(H,{title:"Liste des utilisateurs",onSearch:N,search:n,handleClick:()=>f(!0)}),e.jsx(O,{open:l.open,message:l.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",accept:D,close:()=>u({...l,open:!1,id:0})}),e.jsx(Y,{closeForm:g,open:j}),e.jsx(V,{message:i.message,type:i.type,duration:3e3,position:"top-right",show:i.open,onClose:()=>x({...i,message:"",open:!1})}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r.length===0?e.jsx(K,{nom:"utilisateur",search:n}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map(s=>e.jsx(X,{user:s,handleDelete:I,handleImageError:A},s.id))})})})]})};export{fe as default};
