import{r as a,q as J,j as n,$ as K,m as S}from"./app-C0R29XIQ.js";import{C as Q}from"./ConfirmDialog-f1tpS5vD.js";import{D as U}from"./DataTable-DjK83WDT.js";import{E as X}from"./EmptyState-OdRGVVF3.js";import{H as Y}from"./HeaderPage-DAMjy7Qd.js";import{F as Z}from"./FormulaireMaintenance-C8vliHbA.js";import{F as ee}from"./FormulaireRapportMaintenance-mvF2lTy2.js";import{S as te}from"./Snackbar-BZIn-37I.js";import{f as ne,q as ae}from"./constant-DIokkB-X.js";import{A as oe,R as se}from"./AuthenticatedLayout-BghdF22p.js";import{g as re,d as ie}from"./maintenanceService-C5fZ3Hqq.js";import{G as le}from"./index-CpSAhMeT.js";import{T as de,a as pe}from"./index-BdfHga1E.js";import"./Modal-B1XyOMts.js";import"./transition-CbffA-Ro.js";import"./index-CB1r69tB.js";import"./iconBase-DfiWWOnY.js";import"./TextInput-FYzGsY1y.js";import"./createLucideIcon-BAjLB3is.js";import"./InputLabel-DSyv-HIR.js";import"./installationService-BEWpXYzZ.js";import"./api-BP3h3n6A.js";import"./InputAutocomplete -CtzQ-Szb.js";import"./SelectInput-CZz8WQiz.js";import"./validateForm-CtIdfQW8.js";import"./TextArea-3BjdIvWP.js";import"./InputImage-CqgJxqQf.js";import"./useTheme-BdVR9D_r.js";const qe=()=>{const[u,D]=a.useState(""),[x,k]=a.useState(0),[N,p]=a.useState(!1),[R,b]=a.useState(!1),[L,f]=a.useState({}),[P,h]=a.useState({}),[T,m]=a.useState(1),[g,F]=a.useState([]),[_,v]=a.useState([]),[I,y]=a.useState(!0),[r,c]=a.useState({open:!1,message:"",id:0}),[s,l]=a.useState({open:!1,message:"",type:"success"}),i=J().props.auth.user,[M,$]=a.useState(10),E=[{key:"id",label:"ID",sortable:!0},{key:"code_installation",label:"Installation",sortable:!0},{key:"nom",label:"Client",sortable:!0},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème",customRender:e=>n.jsxs("div",{className:"relative max-w-md group",children:[n.jsx("span",{className:"line-clamp-2",children:e}),n.jsx("div",{className:"absolute bottom-0 left-0 z-50 hidden max-w-md p-2 mt-2 text-sm text-gray-800 bg-white border border-gray-300 rounded shadow-md group-hover:block",children:e})]})},{key:"date_intervention",label:"Date d'intervenir",sortable:!0},{key:"status_intervention",label:"Statuts",customRender:e=>n.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap ${e==="terminée"?"bg-green-500/50":e==="en attente"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"status_intervention",label:"Rapport",sortable:!0,customRender:(e,o)=>{var t,C,j;return n.jsx("span",{onClick:()=>{var w;return e==="terminée"?S.visit("/rapport",{data:{intervention_id:o.id}}):((w=i.user_role)==null?void 0:w.name)==="partenaire"?null:O(o)},className:`px-2 py-1 rounded-full flex text-nowrap ${((t=i.user_role)==null?void 0:t.name)==="partenaire"&&e!=="terminée"?"cursor-default":"cursor-pointer"} ${e==="terminée"?"text-green-500":((C=i.user_role)==null?void 0:C.name)==="partenaire"?"text-gray-300":"text-blue-500"}`,children:e==="terminée"?"Consulter":((j=i.user_role)==null?void 0:j.name)==="partenaire"?"En attente":"Ajouter"})}},{key:"created_via",label:"Via",customRender:e=>n.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?n.jsx(pe,{}):n.jsx(se,{className:"text-blue-400"})})}],A=[{label:n.jsx(de,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>W(e)},{label:n.jsx(le,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>B(e)}],q=()=>{p(!0)},O=e=>{var o;((o=i.user_role)==null?void 0:o.name)==="partenaire"?S.visit("/rapport",{data:{intervention_id:e.id}}):(b(!0),h(e))},d=async()=>{y(!0);const{data:e}=await re(),o=e.map(t=>({id:t.id,installation_id:t.installation_id,code_installation:t.installation.code_installation,nom:t.installation.client.nom+" "+t.installation.client.prenom,idclient:t.installation.client.id,type_intervention:t.type_intervention,description_probleme:t.description_probleme,status_intervention:t.status_intervention,date_intervention:ne(t.date_intervention),created_via:t.created_via}));F(o),v(o),y(!1)};a.useEffect(()=>{d()},[]);const G=e=>{D(e),m(1);const o=g.filter(t=>(t==null?void 0:t.nom.toLowerCase().includes(e.toLowerCase()))||(t==null?void 0:t.type_intervention.toLowerCase().includes(e.toLowerCase()))||(t==null?void 0:t.description_probleme.toLowerCase().includes(e.toLowerCase()))||(t==null?void 0:t.date_intervention.toString().toLowerCase().includes(e.toLowerCase()))||(t==null?void 0:t.code_installation.toLowerCase().includes(e.toLowerCase())));v(o)},H=e=>{d(),e&&l({...s,message:e,open:!0}),f({})},z=e=>{d(),e&&l({...s,message:e,open:!0}),h({})},B=e=>{c({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${e.nom} le ${e.date_intervention} ?`,id:e.id})},V=async()=>{const{message:e}=await ie(r.id);l({...s,message:e,open:!0}),c({...r,open:!1,id:0}),d(),m(1)},W=e=>{const o=e.date_intervention?e.date_intervention:"Invalid date";f({...e,date_intervention:ae(o)}),p(!0)};return n.jsxs(oe,{setId:k,children:[n.jsx(K,{title:"Maintenance"}),n.jsx(Y,{search:u,onSearch:G,title:`Liste des interventions ( Total: ${g.length} )`,handleClick:q}),n.jsx(te,{message:s.message,type:s.type,duration:3e3,position:"top-right",show:s.open,onClose:()=>l({...s,message:"",open:!1})}),n.jsx(Q,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>c({...r,open:!1}),accept:V}),n.jsx(Z,{open:N,setOpen:p,dataModify:L,onCloseFormulaire:H,idTechnicien:x}),n.jsx(ee,{open:R,setOpen:b,dataModify:P,onCloseFormulaire:z,idTechnicien:x}),I?n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):n.jsx("div",{children:_.length>0?n.jsx(U,{headers:E,rows:_,itemsPerPage:M,actions:A,className:"mt-4",currentPage:T,onPageChange:m,masqueColumns:["client_id"],onItemsPerPageChange:e=>$(e)}):n.jsx(X,{nom:"intervention",search:u})})]})};export{qe as default};
