import{j as e,r as w,$ as J}from"./app-BJfPsfag.js";import{A as $,R as K}from"./AuthenticatedLayout-D4akSFUr.js";import{a as Q}from"./clientService-BE-d0xJq.js";import{h as o,a as g,F as X,b as Z,c as B,H as ee,d as te,e as W,g as se,i as ae,j as re,k as ne,I as le,l as de,L as ie}from"./constant-cHJbaWBm.js";import"./fr-Br33CVeN.js";import{E as oe}from"./EmptyState-DavDfsE4.js";import{T as ce}from"./index-DoyDqgDf.js";import"./transition-DZhRA893.js";import"./iconBase-DqttCwT8.js";import"./useTheme-DgOsgskR.js";import"./index-GLRcKjo_.js";import"./Modal-C4qayzp5.js";import"./createLucideIcon-pjZXBrfN.js";import"./api-htqHBfnF.js";o.locale("fr");const xe=({paiement:t,getStatusColor:c,getStatusBadge:r})=>{var l;if(!t)return null;const n=(i,u)=>{if(!i||!u)return"";const b=o(i),f=o(u);return b.isBefore(f,"day")?{color:"text-green-500",text:"(en avance)"}:b.isSame(f,"day")?{color:"text-blue-500",text:"(à temps)"}:{color:"text-red-500",text:"(en retard)"}},d=t.date_paiement?n(t.date_paiement,t.date_echeance):"";return e.jsx("div",{className:`p-4 mb-4 border-2 rounded-lg ${c(t.statut_paiement)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Installation"}),t.date_paiement&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o(t.date_paiement).format("DD MMM YYYY")})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(t.montant)," FCFA"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r(t.statut_paiement,t.date_echeance),e.jsx("span",{className:`${d.color} text-xs`,children:d.text})]}),t.date_paiement&&((l=t.statut_paiement)==null?void 0:l.toLowerCase())==="payé"&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["le"," ",o(t.date_paiement).format("DD MMM YYYY")," "]})]})]})})},me=({montantPaye:t,montantRestant:c,pourcentagePaye:r,trimestresPayes:n,trimestresRestants:d,nombreTrimestres:l})=>e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Vue d'ensemble"}),e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsxs("div",{className:"relative w-40 h-40",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"12",strokeDasharray:`${r*2.51} ${251-r*2.51}`,className:"text-green-500 transition-all duration-500",strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[r,"%"]})})]})}),e.jsx("h4",{className:"mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Progression"}),e.jsx("div",{className:"w-full h-3 mb-4 overflow-hidden bg-gray-200 rounded-full dark:bg-gray-700",children:e.jsx("div",{className:"h-full transition-all duration-500 bg-gradient-to-r from-green-500 to-blue-500",style:{width:`${r}%`}})})]}),ge=({trimestre:t,getStatusColor:c,getStatusBadge:r,isDernierTrimestre:n})=>{var i;const d=((i=t.statut_paiement)==null?void 0:i.toLowerCase())==="payé",l=Math.max(t.montant_attendu-t.montant,0);return e.jsxs("div",{className:`p-4 border-2 rounded-lg transition-all ${c(t.statut_paiement,t.estIncomplet)}`,children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[t.echeance,n&&e.jsx("span",{className:"ml-2 text-xs font-normal text-orange-600 dark:text-orange-400",children:"(Dernier)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.periode})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[g(t.montant)," FCFA"]}),t.estIncomplet&&e.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:["Reste : ",g(l)," FCFA"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.statut_paiement,t.date_echeance,t.estIncomplet),e.jsx("span",{className:`text-xs ${t.remarque.color}`,children:t.remarque.text})]}),d&&t.date_paiement&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["le"," ",o(t.date_paiement).format("DD MMM YYYY")]})]})]})},he=({paiementsTrimestres:t,paiementInstallation:c,getStatusColor:r,getStatusBadge:n,nombreTrimestres:d})=>e.jsxs("div",{className:"p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Calendrier des Paiements"}),e.jsx(xe,{paiement:c,getStatusColor:r,getStatusBadge:n}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:t.map((l,i)=>e.jsx(ge,{trimestre:l,getStatusColor:r,getStatusBadge:n,isDernierTrimestre:i===d-1},l.id))})]}),pe=({paiements:t,client:c})=>{var I;if(!t||t.length===0)return null;const n=3*4,d=18e3,l=22e3,i=t.find(a=>{var s;return((s=a.echeance)==null?void 0:s.toLowerCase())==="installation"}),u=t.filter(a=>{var s;return(s=a.echeance)==null?void 0:s.match(/^T\d+$/i)}),b=(i==null?void 0:i.date_paiement)||((I=u[0])==null?void 0:I.date_paiement)||new Date,f=t.reduce((a,s)=>{if(!s.echeance)return a;const x=s.echeance.toUpperCase();return a[x]||(a[x]=[]),a[x].push(s),a},{}),M=(a,s)=>{if(!a||!s)return"";const x=o(a),p=o(s);return x.isBefore(p,"month")?{color:"text-green-500",text:"(en avance)"}:x.isSame(p,"month")?{color:"text-blue-500",text:"(à temps)"}:{color:"text-red-500",text:"(en retard)"}},Y=Array.from({length:n},(a,s)=>{const x=s+1,p=`T${String(x).padStart(2,"0")}`,C=x===n?l:d,A=f[p]||[],_=A.reduce((v,j)=>{var H;return((H=j.statut_paiement)==null?void 0:H.toLowerCase())==="payé"?v+parseFloat(j.montant||0):v},0),V=_>0&&_<C,T=_>=C?"payé":_>0?"incomplet":"en attente",S=A.filter(v=>{var j;return((j=v.statut_paiement)==null?void 0:j.toLowerCase())==="payé"}).sort((v,j)=>new Date(j.date_paiement)-new Date(v.date_paiement))[0],R=S?S.date_paiement:null,E=o(b).add(s*3,"months"),P=o(E).add(2,"months"),G=`${E.format("MMM YYYY")} – ${P.format("MMM YYYY")}`,z=(T==null?void 0:T.toLowerCase())==="payé"?M(R,P):"";return{id:`trim-${x}`,echeance:p,periode:G,montant:_,montant_attendu:C,statut_paiement:T,date_echeance:P.format("YYYY-MM-DD"),date_paiement:R,estIncomplet:V,remarque:z}}),F=d*(n-1)+l,N=(i?parseFloat(i.montant):0)+F,h=t.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).reduce((a,s)=>a+parseFloat(s.montant||0),0),k=N-h,m=N>0?Math.round(h/N*100):0,D=Y.filter(a=>{var s;return((s=a.statut_paiement)==null?void 0:s.toLowerCase())==="payé"}).length,L=n-D,O=(a,s)=>s?"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-700":(a==null?void 0:a.toLowerCase())==="payé"?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700":"bg-white border-gray-200 dark:bg-slate-800 dark:border-gray-700",U=(a,s,x)=>{const p=(a==null?void 0:a.toLowerCase())==="payé",C=!p&&s&&o(s).isBefore(o());return x?e.jsxs("div",{className:"flex items-center space-x-1 text-yellow-600 dark:text-yellow-400",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Incomplet"})]}):p?e.jsxs("div",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Payé"})]}):C?e.jsxs("div",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"En retard"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-orange-600 dark:text-orange-400",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"À venir"})]})};return e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-6 border-b border-gray-200 md:grid-cols-4 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[g(N)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Payé"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[g(h)," FCFA"]}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:[m,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Reste"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:[g(k)," FCFA"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[L," trim."]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestriel"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[g(d)," FCFA"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"/3 mois"})]})]}),e.jsx(me,{montantPaye:h,montantRestant:k,pourcentagePaye:m,trimestresPayes:D,trimestresRestants:L,montantTrimestrielNormal:d,nombreTrimestres:n}),e.jsx(he,{paiementsTrimestres:Y,paiementInstallation:i,getStatusColor:O,getStatusBadge:U,nombreTrimestres:n}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-6 border-t-2 border-gray-200 md:grid-cols-4 dark:border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant payé"}),e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[g(h)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Montant restant"}),e.jsxs("p",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:[g(k)," FCFA"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres payés"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[D," / ",n]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trimestres restants"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:L})]})]})]})},y=({icon:t,label:c,value:r,bgColor:n,iconColor:d})=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg ${n}`,children:e.jsx(t,{className:`w-5 h-5 ${d}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:c}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:r||"Non renseigné"})]})]}),q=({message:t="Chargement des données..."})=>e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 rounded-full border-t-transparent animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t})]})}),je=({client:t,installation:c})=>{const r=c&&c.length>0?c[0]:null;return e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col justify-between space-y-4 md:flex-row md:space-y-0 md:items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-full bg-teal-500/10",children:e.jsx(ee,{className:"w-8 h-8 text-teal-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.nom," ",t.prenom]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Client ID: #",t.id]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Inscrit le"," ",o(t.created_at).format("DD MMM YYYY")]})]})]})]}),r&&e.jsxs("div",{className:`flex items-center px-4 py-3 space-x-3 rounded-lg text-white border-2 ${r.statuts==="installée"?"border-green-500 bg-green-500/10":"border-red-500 bg-red-500/10"}`,children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-yellow-500/20",children:e.jsx(te,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase dark:text-gray-400",children:"Installation"}),e.jsx("p",{className:"text-base font-bold text-gray-900 dark:text-white",children:r.code_installation||"N/A"}),r.date_installation&&e.jsxs("div",{className:"flex items-center mt-1 space-x-1 text-xs text-gray-600 dark:text-gray-400",children:[e.jsx(W,{className:"w-3 h-3"}),e.jsx("span",{children:o(r.date_installation).format("DD MMM YYYY")})]})]})]})]})})};o.locale("fr");const De=({client:t})=>{var F;const[c,r]=w.useState([]),[n,d]=w.useState([]),[l,i]=w.useState(null),[u,b]=w.useState(!0),[f,M]=w.useState(!0),Y=async N=>{var h,k;try{M(!0);const m=await Q(N);m&&(d(((h=m.client)==null?void 0:h.installations)||[]),r(((k=m.client)==null?void 0:k.paiement)||[]),i(m.client))}catch(m){console.error("Erreur lors de la récupération des données:",m)}finally{b(!1),M(!1)}};return w.useEffect(()=>{t!=null&&t.id&&Y(t.id)},[t]),u?e.jsx($,{children:e.jsx(q,{})}):t?e.jsxs($,{children:[e.jsx(J,{title:`${t.nom} ${t.prenom}`}),f?e.jsx(q,{}):e.jsx("div",{className:"px-4 py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"overflow-hidden bg-white rounded-lg shadow-lg dark:bg-slate-800",children:[e.jsx(je,{client:t,installation:n}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 p-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{icon:se,label:"Téléphone",value:t.telephone,bgColor:"bg-blue-50 dark:bg-blue-900/20",iconColor:"text-blue-600 dark:text-blue-400"}),e.jsx(y,{icon:ae,label:"Email",value:t.email,bgColor:"bg-indigo-50 dark:bg-indigo-900/20",iconColor:"text-indigo-600 dark:text-indigo-400"}),e.jsx(y,{icon:re,label:"CIN",value:t.CIN,bgColor:"bg-yellow-50 dark:bg-yellow-900/20",iconColor:"text-yellow-600 dark:text-yellow-400"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-red-50 dark:bg-red-900/20",children:e.jsx(ne,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Localisation"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:(l==null?void 0:l.localisation)||"Non renseigné"}),((F=l==null?void 0:l.localisation)==null?void 0:F.pays)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l.localisation.pays})]})]}),e.jsx(y,{icon:le,label:"Genre",value:t.genre,bgColor:"bg-purple-50 dark:bg-purple-900/20",iconColor:"text-purple-600 dark:text-purple-400"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-orange-50 dark:bg-orange-900/20",children:e.jsx(W,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Date du contrat"}),e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:o(t.date_contrat).format("DD MMM YYYY")})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{icon:de,label:"Surface cultivée",value:`${t.surface_cultivee} ha`,bgColor:"bg-green-50 dark:bg-green-900/20",iconColor:"text-green-600 dark:text-green-400"}),e.jsx(y,{icon:ie,label:"Type d'activité agricole",value:t.type_activite_agricole,bgColor:"bg-teal-50 dark:bg-teal-900/20",iconColor:"text-teal-600 dark:text-teal-400"}),e.jsx(y,{icon:t.created_via==="telegram_bot"?K:ce,label:"Type d'activité agricole",value:t.created_via==="telegram_bot"?"Telegram":t.created_via||"Non renseigné",bgColor:t.created_via==="telegram_bot"?"bg-blue-50 dark:bg-blue-900/20":"bg-black/5 dark:bg-white/10",iconColor:t.created_via==="telegram_bot"?"text-blue-600 dark:text-blue-400":"text-black dark:text-white"})]})]})]}),e.jsx(pe,{paiements:c,client:t})]})})]}):e.jsx($,{children:e.jsx(oe,{message:"Aucune donnée client disponible"})})};export{De as default};
