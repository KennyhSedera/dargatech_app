import{r as b,j as e,e as L,v as Q,$ as V}from"./app-CKIQC7bl.js";import{I as r}from"./InputLabel-CLXF8NDZ.js";import{T as d,I as _}from"./TextInput-CrJOgruW.js";import{u as X}from"./useTheme-CqPKuz4y.js";import{D as B}from"./DangerButton-BYQd2MHe.js";import{g as z}from"./TypePaiementService-Bnr-w7Tl.js";import{b as K}from"./clientService-CgtVVlBX.js";import{P as J}from"./PrimaryButton-CuBaYsC-.js";import{T as W}from"./TextArea-uAW7LeS_.js";import{S as D}from"./SelectInput-D3RubUYM.js";import{I as Z}from"./InputAutocomplete -C9q5CEsw.js";import{g as E,a as ee,u as te,c as ae}from"./PaiementService-dy_HWb9c.js";import{S as se}from"./Snackbar-BgpWpSLL.js";import{F as le}from"./FichierPaiementPdf-BXHNjZAy.js";import{s as ne,h as O}from"./constant-Ccl-ng2K.js";import"./createLucideIcon-CKqiLiGq.js";import"./api-DgjbNlyT.js";import"./iconBase-BrNMzGLU.js";const re=({data:c,setData:m})=>{const[l,o]=b.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);b.useEffect(()=>{c.produits&&c.produits.length>0&&o(c.produits)},[c.produits]);const s=n=>{const t=parseFloat(n.quantite)||0,i=parseFloat(n.prix_unitaire)||0,j=parseFloat(n.tva)||0,k=t*i,y=k*(1+j/100);return{total_ht:k,total_ttc:y}},a=(n,t,i)=>{const j=[...l];if(j[n][t]=i,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:y,total_ttc:C}=s(j[n]);j[n].total_ht=y,j[n].total_ttc=C}o(j);const k={produits:j,description:c.description||"",montant_paye:v(j).totalTTCGlobal.toFixed(2)};m(y=>({...y,...k}))},v=n=>{const t=y=>{const C=parseFloat(y);return isNaN(C)?0:C},i=n.reduce((y,C)=>y+t(C.total_ht),0),j=n.reduce((y,C)=>y+t(C.total_ttc),0),k=n.reduce((y,C)=>{const $=t(C.tva),S=t(C.total_ht);return y+S*$/100},0);return{totalHTGlobal:parseFloat(i.toFixed(2)),totalTTCGlobal:parseFloat(j.toFixed(2)),totalTVAGlobal:parseFloat(k.toFixed(2))}},{totalHTGlobal:x,totalTTCGlobal:P,totalTVAGlobal:F}=v(l),w=()=>{const n=[...l,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];o(n),m(t=>({...t,produits:n}))},u=n=>{const t=l.filter((j,k)=>k!==n);o(t);const i=v(t);m(j=>({...j,produits:t,montant_paye:i.totalTTCGlobal.toFixed(2)}))},N=n=>{const t=n.target.value;m(i=>({...i,description:t}))},T=n=>{const t=parseFloat(n);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[e.jsx("div",{className:"block lg:hidden",children:l.map((n,t)=>e.jsxs("div",{className:"relative p-4 mb-4 border border-gray-200 rounded-lg",children:[t>0&&e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-xs text-white bg-red-500 rounded-full -top-2 -right-2",onClick:()=>u(t),children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(r,{htmlFor:`designation-${t}`,value:"Nom"}),e.jsx(d,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:i=>a(t,"designation",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`reference-${t}`,value:"Réf"}),e.jsx(d,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:i=>a(t,"reference",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`quantite-${t}`,value:"Qté"}),e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:i=>a(t,"quantite",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`unite-${t}`,value:"Unité"}),e.jsx(d,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:i=>a(t,"unite",i.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`tva-${t}`,value:"TVA%"}),e.jsx(d,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:i=>a(t,"tva",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"}),e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:i=>a(t,"prix_unitaire",i.target.value),required:!0,type:"number",min:0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`total_ht-${t}`,value:"Total HT"}),e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(n.total_ht),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ht",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:`total_ttc-${t}`,value:"Total TTC"}),e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(n.total_ttc),className:"block w-full mt-1 bg-gray-100",autoComplete:"total_ttc",readOnly:!0})]})]})]},t))}),e.jsx("div",{className:"hidden lg:block",children:l.map((n,t)=>e.jsxs("div",{className:"relative grid grid-cols-11 gap-3 my-4",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(r,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(r,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(d,{id:`designation-${t}`,name:"designation",value:n.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:i=>a(t,"designation",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`reference-${t}`,name:"reference",value:n.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:i=>a(t,"reference",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`quantite-${t}`,name:"quantite",value:n.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:i=>a(t,"quantite",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`unite-${t}`,name:"unite",value:n.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:i=>a(t,"unite",i.target.value),required:!0})}),e.jsx("div",{children:e.jsx(d,{id:`tva-${t}`,name:"tva",value:n.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:i=>a(t,"tva",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:n.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:i=>a(t,"prix_unitaire",i.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ht-${t}`,name:"total_ht",value:T(n.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(d,{id:`total_ttc-${t}`,name:"total_ttc",value:T(n.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"absolute w-5 h-5 text-xs text-white bg-red-500 rounded-full -right-2 -top-2",onClick:()=>u(t),children:"×"})]},t))}),e.jsx(W,{name:"description",value:c.description||"",placeholder:"Description",onChange:N,rows:"2",className:"w-full mt-4 border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600"}),e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 mt-4 sm:flex-row sm:items-center",children:[e.jsx("button",{className:"px-4 py-2 text-white transition-colors bg-blue-500 rounded hover:bg-blue-600",onClick:w,children:"+ Produit"}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("div",{className:"p-4 rounded-lg bg-gray-50",children:e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total HT"}),e.jsx("td",{className:"font-mono text-right",children:x.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pr-4 font-medium",children:"Total TVA"}),e.jsx("td",{className:"font-mono text-right",children:F.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]}),e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{className:"py-1 pr-4",children:"Total TTC"}),e.jsx("td",{className:"font-mono text-right",children:P.toFixed(2)}),e.jsx("td",{className:"pl-2 text-gray-600",children:"XOF"})]})]})})})})]})]})},oe=({data:c,setData:m,validationErrors:l,errors:o,setValidationErrors:s})=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx(r,{htmlFor:"type",value:"Type"}),e.jsx(D,{id:"type",name:"type",value:c.type,className:"block w-full mt-1",autoComplete:"type",onChange:a=>m("type",a.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(_,{message:l.type||o.type,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(r,{htmlFor:"numero",value:"N*"}),e.jsx(d,{id:"numero",name:"numero",value:c.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:a=>m("numero",a.target.value),required:!0,disabled:!0,onFocus:()=>s({...l,numero:""})}),e.jsx(_,{message:l.numero||o.numero,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(r,{htmlFor:"date_creation",value:"Date de création"}),e.jsx(d,{id:"date_creation",name:"date_creation",value:c.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:a=>m("date_creation",a.target.value),type:"date",required:!0,onFocus:()=>s({...l,date_creation:""})}),e.jsx(_,{message:l.date_creation||o.date_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(r,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(d,{id:"lieu_creation",name:"lieu_creation",value:c.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:a=>m("lieu_creation",a.target.value),required:!0,onFocus:()=>s({...l,lieu_creation:""})}),e.jsx(_,{message:l.lieu_creation||o.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1 sm:col-span-2 lg:col-span-1",children:[e.jsx(r,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx(D,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:c.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:a=>m("date_additionnel",a.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(_,{message:o.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx(r,{htmlFor:"date",value:"*"}),e.jsx(d,{id:"date",name:"date",value:c.date,className:"block w-full mt-1",autoComplete:"date",onChange:a=>m("date",a.target.value),required:!0,type:"date",onFocus:()=>s({...l,date:""})})]})]}),ie=({clients:c,data:m,setData:l,errors:o,validationErrors:s,setValidationErrors:a,handleSelect:v})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 text-lg font-bold",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(r,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs(D,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:m.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:x=>l("civilite_acheteur",x.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(_,{message:o.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(r,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(Z,{data:c,className:"block w-full mt-1",onSelect:v,defaultValue:m.client_id,onFocus:()=>a({...s,client_id:""})}),e.jsx(_,{message:s.prenom_acheteur||o.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"sm:col-span-1 lg:col-span-2",children:[e.jsx(r,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(d,{id:"nom_acheteur",name:"nom_acheteur",value:m.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:x=>l("nom_acheteur",x.target.value),required:!0,onFocus:()=>a({...s,nom_acheteur:""})}),e.jsx(_,{message:s.nom_acheteur||o.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(d,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:m.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:x=>l("num_rue_acheteur",x.target.value),required:!0,onFocus:()=>a({...s,num_rue_acheteur:""})}),e.jsx(_,{message:s.num_rue_acheteur||o.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(d,{id:"ville_acheteur",name:"ville_acheteur",value:m.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:x=>l("ville_acheteur",x.target.value),required:!0,onFocus:()=>a({...s,ville_acheteur:""})}),e.jsx(_,{message:s.ville_acheteur||o.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(d,{id:"pays_acheteur",name:"pays_acheteur",value:m.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:x=>l("pays_acheteur",x.target.value),required:!0,onFocus:()=>a({...s,pays_acheteur:""})}),e.jsx(_,{message:s.pays_acheteur||o.pays_acheteur,className:"mt-2"})]})]})]})]}),me=({data:c,setData:m,errors:l,validationErrors:o,setValidationErrors:s})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(d,{id:"nom_vendeurs",name:"nom_vendeurs",value:c.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:a=>m("nom_vendeurs",a.target.value),required:!0,onFocus:()=>s({...o,nom_vendeurs:""})}),e.jsx(_,{message:o.nom_vendeurs||l.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"sm:col-span-1",children:[e.jsx(r,{htmlFor:"select1",value:"Type"}),e.jsx(D,{id:"select1",type:"select1",name:"select1",value:c.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:a=>m("select1",a.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(r,{htmlFor:"num_tva",value:"Numéro"}),e.jsx(d,{id:"num_tva",name:"num_tva",value:c.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:a=>m("num_tva",a.target.value),required:!0,onFocus:()=>s({...o,num_tva:""}),placeholder:"Entrez le numéro TVA"}),e.jsx(_,{message:o.num_tva||l.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(d,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:c.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:a=>m("nom_rue_vendeur",a.target.value),required:!0,onFocus:()=>s({...o,nom_rue_vendeur:""})}),e.jsx(_,{message:o.nom_rue_vendeur||l.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(d,{id:"ville_vendeur",name:"ville_vendeur",value:c.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:a=>m("ville_vendeur",a.target.value),required:!0,onFocus:()=>s({...o,ville_vendeur:""})}),e.jsx(_,{message:o.ville_vendeur||l.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(d,{id:"pays_vendeur",name:"pays_vendeur",value:c.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:a=>m("pays_vendeur",a.target.value),required:!0,onFocus:()=>s({...o,pays_vendeur:""})}),e.jsx(_,{message:o.pays_vendeur||l.pays_vendeur,className:"mt-2"})]})]})]})]}),ce=({data:c,errors:m,setData:l,setValidationErrors:o,validationErrors:s,typePaiement:a})=>e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 lg:gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx(D,{id:"mode_paiement",name:"mode_paiement",value:c.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:v=>l("mode_paiement",v.target.value),required:!0,children:a.map(v=>e.jsx("option",{value:v.nom,children:v.nom},v.id))}),e.jsx(_,{message:s.mode_paiement||m.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(d,{id:"date_echeance",name:"date_echeance",value:c.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:v=>l("date_echeance",v.target.value),required:!0,type:"date",onFocus:()=>o({...s,date_echeance:""})}),e.jsx(_,{message:s.date_echeance||m.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(d,{id:"nom_vendeur",name:"nom_vendeur",value:c.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:v=>l("nom_vendeur",v.target.value),required:!0,onFocus:()=>o({...s,nom_vendeur:""})}),e.jsx(_,{message:s.nom_vendeur||m.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"etat_paiment",value:"État"}),e.jsx(D,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:c.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:v=>l("etat_paiment",v.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(_,{message:s.etat_paiment||m.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"montant_paye",name:"montant_paye",value:c.montant_paye,className:"block w-full pr-12 mt-1 bg-gray-50",autoComplete:"montant_paye",readOnly:!0,onChange:v=>l("montant_paye",v.target.value),required:!0,onFocus:()=>o({...s,montant_paye:""})}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-sm text-gray-500",children:"XOF"})})]}),e.jsx(_,{message:s.montant_paye||m.montant_paye,className:"mt-2"})]})]})]}),ue=async(c,m)=>{var l,o;try{const s=await L.post("/api/paiement/generate-and-send-pdf",{email:m,data:c});return s.data.success&&alert(s.data.message),s.data}catch(s){throw console.error("Erreur lors de l'envoi du PDF:",s),alert("Erreur lors de l'envoi du PDF: "+(((o=(l=s.response)==null?void 0:l.data)==null?void 0:o.message)||s.message)),s}};function de(c){const m=/(\d{2}\/\d{2}\/\d{4})/g,l=c.match(m);if(!l||l.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const o=l[0],s=l[1],a=F=>{const[w,u,N]=F.split("/");return new Date(`${u}/${w}/${N}`)},v=a(o),x=a(s),P=F=>({object:F,iso:F.toISOString(),localeFormat:F.toLocaleDateString(),original:`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`});return{startDate:P(v),endDate:P(x),durationDays:Math.floor((x-v)/(1e3*60*60*24))}}const $e=()=>{const{theme:c,setTheme:m}=X(),l=b.useRef(null),[o,s]=b.useState(!0),[a,v]=b.useState(null),[x,P]=b.useState(!1),w=new URLSearchParams(window.location.search).get("id"),{data:u,setData:N,errors:T,reset:n}=Q({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""}),[t,i]=b.useState({}),[j,k]=b.useState([]),[y,C]=b.useState([]),[$,S]=b.useState({open:!1,message:"",type:"success"}),[A,M]=b.useState(""),G=async()=>{var f;try{const[{clients:g},h]=await Promise.all([K(),z()]);k(g==null?void 0:g.map(p=>({id:p.id,nom:p.prenom,nom_famille:p.nom,ville:p.localisation,pays:"Togo",village:p.localisation,quartier:p.localisation,email:p.email,genre:p.genre,telephone:p.telephone,localisation:p.localisation}))),C((f=h.type)==null?void 0:f.map(p=>({id:p.id,nom:p.name})))}catch(g){console.error("Error fetching payment types:",g)}},R=async f=>{try{const g=await E(f);if(g){const h=g,p=j.find(q=>q.id===h.client_id),I=de(h.periode_couverte);u.periode_couverte=I.startDate.original+" au "+I.endDate.original,p&&(N({...u,numero:h.numero,nom_acheteur:p.nom_famille,prenom_acheteur:p.nom,civilite_acheteur:p.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:p.ville,pays_acheteur:p.pays,num_rue_acheteur:p.village||p.quartier,client_id:p.id,objet:h.observation,description:h.description,mode_paiement:h.mode_paiement,date_echeance:h.echeance,statut_paiement:h.statut_paiement,produits:h.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseFloat(h.montant).toFixed(2),date_creation:h.date_creation||I.startDate.original,date:h.date||I.endDate.original,lieu_creation:h.lieu_creation,date_additionnel:h.date_additionnel,nom_vendeur:h.nom_vendeur,nom_vendeurs:h.nom_vendeurs,select1:h.select1,num_tva:h.num_tva,nom_rue_vendeur:h.nom_rue_vendeur,ville_vendeur:h.ville_vendeur,pays_vendeur:h.pays_vendeur}),M(p.email)),P(!0)}}catch(g){console.error("Error fetching payment data:",g),S({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};b.useEffect(()=>{m(c||"light"),G()},[c]),b.useEffect(()=>{j.length>0&&w&&R(w)},[j,w]);const Y=async()=>{const{data:f}=await ee();f&&N("numero",ne(f.numero))};b.useEffect(()=>{w||Y()},[w]);const H=f=>{const g=j.find(h=>h.id===f.id);g&&(N("client_id",g.id),N("nom_acheteur",g.nom_famille),N("prenom_acheteur",g.nom),N("ville_acheteur",g.ville),N("pays_acheteur",g.pays),N("num_rue_acheteur",g.village||g.quartier),N("civilite_acheteur",g.genre==="Homme"?"Mr.":"Mme."),M(g.email))},U=async()=>{u.periode_couverte=O(u.date_creation).format("DD/MM/YYYY")+" au "+O(u.date).format("DD/MM/YYYY"),u.date_paiement=u.date_paiement?new Date(u.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],u.observation=u.objet,u.echeance=u.date_echeance,u.statut_paiement=u.etat_paiment,u.montant_paye=u.montant_paye||"0",u.montant=u.montant_paye||"0",x&&w&&(u.id=w);try{let f;x?f=await te(w,u):f=await ae(u),S({open:!0,message:f.message,type:f.success?"success":"error"}),f.success&&(setTimeout(()=>{n(),window.history.back()},3e3),ue(u,A))}catch(f){console.error("Error submitting payment:",f),S({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"min-h-screen p-4 bg-gray-100 sm:p-6 lg:p-10 dark:bg-gray-900 dark:text-white",children:[e.jsx(V,{title:x?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(se,{message:$.message,type:$.type,duration:3e3,position:"top-right",show:$.open,onClose:()=>S({...$,message:"",open:!1})}),e.jsxs("div",{className:"relative p-4 mx-auto bg-white rounded-lg shadow-lg max-w-7xl sm:p-6 dark:bg-gray-800",children:[e.jsx("div",{className:"mb-6",children:e.jsx(B,{onClick:()=>window.history.back(),className:"text-sm capitalize sm:text-base",children:"← Retour"})}),e.jsx("div",{className:"mb-6 text-xl font-bold text-center sm:text-2xl lg:text-3xl sm:mb-8",children:x?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(oe,{data:u,errors:T,setData:N,validationErrors:t,setValidationErrors:i})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-6 lg:grid-cols-2 sm:gap-6 lg:gap-8 sm:mb-8",children:[e.jsx("div",{className:"space-y-4",children:e.jsx(me,{data:u,errors:T,setData:N,setValidationErrors:i,validationErrors:t})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ie,{clients:j,data:u,errors:T,handleSelect:H,setData:N,setValidationErrors:i,validationErrors:t})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 my-6 md:grid-cols-2 sm:my-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx(r,{htmlFor:"objet",value:"Objet"}),e.jsx(d,{id:"objet",name:"objet",value:u.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:f=>N("objet",f.target.value),required:!0,onFocus:()=>i({...t,objet:""})}),e.jsx(_,{message:t.objet||T.objet,className:"mt-2"})]})}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center justify-start mb-4",children:e.jsx("span",{className:"text-lg font-bold sm:text-xl",children:"Désignations"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(re,{data:u,setData:N})})]}),e.jsx("div",{className:"w-full my-4 border-b sm:my-6 opacity-35"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(ce,{data:u,errors:T,setData:N,setValidationErrors:i,typePaiement:y,validationErrors:t})}),e.jsx("div",{className:"flex flex-col items-center justify-end gap-4 mt-6 sm:flex-row sm:mt-8",children:e.jsx(J,{className:"w-full px-6 py-2 text-sm sm:w-auto sm:px-10 sm:text-base",onClick:U,children:x?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:o&&a&&e.jsx("div",{ref:l,children:e.jsx(le,{data:a})})})]})};export{$e as default};
