import{j as e,r as d,m as M,e as _,L as P}from"./app-CnkIUv3B.js";import{A as T}from"./AuthenticatedLayout-DwESgWz7.js";import{g as z,d as H}from"./userService-D1Opl5vW.js";import{H as V}from"./HeaderPage-BSJfHehM.js";import{S as $}from"./Snackbar-DyGqIxJp.js";import{C as O}from"./ConfirmDialog-D1lJgOPT.js";import{t as R,z as W,F as B,v as G,u as J}from"./constant-C6uhH7Dw.js";import{E as K}from"./EmptyState-lj4ycwmg.js";import{M as Q}from"./Modal-Dpl8K2P_.js";import{I as w}from"./InputLabel-CWGpk8XY.js";import{T as v,I as N}from"./TextInput-QYPNaLiJ.js";import"./transition-DTInvTIh.js";import"./iconBase-BVmeR0DU.js";import"./useTheme-DhvS6su6.js";import"./index-RpVCEKlg.js";import"./index-DtqEcUQL.js";import"./api-DGCm_Bs0.js";import"./index-l2geJXoj.js";const X=({user:t,handleDelete:y,handleImageError:r})=>{var o,f,p,i,x,l,u,c,n,b,j,g;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-400 via-pink-500 to-purple-600 dark:from-indigo-600 dark:via-purple-600 dark:to-blue-700 opacity-90"}),e.jsxs("div",{className:"relative pt-4 pb-14 px-6 flex justify-between items-start",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:t.name}),e.jsx("div",{className:"relative",children:!t.user_role.isAdmin&&e.jsx("button",{onClick:()=>y(t.id),className:"p-2 text-white hover:bg-red-50 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(R,{})})})]}),e.jsx("div",{className:"absolute -bottom-12 left-6",children:e.jsx("div",{className:"h-24 w-24 rounded-xl shadow-md overflow-hidden border-4 border-white dark:border-gray-800",children:(o=t.profile)!=null&&o.photo||(f=t.technicien)!=null&&f.photo||(p=t.partenaire)!=null&&p.logo?e.jsx("img",{src:((i=t.profile)==null?void 0:i.photo)||((x=t.technicien)==null?void 0:x.photo)||((l=t.partenaire)==null?void 0:l.logo),alt:`${t.name}'s profile`,className:"h-full w-full object-cover bg-gray-100 dark:bg-gray-900",onError:r}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-gray-100 to-gray-300 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center",children:e.jsx(W,{className:"text-4xl text-gray-400 dark:text-gray-300"})})})})]}),e.jsxs("div",{className:"pt-14 px-6 pb-6",children:[e.jsx("div",{className:"mt-2 mb-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-full bg-gradient-to-r from-green-400 to-blue-500 text-white",children:t.user_role.name})}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:t.email})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(G,{className:"text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((u=t.technicien)==null?void 0:u.contact)||((c=t.profile)==null?void 0:c.contact)||((n=t.partenaire)==null?void 0:n.telephone)})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(J,{className:"text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:((b=t.technicien)==null?void 0:b.adress)||((j=t.profile)==null?void 0:j.adress)||((g=t.partenaire)==null?void 0:g.adresse)})]})]})]})]},t.id)},Y=({open:t,closeForm:y})=>{const[r,o]=d.useState({}),[f,p]=d.useState(!1),{data:i,setData:x,errors:l,reset:u,setErrors:c}=M({name:"",email:"",contact:"",adress:""}),n=a=>{y(a),b()},b=()=>{u(),o({}),p(!1)},j=(a,C)=>{const h={};return a.name||(h.name="Le nom est obligatoire"),a.email||(h.email="L'email est obligatoire"),a.contact||(h.contact="Le contact est obligatoire"),a.adress||(h.adress="L'adresse est obligatoire"),C(h),Object.keys(h).length===0},g=()=>{j(i,o)&&(p(!0),_.post("create/admin",i).then(a=>{p(!1),n(a.data.message)}).catch(a=>{p(!1),a.response&&a.response.data&&o(a.response.data.errors||{})}))};return e.jsxs(Q,{show:t,maxWidth:"xl",onClose:()=>n(""),closeable:!1,children:[e.jsx("div",{className:"text-center font-semibold text-2xl",children:"Créer un Administrateur"}),e.jsxs("form",{className:"w-full my-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"name",value:"Nom"}),e.jsx(v,{id:"name",name:"name",value:i.name,className:"mt-1 block w-full",autoComplete:"name",isFocused:!0,onChange:a=>x("name",a.target.value),required:!0,onFocus:()=>o({...r,name:""})}),e.jsx(N,{message:r.name||l.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"email",value:"Email"}),e.jsx(v,{id:"email",name:"email",value:i.email,className:"mt-1 block w-full",autoComplete:"email",onChange:a=>x("email",a.target.value),required:!0,onFocus:()=>o({...r,email:""})}),e.jsx(N,{message:r.email||l.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"contact",value:"Contact"}),e.jsx(v,{id:"contact",name:"contact",value:i.contact,className:"mt-1 block w-full",autoComplete:"contact",type:"number",onChange:a=>x("contact",a.target.value),required:!0,onFocus:()=>o({...r,contact:""})}),e.jsx(N,{message:r.contact||l.contact,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"adress",value:"adress"}),e.jsx(v,{id:"adress",name:"adress",value:i.adress,className:"mt-1 block w-full",autoComplete:"adress",onChange:a=>x("adress",a.target.value),required:!0,onFocus:()=>o({...r,adress:""})}),e.jsx(N,{message:r.adress||l.adress,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 px-1",children:[e.jsx("button",{type:"button",className:"rounded-md py-1 px-4 text-red-500 bg-red-400/10",onClick:()=>n(""),children:"Fermer"}),e.jsx("button",{type:"submit",className:`disabled:cursor-not-allowed rounded-md py-1 px-4 bg-blue-500 text-white ${f&&"opacity-25"}`,disabled:f,onClick:g,children:"Enregistrer"})]})]})},fe=()=>{const[t,y]=d.useState([]),[r,o]=d.useState([]),[f,p]=d.useState(!0),[i,x]=d.useState(""),[l,u]=d.useState({open:!1,message:"",id:0}),[c,n]=d.useState({open:!1,message:"",type:"success"}),[b,j]=d.useState(!1),g=async()=>{try{const s=await z();y(s),o(s)}catch(s){console.error("Failed to fetch users:",s)}finally{p(!1)}};d.useEffect(()=>{g()},[]);const a=s=>{x(s);const q=t.filter(m=>{var L,k,F,S,E,U,A;return m.name.toLowerCase().includes(s.toLowerCase())||m.email.toLowerCase().includes(s.toLowerCase())||((L=m.technicien)==null?void 0:L.contact.toLowerCase().includes(s.toLowerCase()))||((k=m.technicien)==null?void 0:k.adress.toLowerCase().includes(s.toLowerCase()))||m.user_role.name.toLowerCase().includes(s.toLowerCase())||((F=m.profile)==null?void 0:F.adress.toLowerCase().includes(s.toLowerCase()))||((S=m.profile)==null?void 0:S.contact.toLowerCase().includes(s.toLowerCase()))||((E=m.partenaire)==null?void 0:E.telephone.toLowerCase().includes(s.toLowerCase()))||((U=m.partenaire)==null?void 0:U.adresse.toLowerCase().includes(s.toLowerCase()))||((A=m.partenaire)==null?void 0:A.site_web.toLowerCase().includes(s.toLowerCase()))});o(q)},C=s=>{s&&n({open:!0,message:s,type:"success"}),j(!1),g()},h=s=>{s.target.onerror=null,s.target.src="/path/to/default-avatar.png"},I=s=>{u({open:!0,message:"Voulez-vous vraiment supprimer cet utilisateur ?",id:s})},D=async()=>{const s=await H(l.id);s.success?(n({...c,open:!0,message:"Utilisateur supprimé avec succès",type:"success"}),u({...l,open:!1}),g()):n({...c,open:!0,message:s.message,type:"error"})};return e.jsxs(T,{children:[e.jsx(P,{title:"Users"}),e.jsx(V,{title:"Liste des utilisateurs",onSearch:a,search:i,handleClick:()=>j(!0)}),e.jsx(O,{open:l.open,message:l.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",accept:D,close:()=>u({...l,open:!1,id:0})}),e.jsx(Y,{closeForm:C,open:b}),e.jsx($,{message:c.message,type:c.type,duration:3e3,position:"top-right",show:c.open,onClose:()=>n({...c,message:"",open:!1})}),e.jsx("div",{className:"py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:f?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):r.length===0?e.jsx(K,{nom:"utilisateur",search:i}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.map(s=>e.jsx(X,{user:s,handleDelete:I,handleImageError:h},s.id))})})})]})};export{fe as default};
