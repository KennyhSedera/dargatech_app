import{r as a,q as Q,j as n,$ as U,m as k}from"./app-clMDA67x.js";import{C as X}from"./ConfirmDialog-CsgL29Xv.js";import{D as Y}from"./DataTable-7O04XAw5.js";import{E as Z}from"./EmptyState-BbgHA4a2.js";import{H as ee}from"./HeaderPage-i7nD91uA.js";import{F as te}from"./FormulaireMaintenance-D1qVMedN.js";import{F as ne}from"./FormulaireRapportMaintenance-BhcIxlyY.js";import{S as ae}from"./Snackbar-jsmHZbT6.js";import{f as oe,q as se}from"./constant-BMpCbHf-.js";import{A as re,R as ie}from"./AuthenticatedLayout-CZO87fiy.js";import{g as le,d as de}from"./maintenanceService-CRbeSvwd.js";import{G as pe}from"./index-DmNBKA1e.js";import{T as me,a as ce}from"./index-BVhdIJJD.js";import"./Modal-DL7avN2s.js";import"./transition-Ca4-pGYK.js";import"./index-UB8-a8rO.js";import"./iconBase-DgEeITKv.js";import"./TextInput-Dc4aDVti.js";import"./createLucideIcon-TXl_3ZLp.js";import"./InputLabel-BtJ_EI82.js";import"./installationService-G07dF1Ox.js";import"./api-vU-7hkGc.js";import"./InputAutocomplete -BwK5b4kU.js";import"./SelectInput-tSz_y1-7.js";import"./validateForm-CtIdfQW8.js";import"./TextArea-5LFm12Ib.js";import"./InputImage-B_SP6LH_.js";import"./useTheme-BIKk6cg-.js";const Ge=()=>{const[f,N]=a.useState(""),[h,R]=a.useState(0),[L,u]=a.useState(!1),[P,g]=a.useState(!1),[T,_]=a.useState({}),[F,v]=a.useState({}),[I,x]=a.useState(1),[y,M]=a.useState([]),[C,j]=a.useState([]),[$,w]=a.useState(!0),[r,b]=a.useState({open:!1,message:"",id:0}),[s,m]=a.useState({open:!1,message:"",type:"success"}),i=Q().props.auth.user,[E,A]=a.useState(10),q=[{key:"id",label:"ID",sortable:!0},{key:"code_installation",label:"Installation",sortable:!0},{key:"nom",label:"Client",sortable:!0},{key:"type_intervention",label:"Type"},{key:"description_probleme",label:"Problème",customRender:e=>n.jsxs("div",{className:"relative max-w-md group",children:[n.jsx("span",{className:"line-clamp-2",children:e}),n.jsx("div",{className:"absolute bottom-0 left-0 z-50 hidden max-w-md p-2 mt-2 text-sm text-gray-800 bg-white border border-gray-300 rounded shadow-md group-hover:block",children:e})]})},{key:"date_intervention",label:"Date d'intervenir",sortable:!0},{key:"status_intervention",label:"Statuts",customRender:e=>n.jsx("span",{className:`px-2 py-1 rounded-full text-white flex text-nowrap ${e==="terminée"?"bg-green-500/50":e==="en attente"?"bg-blue-500/50":"bg-red-500/50"}`,children:e})},{key:"status_intervention",label:"Rapport",sortable:!0,customRender:(e,o)=>{var t,l,d;return n.jsx("span",{onClick:()=>{var p;return e==="terminée"?k.visit("/rapport",{data:{intervention_id:o.id}}):((p=i.user_role)==null?void 0:p.name)==="partenaire"?null:H(o)},className:`px-2 py-1 rounded-full flex text-nowrap ${((t=i.user_role)==null?void 0:t.name)==="partenaire"&&e!=="terminée"?"cursor-default":"cursor-pointer"} ${e==="terminée"?"text-green-500":((l=i.user_role)==null?void 0:l.name)==="partenaire"?"text-gray-300":"text-blue-500"}`,children:e==="terminée"?"Consulter":((d=i.user_role)==null?void 0:d.name)==="partenaire"?"En attente":"Ajouter"})}},{key:"created_via",label:"Via",customRender:e=>n.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-white",children:e==="web"?n.jsx(ce,{}):n.jsx(ie,{className:"text-blue-400"})})}],O=[{label:n.jsx(me,{className:"text-lg"}),color:"text-blue-500",hoverColor:"text-blue-600",handler:e=>K(e)},{label:n.jsx(pe,{className:"text-base"}),color:"text-red-500",hoverColor:"text-red-600",handler:e=>W(e)}],G=()=>{u(!0)},H=e=>{var o;((o=i.user_role)==null?void 0:o.name)==="partenaire"?k.visit("/rapport",{data:{intervention_id:e.id}}):(g(!0),v(e))},c=async()=>{w(!0);const{data:e}=await le(),o=e.map(t=>({id:t.id,installation_id:t.installation_id,code_installation:t.installation.code_installation,nom:t.installation.client.nom+" "+t.installation.client.prenom,idclient:t.installation.client.id,type_intervention:t.type_intervention,description_probleme:t.description_probleme,status_intervention:t.status_intervention,date_intervention:oe(t.date_intervention),created_via:t.created_via}));M(o),j(o),w(!1)};a.useEffect(()=>{c()},[]);const z=e=>{N(e),x(1);const o=y.filter(t=>{var l,d,p,S,D;return((l=t==null?void 0:t.nom)==null?void 0:l.toLowerCase().includes(e.toLowerCase()))||((d=t==null?void 0:t.type_intervention)==null?void 0:d.toLowerCase().includes(e.toLowerCase()))||((p=t==null?void 0:t.description_probleme)==null?void 0:p.toLowerCase().includes(e.toLowerCase()))||((S=t==null?void 0:t.date_intervention)==null?void 0:S.toString().toLowerCase().includes(e.toLowerCase()))||((D=t==null?void 0:t.code_installation)==null?void 0:D.toLowerCase().includes(e.toLowerCase()))});j(o)},B=e=>{c(),e&&m({...s,message:e,open:!0}),_({})},V=e=>{c(),e&&m({...s,message:e,open:!0}),v({})},W=e=>{b({open:!0,message:`Êtes-vous sûr de vouloir supprimer l'intervention du ${e.nom} le ${e.date_intervention} ?`,id:e.id})},J=async()=>{const{message:e}=await de(r.id);m({...s,message:e,open:!0}),b({...r,open:!1,id:0}),c(),x(1)},K=e=>{const o=e.date_intervention?e.date_intervention:"Invalid date";_({...e,date_intervention:se(o)}),u(!0)};return n.jsxs(re,{setId:R,children:[n.jsx(U,{title:"Maintenance"}),n.jsx(ee,{search:f,onSearch:z,title:`Liste des interventions ( Total: ${y.length} )`,handleClick:G}),n.jsx(ae,{message:s.message,type:s.type,duration:3e3,position:"top-right",show:s.open,onClose:()=>m({...s,message:"",open:!1})}),n.jsx(X,{open:r.open,message:r.message,btnAcceptName:"Supprimer",title:"Suppression",btnAcceptColor:"bg-red-500 text-white",close:()=>b({...r,open:!1}),accept:J}),n.jsx(te,{open:L,setOpen:u,dataModify:T,onCloseFormulaire:B,idTechnicien:h}),n.jsx(ne,{open:P,setOpen:g,dataModify:F,onCloseFormulaire:V,idTechnicien:h}),$?n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"w-12 h-12 border-t-2 border-b-2 border-blue-500 rounded-full animate-spin"})}):n.jsx("div",{children:C.length>0?n.jsx(Y,{headers:q,rows:C,itemsPerPage:E,actions:O,className:"mt-4",currentPage:I,onPageChange:x,masqueColumns:["client_id"],onItemsPerPageChange:e=>A(e)}):n.jsx(Z,{nom:"intervention",search:f})})]})};export{Ge as default};
