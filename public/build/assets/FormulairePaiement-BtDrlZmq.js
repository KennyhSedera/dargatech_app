import{r as b,j as e,e as L,v as X,$ as B}from"./app-BCTpGmsD.js";import{I as c}from"./InputLabel-CvD6hZot.js";import{T as _,I as v}from"./TextInput-CBe1B35h.js";import{u as Q}from"./useTheme-DZz2seck.js";import{D as K}from"./DangerButton-BqGKzE_v.js";import{g as V}from"./TypePaiementService-DXL0jKMw.js";import{b as z}from"./clientService-Oila0jpe.js";import{P as J}from"./PrimaryButton-CguJ7lED.js";import{T as W}from"./TextArea-D4PJoGv7.js";import{S as $}from"./SelectInput-Co5NIkm7.js";import{I as Z}from"./InputAutocomplete -ACh-68No.js";import{g as E,a as ee,u as te,c as ae}from"./PaiementService-CBmAqEV7.js";import{S as ne}from"./Snackbar-Cwn-wBjx.js";import"./html2pdf-TMLHteKl.js";import{F as se}from"./FichierPaiementPdf-DGYUCaLK.js";import{r as le,h as O}from"./constant-CLva_kaP.js";import"./createLucideIcon-DvDEodQ2.js";import"./api-CVEOtcPz.js";import"./iconBase-D9bOESUt.js";const re=({data:o,setData:r})=>{const[s,l]=b.useState([{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}]);b.useEffect(()=>{o.produits&&o.produits.length>0&&l(o.produits)},[o.produits]);const a=u=>{const t=parseFloat(u.quantite)||0,m=parseFloat(u.prix_unitaire)||0,j=parseFloat(u.tva)||0,T=t*m,N=T*(1+j/100);return{total_ht:T,total_ttc:N}},n=(u,t,m)=>{const j=[...s];if(j[u][t]=m,["quantite","prix_unitaire","tva"].includes(t)){const{total_ht:N,total_ttc:C}=a(j[u]);j[u].total_ht=N,j[u].total_ttc=C}l(j);const T={produits:j,description:o.description||"",montant_paye:h(j).totalTTCGlobal.toFixed(2)};r(N=>({...N,...T}))},h=u=>{const t=N=>{const C=parseFloat(N);return isNaN(C)?0:C},m=u.reduce((N,C)=>N+t(C.total_ht),0),j=u.reduce((N,C)=>N+t(C.total_ttc),0),T=u.reduce((N,C)=>{const S=t(C.tva),D=t(C.total_ht);return N+D*S/100},0);return{totalHTGlobal:parseFloat(m.toFixed(2)),totalTTCGlobal:parseFloat(j.toFixed(2)),totalTVAGlobal:parseFloat(T.toFixed(2))}},{totalHTGlobal:x,totalTTCGlobal:P,totalTVAGlobal:w}=h(s),F=()=>{const u=[...s,{designation:"",reference:"",quantite:1,unite:"",tva:0,prix_unitaire:0,total_ht:0,total_ttc:0}];l(u),r(t=>({...t,produits:u}))},i=u=>{const t=s.filter((j,T)=>T!==u);l(t);const m=h(t);r(j=>({...j,produits:t,montant_paye:m.totalTTCGlobal.toFixed(2)}))},y=u=>{const t=u.target.value;r(m=>({...m,description:t}))},k=u=>{const t=parseFloat(u);return isNaN(t)?"0.00":t.toFixed(2)};return e.jsxs("div",{children:[s.map((u,t)=>e.jsxs("div",{className:"grid grid-cols-11 gap-3 my-4 relative",children:[t===0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-4",children:e.jsx(c,{htmlFor:`designation-${t}`,value:"Nom"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`reference-${t}`,value:"Réf"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`quantite-${t}`,value:"Qté"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`unite-${t}`,value:"Unité"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`tva-${t}`,value:"TVA%"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`prix_unitaire-${t}`,value:"PU TTC"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`total_ht-${t}`,value:"Total HT"})}),e.jsx("div",{children:e.jsx(c,{htmlFor:`total_ttc-${t}`,value:"Total TTC"})})]}),e.jsx("div",{className:"col-span-4",children:e.jsx(_,{id:`designation-${t}`,name:"designation",value:u.designation,className:"block w-full mt-1",autoComplete:"designation",onChange:m=>n(t,"designation",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(_,{id:`reference-${t}`,name:"reference",value:u.reference,className:"block w-full mt-1",autoComplete:"reference",onChange:m=>n(t,"reference",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(_,{id:`quantite-${t}`,name:"quantite",value:u.quantite,className:"block w-full mt-1",autoComplete:"quantite",onChange:m=>n(t,"quantite",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(_,{id:`unite-${t}`,name:"unite",value:u.unite,className:"block w-full mt-1",autoComplete:"unite",onChange:m=>n(t,"unite",m.target.value),required:!0})}),e.jsx("div",{children:e.jsx(_,{id:`tva-${t}`,name:"tva",value:u.tva,className:"block w-full mt-1",autoComplete:"tva",onChange:m=>n(t,"tva",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(_,{id:`prix_unitaire-${t}`,name:"prix_unitaire",value:u.prix_unitaire,className:"block w-full mt-1",autoComplete:"prix_unitaire",onChange:m=>n(t,"prix_unitaire",m.target.value),required:!0,type:"number",min:0})}),e.jsx("div",{children:e.jsx(_,{id:`total_ht-${t}`,name:"total_ht",value:k(u.total_ht),className:"block w-full mt-1",autoComplete:"total_ht",readOnly:!0})}),e.jsx("div",{children:e.jsx(_,{id:`total_ttc-${t}`,name:"total_ttc",value:k(u.total_ttc),className:"block w-full mt-1",autoComplete:"total_ttc",readOnly:!0})}),t>0&&e.jsx("button",{className:"bg-red-500 absolute -right-2 -top-2 w-5 h-5 rounded-full text-xs",onClick:()=>i(t),children:"X"})]},t)),e.jsx(W,{name:"description",value:o.description||"",placeholder:"Description",onChange:y,rows:"2",className:"rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:focus:border-indigo-600 dark:focus:ring-indigo-600 w-full"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-1 mt-3 rounded",onClick:F,children:"+ Produit"}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total HT"}),e.jsx("td",{className:"pl-8",children:x.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]}),e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total TVA"}),e.jsx("td",{className:"pl-8",children:w.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]}),e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"pr-10",children:"Total TTC"}),e.jsx("td",{className:"pl-8",children:P.toFixed(2)}),e.jsx("td",{className:"pl-8",children:"XOF"})]})]})})})]})},oe=({data:o,setData:r,validationErrors:s,errors:l,setValidationErrors:a})=>e.jsxs("div",{className:"grid grid-cols-6 gap-2 mt-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",value:"Type"}),e.jsx($,{id:"type",name:"type",value:o.type,className:"block w-full mt-1",autoComplete:"type",onChange:n=>r("type",n.target.value),required:!0,children:e.jsx("option",{value:"recus",children:"Reçus"})}),e.jsx(v,{message:s.type||l.type,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"numero",value:"N*"}),e.jsx(_,{id:"numero",name:"numero",value:o.numero,className:"block w-full mt-1",autoComplete:"numero",onChange:n=>r("numero",n.target.value),required:!0,disabled:!0,onFocus:()=>a({...s,numero:""})}),e.jsx(v,{message:s.numero||l.numero,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"installation_id",value:"Date de création"}),e.jsx(_,{id:"date_creation",name:"date_creation",value:o.date_creation,className:"block w-full mt-1",autoComplete:"date_creation",onChange:n=>r("date_creation",n.target.value),type:"date",required:!0,onFocus:()=>a({...s,date_creation:""})}),e.jsx(v,{message:s.date_creation||l.date_creation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"lieu_creation",value:"Lieu de création"}),e.jsx(_,{id:"lieu_creation",name:"lieu_creation",value:o.lieu_creation,className:"block w-full mt-1",autoComplete:"lieu_creation",onChange:n=>r("lieu_creation",n.target.value),required:!0,onFocus:()=>a({...s,lieu_creation:""})}),e.jsx(v,{message:s.lieu_creation||l.lieu_creation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date_additionnel",value:"Type d'intervention"}),e.jsx($,{id:"date_additionnel",type:"date_additionnel",name:"date_additionnel",value:o.date_additionnel,className:"block w-full mt-1",autoComplete:"date_additionnel",onChange:n=>r("date_additionnel",n.target.value),required:!0,children:e.jsx("option",{value:"Date de vente",children:"Date de vente"})}),e.jsx(v,{message:l.date_additionnel,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date",value:"*"}),e.jsx(_,{id:"date",name:"date",value:o.date,className:"block w-full mt-1",autoComplete:"date",onChange:n=>r("date",n.target.value),required:!0,type:"date",onFocus:()=>a({...s,date:""})})]})]}),ie=({clients:o,data:r,setData:s,errors:l,validationErrors:a,setValidationErrors:n,handleSelect:h})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Maraicheur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"civilite_acheteur",value:"Civilité"}),e.jsxs($,{id:"civilite_acheteur",type:"civilite_acheteur",name:"civilite_acheteur",value:r.civilite_acheteur,className:"block w-full mt-1",autoComplete:"civilite_acheteur",onChange:x=>s("civilite_acheteur",x.target.value),required:!0,children:[e.jsx("option",{value:"préventive",children:"Mr."}),e.jsx("option",{value:"curative",children:"Mme."})]}),e.jsx(v,{message:l.civilite_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{htmlFor:"prenom_acheteur",value:"Prénom"}),e.jsx(Z,{data:o,className:"block w-full mt-1",onSelect:h,defaultValue:r.client_id,onFocus:()=>n({...a,client_id:""})}),e.jsx(v,{message:a.prenom_acheteur||l.prenom_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(c,{htmlFor:"nom_acheteur",value:"Nom de famille"}),e.jsx(_,{id:"nom_acheteur",name:"nom_acheteur",value:r.nom_acheteur,className:"block w-full mt-1",autoComplete:"nom_acheteur",onChange:x=>s("nom_acheteur",x.target.value),required:!0,onFocus:()=>n({...a,nom_acheteur:""})}),e.jsx(v,{message:a.nom_acheteur||l.nom_acheteur,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"num_rue_acheteur",value:"Village ou Quartier"}),e.jsx(_,{id:"num_rue_acheteur",name:"num_rue_acheteur",value:r.num_rue_acheteur,className:"block w-full mt-1",autoComplete:"num_rue_acheteur",onChange:x=>s("num_rue_acheteur",x.target.value),required:!0,onFocus:()=>n({...a,num_rue_acheteur:""})}),e.jsx(v,{message:a.num_rue_acheteur||l.num_rue_acheteur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"ville_acheteur",value:"Ville"}),e.jsx(_,{id:"ville_acheteur",name:"ville_acheteur",value:r.ville_acheteur,className:"block w-full mt-1",autoComplete:"ville_acheteur",onChange:x=>s("ville_acheteur",x.target.value),required:!0,onFocus:()=>n({...a,ville_acheteur:""})}),e.jsx(v,{message:a.ville_acheteur||l.ville_acheteur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"pays_acheteur",value:"Pays"}),e.jsx(_,{id:"pays_acheteur",name:"pays_acheteur",value:r.pays_acheteur,className:"block w-full mt-1",autoComplete:"pays_acheteur",onChange:x=>s("pays_acheteur",x.target.value),required:!0,onFocus:()=>n({...a,pays_acheteur:""})}),e.jsx(v,{message:a.pays_acheteur||l.pays_acheteur,className:"mt-2"})]})]})]})]}),ue=({data:o,setData:r,errors:s,validationErrors:l,setValidationErrors:a})=>e.jsxs("div",{children:[e.jsx("div",{className:"my-4 font-bold text-lg",children:"Vendeur"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_vendeurs",value:"Nom"}),e.jsx(_,{id:"nom_vendeurs",name:"nom_vendeurs",value:o.nom_vendeurs,className:"block w-full mt-1",autoComplete:"nom_vendeurs",onChange:n=>r("nom_vendeurs",n.target.value),required:!0,onFocus:()=>a({...l,nom_vendeurs:""})}),e.jsx(v,{message:l.nom_vendeurs||s.nom_vendeurs,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx("div",{className:"col-span-1",children:e.jsx($,{id:"select1",type:"select1",name:"select1",value:o.select1,className:"block w-full mt-1",autoComplete:"select1",onChange:n=>r("select1",n.target.value),required:!0,children:e.jsx("option",{value:"préventive",children:"Numéro TVA"})})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(_,{id:"num_tva",name:"num_tva",value:o.num_tva,className:"block w-full mt-1",autoComplete:"num_tva",onChange:n=>r("num_tva",n.target.value),required:!0,onFocus:()=>a({...l,num_tva:""})}),e.jsx(v,{message:l.num_tva||s.num_tva,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_rue_vendeur",value:"Village ou Quartier"}),e.jsx(_,{id:"nom_rue_vendeur",name:"nom_rue_vendeur",value:o.nom_rue_vendeur,className:"block w-full mt-1",autoComplete:"nom_rue_vendeur",onChange:n=>r("nom_rue_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,nom_rue_vendeur:""})}),e.jsx(v,{message:l.nom_rue_vendeur||s.nom_rue_vendeur,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"ville_vendeur",value:"Ville"}),e.jsx(_,{id:"ville_vendeur",name:"ville_vendeur",value:o.ville_vendeur,className:"block w-full mt-1",autoComplete:"ville_vendeur",onChange:n=>r("ville_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,ville_vendeur:""})}),e.jsx(v,{message:l.ville_vendeur||s.ville_vendeur,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"pays_vendeur",value:"Pays"}),e.jsx(_,{id:"pays_vendeur",name:"pays_vendeur",value:o.pays_vendeur,className:"block w-full mt-1",autoComplete:"pays_vendeur",onChange:n=>r("pays_vendeur",n.target.value),required:!0,onFocus:()=>a({...l,pays_vendeur:""})}),e.jsx(v,{message:l.pays_vendeur||s.pays_vendeur,className:"mt-2"})]})]})]})]}),ce=({data:o,errors:r,setData:s,setValidationErrors:l,validationErrors:a,typePaiement:n})=>e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"mode_paiement",value:"Mode de règlement"}),e.jsx($,{id:"mode_paiement",name:"mode_paiement",value:o.mode_paiement,className:"block w-full mt-1",autoComplete:"mode_paiement",onChange:h=>s("mode_paiement",h.target.value),required:!0,children:n.map(h=>e.jsx("option",{value:h.nom,children:h.nom},h.id))}),e.jsx(v,{message:a.mode_paiement||r.mode_paiement,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"date_echeance",value:"Date d'échéance"}),e.jsx(_,{id:"date_echeance",name:"date_echeance",value:o.date_echeance,className:"block w-full mt-1",autoComplete:"date_echeance",onChange:h=>s("date_echeance",h.target.value),required:!0,type:"date",onFocus:()=>l({...a,date_echeance:""})}),e.jsx(v,{message:a.date_echeance||r.date_echeance,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"nom_vendeur",value:"Nom du vendeur"}),e.jsx(_,{id:"nom_vendeur",name:"nom_vendeur",value:o.nom_vendeur,className:"block w-full mt-1",autoComplete:"nom_vendeur",onChange:h=>s("nom_vendeur",h.target.value),required:!0,onFocus:()=>l({...a,nom_vendeur:""})}),e.jsx(v,{message:a.nom_vendeur||r.nom_vendeur,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"etat_paiment",value:"Etat"}),e.jsx($,{id:"etat_paiment",type:"etat_paiment",name:"etat_paiment",value:o.etat_paiment,className:"block w-full mt-1",autoComplete:"etat_paiment",onChange:h=>s("etat_paiment",h.target.value),required:!0,children:e.jsx("option",{value:"Payé",children:"Payé"})}),e.jsx(v,{message:a.etat_paiment||r.etat_paiment,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"montant_paye",value:"Montant payé"}),e.jsx(_,{id:"montant_paye",name:"montant_paye",value:o.montant_paye,className:"block w-full mt-1",autoComplete:"montant_paye",readOnly:!0,onChange:h=>s("montant_paye",h.target.value),required:!0,onFocus:()=>l({...a,montant_paye:""})}),e.jsx(v,{message:a.montant_paye||r.montant_paye,className:"mt-2"})]})]})]}),me=async(o,r)=>{var s,l;try{const a=await L.post("/api/paiement/generate-and-send-pdf",{email:r,data:o});return a.data.success&&alert(a.data.message),a.data}catch(a){throw console.error("Erreur lors de l'envoi du PDF:",a),alert("Erreur lors de l'envoi du PDF: "+(((l=(s=a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message)),a}};function de(o){const r=/(\d{2}\/\d{2}\/\d{4})/g,s=o.match(r);if(!s||s.length<2)throw new Error("Could not find two valid dates in the format DD/MM/YYYY");const l=s[0],a=s[1],n=w=>{const[F,i,y]=w.split("/");return new Date(`${i}/${F}/${y}`)},h=n(l),x=n(a),P=w=>({object:w,iso:w.toISOString(),localeFormat:w.toLocaleDateString(),original:`${w.getFullYear()}-${(w.getMonth()+1).toString().padStart(2,"0")}-${w.getDate().toString().padStart(2,"0")}`});return{startDate:P(h),endDate:P(x),durationDays:Math.floor((x-h)/(1e3*60*60*24))}}const De=()=>{const{theme:o,setTheme:r}=Q(),s=b.useRef(null),[l,a]=b.useState(!0),[n,h]=b.useState(null),[x,P]=b.useState(!1),F=new URLSearchParams(window.location.search).get("id"),{data:i,setData:y,errors:k,reset:u}=X({type:"recu",numero:"RECU_N_0001",date_creation:new Date().toISOString().split("T")[0],date:new Date().toISOString().split("T")[0],lieu_creation:"Atakpamé",date_additionnel:"Date de vente",periode_couverte:"",nom_vendeur:"Darga",nom_vendeurs:"DARGATECH TOGO",select1:"Numéro TVA",num_tva:"",nom_rue_vendeur:"Kara",ville_vendeur:"Kara",pays_vendeur:"Togo",civilite_acheteur:"Mr.",prenom_acheteur:"",nom_acheteur:"",num_rue_acheteur:"",ville_acheteur:"",pays_acheteur:"",mode_paiement:"Espèce",date_echeance:new Date().toISOString().split("T")[0],date_paiement:new Date().toISOString().split("T")[0],etat_paiment:"Payé",montant_paye:"",objet:"",description:"",produits:[],client_id:""}),[t,m]=b.useState({}),[j,T]=b.useState([]),[N,C]=b.useState([]),[S,D]=b.useState({open:!1,message:"",type:"success"}),[G,M]=b.useState(""),A=async()=>{var f;try{const[{clients:g},d]=await Promise.all([z(),V()]);T(g==null?void 0:g.map(p=>({id:p.id,nom:p.prenom,nom_famille:p.nom,ville:p.localisation,pays:"Togo",village:p.localisation,quartier:p.localisation,email:p.email,genre:p.genre,telephone:p.telephone,localisation:p.localisation}))),C((f=d.type)==null?void 0:f.map(p=>({id:p.id,nom:p.name})))}catch(g){console.error("Error fetching payment types:",g)}},R=async f=>{try{const g=await E(f);if(g){const d=g,p=j.find(q=>q.id===d.client_id),I=de(d.periode_couverte);i.periode_couverte=I.startDate.original+" au "+I.endDate.original,p&&(y({...i,numero:d.numero,nom_acheteur:p.nom_famille,prenom_acheteur:p.nom,civilite_acheteur:p.genre==="Homme"?"Mr.":"Mme.",ville_acheteur:p.ville,pays_acheteur:p.pays,num_rue_acheteur:p.village||p.quartier,client_id:p.id,objet:d.observation,description:d.description,mode_paiement:d.mode_paiement,date_echeance:d.echeance,statut_paiement:d.statut_paiement,produits:d.produits.map(q=>({...q,designation:q.designation,prix_unitaire:q.prix_unitaire,quantite:q.quantite,unite:q.unite})),montant_paye:parseFloat(d.montant).toFixed(2),date_creation:d.date_creation||I.startDate.original,date:d.date||I.endDate.original,lieu_creation:d.lieu_creation,date_additionnel:d.date_additionnel,nom_vendeur:d.nom_vendeur,nom_vendeurs:d.nom_vendeurs,select1:d.select1,num_tva:d.num_tva,nom_rue_vendeur:d.nom_rue_vendeur,ville_vendeur:d.ville_vendeur,pays_vendeur:d.pays_vendeur}),M(p.email)),P(!0)}}catch(g){console.error("Error fetching payment data:",g),D({open:!0,message:"Erreur lors du chargement du paiement",type:"error"})}};b.useEffect(()=>{r(o||"light"),A()},[o]),b.useEffect(()=>{j.length>0&&F&&R(F)},[j,F]);const Y=async()=>{const{data:f}=await ee();f&&y("numero",le(f.numero))};b.useEffect(()=>{F||Y()},[F]);const H=f=>{const g=j.find(d=>d.id===f.id);g&&(y("client_id",g.id),y("nom_acheteur",g.nom_famille),y("prenom_acheteur",g.nom),y("ville_acheteur",g.ville),y("pays_acheteur",g.pays),y("num_rue_acheteur",g.village||g.quartier),y("civilite_acheteur",g.genre==="Homme"?"Mr.":"Mme."),M(g.email))},U=async()=>{i.periode_couverte=O(i.date_creation).format("DD/MM/YYYY")+" au "+O(i.date).format("DD/MM/YYYY"),i.date_paiement=i.date_paiement?new Date(i.date_paiement).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],i.observation=i.objet,i.echeance=i.date_echeance,i.statut_paiement=i.etat_paiment,i.montant_paye=i.montant_paye||"0",i.montant=i.montant_paye||"0",x&&F&&(i.id=F);try{let f;x?f=await te(F,i):f=await ae(i),D({open:!0,message:f.message,type:f.success?"success":"error"}),f.success&&(setTimeout(()=>{u(),window.history.back()},3e3),me(i,G))}catch(f){console.error("Error submitting payment:",f),D({open:!0,message:"Erreur lors de l'enregistrement du paiement",type:"error"})}};return e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-900 dark:text-white p-10",children:[e.jsx(B,{title:x?"Modifier Paiement":"Formulaire Paiement"}),e.jsx(ne,{message:S.message,type:S.type,duration:3e3,position:"top-right",show:S.open,onClose:()=>D({...S,message:"",open:!1})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg",children:[e.jsx(K,{onClick:()=>window.history.back(),className:"absolute capitalize",children:"Retour"}),e.jsx("div",{className:"text-center text-2xl font-bold",children:x?"Modifier Paiement":"Formulaire de Paiement"}),e.jsx(oe,{data:i,errors:k,setData:y,validationErrors:t,setValidationErrors:m}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsx(ue,{data:i,errors:k,setData:y,setValidationErrors:m,validationErrors:t}),e.jsx(ie,{clients:j,data:i,errors:k,handleSelect:H,setData:y,setValidationErrors:m,validationErrors:t})]}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsx("div",{className:"my-10 grid grid-cols-2",children:e.jsxs("div",{children:[e.jsx(c,{htmlFor:"objet",value:"Objet"}),e.jsx(_,{id:"objet",name:"objet",value:i.objet,className:"block w-full mt-1",autoComplete:"objet",onChange:f=>y("objet",f.target.value),required:!0,onFocus:()=>m({...t,objet:""})}),e.jsx(v,{message:t.objet||k.objet,className:"mt-2"})]})}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex items-center justify-start",children:e.jsx("span",{className:"font-bold text-lg",children:"Désignations"})}),e.jsx(re,{data:i,setData:y})]}),e.jsx("div",{className:"border-b w-full my-6 opacity-35 "}),e.jsx(ce,{data:i,errors:k,setData:y,setValidationErrors:m,typePaiement:N,validationErrors:t}),e.jsx("div",{className:"mt-8 flex items-center justify-end",children:e.jsx(J,{className:"px-10",onClick:U,children:x?"Mettre à jour":"Enregistrer"})})]}),e.jsx("div",{className:"hidden",children:l&&n&&e.jsx("div",{ref:s,children:e.jsx(se,{data:n})})})]})};export{De as default};
